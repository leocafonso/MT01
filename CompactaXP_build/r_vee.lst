* RX FAMILY ASSEMBLER V2.03.00.01 [24 Oct 2014] *  SOURCE LIST  Tue Feb 28 14:07:24 2017

LOC.     OBJ.              0XMDA SOURCE STATEMENT

                                 ;RX Family C/C++ Compiler (V2.03.00.03 [04 Dec 2014])  28-Feb-2017 14:07:24
                                 
                                 ;*** CPU TYPE ***
                                 
                                 ;-ISA=RXV1
                                 
                                 ;*** COMMAND PARAMETER ***
                                 
                                 ;-output=src=r_vee.src
                                 ;-lang=c99
                                 ;-include=C:\PROGRA~2\Renesas\RX\2_3_0/include,C:\Workspace\e2studio\git\MT01\r_lvd_rx,C:\Workspace\e2studio\git\MT01\r_lvd_rx\src,C:/Workspace/e2studio/git/MT01/r_tfa
                                 ;-debug
                                 ;-show=source,conditionals,definitions,expansions
                                 ;-listfile=r_vee.lst
                                 ;-isa=rxv1
                                 ;-optimize=0
                                 ;-fpu
                                 ;-alias=noansi
                                 ;-nologo
                                 ;-nomessage
                                 ;-define=__RX,COMPACTAXP=1,EASYMAK=0,MOBILE=0,FREE_RTOS_PP
                                 ;r_vee.c
                                 
                                 		.glb	_g_vee_RecordLocations
                                 		.glb	_g_vee_sect0_block_addresses
                                 		.glb	_g_vee_sect0_df_blocks
                                 		.glb	_g_vee_Sectors
                                 		.glb	_R_FlashGetStatus
                                 		.glb	_R_BSP_SoftwareLock
                                 		.glb	_vee_enable_df
                                 		.glb	_R_BSP_SoftwareUnlock
                                 		.glb	_R_VEE_ReleaseState
                                 		.glb	_R_VEE_GetState
                                 		.glb	_R_VEE_Open
                                 		.glb	_R_VEE_Read
                                 		.glb	_vee_get_block_info
                                 		.glb	_vee_blank_check_address
                                 		.glb	_vee_check_record
                                 		.glb	_vee_move_to_boundary
                                 		.glb	_R_VEE_Write
                                 		.glb	_VEE_OperationDone_Callback
                                 		.glb	_R_FlashWrite
                                 		.glb	_FlashError
                                 		.glb	_R_FlashErase
                                 		.glb	_vee_blank_check_block
                                 		.glb	_R_VEE_Erase
                                 		.glb	_R_VEE_Defrag
                                 		.glb	_FlashEraseDone
                                 		.glb	_FlashWriteDone
                                 		.glb	_FlashBlankCheckDone
                                 		.glb	_R_VEE_GetVersion
                                 		.glb	_R_VEE_Control
                                 ;LineNo. C-SOURCE STATEMENT
                                 
                                 		.SECTION	P,CODE
00000000                         __$vee_grab_state:
                                 		.STACK	__$vee_grab_state=16
                                 ;       1 /***********************************************************************************************************************
                                 ;       2 * DISCLAIMER
                                 ;       3 * This software is supplied by Renesas Electronics Corporation and is only intended for use with Renesas products. No 
                                 ;       4 * other uses are authorized. This software is owned by Renesas Electronics Corporation and is protected under all 
                                 ;       5 * applicable laws, including copyright laws. 
                                 ;       6 * THIS SOFTWARE IS PROVIDED "AS IS" AND RENESAS MAKES NO WARRANTIES REGARDING
                                 ;       7 * THIS SOFTWARE, WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING BUT NOT LIMITED TO WARRANTIES OF MERCHANTABILITY, 
                                 ;       8 * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. ALL SUCH WARRANTIES ARE EXPRESSLY DISCLAIMED. TO THE MAXIMUM 
                                 ;       9 * EXTENT PERMITTED NOT PROHIBITED BY LAW, NEITHER RENESAS ELECTRONICS CORPORATION NOR ANY OF ITS AFFILIATED COMPANIES 
                                 ;      10 * SHALL BE LIABLE FOR ANY DIRECT, INDIRECT, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES FOR ANY REASON RELATED TO THIS 
                                 ;      11 * SOFTWARE, EVEN IF RENESAS OR ITS AFFILIATES HAVE BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.
                                 ;      12 * Renesas reserves the right, without notice, to make changes to this software and to discontinue the availability of 
                                 ;      13 * this software. By using this software, you agree to the additional terms and conditions found by accessing the 
                                 ;      14 * following link:
                                 ;      15 * http://www.renesas.com/disclaimer 
                                 ;      16 *
                                 ;      17 * Copyright (C) 2013 Renesas Electronics Corporation. All rights reserved.    
                                 ;      18 ***********************************************************************************************************************/
                                 ;      19 /***********************************************************************************************************************
                                 ;      20 * File Name    : r_vee.c
                                 ;      21 * Description  : Virtual EEPROM implementation using MCU's data flash memory
                                 ;      22 ************************************************************************************************************************
                                 ;      23 * History : DD.MM.YYYY Version Description
                                 ;      24 *         : 12.07.2011 1.00    First Release
                                 ;      25 *         : 03.01.2012 1.50    Updated for internal CS and for FIT. Added support for RX63x Groups. 
                                 ;      26 *         : 14.09.2012 1.60    Updated for FIT v0.7 Spec. Fixed bug found when reset occurred after FULL flag was 
                                 ;      27 *                              written and before NEXTUP was written. VEE now handles this event.
                                 ;      28 *         : 03.01.2013 1.70    Added R_VEE_Open() function to initialize or reset VEE. Created r_vee_target.h to replace
                                 ;      29 *                              multiple r_vee_<mcu>.h files that had duplicate information. Updated to be compliant with
                                 ;      30 *                              FIT v1.00 specification. This means that config file is now in 'ref' folder. Tested with
                                 ;      31 *                              RX62G, RX210, and RX63T. Added R_VEE_Control() function. Added vee_invalidate_cache().
                                 ;      32 ***********************************************************************************************************************/
                                 ;      33 
                                 ;      34 /* This file will declare const VEE Sector structures from r_vee_config.h */
                                 ;      35 #define VEE_MEM_DECLARE
                                 ;      36 
                                 ;      37 /***********************************************************************************************************************
                                 ;      38 Includes   <System Includes> , "Project Includes"
                                 ;      39 ***********************************************************************************************************************/
                                 ;      40 /* Used for offsetof() */
                                 ;      41 #include <stddef.h>
                                 ;      42 /* Used for memcpy() */
                                 ;      43 #include <string.h>
                                 ;      44 /* Defines, prototypes, and other configuration parameters for VEE use */
                                 ;      45 #include "r_vee_if.h"
                                 ;      46 /* VEE structures. */
                                 ;      47 #include "r_vee_types.h"
                                 ;      48 /* Includes correct files for current VEE target MCU. */
                                 ;      49 #include "r_vee_target.h"
                                 ;      50 /* Used for Flash API calls. */
                                 ;      51 #include "r_flash_api_rx_if.h"
                                 ;      52 
                                 ;      53 /***********************************************************************************************************************
                                 ;      54 Macro definitions
                                 ;      55 ***********************************************************************************************************************/
                                 ;      56 /* This macro should only be used for testing purposes. This macro will remove the 'static' keyword from VEE data 
                                 ;      57    structures and functions. This is done so that these items can be expected during testing. */
                                 ;      58 //#define VEE_TESTING
                                 ;      59 
                                 ;      60 #if defined(VEE_TESTING)
                                 ;      61     #define VEE_STATIC  
                                 ;      62 #else
                                 ;      63     #define VEE_STATIC      static
                                 ;      64 #endif
                                 ;      65 
                                 ;      66 /***********************************************************************************************************************
                                 ;      67 Private Global Variables
                                 ;      68 ***********************************************************************************************************************/
                                 ;      69 /* Holds the current state of the VEE */
                                 ;      70 VEE_STATIC vee_states_t         g_vee_state = VEE_READY;
                                 ;      71 /* Cache used by VEE to hold record addresses */
                                 ;      72 VEE_STATIC vee_cache_t          g_vee_cache;  
                                 ;      73 /* Cache used to hold the next open address in sectors */
                                 ;      74 VEE_STATIC vee_next_address_t   g_vee_next_address[VEE_NUM_SECTORS];               
                                 ;      75 /* A VEE Block can be made up of multiple MCU data flash blocks. When erasing a VEE Block we may end up erasing multiple 
                                 ;      76    MCU data flash bocks. */
                                 ;      77 /* Current data flash block to erase */
                                 ;      78 VEE_STATIC uint32_t             g_vee_erase_block_current;
                                 ;      79 /* Highest numbered data flash block to erase */
                                 ;      80 VEE_STATIC uint32_t             g_vee_erase_block_end;
                                 ;      81 /* Holds the current write state */
                                 ;      82 VEE_STATIC vee_write_states_t   g_vee_write_state;
                                 ;      83 /* Holds the record currently being written */
                                 ;      84 VEE_STATIC vee_record_t         g_vee_current_record;
                                 ;      85 /* Holds the sector currently being operated on */
                                 ;      86 VEE_STATIC uint8_t              g_vee_current_sector;
                                 ;      87 /* Holds the ACTIVE block currently being operated on */
                                 ;      88 VEE_STATIC uint32_t             g_vee_current_block_active;
                                 ;      89 /* Holds the NEXTUP block currently being operated on */
                                 ;      90 VEE_STATIC uint32_t             g_vee_current_block_nextup;
                                 ;      91 /* Current block being blank checked */
                                 ;      92 VEE_STATIC uint32_t             g_vee_blank_check_block_current;
                                 ;      93 /* Last block to be blank checked */
                                 ;      94 VEE_STATIC uint32_t             g_vee_blank_check_block_end;
                                 ;      95 /* Holds the current flash write address */
                                 ;      96 VEE_STATIC vee_record_t far *   g_vee_write_address;
                                 ;      97 /* Used for locking state of VEE */
                                 ;      98 VEE_STATIC bsp_lock_t           g_vee_lock;
                                 ;      99 #ifdef VEE_ENABLE_DF
                                 ;     100 /* Holds whether the data flash has been enabled yet */
                                 ;     101 VEE_STATIC uint8_t              g_vee_df_enabled;
                                 ;     102 #endif
                                 ;     103 
                                 ;     104 /***********************************************************************************************************************
                                 ;     105 Private Function Prototypes
                                 ;     106 ***********************************************************************************************************************/
                                 ;     107 VEE_STATIC uint8_t vee_seek(vee_record_t *vee_temp);
                                 ;     108 VEE_STATIC uint8_t vee_find_record(uint8_t sector, uint32_t block, vee_record_t *vee_temp);
                                 ;     109 #ifdef VEE_CACHE_FILL_ALL                                                               
                                 ;     110 VEE_STATIC uint8_t vee_fill_cache(void);
                                 ;     111 #endif
                                 ;     112 VEE_STATIC uint8_t vee_check_sector(uint8_t sector);
                                 ;     113 VEE_STATIC uint8_t vee_check_block(uint8_t sector, uint32_t block);
                                 ;     114 VEE_STATIC uint8_t vee_erase_block(uint8_t sector, uint32_t block);
                                 ;     115 VEE_STATIC uint8_t vee_defrag_block(uint8_t sector, uint32_t active, uint32_t nextup);
                                 ;     116 VEE_STATIC uint8_t vee_write_flag(uint8_t sector, uint32_t block, uint8_t flag, vee_var_min_t value);
                                 ;     117 VEE_STATIC uint8_t vee_erase_and_defrag(uint8_t sector, uint32_t active, uint32_t nextup);                           
                                 ;     118 VEE_STATIC uint8_t vee_start_write(vee_record_t * vee_temp);  
                                 ;     119 VEE_STATIC uint8_t vee_grab_state(vee_states_t state);                                  
                                 ;     120 VEE_STATIC uint8_t vee_check_input_record(vee_record_t * vee_temp, bool read_operation);
                                 ;     121 VEE_STATIC uint8_t vee_check_input_sector(uint8_t sector);
                                 ;     122 VEE_STATIC void    vee_reset(void);
                                 ;     123 VEE_STATIC uint8_t vee_invalidate_cache(uint8_t sector);
                                 ;     124 
                                 ;     125 /***********************************************************************************************************************
                                 ;     126 * Function Name: vee_grab_state
                                 ;     127 * Description  : Tries to grab the VEE state
                                 ;     128 * Arguments    : state - 
                                 ;     129 *                    Which state to try to transfer to
                                 ;     130 * Return value : VEE_SUCCESS -     
                                 ;     131 *                    Successful, state grabbed
                                 ;     132 *                VEE_BUSY -
                                 ;     133 *                    Data flash is busy, state not grabbed
                                 ;     134 ***********************************************************************************************************************/
                                 ;     135 VEE_STATIC uint8_t vee_grab_state (vee_states_t state)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",135
00000000 60C0                    		SUB #0CH, R0
00000002 A081                    		MOV.L R1, 08H[R0]
                                 ;     136 {
                                 ;     137     /* Local return variable */
                                 ;     138     uint8_t ret = VEE_SUCCESS;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",138
00000004 3C0600                  		MOV.B #00H, 06H[R0]
00000007                         L11:	; entry.split
                                 ;     139     
                                 ;     140     /* Check flash status */
                                 ;     141     if (1 == g_vee_df_enabled)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",141
00000007 FBE2rrrrrrrr            		MOV.L #__$g_vee_df_enabled, R14
0000000D 58EE                    		MOVU.B [R14], R14
0000000F 611E                    		CMP #01H, R14
00000011 21rr                    		BNE L14
00000013                         L12:	; bb4
                                 ;     142     {
                                 ;     143         if( R_FlashGetStatus() != FLASH_SUCCESS )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",143
00000013 05rrrrrr             A  		BSR _R_FlashGetStatus
00000017 6101                    		CMP #00H, R1
00000019 10                   S  		BEQ L14
0000001A                         L13:	; bb5
                                 ;     144         {
                                 ;     145             /* Flash is busy */
                                 ;     146             return VEE_BUSY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",146
0000001A 3C0502                  		MOV.B #02H, 05H[R0]
0000001D 38rrrr               W  		BRA L33
00000020                         L14:	; bb18
                                 ;     147         }   
                                 ;     148     }
                                 ;     149     
                                 ;     150     /* Try to lock VEE to change state. */
                                 ;     151     /* Check to see if lock was successfully taken. */
                                 ;     152     if(false == R_BSP_SoftwareLock(&g_vee_lock))
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",152
00000020 FB12rrrrrrrr            		MOV.L #__$g_vee_lock, R1
00000026 05rrrrrr             A  		BSR _R_BSP_SoftwareLock
0000002A 6101                    		CMP #00H, R1
0000002C 18                   S  		BNE L16
0000002D                         L15:	; bb19
                                 ;     153     {
                                 ;     154         /* Another operation is on-going */
                                 ;     155         return VEE_BUSY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",155
0000002D 3C0502                  		MOV.B #02H, 05H[R0]
00000030 2Err                 B  		BRA L33
00000032                         L16:	; bb27
                                 ;     156     }
                                 ;     157         
                                 ;     158     #ifdef VEE_ENABLE_DF
                                 ;     159     
                                 ;     160     /* Make sure data flash is enabled */
                                 ;     161     if( g_vee_df_enabled == 0 )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",161
00000032 FBE2rrrrrrrr            		MOV.L #__$g_vee_df_enabled, R14
00000038 58EE                    		MOVU.B [R14], R14
0000003A 610E                    		CMP #00H, R14
0000003C 21rr                    		BNE L19
0000003E                         L17:	; bb28
                                 ;     162     {
                                 ;     163         /* Enable data flash */
                                 ;     164         vee_enable_df();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",164
0000003E 05rrrrrr             A  		BSR _vee_enable_df
00000042                         L18:	; bb28.split
                                 ;     165         
                                 ;     166         /* Remember that data flash has been enabled */
                                 ;     167         g_vee_df_enabled = 1;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",167
00000042 FBE2rrrrrrrr            		MOV.L #__$g_vee_df_enabled, R14
00000048 F8E401                  		MOV.B #01H, [R14]
0000004B                         L19:	; bb35
                                 ;     168     }
                                 ;     169     
                                 ;     170     #endif
                                 ;     171 
                                 ;     172     /* If a reset is occuring then change the state no matter what. */
                                 ;     173     if (VEE_RESET != state)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",173
0000004B A881                    		MOV.L 08H[R0], R1
0000004D 6191                    		CMP #09H, R1
0000004F 20rr                    		BEQ L29
00000051                         L20:	; bb37
                                 ;     174     {
                                 ;     175         /* Check VEE status to make sure we are not stomping on another thread */
                                 ;     176         if( state == VEE_READING )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",176
00000051 A881                    		MOV.L 08H[R0], R1
00000053 6111                    		CMP #01H, R1
00000055 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
0000005B ECEE                    		MOV.L [R14], R14
0000005D 21rr                    		BNE L27
0000005F                         L21:	; bb39
0000005F 610E                    		CMP #00H, R14
                                 ;     177         {
                                 ;     178             /* If another read comes in while the state is reading then we are okay */
                                 ;     179             if( ( g_vee_state != VEE_READY ) && ( g_vee_state != VEE_READING) ) 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",179
00000061 18                   S  		BNE L23
00000062 2Err                 B  		BRA L25
00000064                         L22:	; bb40
                                 ;     180             {
                                 ;     181                 /* VEE is busy */
                                 ;     182                 ret = VEE_BUSY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",182
00000064 3C0602                  		MOV.B #02H, 06H[R0]
00000067 2Err                 B  		BRA L29
00000069                         L23:	; bb44
00000069 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
0000006F ECEE                    		MOV.L [R14], R14
00000071 611E                    		CMP #01H, R14
00000073 10                   S  		BEQ L25
00000074                         L24:	; bb48
00000074 F80601                  		MOV.L #00000001H, [R0]
00000077 08                   S  		BRA L26
00000078                         L25:	; bb49
00000078 F80600                  		MOV.L #00000000H, [R0]
0000007B                         L26:	; bb50
0000007B EC0E                    		MOV.L [R0], R14
0000007D 610E                    		CMP #00H, R14
0000007F 21rr                    		BNE L22
00000081 08                   S  		BRA L29
00000082                         L27:	; bb57
                                 ;     183             }        
                                 ;     184         }
                                 ;     185         else
                                 ;     186         {
                                 ;     187             /* If we are doing something other than reading then we must be in the VEE_READY state */
                                 ;     188             if (g_vee_state != VEE_READY)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",188
00000082 610E                    		CMP #00H, R14
00000084 10                   S  		BEQ L29
00000085                         L28:	; bb58
                                 ;     189             {
                                 ;     190                 /* VEE is busy */
                                 ;     191                 ret = VEE_BUSY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",191
00000085 3C0602                  		MOV.B #02H, 06H[R0]
00000088                         L29:	; bb74
                                 ;     192             }
                                 ;     193         }
                                 ;     194     }
                                 ;     195     
                                 ;     196     if( ret == VEE_SUCCESS )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",196
00000088 B181                    		MOVU.B 06H[R0], R1
0000008A 6101                    		CMP #00H, R1
0000008C 18                   S  		BNE L31
0000008D                         L30:	; bb75
                                 ;     197     {                    
                                 ;     198         /* Grab state */
                                 ;     199         g_vee_state = state;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",199
0000008D FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00000093 E10E02                  		MOV.L 08H[R0], [R14]
00000096                         L31:	; bb82
                                 ;     200     }
                                 ;     201     
                                 ;     202     /* Release lock. */
                                 ;     203     R_BSP_SoftwareUnlock(&g_vee_lock);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",203
00000096 FB12rrrrrrrr            		MOV.L #__$g_vee_lock, R1
0000009C 05rrrrrr             A  		BSR _R_BSP_SoftwareUnlock
000000A0                         L32:	; bb82.split
                                 ;     204         
                                 ;     205     return ret;    
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",205
000000A0 C5000605                		MOV.B 06H[R0], 05H[R0]
000000A4                         L33:	; bb86
000000A4 C5000507                		MOV.B 05H[R0], 07H[R0]
                                 ;     206 
                                 ;     207 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",207
000000A8 B189                    		MOVU.B 07H[R0], R1
000000AA 6703                    		RTSD #0CH
000000AC                         _R_VEE_ReleaseState:
                                 		.STACK	_R_VEE_ReleaseState=12
                                 ;     208 /***********************************************************************************************************************
                                 ;     209 End of function vee_grab_state
                                 ;     210 ***********************************************************************************************************************/
                                 ;     211 
                                 ;     212 /***********************************************************************************************************************
                                 ;     213 * Function Name: R_VEE_ReleaseState
                                 ;     214 * Description  : Sets the VEE State to ready. User would call this function after having called R_VEE_Read().  This 
                                 ;     215 *                will release the VEE state so that other operations can occur.
                                 ;     216 * Arguments    : none
                                 ;     217 * Return Value : VEE_SUCCESS - 
                                 ;     218 *                    Successful, state released
                                 ;     219 *                VEE_FAILURE -
                                 ;     220 *                    Cannot releas state during non-read operation
                                 ;     221 ***********************************************************************************************************************/
                                 ;     222 uint8_t R_VEE_ReleaseState (void)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",222
000000AC 6080                    		SUB #08H, R0
                                 ;     223 {
                                 ;     224     /* Initialize return to successful. */
                                 ;     225     uint8_t ret = VEE_SUCCESS;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",225
000000AE 3C0600                  		MOV.B #00H, 06H[R0]
000000B1                         L35:	; entry.split
                                 ;     226 
                                 ;     227     /* This function can only release state if it was reading */    
                                 ;     228     if (g_vee_state == VEE_READING)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",228
000000B1 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
000000B7 ECEE                    		MOV.L [R14], R14
000000B9 611E                    		CMP #01H, R14
000000BB 21rr                    		BNE L37
000000BD                         L36:	; bb2
                                 ;     229     {
                                 ;     230         /* Release state */
                                 ;     231         g_vee_state = VEE_READY;        
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",231
000000BD FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
000000C3 F8E600                  		MOV.L #00000000H, [R14]
000000C6 2Err                 B  		BRA L43
000000C8                         L37:	; bb4
                                 ;     232     }
                                 ;     233     else if ((g_vee_state != VEE_READY) && (g_vee_state != VEE_READING))
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",233
000000C8 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
000000CE ECEE                    		MOV.L [R14], R14
000000D0 610E                    		CMP #00H, R14
000000D2 18                   S  		BNE L39
000000D3 2Err                 B  		BRA L41
000000D5                         L38:	; bb5
                                 ;     234     {
                                 ;     235         /* Cannot release state. Another operation is still on-going. */
                                 ;     236         ret = VEE_FAILURE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",236
000000D5 3C0601                  		MOV.B #01H, 06H[R0]
000000D8 2Err                 B  		BRA L43
000000DA                         L39:	; bb10
000000DA FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
000000E0 ECEE                    		MOV.L [R14], R14
000000E2 611E                    		CMP #01H, R14
000000E4 10                   S  		BEQ L41
000000E5                         L40:	; bb14
000000E5 F80601                  		MOV.L #00000001H, [R0]
000000E8 08                   S  		BRA L42
000000E9                         L41:	; bb15
000000E9 F80600                  		MOV.L #00000000H, [R0]
000000EC                         L42:	; bb16
000000EC EC01                    		MOV.L [R0], R1
000000EE 6101                    		CMP #00H, R1
000000F0 21rr                    		BNE L38
000000F2                         L43:	; bb25
                                 ;     237     }
                                 ;     238     else
                                 ;     239     {
                                 ;     240         /* This means that g_vee_state is VEE_READY which means that g_vee_state should not be modified.
                                 ;     241            The g_vee_state variable should not be modified because of a race condition where g_vee_state is
                                 ;     242            just about to be written as VEE_READY and then an interrupt occurs and R_VEE_Write() is called. At this time
                                 ;     243            the state will be set to some writing state and when execution returns to here it could set the state to 
                                 ;     244            VEE_READY when it should not. */
                                 ;     245     }
                                 ;     246 
                                 ;     247     return ret;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",247
000000F2 C5000607                		MOV.B 06H[R0], 07H[R0]
000000F6 B189                    		MOVU.B 07H[R0], R1
000000F8                         L44:	; bb25.split
                                 ;     248 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",248
000000F8 5B11                    		MOVU.B R1, R1
000000FA 6702                    		RTSD #08H
000000FC                         _R_VEE_GetState:
                                 		.STACK	_R_VEE_GetState=8
                                 ;     249 /***********************************************************************************************************************
                                 ;     250 End of function R_VEE_ReleaseState
                                 ;     251 ***********************************************************************************************************************/
                                 ;     252 
                                 ;     253 /***********************************************************************************************************************
                                 ;     254 * Function Name: R_VEE_GetState
                                 ;     255 * Description  : Returns the current state of the VEE
                                 ;     256 * Arguments    : none
                                 ;     257 * Return Value : State of VEE
                                 ;     258 ***********************************************************************************************************************/
                                 ;     259 vee_states_t R_VEE_GetState (void)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",259
000000FC 6040                    		SUB #04H, R0
                                 ;     260 {
                                 ;     261     /* Return state */
                                 ;     262     return g_vee_state;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",262
000000FE FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00000104 ECE1                    		MOV.L [R14], R1
00000106 E301                    		MOV.L R1, [R0]
00000108                         L46:	; entry.split
                                 ;     263 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",263
00000108 6701                    		RTSD #04H
0000010A                         _R_VEE_Open:
                                 		.STACK	_R_VEE_Open=8
                                 ;     264 /***********************************************************************************************************************
                                 ;     265 End of function R_VEE_GetState
                                 ;     266 ***********************************************************************************************************************/
                                 ;     267 
                                 ;     268 /***********************************************************************************************************************
                                 ;     269 * Function Name: R_VEE_Open
                                 ;     270 * Description  : Initializes and resets all VEE data structures
                                 ;     271 * Arguments    : none
                                 ;     272 * Return Value : VEE_SUCCESS -
                                 ;     273 *                    VEE initialized successfully.
                                 ;     274 ***********************************************************************************************************************/
                                 ;     275 uint8_t R_VEE_Open (void)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",275
0000010A 6040                    		SUB #04H, R0
0000010C 6681                    		MOV.L #00000008H, R1
                                 ;     276 {
                                 ;     277     /* Try to grab VEE State. */
                                 ;     278     if( vee_grab_state(VEE_OPENING) != VEE_SUCCESS )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",278
0000010E 39rrrr               W  		BSR __$vee_grab_state
00000111 6101                    		CMP #00H, R1
00000113 10                   S  		BEQ L49
00000114                         L48:	; bb1
                                 ;     279     {
                                 ;     280         /* Could not grab state */
                                 ;     281         return VEE_BUSY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",281
00000114 3C0202                  		MOV.B #02H, 02H[R0]
00000117 2Err                 B  		BRA L52
00000119                         L49:	; bb7
                                 ;     282     }
                                 ;     283 
                                 ;     284     vee_reset();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",284
00000119 39rrrr               W  		BSR __$vee_reset
0000011C                         L50:	; bb7.split
                                 ;     285 
                                 ;     286     g_vee_state = VEE_READY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",286
0000011C FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00000122 F8E600                  		MOV.L #00000000H, [R14]
00000125                         L51:	; bb7.split1
                                 ;     287 
                                 ;     288     return VEE_SUCCESS;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",288
00000125 3C0200                  		MOV.B #00H, 02H[R0]
00000128                         L52:	; bb9
00000128 C5000203                		MOV.B 02H[R0], 03H[R0]
                                 ;     289 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",289
0000012C B089                    		MOVU.B 03H[R0], R1
0000012E 6701                    		RTSD #04H
00000130                         __$vee_reset:
                                 		.STACK	__$vee_reset=8
                                 ;     290 /***********************************************************************************************************************
                                 ;     291 End of function R_VEE_Open
                                 ;     292 ***********************************************************************************************************************/
                                 ;     293 
                                 ;     294 /***********************************************************************************************************************
                                 ;     295 * Function Name: vee_reset
                                 ;     296 * Description  : Initializes and resets all VEE data structures
                                 ;     297 * Arguments    : none
                                 ;     298 * Return Value : none
                                 ;     299 ***********************************************************************************************************************/
                                 ;     300 VEE_STATIC void vee_reset (void)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",300
00000130 6040                    		SUB #04H, R0
                                 ;     301 {
                                 ;     302     uint32_t i;
                                 ;     303 
                                 ;     304     /* Initialize all global variables. */
                                 ;     305     g_vee_state = VEE_READY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",305
00000132 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00000138 F8E600                  		MOV.L #00000000H, [R14]
0000013B                         L54:	; entry.split
                                 ;     306     g_vee_erase_block_current = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",306
0000013B FBE2rrrrrrrr            		MOV.L #__$g_vee_erase_block_current, R14
00000141 F8E600                  		MOV.L #00000000H, [R14]
00000144                         L55:	; entry.split1
                                 ;     307     g_vee_erase_block_end = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",307
00000144 FBE2rrrrrrrr            		MOV.L #__$g_vee_erase_block_end, R14
0000014A F8E600                  		MOV.L #00000000H, [R14]
0000014D                         L56:	; entry.split2
                                 ;     308     g_vee_write_state = VEE_WRITE_DONE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",308
0000014D FBE2rrrrrrrr            		MOV.L #__$g_vee_write_state, R14
00000153 F8E60A                  		MOV.L #0000000AH, [R14]
00000156                         L57:	; entry.split3
                                 ;     309     g_vee_current_record.ID = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",309
00000156 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_record, R14
0000015C F8E500                  		MOV.W #0000H, [R14]
0000015F                         L58:	; entry.split4
                                 ;     310     g_vee_current_record.size = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",310
0000015F FB12rrrrrrrr            		MOV.L #__$g_vee_current_record, R1
00000165 3D1100                  		MOV.W #0000H, 02H[R1]
00000168                         L59:	; entry.split5
                                 ;     311     g_vee_current_record.check = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",311
00000168 FB12rrrrrrrr            		MOV.L #__$g_vee_current_record, R1
0000016E 3D1200                  		MOV.W #0000H, 04H[R1]
00000171                         L60:	; entry.split6
                                 ;     312     g_vee_current_record.block = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",312
00000171 FB12rrrrrrrr            		MOV.L #__$g_vee_current_record, R1
00000177 3D1300                  		MOV.W #0000H, 06H[R1]
0000017A                         L61:	; entry.split7
                                 ;     313     g_vee_current_record.pData = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",313
0000017A FB12rrrrrrrr            		MOV.L #__$g_vee_current_record, R1
00000180 3E1200                  		MOV.L #00000000H, 08H[R1]
00000183                         L62:	; entry.split8
                                 ;     314     g_vee_current_sector = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",314
00000183 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
00000189 F8E400                  		MOV.B #00H, [R14]
0000018C                         L63:	; entry.split9
                                 ;     315     g_vee_current_block_active = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",315
0000018C FBE2rrrrrrrr            		MOV.L #__$g_vee_current_block_active, R14
00000192 F8E600                  		MOV.L #00000000H, [R14]
00000195                         L64:	; entry.split10
                                 ;     316     g_vee_current_block_nextup = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",316
00000195 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_block_nextup, R14
0000019B F8E600                  		MOV.L #00000000H, [R14]
0000019E                         L65:	; entry.split11
                                 ;     317     g_vee_blank_check_block_current = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",317
0000019E FBE2rrrrrrrr            		MOV.L #__$g_vee_blank_check_block_current, R14
000001A4 F8E600                  		MOV.L #00000000H, [R14]
000001A7                         L66:	; entry.split12
                                 ;     318     g_vee_blank_check_block_end = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",318
000001A7 FBE2rrrrrrrr            		MOV.L #__$g_vee_blank_check_block_end, R14
000001AD F8E600                  		MOV.L #00000000H, [R14]
000001B0                         L67:	; entry.split13
                                 ;     319     g_vee_write_address = (vee_record_t far *)0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",319
000001B0 FBE2rrrrrrrr            		MOV.L #__$g_vee_write_address, R14
000001B6 F8E600                  		MOV.L #00000000H, [R14]
000001B9                         L68:	; entry.split14
                                 ;     320     #ifdef VEE_ENABLE_DF
                                 ;     321     g_vee_df_enabled = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",321
000001B9 FBE2rrrrrrrr            		MOV.L #__$g_vee_df_enabled, R14
000001BF F8E400                  		MOV.B #00H, [R14]
000001C2                         L69:	; entry.split15
                                 ;     322     #endif
                                 ;     323 
                                 ;     324     /* Invalidate next address structure and cache. */
                                 ;     325     for (i = 0; i < VEE_NUM_SECTORS; i++)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",325
000001C2 F80600                  		MOV.L #00000000H, [R0]
000001C5 2Err                 B  		BRA L71
000001C7                         L70:	; bb
                                 ;     326     {
                                 ;     327         vee_invalidate_cache(i);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",327
000001C7 5801                    		MOVU.B [R0], R1
000001C9 39rrrr               W  		BSR __$vee_invalidate_cache
000001CC EC01                    		MOV.L [R0], R1
000001CE 6211                    		ADD #01H, R1
000001D0 E301                    		MOV.L R1, [R0]
000001D2                         L71:	; bb6
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",325
000001D2 EC01                    		MOV.L [R0], R1
000001D4 6101                    		CMP #00H, R1
000001D6 20rr                    		BEQ L70
000001D8                         L72:	; return
                                 ;     328     }
                                 ;     329 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",329
000001D8 6701                    		RTSD #04H
000001DA                         _R_VEE_Read:
                                 		.STACK	_R_VEE_Read=20
                                 ;     330 /***********************************************************************************************************************
                                 ;     331 End of function vee_reset
                                 ;     332 ***********************************************************************************************************************/
                                 ;     333 
                                 ;     334 /***********************************************************************************************************************
                                 ;     335 * Function Name: R_VEE_Read
                                 ;     336 * Description  : Returns address for data if record is cached. If not cached then it searches the data flash.
                                 ;     337 * Arguments    : vee_temp - 
                                 ;     338 *                    Structure with record information
                                 ;     339 * Return Value : VEE_SUCCESS -
                                 ;     340 *                    Successful, structure members set accordingly
                                 ;     341 *                VEE_NOT_FOUND -  
                                 ;     342 *                    Record not found
                                 ;     343 *                VEE_BUSY - 
                                 ;     344 *                    Data flash is busy, try again later
                                 ;     345 *                VEE_INVALID_INPUT -
                                 ;     346 *                    Record sent in had invalid data.
                                 ;     347 ***********************************************************************************************************************/
                                 ;     348 uint8_t R_VEE_Read (vee_record_t *vee_temp)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",348
000001DA 7100F0                  		ADD #0FFFFFFF0H, R0
000001DD A089                    		MOV.L R1, 0CH[R0]
000001DF 6612                    		MOV.L #00000001H, R2
                                 ;     349 {
                                 ;     350     /* Local variable */
                                 ;     351     vee_record_t far * record;
                                 ;     352 
                                 ;     353     /* Check record. */
                                 ;     354     if (VEE_SUCCESS != vee_check_input_record(vee_temp, true))
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",354
000001E1 39rrrr               W  		BSR __$vee_check_input_record
000001E4 6101                    		CMP #00H, R1
000001E6 10                   S  		BEQ L75
000001E7                         L74:	; bb3
                                 ;     355     {
                                 ;     356         /* Record was invalid. E.g. record ID is out of range. */
                                 ;     357         return VEE_INVALID_INPUT;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",357
000001E7 3C0306                  		MOV.B #06H, 03H[R0]
000001EA 2Err                 B  		BRA L88
000001EC                         L75:	; bb11
000001EC 6611                    		MOV.L #00000001H, R1
                                 ;     358     }
                                 ;     359     
                                 ;     360     /* Try to grab VEE State */
                                 ;     361     if( vee_grab_state(VEE_READING) != VEE_SUCCESS )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",361
000001EE 39rrrr               W  		BSR __$vee_grab_state
000001F1 6101                    		CMP #00H, R1
000001F3 10                   S  		BEQ L77
000001F4                         L76:	; bb12
                                 ;     362     {
                                 ;     363         /* Could not grab state */
                                 ;     364         return VEE_BUSY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",364
000001F4 3C0302                  		MOV.B #02H, 03H[R0]
000001F7 2Err                 B  		BRA L88
000001F9                         L77:	; bb20
                                 ;     365     }
                                 ;     366     
                                 ;     367     #ifdef VEE_CACHE_FILL_ALL
                                 ;     368     
                                 ;     369     /* Check to see if cache has been filled yet, if not then fill it */
                                 ;     370     if( g_vee_cache.valid != VEE_CACHE_ENTRY_VALID )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",370
000001F9 FBE2rrrrrrrr            		MOV.L #__$g_vee_cache, R14
000001FF 58EE                    		MOVU.B [R14], R14
00000201 755E85                  		CMP #85H, R14
00000204 10                   S  		BEQ L79
00000205                         L78:	; bb21
                                 ;     371     {
                                 ;     372         /* Cache needs to be filled */
                                 ;     373         vee_fill_cache();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",373
00000205 39rrrr               W  		BSR __$vee_fill_cache
00000208                         L79:	; bb29
                                 ;     374     }
                                 ;     375     
                                 ;     376     #endif                
                                 ;     377     
                                 ;     378     /* Check the cache to see if entry is found */
                                 ;     379     if( g_vee_cache.entries[vee_temp->ID].valid == VEE_CACHE_ENTRY_VALID )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",379
00000208 A889                    		MOV.L 0CH[R0], R1
0000020A 5C1E                    		MOVU.W [R1], R14
0000020C 63CE                    		MUL #0CH, R14
0000020E FB12rrrrrrrr            		MOV.L #__$g_vee_cache, R1
00000214 4BE1                    		ADD R14, R1
00000216 B111                    		MOVU.B 04H[R1], R1
00000218 755185                  		CMP #85H, R1
0000021B 21rr                    		BNE L86
0000021D                         L80:	; bb30
                                 ;     380     {
                                 ;     381         /* Success, entry found in cache, fill in fields  */
                                 ;     382         record = g_vee_cache.entries[vee_temp->ID].address;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",382
0000021D A889                    		MOV.L 0CH[R0], R1
0000021F 5C1E                    		MOVU.W [R1], R14
00000221 63CE                    		MUL #0CH, R14
00000223 FB12rrrrrrrr            		MOV.L #__$g_vee_cache, R1
00000229 4BE1                    		ADD R14, R1
0000022B E5100301                		MOV.L 0CH[R1], 04H[R0]
0000022F                         L81:	; bb30.split
                                 ;     383         
                                 ;     384         /* Fill in data */
                                 ;     385         vee_temp->pData = (uint8_t far *)&record->pData;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",385
0000022F A809                    		MOV.L 04H[R0], R1
00000231 6281                    		ADD #08H, R1
00000233 A88A                    		MOV.L 0CH[R0], R2
00000235 A0A1                    		MOV.L R1, 08H[R2]
00000237                         L82:	; bb30.split1
                                 ;     386                           
                                 ;     387         /* Fill in size */
                                 ;     388         vee_temp->size = record->size;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",388
00000237 A809                    		MOV.L 04H[R0], R1
00000239 A88A                    		MOV.L 0CH[R0], R2
0000023B D5120101                		MOV.W 02H[R1], 02H[R2]
0000023F                         L83:	; bb30.split2
                                 ;     389         
                                 ;     390         /* Fill in check */
                                 ;     391         vee_temp->check = record->check;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",391
0000023F A809                    		MOV.L 04H[R0], R1
00000241 A88A                    		MOV.L 0CH[R0], R2
00000243 D5120202                		MOV.W 04H[R1], 04H[R2]
00000247                         L84:	; bb30.split3
                                 ;     392         
                                 ;     393         /* Fill in block */
                                 ;     394         vee_temp->block = record->block;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",394
00000247 A809                    		MOV.L 04H[R0], R1
00000249 A88A                    		MOV.L 0CH[R0], R2
0000024B D5120303                		MOV.W 06H[R1], 06H[R2]
0000024F                         L85:	; bb30.split4
                                 ;     395         
                                 ;     396         /* Success */
                                 ;     397         return VEE_SUCCESS;                 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",397
0000024F 3C0300                  		MOV.B #00H, 03H[R0]
00000252 2Err                 B  		BRA L88
00000254                         L86:	; bb71
                                 ;     398     }
                                 ;     399 #ifndef VEE_CACHE_FILL_ALL
                                 ;     400     else
                                 ;     401     {
                                 ;     402         /* Seek for record in data flash */
                                 ;     403         if( vee_seek(vee_temp) == VEE_SUCCESS )
                                 ;     404         {
                                 ;     405             /* Record was found, update cache */            
                                 ;     406             g_vee_cache.entries[vee_temp->ID].address = (vee_record_t far *)
                                 ;     407                                                         (vee_temp->pData - offsetof(vee_record_t, pData));
                                 ;     408 
                                 ;     409             /* Update which VEE Block the record is in */
                                 ;     410             g_vee_cache.entries[vee_temp->ID].block = vee_temp->block;
                                 ;     411                     
                                 ;     412             /* Set cache entry as valid */
                                 ;     413             g_vee_cache.entries[vee_temp->ID].valid = VEE_CACHE_ENTRY_VALID;            
                                 ;     414             
                                 ;     415             /* Success */
                                 ;     416             return VEE_SUCCESS;             
                                 ;     417         }
                                 ;     418     }
                                 ;     419 #endif
                                 ;     420 
                                 ;     421     /* Nothing to read so release state */
                                 ;     422     g_vee_state = VEE_READY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",422
00000254 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
0000025A F8E600                  		MOV.L #00000000H, [R14]
0000025D                         L87:	; bb71.split
                                 ;     423 
                                 ;     424     /* Record Not Found */
                                 ;     425     return VEE_NOT_FOUND;                 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",425
0000025D 3C0304                  		MOV.B #04H, 03H[R0]
00000260                         L88:	; bb73
00000260 C500030B                		MOV.B 03H[R0], 0BH[R0]
                                 ;     426 
                                 ;     427 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",427
00000264 B289                    		MOVU.B 0BH[R0], R1
00000266 6704                    		RTSD #10H
00000268                         __$vee_fill_cache:
                                 		.STACK	__$vee_fill_cache=24
                                 ;     428 /***********************************************************************************************************************
                                 ;     429 End of function R_VEE_Read
                                 ;     430 ***********************************************************************************************************************/
                                 ;     431 
                                 ;     432 #ifdef VEE_CACHE_FILL_ALL
                                 ;     433 
                                 ;     434 /***********************************************************************************************************************
                                 ;     435 * Function Name: vee_fill_cache
                                 ;     436 * Description  : Fills in the VEE Cache with record locations            
                                 ;     437 * Arguments    : none
                                 ;     438 * Return Value : VEE_SUCCESS -  
                                 ;     439 *                    Successful, cache has been filled in
                                 ;     440 *                VEE_FAILURE -
                                 ;     441 *                    Failure
                                 ;     442 ***********************************************************************************************************************/
                                 ;     443 VEE_STATIC uint8_t vee_fill_cache (void)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",443
00000268 7100EC                  		ADD #0FFFFFFECH, R0
                                 ;     444 {
                                 ;     445     /* Local variables */
                                 ;     446     uint8_t i;
                                 ;     447     vee_record_t vee_temp;
                                 ;     448     
                                 ;     449     for(i = 0; i < VEE_MAX_RECORD_ID; i++)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",449
0000026B 3C0300                  		MOV.B #00H, 03H[R0]
0000026E 2Err                 B  		BRA L96
00000270                         L90:	; bb
                                 ;     450     {
                                 ;     451         /* Update Record ID */
                                 ;     452         vee_temp.ID = i;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",452
00000270 B089                    		MOVU.B 03H[R0], R1
00000272 9081                    		MOV.W R1, 04H[R0]
00000274                         L91:	; bb.split
00000274 710104                  		ADD #04H, R0, R1
                                 ;     453         
                                 ;     454         /* Seek for record in data flash */
                                 ;     455         if( vee_seek(&vee_temp) == VEE_SUCCESS )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",455
00000277 39rrrr               W  		BSR __$vee_seek
0000027A 6101                    		CMP #00H, R1
0000027C 21rr                    		BNE L95
0000027E                         L92:	; bb7
                                 ;     456         {
                                 ;     457             /* Record was found, update cache */            
                                 ;     458             g_vee_cache.entries[i].address = (vee_record_t far *)(vee_temp.pData - offsetof(vee_record_t, pData));
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",458
0000027E B089                    		MOVU.B 03H[R0], R1
00000280 63C1                    		MUL #0CH, R1
00000282 FB22rrrrrrrr            		MOV.L #__$g_vee_cache, R2
00000288 4B12                    		ADD R1, R2
0000028A A889                    		MOV.L 0CH[R0], R1
0000028C 6081                    		SUB #08H, R1
0000028E A0A9                    		MOV.L R1, 0CH[R2]
00000290                         L93:	; bb7.split
                                 ;     459             
                                 ;     460             /* Update which VEE Block the record is in */
                                 ;     461             g_vee_cache.entries[vee_temp.ID].block = vee_temp.block;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",461
00000290 B881                    		MOVU.W 04H[R0], R1
00000292 63C1                    		MUL #0CH, R1
00000294 FB22rrrrrrrr            		MOV.L #__$g_vee_cache, R2
0000029A 4B12                    		ADD R1, R2
0000029C B909                    		MOVU.W 0AH[R0], R1
0000029E A0A1                    		MOV.L R1, 08H[R2]
000002A0                         L94:	; bb7.split1
                                 ;     462             
                                 ;     463             /* Set cache entry as valid */
                                 ;     464             g_vee_cache.entries[i].valid = VEE_CACHE_ENTRY_VALID;    
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",464
000002A0 B089                    		MOVU.B 03H[R0], R1
000002A2 63C1                    		MUL #0CH, R1
000002A4 FB22rrrrrrrr            		MOV.L #__$g_vee_cache, R2
000002AA 4B12                    		ADD R1, R2
000002AC 3C2485                  		MOV.B #85H, 04H[R2]
000002AF                         L95:	; bb32
000002AF B089                    		MOVU.B 03H[R0], R1
000002B1 6211                    		ADD #01H, R1
000002B3 8089                    		MOV.B R1, 03H[R0]
000002B5                         L96:	; bb35
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",449
000002B5 B089                    		MOVU.B 03H[R0], R1
000002B7 6181                    		CMP #08H, R1
000002B9 29rr                    		BLT L90
000002BB                         L97:	; bb41
                                 ;     465         }        
                                 ;     466     }
                                 ;     467     
                                 ;     468     /* Set 'valid' bit to show that cache has been filled in */
                                 ;     469     g_vee_cache.valid = VEE_CACHE_ENTRY_VALID;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",469
000002BB FBE2rrrrrrrr            		MOV.L #__$g_vee_cache, R14
000002C1 F8E485                  		MOV.B #85H, [R14]
000002C4                         L98:	; bb41.split
                                 ;     470 
                                 ;     471     /* Success */                                              
                                 ;     472     return VEE_SUCCESS;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",472
000002C4 3C8300                  		MOV.B #00H, 13H[R0]
000002C7 B489                    		MOVU.B 13H[R0], R1
000002C9                         L99:	; bb41.split2
                                 ;     473 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",473
000002C9 5B11                    		MOVU.B R1, R1
000002CB 6705                    		RTSD #14H
000002CD                         __$vee_seek:
                                 		.STACK	__$vee_seek=28
                                 ;     474 /***********************************************************************************************************************
                                 ;     475 End of function g_vee_cache
                                 ;     476 ***********************************************************************************************************************/
                                 ;     477 
                                 ;     478 #endif /* VEE_CACHE_FILL_ALL */
                                 ;     479 
                                 ;     480 /***********************************************************************************************************************
                                 ;     481 * Function Name: vee_seek
                                 ;     482 * Description  : Tries to find a record in the MCU's data flash
                                 ;     483 * Arguments    : vee_temp - 
                                 ;     484 *                    structure with record information
                                 ;     485 * Return Value : VEE_SUCCESS -
                                 ;     486 *                    Successful, structure filled in
                                 ;     487 *                VEE_NOT_FOUND -
                                 ;     488 *                    Record was not found
                                 ;     489 ***********************************************************************************************************************/
                                 ;     490 VEE_STATIC uint8_t vee_seek (vee_record_t *vee_temp)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",490
000002CD 7100E8                  		ADD #0FFFFFFE8H, R0
000002D0 A109                    		MOV.L R1, 14H[R0]
                                 ;     491 {
                                 ;     492     /* Loop variables */
                                 ;     493     uint32_t     i;
                                 ;     494     /* Structure pointer for VEE Block info */
                                 ;     495     vee_block_info_t block_info;
                                 ;     496         
                                 ;     497     /* Loop through blocks */
                                 ;     498     for(i=0;i<g_vee_Sectors[g_vee_RecordLocations[vee_temp->ID]].num_VEE_blocks;i++)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",498
000002D2 3E0200                  		MOV.L #00000000H, 08H[R0]
000002D5 2Err                 B  		BRA L111
000002D7                         L101:	; bb
                                 ;     499     {
                                 ;     500         /* Get block info */
                                 ;     501         vee_get_block_info(g_vee_RecordLocations[vee_temp->ID],i, &block_info);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",501
000002D7 A909                    		MOV.L 14H[R0], R1
000002D9 5C1E                    		MOVU.W [R1], R14
000002DB FBF2rrrrrrrr            		MOV.L #_g_vee_RecordLocations, R15
000002E1 FECFE1                  		MOVU.B [R15,R14], R1
000002E4 A882                    		MOV.L 08H[R0], R2
000002E6 71030F                  		ADD #0FH, R0, R3
000002E9 05rrrrrr             A  		BSR _vee_get_block_info
000002ED                         L102:	; bb.split
                                 ;     502                 
                                 ;     503         /* Check for block with ACTIVE flag set. */
                                 ;     504         if( (block_info.active  == VEE_BLOCK_FLAG_SET) &&            
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",504
000002ED B401                    		MOVU.B 10H[R0], R1
000002EF 6111                    		CMP #01H, R1
000002F1 20rr                    		BEQ L106
000002F3 2Err                 B  		BRA L108
000002F5                         L103:	; bb14
                                 ;     505             (block_info.erasing == VEE_BLOCK_FLAG_NOT_SET ) )
                                 ;     506         {
                                 ;     507             /* See if record is found in this block */
                                 ;     508             if( VEE_SUCCESS == vee_find_record(g_vee_RecordLocations[vee_temp->ID], i, vee_temp) )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",508
000002F5 A90B                    		MOV.L 14H[R0], R3
000002F7 5C3E                    		MOVU.W [R3], R14
000002F9 FBF2rrrrrrrr            		MOV.L #_g_vee_RecordLocations, R15
000002FF FECFE1                  		MOVU.B [R15,R14], R1
00000302 A882                    		MOV.L 08H[R0], R2
00000304 39rrrr               W  		BSR __$vee_find_record
00000307 6101                    		CMP #00H, R1
00000309 18                   S  		BNE L105
0000030A                         L104:	; bb15
                                 ;     509             {
                                 ;     510                 /* Record found! */
                                 ;     511                 return VEE_SUCCESS;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",511
0000030A 3C0700                  		MOV.B #00H, 07H[R0]
0000030D 2Err                 B  		BRA L113
0000030F                         L105:	; bb17
                                 ;     512             }
                                 ;     513             else
                                 ;     514             {
                                 ;     515                 /* Record not found */
                                 ;     516                 return VEE_NOT_FOUND;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",516
0000030F 3C0704                  		MOV.B #04H, 07H[R0]
00000312 2Err                 B  		BRA L113
00000314                         L106:	; bb37
00000314 B389                    		MOVU.B 0FH[R0], R1
00000316 6101                    		CMP #00H, R1
00000318 18                   S  		BNE L108
00000319                         L107:	; bb43
00000319 F80601                  		MOV.L #00000001H, [R0]
0000031C 08                   S  		BRA L109
0000031D                         L108:	; bb44
0000031D F80600                  		MOV.L #00000000H, [R0]
00000320                         L109:	; bb45
00000320 EC01                    		MOV.L [R0], R1
00000322 6101                    		CMP #00H, R1
00000324 21rr                    		BNE L103
00000326                         L110:	; bb50
00000326 A881                    		MOV.L 08H[R0], R1
00000328 6211                    		ADD #01H, R1
0000032A A081                    		MOV.L R1, 08H[R0]
0000032C                         L111:	; bb53
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",498
0000032C A909                    		MOV.L 14H[R0], R1
0000032E 5C1E                    		MOVU.W [R1], R14
00000330 FBF2rrrrrrrr            		MOV.L #_g_vee_RecordLocations, R15
00000336 FECFEE                  		MOVU.B [R15,R14], R14
00000339 751E14                  		MUL #14H, R14
0000033C FB12rrrrrrrr            		MOV.L #_g_vee_Sectors, R1
00000342 4BE1                    		ADD R14, R1
00000344 B019                    		MOVU.B 01H[R1], R1
00000346 06850102                		CMP 08H[R0].L, R1
0000034A 24rr                    		BGTU L101
0000034C                         L112:	; bb70
                                 ;     517             }
                                 ;     518         }        
                                 ;     519     }
                                 ;     520 
                                 ;     521     /* If we get here then record was not found */
                                 ;     522     return VEE_NOT_FOUND;                     
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",522
0000034C 3C0704                  		MOV.B #04H, 07H[R0]
0000034F                         L113:	; bb72
0000034F C5000713                		MOV.B 07H[R0], 13H[R0]
                                 ;     523 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",523
00000353 B489                    		MOVU.B 13H[R0], R1
00000355 6706                    		RTSD #18H
00000357                         __$vee_find_record:
                                 		.STACK	__$vee_find_record=32
                                 ;     524 /***********************************************************************************************************************
                                 ;     525 End of function vee_seek
                                 ;     526 ***********************************************************************************************************************/
                                 ;     527 
                                 ;     528 /***********************************************************************************************************************
                                 ;     529 * Function Name: vee_find_record
                                 ;     530 * Description  : Searches for a record in a specific VEE Block          
                                 ;     531 * Arguments    : sector -   
                                 ;     532 *                    Which sector to search
                                 ;     533 *                block -   
                                 ;     534 *                    Which VEE block to search
                                 ;     535 *                vee_temp -   
                                 ;     536 *                    Structure with record info
                                 ;     537 * Return Value : VEE_SUCCESS -
                                 ;     538 *                    Successful, record found
                                 ;     539 *                VEE_NOT_FOUND -
                                 ;     540 *                    Record was not found
                                 ;     541 ***********************************************************************************************************************/
                                 ;     542 VEE_STATIC uint8_t vee_find_record (uint8_t sector, uint32_t block, vee_record_t *vee_temp)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",542
00000357 7100E4                  		ADD #0FFFFFFE4H, R0
0000035A 8689                    		MOV.B R1, 1BH[R0]
0000035C A10A                    		MOV.L R2, 14H[R0]
0000035E A103                    		MOV.L R3, 10H[R0]
                                 ;     543 {
                                 ;     544     /* Pointers for searching */
                                 ;     545     vee_record_t *ptr, *end_addr;        
                                 ;     546     /* Boolean for whether we found valid record or not */
                                 ;     547     uint8_t  record_found = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",547
00000360 3C0E00                  		MOV.B #00H, 0EH[R0]
00000363                         L115:	; entry.split
                                 ;     548     
                                 ;     549     /* Move past flags at beginning */
                                 ;     550     ptr = (vee_record_t *)(((uint8_t *)g_vee_Sectors[sector].VEE_block_addr[block]) +
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",550
00000363 B689                    		MOVU.B 1BH[R0], R1
00000365 751114                  		MUL #14H, R1
00000368 FB22rrrrrrrr            		MOV.L #_g_vee_Sectors, R2
0000036E 4B12                    		ADD R1, R2
00000370 A8A1                    		MOV.L 08H[R2], R1
00000372 A90A                    		MOV.L 14H[R0], R2
00000374 FE6211                  		MOV.L [R2,R1], R1
00000377 6281                    		ADD #08H, R1
00000379 A009                    		MOV.L R1, 04H[R0]
0000037B                         L116:	; entry.split1
                                 ;     551                            ((VEE_BLOCK_STATE_NEXTUP+1)*sizeof(vee_var_min_t)));
                                 ;     552     /* Flags are at beginning of block so end is the real end */
                                 ;     553     end_addr =  (vee_record_t *)(((uint8_t *)g_vee_Sectors[sector].VEE_block_addr[block]) + 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",553
0000037B B689                    		MOVU.B 1BH[R0], R1
0000037D 751114                  		MUL #14H, R1
00000380 FB22rrrrrrrr            		MOV.L #_g_vee_Sectors, R2
00000386 4B12                    		ADD R1, R2
00000388 A8A1                    		MOV.L 08H[R2], R1
0000038A A90B                    		MOV.L 14H[R0], R3
0000038C FE6311                  		MOV.L [R3,R1], R1
0000038F 06892101                		ADD 04H[R2].L, R1
00000393 A081                    		MOV.L R1, 08H[R0]
00000395 2Err                 B  		BRA L127
00000397                         L117:	; bb34
                                 ;     554                                              g_vee_Sectors[sector].VEE_block_size);
                                 ;     555     
                                 ;     556     /* Search until end of block */
                                 ;     557     while(ptr < end_addr )
                                 ;     558     {
                                 ;     559         /* Make sure this address is not empty */
                                 ;     560         if( vee_blank_check_address((uint8_t *)ptr) == VEE_SUCCESS )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",560
00000397 A809                    		MOV.L 04H[R0], R1
00000399 05rrrrrr             A  		BSR _vee_blank_check_address
0000039D 6101                    		CMP #00H, R1
0000039F 20rr                    		BEQ L128
000003A1                         L118:	; bb44
                                 ;     561         {
                                 ;     562             /* Address was blank so search is done */            
                                 ;     563             /* Exit loop */
                                 ;     564             break;
                                 ;     565         }
                                 ;     566         
                                 ;     567         /* Check to see if ID's match */
                                 ;     568         if( vee_temp->ID == ptr->ID )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",568
000003A1 A901                    		MOV.L 10H[R0], R1
000003A3 5C1E                    		MOVU.W [R1], R14
000003A5 A809                    		MOV.L 04H[R0], R1
000003A7 06C41E                  		CMP [R1].UW, R14
000003AA 21rr                    		BNE L125
000003AC                         L119:	; bb46
                                 ;     569         {
                                 ;     570             /* Check to make sure record is valid */
                                 ;     571             if( vee_check_record(ptr) == VEE_SUCCESS )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",571
000003AC A809                    		MOV.L 04H[R0], R1
000003AE 05rrrrrr             A  		BSR _vee_check_record
000003B2 6101                    		CMP #00H, R1
000003B4 21rr                    		BNE L128
000003B6                         L120:	; bb47
                                 ;     572             {            
                                 ;     573                 /* We have a match, copy over record info, keep searching for newer versions though */
                                 ;     574                 vee_temp->check = ptr->check;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",574
000003B6 A809                    		MOV.L 04H[R0], R1
000003B8 A902                    		MOV.L 10H[R0], R2
000003BA D5120202                		MOV.W 04H[R1], 04H[R2]
000003BE                         L121:	; bb47.split
                                 ;     575                 vee_temp->size = ptr->size;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",575
000003BE A809                    		MOV.L 04H[R0], R1
000003C0 A902                    		MOV.L 10H[R0], R2
000003C2 D5120101                		MOV.W 02H[R1], 02H[R2]
000003C6                         L122:	; bb47.split2
                                 ;     576                 vee_temp->pData = (uint8_t far *)&ptr->pData;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",576
000003C6 A809                    		MOV.L 04H[R0], R1
000003C8 6281                    		ADD #08H, R1
000003CA A902                    		MOV.L 10H[R0], R2
000003CC A0A1                    		MOV.L R1, 08H[R2]
000003CE                         L123:	; bb47.split3
                                 ;     577                 vee_temp->block = block;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",577
000003CE A909                    		MOV.L 14H[R0], R1
000003D0 A902                    		MOV.L 10H[R0], R2
000003D2 90A9                    		MOV.W R1, 06H[R2]
000003D4                         L124:	; bb47.split4
                                 ;     578                 /* Record found */
                                 ;     579                 record_found = 1;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",579
000003D4 3C0E01                  		MOV.B #01H, 0EH[R0]
000003D7                         L125:	; bb88
                                 ;     580             }
                                 ;     581             else
                                 ;     582             {
                                 ;     583                 /* This record is not valid which means that we should not try to continue onwards. Exit loop. */
                                 ;     584                 break;                  
                                 ;     585             }
                                 ;     586         }
                                 ;     587                    
                                 ;     588         /* Move on to next record */
                                 ;     589         ptr = (vee_record_t *)(((uint8_t *)&ptr->pData) + ptr->size);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",589
000003D7 A809                    		MOV.L 04H[R0], R1
000003D9 06C91101                		ADD 02H[R1].UW, R1
000003DD 6281                    		ADD #08H, R1
000003DF A009                    		MOV.L R1, 04H[R0]
000003E1                         L126:	; bb88.split5
                                 ;     590         
                                 ;     591         /* Only need to check boundary if minimum write size is larger than 1 byte */
                                 ;     592         if( sizeof(vee_var_min_t) > 1 )
                                 ;     593         {
                                 ;     594             /* Due to program sizes on some data flashes we need to make sure that we are on a program boundary */
                                 ;     595             ptr = (vee_record_t *)vee_move_to_boundary((uint32_t)ptr); 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",595
000003E1 A809                    		MOV.L 04H[R0], R1
000003E3 05rrrrrr             A  		BSR _vee_move_to_boundary
000003E7 A009                    		MOV.L R1, 04H[R0]
000003E9                         L127:	; bb105
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",557
000003E9 A809                    		MOV.L 04H[R0], R1
000003EB 06850102                		CMP 08H[R0].L, R1
000003EF 23rr                    		BLTU L117
000003F1                         L128:	; bb113
                                 ;     596         }
                                 ;     597     }
                                 ;     598     
                                 ;     599     /* Check to see if record was found */
                                 ;     600     if( record_found == 1 )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",600
000003F1 B381                    		MOVU.B 0EH[R0], R1
000003F3 6111                    		CMP #01H, R1
000003F5 18                   S  		BNE L130
000003F6                         L129:	; bb114
                                 ;     601     {
                                 ;     602         /* Record found */
                                 ;     603         return VEE_SUCCESS;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",603
000003F6 3C0300                  		MOV.B #00H, 03H[R0]
000003F9 08                   S  		BRA L131
000003FA                         L130:	; bb116
                                 ;     604     }
                                 ;     605     else
                                 ;     606     {
                                 ;     607         /* Record not found */
                                 ;     608         return VEE_NOT_FOUND;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",608
000003FA 3C0304                  		MOV.B #04H, 03H[R0]
000003FD                         L131:	; bb124
000003FD C500030F                		MOV.B 03H[R0], 0FH[R0]
                                 ;     609     }
                                 ;     610 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",610
00000401 B389                    		MOVU.B 0FH[R0], R1
00000403 6707                    		RTSD #1CH
00000405                         _R_VEE_Write:
                                 		.STACK	_R_VEE_Write=28
                                 ;     611 /***********************************************************************************************************************
                                 ;     612 End of function vee_find_record
                                 ;     613 ***********************************************************************************************************************/
                                 ;     614 
                                 ;     615 /***********************************************************************************************************************
                                 ;     616 * Function Name: R_VEE_Write
                                 ;     617 * Description  : Attempts to write a VEE Record to the data flash
                                 ;     618 * Arguments    : vee_temp - 
                                 ;     619 *                    Structure with record information
                                 ;     620 * Return Value : VEE_SUCCESS -  
                                 ;     621 *                    Successful, write in progress
                                 ;     622 *                VEE_BUSY -     
                                 ;     623 *                    Defrag in process, try again later
                                 ;     624 *                VEE_NO_ROOM -
                                 ;     625 *                    No room, need to call R_VEE_Erase() 
                                 ;     626 *                VEE_FAILURE -
                                 ;     627 *                    Failure
                                 ;     628 *                VEE_INVALID_INPUT -
                                 ;     629 *                    Record sent in had invalid data.
                                 ;     630 ***********************************************************************************************************************/
                                 ;     631 uint8_t R_VEE_Write (vee_record_t * vee_temp)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",631
00000405 7100E8                  		ADD #0FFFFFFE8H, R0
00000408 A109                    		MOV.L R1, 14H[R0]
0000040A 6602                    		MOV.L #00000000H, R2
                                 ;     632 {
                                 ;     633     /* Local variables */
                                 ;     634     uint8_t sector, ret;
                                 ;     635 
                                 ;     636     /* Check record. */
                                 ;     637     if (VEE_SUCCESS != vee_check_input_record(vee_temp, false))
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",637
0000040C 39rrrr               W  		BSR __$vee_check_input_record
0000040F 6101                    		CMP #00H, R1
00000411 10                   S  		BEQ L134
00000412                         L133:	; bb7
                                 ;     638     {
                                 ;     639         /* Record was invalid. E.g. record ID is out of range. */
                                 ;     640         return VEE_INVALID_INPUT;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",640
00000412 3C0106                  		MOV.B #06H, 01H[R0]
00000415 38rrrr               W  		BRA L172
00000418                         L134:	; bb15
00000418 6621                    		MOV.L #00000002H, R1
                                 ;     641     }
                                 ;     642 
                                 ;     643     /* Try to grab VEE State */
                                 ;     644     if( vee_grab_state(VEE_WRITING) != VEE_SUCCESS )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",644
0000041A 39rrrr               W  		BSR __$vee_grab_state
0000041D 6101                    		CMP #00H, R1
0000041F 10                   S  		BEQ L136
00000420                         L135:	; bb16
                                 ;     645     {
                                 ;     646         /* Could not grab state */
                                 ;     647         return VEE_BUSY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",647
00000420 3C0102                  		MOV.B #02H, 01H[R0]
00000423 38rrrr               W  		BRA L172
00000426                         L136:	; bb23
                                 ;     648     }
                                 ;     649         
                                 ;     650     /* Get which sector this record will be stored in */
                                 ;     651     sector = g_vee_RecordLocations[vee_temp->ID];
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",651
00000426 A909                    		MOV.L 14H[R0], R1
00000428 5C1E                    		MOVU.W [R1], R14
0000042A FBF2rrrrrrrr            		MOV.L #_g_vee_RecordLocations, R15
00000430 FECFE1                  		MOVU.B [R15,R14], R1
00000433 8081                    		MOV.B R1, 02H[R0]
00000435                         L137:	; bb23.split
                                 ;     652     
                                 ;     653 #ifdef VEE_IGNORE_DUPLICATE_WRITES
                                 ;     654     {
                                 ;     655     /* Used for checking entries */        
                                 ;     656     vee_record_t VEE_existing;
                                 ;     657     /* Loop variable */
                                 ;     658     vee_var_data_t i;
                                 ;     659     /* Boolean for whether records match */
                                 ;     660     uint8_t same;
                                 ;     661     
                                 ;     662     /* Check to see if the data that the user wants to write is the same as the record already in the VEE.  If so, 
                                 ;     663        ignore this new write */
                                 ;     664        
                                 ;     665     /* Check to see if entry is cached */       
                                 ;     666     if( g_vee_cache.entries[vee_temp->ID].valid == VEE_CACHE_ENTRY_VALID )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",666
00000435 A909                    		MOV.L 14H[R0], R1
00000437 5C1E                    		MOVU.W [R1], R14
00000439 63CE                    		MUL #0CH, R14
0000043B FB12rrrrrrrr            		MOV.L #__$g_vee_cache, R1
00000441 4BE1                    		ADD R14, R1
00000443 B111                    		MOVU.B 04H[R1], R1
00000445 755185                  		CMP #85H, R1
00000448 21rr                    		BNE L140
0000044A                         L138:	; bb31
                                 ;     667     {
                                 ;     668         /* Copy over record information from data flash */
                                 ;     669         memcpy(&VEE_existing, g_vee_cache.entries[vee_temp->ID].address, sizeof(VEE_existing));    
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",669
0000044A A909                    		MOV.L 14H[R0], R1
0000044C 5C1E                    		MOVU.W [R1], R14
0000044E 63CE                    		MUL #0CH, R14
00000450 FB12rrrrrrrr            		MOV.L #__$g_vee_cache, R1
00000456 4BE1                    		ADD R14, R1
00000458 A899                    		MOV.L 0CH[R1], R1
0000045A E5100203                		MOV.L 08H[R1], 0CH[R0]
0000045E E5100102                		MOV.L 04H[R1], 08H[R0]
00000462 E41001                  		MOV.L [R1], 04H[R0]
00000465                         L139:	; bb31.split
                                 ;     670                
                                 ;     671         /* Fix pData pointer */
                                 ;     672         VEE_existing.pData = ((uint8_t far *)g_vee_cache.entries[vee_temp->ID].address) + offsetof(vee_record_t, pData);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",672
00000465 A909                    		MOV.L 14H[R0], R1
00000467 5C1E                    		MOVU.W [R1], R14
00000469 63CE                    		MUL #0CH, R14
0000046B FB12rrrrrrrr            		MOV.L #__$g_vee_cache, R1
00000471 4BE1                    		ADD R14, R1
00000473 A899                    		MOV.L 0CH[R1], R1
00000475 6281                    		ADD #08H, R1
00000477 A089                    		MOV.L R1, 0CH[R0]
00000479 2Err                 B  		BRA L147
0000047B                         L140:	; bb51
                                 ;     673     }
                                 ;     674     else
                                 ;     675     {
                                 ;     676         /* Record not in cache, try to find it */
                                 ;     677         
                                 ;     678         /* Copy over ID */
                                 ;     679         VEE_existing.ID = vee_temp->ID;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",679
0000047B A909                    		MOV.L 14H[R0], R1
0000047D D41002                  		MOV.W [R1], 04H[R0]
00000480                         L141:	; bb51.split
                                 ;     680         
                                 ;     681         /* Make pData 0 so we will know if we found the record or not */
                                 ;     682         VEE_existing.pData = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",682
00000480 3E0300                  		MOV.L #00000000H, 0CH[R0]
00000483                         L142:	; bb51.split1
00000483 710104                  		ADD #04H, R0, R1
                                 ;     683         
                                 ;     684         /* Seek for record */
                                 ;     685         vee_seek(&VEE_existing);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",685
00000486 39rrrr               W  		BSR __$vee_seek
00000489                         L143:	; bb51.split2
                                 ;     686         
                                 ;     687         /* If record was found then go ahead and update cache */
                                 ;     688         if( (uint32_t)VEE_existing.pData != 0 )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",688
00000489 A889                    		MOV.L 0CH[R0], R1
0000048B 6101                    		CMP #00H, R1
0000048D 20rr                    		BEQ L147
0000048F                         L144:	; bb59
                                 ;     689         {
                                 ;     690             /* Record was found, update cache */            
                                 ;     691             g_vee_cache.entries[VEE_existing.ID].address = (vee_record_t far *)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",691
0000048F B881                    		MOVU.W 04H[R0], R1
00000491 63C1                    		MUL #0CH, R1
00000493 FB22rrrrrrrr            		MOV.L #__$g_vee_cache, R2
00000499 4B12                    		ADD R1, R2
0000049B A889                    		MOV.L 0CH[R0], R1
0000049D 6081                    		SUB #08H, R1
0000049F A0A9                    		MOV.L R1, 0CH[R2]
000004A1                         L145:	; bb59.split
                                 ;     692                                                            (VEE_existing.pData - offsetof(vee_record_t, pData));
                                 ;     693 
                                 ;     694             /* Update which VEE Block the record is in */
                                 ;     695             g_vee_cache.entries[VEE_existing.ID].block = VEE_existing.block;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",695
000004A1 B881                    		MOVU.W 04H[R0], R1
000004A3 63C1                    		MUL #0CH, R1
000004A5 FB22rrrrrrrr            		MOV.L #__$g_vee_cache, R2
000004AB 4B12                    		ADD R1, R2
000004AD B909                    		MOVU.W 0AH[R0], R1
000004AF A0A1                    		MOV.L R1, 08H[R2]
000004B1                         L146:	; bb59.split3
                                 ;     696                     
                                 ;     697             /* Set cache entry as valid */
                                 ;     698             g_vee_cache.entries[VEE_existing.ID].valid = VEE_CACHE_ENTRY_VALID;              
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",698
000004B1 B881                    		MOVU.W 04H[R0], R1
000004B3 63C1                    		MUL #0CH, R1
000004B5 FB22rrrrrrrr            		MOV.L #__$g_vee_cache, R2
000004BB 4B12                    		ADD R1, R2
000004BD 3C2485                  		MOV.B #85H, 04H[R2]
000004C0                         L147:	; bb101
                                 ;     699         }
                                 ;     700     }
                                 ;     701     
                                 ;     702     /* Was there an existing record with same ID? */
                                 ;     703     if( (uint32_t)VEE_existing.pData != 0 )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",703
000004C0 A889                    		MOV.L 0CH[R0], R1
000004C2 6101                    		CMP #00H, R1
000004C4 20rr                    		BEQ L160
000004C6                         L148:	; bb103
                                 ;     704     {                        
                                 ;     705         /* Check size field */
                                 ;     706         if( vee_temp->size == VEE_existing.size )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",706
000004C6 A909                    		MOV.L 14H[R0], R1
000004C8 B819                    		MOVU.W 02H[R1], R1
000004CA 06C50103                		CMP 06H[R0].UW, R1
000004CE 21rr                    		BNE L160
000004D0                         L149:	; bb105
                                 ;     707         {
                                 ;     708             /* Check 'check' field */
                                 ;     709             if( vee_temp->check == VEE_existing.check )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",709
000004D0 A909                    		MOV.L 14H[R0], R1
000004D2 B891                    		MOVU.W 04H[R1], R1
000004D4 06C50104                		CMP 08H[R0].UW, R1
000004D8 21rr                    		BNE L160
000004DA                         L150:	; bb106
                                 ;     710             {
                                 ;     711                 /* Check data */
                                 ;     712                 same = 1;         
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",712
000004DA 3C8201                  		MOV.B #01H, 12H[R0]
000004DD                         L151:	; bb106.split
                                 ;     713 
                                 ;     714                 for(i = 0; i < vee_temp->size; i++)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",714
000004DD 3D0800                  		MOV.W #0000H, 10H[R0]
000004E0 2Err                 B  		BRA L155
000004E2                         L152:	; bb108
                                 ;     715                 {
                                 ;     716                     /* Check byte by byte */
                                 ;     717                     if( vee_temp->pData[i] != VEE_existing.pData[i] )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",717
000004E2 BA01                    		MOVU.W 10H[R0], R1
000004E4 A88A                    		MOV.L 0CH[R0], R2
000004E6 FEC21E                  		MOVU.B [R2,R1], R14
000004E9 A90A                    		MOV.L 14H[R0], R2
000004EB A8A2                    		MOV.L 08H[R2], R2
000004ED FEC21F                  		MOVU.B [R2,R1], R15
000004F0 47EF                    		CMP R14, R15
000004F2 10                   S  		BEQ L154
000004F3                         L153:	; bb109
                                 ;     718                     {
                                 ;     719                         /* Data does not match */
                                 ;     720                         same = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",720
000004F3 3C8200                  		MOV.B #00H, 12H[R0]
000004F6 2Err                 B  		BRA L156
000004F8                         L154:	; bb129
000004F8 9A01                    		MOV.W 10H[R0], R1
000004FA 6211                    		ADD #01H, R1
000004FC 9201                    		MOV.W R1, 10H[R0]
000004FE                         L155:	; bb132
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",714
000004FE A909                    		MOV.L 14H[R0], R1
00000500 BA02                    		MOVU.W 10H[R0], R2
00000502 06C51201                		CMP 02H[R1].UW, R2
00000506 29rr                    		BLT L152
00000508                         L156:	; bb144
                                 ;     721                         
                                 ;     722                         break;
                                 ;     723                     }
                                 ;     724                 }
                                 ;     725                 
                                 ;     726                 /* Did all data match? */
                                 ;     727                 if( same == 1 )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",727
00000508 B481                    		MOVU.B 12H[R0], R1
0000050A 6111                    		CMP #01H, R1
0000050C 21rr                    		BNE L160
0000050E                         L157:	; bb145
                                 ;     728                 {
                                 ;     729                     /* Release state */
                                 ;     730                     g_vee_state = VEE_READY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",730
0000050E FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00000514 F8E600                  		MOV.L #00000000H, [R14]
00000517                         L158:	; bb145.split
                                 ;     731                     
                                 ;     732                     /* Data did match */
                                 ;     733                     #ifdef VEE_CALLBACK_FUNCTION
                                 ;     734                     /* Call user's callback function */
                                 ;     735                     VEE_CALLBACK_FUNCTION();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",735
00000517 05rrrrrr             A  		BSR _VEE_OperationDone_Callback
0000051B                         L159:	; bb145.split4
                                 ;     736                     #endif
                                 ;     737                     
                                 ;     738                     /* No need to write */
                                 ;     739                     return VEE_SUCCESS;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",739
0000051B 3C0100                  		MOV.B #00H, 01H[R0]
0000051E 38rrrr               W  		BRA L172
00000521                         L160:	; bb182
                                 ;     740                 }
                                 ;     741                 /* Data did not match, continue with write */
                                 ;     742             }
                                 ;     743         }                            
                                 ;     744     }
                                 ;     745     }
                                 ;     746 #endif       
                                 ;     747     
                                 ;     748     /* Check to see if the next available address cached */
                                 ;     749     if( g_vee_next_address[sector].valid != VEE_CACHE_ENTRY_VALID )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",749
00000521 B081                    		MOVU.B 02H[R0], R1
00000523 63C1                    		MUL #0CH, R1
00000525 FBE2rrrrrrrr            		MOV.L #__$g_vee_next_address, R14
0000052B FECE1E                  		MOVU.B [R14,R1], R14
0000052E 755E85                  		CMP #85H, R14
00000531 20rr                    		BEQ L167
00000533                         L161:	; bb183
                                 ;     750     {
                                 ;     751         /* Next available write address not in cache.  This means that this is the first write that has been issued.  
                                 ;     752            At this point error checking be done on this VEE Sector to see if a power down occurred during a program or 
                                 ;     753            erasure.  If a error is detected, the API will start the process of fixing the problem. If no error is 
                                 ;     754            detected then this write will proceed on. */
                                 ;     755         ret = vee_check_sector(sector);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",755
00000533 B081                    		MOVU.B 02H[R0], R1
00000535 39rrrr               W  		BSR __$vee_check_sector
00000538 8089                    		MOV.B R1, 03H[R0]
0000053A                         L162:	; bb183.split
                                 ;     756         
                                 ;     757         /* Check return value */
                                 ;     758         if( ret == VEE_BUSY )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",758
0000053A B089                    		MOVU.B 03H[R0], R1
0000053C 6121                    		CMP #02H, R1
0000053E 18                   S  		BNE L164
0000053F                         L163:	; bb187
                                 ;     759         {
                                 ;     760             /* Something had to be fixed or initialized, come back later */
                                 ;     761             return VEE_BUSY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",761
0000053F 3C0102                  		MOV.B #02H, 01H[R0]
00000542 2Err                 B  		BRA L172
00000544                         L164:	; bb190
                                 ;     762         }                       
                                 ;     763         else if( ret == VEE_NOT_FOUND )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",763
00000544 B089                    		MOVU.B 03H[R0], R1
00000546 6141                    		CMP #04H, R1
00000548 21rr                    		BNE L167
0000054A                         L165:	; bb191
                                 ;     764         {
                                 ;     765             /* In this case no ACTIVE block was found so a blank check is now ongoing. If it returns that the block is 
                                 ;     766                blank then it will write the ACTIVE flag and then the record */
                                 ;     767 
                                 ;     768             /* Copy over record information to write to global variable */
                                 ;     769             memcpy(&g_vee_current_record, vee_temp, sizeof(g_vee_current_record));               
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",769
0000054A FBE2rrrrrrrr            		MOV.L #__$g_vee_current_record, R14
00000550 A909                    		MOV.L 14H[R0], R1
00000552 E51E0202                		MOV.L 08H[R1], 08H[R14]
00000556 E51E0101                		MOV.L 04H[R1], 04H[R14]
0000055A E01E                    		MOV.L [R1], [R14]
0000055C                         L166:	; bb191.split
                                 ;     770 
                                 ;     771             /* Record will be written once data flash is setup */                           
                                 ;     772             return VEE_SUCCESS;               
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",772
0000055C 3C0100                  		MOV.B #00H, 01H[R0]
0000055F 2Err                 B  		BRA L172
00000561                         L167:	; bb217
                                 ;     773         }      
                                 ;     774     }
                                 ;     775     
                                 ;     776     /* Is there room for this write? Need to take into consideration VEE structure as well as record data. */
                                 ;     777     if( ((uint32_t)g_vee_next_address[sector].address + vee_temp->size + sizeof(vee_record_t) - 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",777
00000561 B081                    		MOVU.B 02H[R0], R1
00000563 EF1E                    		MOV.L R1, R14
00000565 751E14                  		MUL #14H, R14
00000568 FB22rrrrrrrr            		MOV.L #_g_vee_Sectors, R2
0000056E 4BE2                    		ADD R14, R2
00000570 A8A3                    		MOV.L 08H[R2], R3
00000572 63C1                    		MUL #0CH, R1
00000574 FB42rrrrrrrr            		MOV.L #__$g_vee_next_address, R4
0000057A 4B14                    		ADD R1, R4
0000057C A849                    		MOV.L 04H[R4], R1
0000057E FE613E                  		MOV.L [R1,R3], R14
00000581 06892E01                		ADD 04H[R2].L, R14
00000585 A8C1                    		MOV.L 08H[R4], R1
00000587 A90A                    		MOV.L 14H[R0], R2
00000589 06C92101                		ADD 02H[R2].UW, R1
0000058D 6281                    		ADD #08H, R1
0000058F 47E1                    		CMP R14, R1
00000591 25rr                    		BLEU L171
00000593                         L168:	; bb218
                                 ;     778          sizeof(g_vee_current_record.pData)) > 
                                 ;     779         (g_vee_Sectors[sector].VEE_block_addr[g_vee_next_address[sector].block] + g_vee_Sectors[sector].VEE_block_size) )
                                 ;     780     {
                                 ;     781         /* Change state to signify write and defrag */
                                 ;     782         g_vee_state = VEE_WRITE_AND_DEFRAG;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",782
00000593 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00000599 F8E606                  		MOV.L #00000006H, [R14]
0000059C                         L169:	; bb218.split
                                 ;     783         
                                 ;     784         /* Copy over record information to write to global variable */
                                 ;     785         memcpy(&g_vee_current_record, vee_temp, sizeof(g_vee_current_record));
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",785
0000059C FBE2rrrrrrrr            		MOV.L #__$g_vee_current_record, R14
000005A2 A909                    		MOV.L 14H[R0], R1
000005A4 E51E0202                		MOV.L 08H[R1], 08H[R14]
000005A8 E51E0101                		MOV.L 04H[R1], 04H[R14]
000005AC E01E                    		MOV.L [R1], [R14]
000005AE                         L170:	; bb218.split5
                                 ;     786         
                                 ;     787         /* Not enough room, time for a defrag */
                                 ;     788         return R_VEE_Defrag(sector);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",788
000005AE B081                    		MOVU.B 02H[R0], R1
000005B0 39rrrr               W  		BSR _R_VEE_Defrag
000005B3 8009                    		MOV.B R1, 01H[R0]
000005B5 08                   S  		BRA L172
000005B6                         L171:	; bb224
                                 ;     789     }
                                 ;     790     else
                                 ;     791     {
                                 ;     792         /* Room is available, write the record */
                                 ;     793         return vee_start_write(vee_temp);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",793
000005B6 A909                    		MOV.L 14H[R0], R1
000005B8 39rrrr               W  		BSR __$vee_start_write
000005BB 8009                    		MOV.B R1, 01H[R0]
000005BD                         L172:	; bb263
000005BD C5000113                		MOV.B 01H[R0], 13H[R0]
                                 ;     794     }
                                 ;     795 
                                 ;     796 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",796
000005C1 B489                    		MOVU.B 13H[R0], R1
000005C3 6706                    		RTSD #18H
000005C5                         __$vee_start_write:
                                 		.STACK	__$vee_start_write=12
                                 ;     797 /***********************************************************************************************************************
                                 ;     798 End of function R_VEE_Write
                                 ;     799 ***********************************************************************************************************************/
                                 ;     800 
                                 ;     801 /***********************************************************************************************************************
                                 ;     802 * Function Name: vee_start_write
                                 ;     803 * Description  : Starts writing of record to data flash
                                 ;     804 * Arguments    : vee_temp - 
                                 ;     805 *                    Structure with record information
                                 ;     806 * Return Value : VEE_SUCCESS -  
                                 ;     807 *                    Successful, write in progress
                                 ;     808 *                VEE_FAILURE -  
                                 ;     809 *                    Failure
                                 ;     810 ***********************************************************************************************************************/
                                 ;     811 VEE_STATIC uint8_t vee_start_write (vee_record_t * vee_temp)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",811
000005C5 6080                    		SUB #08H, R0
000005C7 A009                    		MOV.L R1, 04H[R0]
                                 ;     812 {
                                 ;     813     if( g_vee_next_address[g_vee_RecordLocations[vee_temp->ID]].valid != VEE_CACHE_ENTRY_VALID )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",813
000005C9 5C1E                    		MOVU.W [R1], R14
000005CB FBF2rrrrrrrr            		MOV.L #_g_vee_RecordLocations, R15
000005D1 FECFEE                  		MOVU.B [R15,R14], R14
000005D4 63CE                    		MUL #0CH, R14
000005D6 FBF2rrrrrrrr            		MOV.L #__$g_vee_next_address, R15
000005DC FECFEE                  		MOVU.B [R15,R14], R14
000005DF 755E85                  		CMP #85H, R14
000005E2 10                   S  		BEQ L175
000005E3                         L174:	; bb2
                                 ;     814     {
                                 ;     815         /* Next available address should already have been filled in */
                                 ;     816         return VEE_FAILURE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",816
000005E3 3C0201                  		MOV.B #01H, 02H[R0]
000005E6 38rrrr               W  		BRA L182
000005E9                         L175:	; bb17
                                 ;     817     }
                                 ;     818     
                                 ;     819     /* Init R_g_vee_write_address structure */
                                 ;     820     g_vee_write_address = (vee_record_t far *) g_vee_next_address[g_vee_RecordLocations[vee_temp->ID]].address;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",820
000005E9 A809                    		MOV.L 04H[R0], R1
000005EB 5C1E                    		MOVU.W [R1], R14
000005ED FBF2rrrrrrrr            		MOV.L #_g_vee_RecordLocations, R15
000005F3 FECFEE                  		MOVU.B [R15,R14], R14
000005F6 63CE                    		MUL #0CH, R14
000005F8 FBF2rrrrrrrr            		MOV.L #__$g_vee_next_address, R15
000005FE 4BEF                    		ADD R14, R15
00000600 FBE2rrrrrrrr            		MOV.L #__$g_vee_write_address, R14
00000606 E1FE02                  		MOV.L 08H[R15], [R14]
00000609                         L176:	; bb17.split
                                 ;     821                        
                                 ;     822     /* Set g_vee_current_sector to update NextAddress later */
                                 ;     823     g_vee_current_sector = g_vee_RecordLocations[vee_temp->ID];
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",823
00000609 A809                    		MOV.L 04H[R0], R1
0000060B 5C1E                    		MOVU.W [R1], R14
0000060D FBF2rrrrrrrr            		MOV.L #_g_vee_RecordLocations, R15
00000613 FECFEE                  		MOVU.B [R15,R14], R14
00000616 FBF2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R15
0000061C C3FE                    		MOV.B R14, [R15]
0000061E                         L177:	; bb17.split1
                                 ;     824                        
                                 ;     825     /* Copy over record information to write to global variable */
                                 ;     826     memcpy(&g_vee_current_record, vee_temp, sizeof(g_vee_current_record));   
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",826
0000061E FBE2rrrrrrrr            		MOV.L #__$g_vee_current_record, R14
00000624 A809                    		MOV.L 04H[R0], R1
00000626 E51E0202                		MOV.L 08H[R1], 08H[R14]
0000062A E51E0101                		MOV.L 04H[R1], 04H[R14]
0000062E E01E                    		MOV.L [R1], [R14]
00000630                         L178:	; bb17.split2
                                 ;     827     
                                 ;     828     /* Fill in 'block' field */
                                 ;     829     g_vee_current_record.block = g_vee_next_address[g_vee_RecordLocations[vee_temp->ID]].block;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",829
00000630 A809                    		MOV.L 04H[R0], R1
00000632 5C1E                    		MOVU.W [R1], R14
00000634 FBF2rrrrrrrr            		MOV.L #_g_vee_RecordLocations, R15
0000063A FECFEE                  		MOVU.B [R15,R14], R14
0000063D 63CE                    		MUL #0CH, R14
0000063F FB12rrrrrrrr            		MOV.L #__$g_vee_next_address, R1
00000645 4BE1                    		ADD R14, R1
00000647 A819                    		MOV.L 04H[R1], R1
00000649 FB22rrrrrrrr            		MOV.L #__$g_vee_current_record, R2
0000064F 90A9                    		MOV.W R1, 06H[R2]
00000651                         L179:	; bb17.split3
                                 ;     830     
                                 ;     831     /* Write 'ID' structure member */
                                 ;     832     R_FlashWrite( (FLASH_PTR_TYPE)&g_vee_write_address->ID, 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",832
00000651 FBE2rrrrrrrr            		MOV.L #__$g_vee_write_address, R14
00000657 ECE1                    		MOV.L [R14], R1
00000659 6623                    		MOV.L #00000002H, R3
0000065B FB22rrrrrrrr            		MOV.L #__$g_vee_current_record, R2
00000661 05rrrrrr             A  		BSR _R_FlashWrite
00000665                         L180:	; bb17.split4
                                 ;     833                   (BUF_PTR_TYPE)&g_vee_current_record.ID,
                                 ;     834                   sizeof(g_vee_current_record.ID) );                
                                 ;     835 
                                 ;     836     /* Next time in the ISR we will write the 'size' field */
                                 ;     837     g_vee_write_state = VEE_WRITE_SIZE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",837
00000665 FBE2rrrrrrrr            		MOV.L #__$g_vee_write_state, R14
0000066B F8E606                  		MOV.L #00000006H, [R14]
0000066E                         L181:	; bb17.split5
                                 ;     838 
                                 ;     839     return VEE_SUCCESS;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",839
0000066E 3C0200                  		MOV.B #00H, 02H[R0]
00000671                         L182:	; bb53
00000671 C5000203                		MOV.B 02H[R0], 03H[R0]
                                 ;     840 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",840
00000675 B089                    		MOVU.B 03H[R0], R1
00000677 6702                    		RTSD #08H
00000679                         __$vee_check_sector:
                                 		.STACK	__$vee_check_sector=36
                                 ;     841 /***********************************************************************************************************************
                                 ;     842 End of function vee_start_write
                                 ;     843 ***********************************************************************************************************************/
                                 ;     844 
                                 ;     845 
                                 ;     846 /***********************************************************************************************************************
                                 ;     847 * Function Name: vee_check_sector
                                 ;     848 * Description  : Checks for errors in a sector and finds next blank spot
                                 ;     849 * Arguments    : sector - 
                                 ;     850 *                    Which VEE Sector to check
                                 ;     851 * Return Value : VEE_SUCCESS -  
                                 ;     852 *                    Successful, sector is valid and ready
                                 ;     853 *                VEE_BUSY -  
                                 ;     854 *                    Error found, now API is fixing it
                                 ;     855 *                VEE_NOT_FOUND -  
                                 ;     856 *                    No active block found, preparing block
                                 ;     857 ***********************************************************************************************************************/
                                 ;     858 VEE_STATIC uint8_t vee_check_sector (uint8_t sector)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",858
00000679 7100E0                  		ADD #0FFFFFFE0H, R0
0000067C 8789                    		MOV.B R1, 1FH[R0]
                                 ;     859 {
                                 ;     860     /* Loop variables */
                                 ;     861     uint32_t i;
                                 ;     862     /* Structure pointer for VEE Block info */
                                 ;     863     vee_block_info_t block_info;
                                 ;     864     /* The found active block */
                                 ;     865     int32_t active_block;
                                 ;     866     int32_t nextup_block; 
                                 ;     867     int32_t active_and_full_block;
                                 ;     868     
                                 ;     869     /* Init variables */
                                 ;     870     active_and_full_block = -1;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",870
0000067E F90606FF                		MOV.L #0FFFFFFFFH, 18H[R0]
00000682                         L184:	; entry.split
                                 ;     871     nextup_block = -1;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",871
00000682 F90605FF                		MOV.L #0FFFFFFFFH, 14H[R0]
00000686                         L185:	; entry.split1
                                 ;     872     active_block = -1;    
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",872
00000686 F90604FF                		MOV.L #0FFFFFFFFH, 10H[R0]
0000068A                         L186:	; entry.split2
                                 ;     873     
                                 ;     874     /* Loop through VEE Blocks in this VEE Sector */
                                 ;     875     for(i = 0; i < g_vee_Sectors[sector].num_VEE_blocks; i++)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",875
0000068A 3E0200                  		MOV.L #00000000H, 08H[R0]
0000068D 38rrrr               W  		BRA L220
00000690                         L187:	; bb
                                 ;     876     {
                                 ;     877         /* Get information from status flags about this block */
                                 ;     878         vee_get_block_info(sector, i, &block_info);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",878
00000690 A882                    		MOV.L 08H[R0], R2
00000692 B789                    		MOVU.B 1FH[R0], R1
00000694 71030C                  		ADD #0CH, R0, R3
00000697 05rrrrrr             A  		BSR _vee_get_block_info
0000069B                         L188:	; bb.split
                                 ;     879                 
                                 ;     880         if( block_info.erasing == VEE_BLOCK_FLAG_SET )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",880
0000069B B301                    		MOVU.B 0CH[R0], R1
0000069D 6111                    		CMP #01H, R1
0000069F 21rr                    		BNE L195
000006A1                         L189:	; bb11
                                 ;     881         {
                                 ;     882             /* Set global variables which will allow us to erase multiple blocks without user intervention */
                                 ;     883             g_vee_erase_block_current = g_vee_Sectors[sector].df_blocks[i][0];
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",883
000006A1 B789                    		MOVU.B 1FH[R0], R1
000006A3 751114                  		MUL #14H, R1
000006A6 FBE2rrrrrrrr            		MOV.L #_g_vee_Sectors, R14
000006AC 4B1E                    		ADD R1, R14
000006AE A881                    		MOV.L 08H[R0], R1
000006B0 6C31                    		SHLL #03H, R1
000006B2 0689E104                		ADD 10H[R14].L, R1
000006B6 FBE2rrrrrrrr            		MOV.L #__$g_vee_erase_block_current, R14
000006BC E01E                    		MOV.L [R1], [R14]
000006BE                         L190:	; bb11.split
                                 ;     884             g_vee_erase_block_end = g_vee_Sectors[sector].df_blocks[i][1];             
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",884
000006BE B789                    		MOVU.B 1FH[R0], R1
000006C0 751114                  		MUL #14H, R1
000006C3 FBE2rrrrrrrr            		MOV.L #_g_vee_Sectors, R14
000006C9 4B1E                    		ADD R1, R14
000006CB A881                    		MOV.L 08H[R0], R1
000006CD 6C31                    		SHLL #03H, R1
000006CF 0689E104                		ADD 10H[R14].L, R1
000006D3 FBE2rrrrrrrr            		MOV.L #__$g_vee_erase_block_end, R14
000006D9 E11E01                  		MOV.L 04H[R1], [R14]
000006DC                         L191:	; bb11.split3
                                 ;     885             
                                 ;     886             /* Set state to erasing */
                                 ;     887             g_vee_state = VEE_ERASING;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",887
000006DC FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
000006E2 F8E603                  		MOV.L #00000003H, [R14]
000006E5                         L192:	; bb11.split4
                                 ;     888             
                                 ;     889             /* This block was interrupted during an erase, start erase again */
                                 ;     890             if( R_FlashErase(g_vee_erase_block_end) != FLASH_SUCCESS )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",890
000006E5 FBE2rrrrrrrr            		MOV.L #__$g_vee_erase_block_end, R14
000006EB ECE1                    		MOV.L [R14], R1
000006ED 05rrrrrr             A  		BSR _R_FlashErase
000006F1 6101                    		CMP #00H, R1
000006F3 10                   S  		BEQ L194
000006F4                         L193:	; bb33
                                 ;     891             {            
                                 ;     892                 /* Something failed in the FlashAPI */
                                 ;     893                 FlashError();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",893
000006F4 05rrrrrr             A  		BSR _FlashError
000006F8                         L194:	; bb39
                                 ;     894             } 
                                 ;     895             
                                 ;     896             /* Erase in process */
                                 ;     897             return VEE_BUSY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",897
000006F8 3C0702                  		MOV.B #02H, 07H[R0]
000006FB 38rrrr               W  		BRA L278
000006FE                         L195:	; bb42
                                 ;     898         }
                                 ;     899         else if( (block_info.active == VEE_BLOCK_FLAG_SET) &&
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",899
000006FE B309                    		MOVU.B 0DH[R0], R1
00000700 6111                    		CMP #01H, R1
00000702 3Arrrr               W  		BEQ L215
00000705 38rrrr               W  		BRA L217
00000708                         L196:	; bb43
                                 ;     900                  (block_info.full   == VEE_BLOCK_FLAG_NOT_SET) )
                                 ;     901         {
                                 ;     902             /* ACTIVE block found, keep searching to make sure other blocks
                                 ;     903                are okay (e.g. make sure no blocks failed during erasure) */
                                 ;     904             active_block = i;            
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",904
00000708 E5000204                		MOV.L 08H[R0], 10H[R0]
0000070C 38rrrr               W  		BRA L219
0000070F                         L197:	; bb46
                                 ;     905         }
                                 ;     906         else if( (block_info.active == VEE_BLOCK_FLAG_NOT_SET) &&
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",906
0000070F B309                    		MOVU.B 0DH[R0], R1
00000711 6101                    		CMP #00H, R1
00000713 20rr                    		BEQ L211
00000715 2Err                 B  		BRA L213
00000717                         L198:	; bb48
                                 ;     907                  (block_info.nextup == VEE_BLOCK_FLAG_SET) )
                                 ;     908         {
                                 ;     909             /* In this case a reset interrupted a defrag. To fix this we need to erase the NEXTUP block and try the 
                                 ;     910                defrag again. */
                                 ;     911             if( active_and_full_block != -1 )                        
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",911
00000717 A981                    		MOV.L 18H[R0], R1
00000719 7501FF                  		CMP #0FFFFFFFFH, R1
0000071C 20rr                    		BEQ L201
0000071E                         L199:	; bb49
                                 ;     912             {   
                                 ;     913                 /* The ACTIVE & FULL block has already been found */         
                                 ;     914                 vee_erase_and_defrag(sector, (uint32_t)active_and_full_block, i);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",914
0000071E A883                    		MOV.L 08H[R0], R3
00000720 A982                    		MOV.L 18H[R0], R2
00000722 B789                    		MOVU.B 1FH[R0], R1
00000724 39rrrr               W  		BSR __$vee_erase_and_defrag
00000727                         L200:	; bb49.split
                                 ;     915                 
                                 ;     916                 /* Write will have to wait */
                                 ;     917                 return VEE_BUSY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",917
00000727 3C0702                  		MOV.B #02H, 07H[R0]
0000072A 38rrrr               W  		BRA L278
0000072D                         L201:	; bb55
                                 ;     918             }
                                 ;     919             else
                                 ;     920             {
                                 ;     921                 /* We now need to find the ACTIVE & FULL block to start Erase & Defrag */
                                 ;     922                 nextup_block = i;                
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",922
0000072D E5000205                		MOV.L 08H[R0], 14H[R0]
00000731 2Err                 B  		BRA L219
00000733                         L202:	; bb63
                                 ;     923             }
                                 ;     924         }
                                 ;     925         else if( (block_info.active == VEE_BLOCK_FLAG_SET) &&
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",925
00000733 B309                    		MOVU.B 0DH[R0], R1
00000735 6111                    		CMP #01H, R1
00000737 20rr                    		BEQ L207
00000739 2Err                 B  		BRA L209
0000073B                         L203:	; bb65
                                 ;     926                  (block_info.full   == VEE_BLOCK_FLAG_SET) )
                                 ;     927         { 
                                 ;     928             /* We found a block that was ACTIVE and FULL.  A defrag should have been started */
                                 ;     929             if( nextup_block != -1 )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",929
0000073B A909                    		MOV.L 14H[R0], R1
0000073D 7501FF                  		CMP #0FFFFFFFFH, R1
00000740 20rr                    		BEQ L206
00000742                         L204:	; bb66
                                 ;     930             {
                                 ;     931                 /* The NEXTUP block has already been found. Erase that block and start defrag again */
                                 ;     932                 vee_erase_and_defrag(sector, i, (uint32_t)nextup_block);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",932
00000742 A90B                    		MOV.L 14H[R0], R3
00000744 A882                    		MOV.L 08H[R0], R2
00000746 B789                    		MOVU.B 1FH[R0], R1
00000748 39rrrr               W  		BSR __$vee_erase_and_defrag
0000074B                         L205:	; bb66.split
                                 ;     933                 
                                 ;     934                 /* Write will have to wait */
                                 ;     935                 return VEE_BUSY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",935
0000074B 3C0702                  		MOV.B #02H, 07H[R0]
0000074E 38rrrr               W  		BRA L278
00000751                         L206:	; bb72
                                 ;     936             }
                                 ;     937             else
                                 ;     938             {
                                 ;     939                 /* Defrag is needed, find the NEXTUP block if there is one */
                                 ;     940                 active_and_full_block = i;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",940
00000751 E5000206                		MOV.L 08H[R0], 18H[R0]
00000755 2Err                 B  		BRA L219
00000757                         L207:	; bb84
00000757 B381                    		MOVU.B 0EH[R0], R1
00000759 6111                    		CMP #01H, R1
0000075B 18                   S  		BNE L209
0000075C                         L208:	; bb90
0000075C F80601                  		MOV.L #00000001H, [R0]
0000075F 08                   S  		BRA L210
00000760                         L209:	; bb91
00000760 F80600                  		MOV.L #00000000H, [R0]
00000763                         L210:	; bb92
00000763 EC01                    		MOV.L [R0], R1
00000765 6101                    		CMP #00H, R1
00000767 21rr                    		BNE L203
00000769 2Err                 B  		BRA L219
0000076B                         L211:	; bb103
0000076B B389                    		MOVU.B 0FH[R0], R1
0000076D 6111                    		CMP #01H, R1
0000076F 18                   S  		BNE L213
00000770                         L212:	; bb109
00000770 F80601                  		MOV.L #00000001H, [R0]
00000773 08                   S  		BRA L214
00000774                         L213:	; bb110
00000774 F80600                  		MOV.L #00000000H, [R0]
00000777                         L214:	; bb111
00000777 EC01                    		MOV.L [R0], R1
00000779 6101                    		CMP #00H, R1
0000077B 21rr                    		BNE L198
0000077D 2Err                 B  		BRA L202
0000077F                         L215:	; bb122
0000077F B381                    		MOVU.B 0EH[R0], R1
00000781 6101                    		CMP #00H, R1
00000783 18                   S  		BNE L217
00000784                         L216:	; bb128
00000784 F80601                  		MOV.L #00000001H, [R0]
00000787 08                   S  		BRA L218
00000788                         L217:	; bb129
00000788 F80600                  		MOV.L #00000000H, [R0]
0000078B                         L218:	; bb130
0000078B EC01                    		MOV.L [R0], R1
0000078D 6101                    		CMP #00H, R1
0000078F 3Brrrr               W  		BNE L196
00000792 38rrrr               W  		BRA L197
00000795                         L219:	; bb142
00000795 A881                    		MOV.L 08H[R0], R1
00000797 6211                    		ADD #01H, R1
00000799 A081                    		MOV.L R1, 08H[R0]
0000079B                         L220:	; bb145
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",875
0000079B B789                    		MOVU.B 1FH[R0], R1
0000079D 751114                  		MUL #14H, R1
000007A0 FB22rrrrrrrr            		MOV.L #_g_vee_Sectors, R2
000007A6 4B12                    		ADD R1, R2
000007A8 B029                    		MOVU.B 01H[R2], R1
000007AA 06850102                		CMP 08H[R0].L, R1
000007AE 25rr                  * 		BGTU L187
         38rrrr                  
000007B3                         L221:	; bb157
                                 ;     941             }
                                 ;     942         }
                                 ;     943     }
                                 ;     944     
                                 ;     945     /* Check results of searching the sector */
                                 ;     946     if( (active_block != -1) && ((active_and_full_block != -1) || (nextup_block != -1)) )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",946
000007B3 A901                    		MOV.L 10H[R0], R1
000007B5 7501FF                  		CMP #0FFFFFFFFH, R1
000007B8 21rr                    		BNE L227
000007BA 2Err                 B  		BRA L233
000007BC                         L222:	; bb159
                                 ;     947     {
                                 ;     948         /* This should not happen, there is a block marked ACTIVE and also another block that is marked ACTIVE or 
                                 ;     949            NEXTUP. This likely means that an erase failed.  Try to erase the block again */
                                 ;     950         if( active_and_full_block != -1 )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",950
000007BC 7501FF                  		CMP #0FFFFFFFFH, R1
000007BF B789                    		MOVU.B 1FH[R0], R1
000007C1 20rr                    		BEQ L225
000007C3                         L223:	; bb160
                                 ;     951         {
                                 ;     952             /* Should invalidate the cache in case records in the FULL block have been read. */
                                 ;     953             vee_invalidate_cache(sector);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",953
000007C3 5B11                    		MOVU.B R1, R1
000007C5 39rrrr               W  		BSR __$vee_invalidate_cache
000007C8                         L224:	; bb160.split
                                 ;     954 
                                 ;     955             /* This block was interrupted during an erase, start erase again */
                                 ;     956             vee_erase_block(sector, (uint32_t)active_and_full_block);            
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",956
000007C8 A982                    		MOV.L 18H[R0], R2
000007CA B789                    		MOVU.B 1FH[R0], R1
000007CC 39rrrr               W  		BSR __$vee_erase_block
000007CF 08                   S  		BRA L226
000007D0                         L225:	; bb166
                                 ;     957         }
                                 ;     958         else
                                 ;     959         {
                                 ;     960             /* This block was interrupted during an erase, start erase again */
                                 ;     961             vee_erase_block(sector, (uint32_t)nextup_block);                        
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",961
000007D0 A90A                    		MOV.L 14H[R0], R2
000007D2 5B11                    		MOVU.B R1, R1
000007D4 39rrrr               W  		BSR __$vee_erase_block
000007D7                         L226:	; bb174
                                 ;     962         }   
                                 ;     963         
                                 ;     964         /* Erase in process */
                                 ;     965         return VEE_BUSY;        
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",965
000007D7 3C0702                  		MOV.B #02H, 07H[R0]
000007DA 38rrrr               W  		BRA L278
000007DD                         L227:	; bb179
000007DD A981                    		MOV.L 18H[R0], R1
000007DF 7501FF                  		CMP #0FFFFFFFFH, R1
000007E2 18                   S  		BNE L229
000007E3                         L228:	; bb183
000007E3 A909                    		MOV.L 14H[R0], R1
000007E5 7501FF                  		CMP #0FFFFFFFFH, R1
000007E8 10                   S  		BEQ L230
000007E9                         L229:	; bb187
000007E9 F80601                  		MOV.L #00000001H, [R0]
000007EC 08                   S  		BRA L231
000007ED                         L230:	; bb188
000007ED F80600                  		MOV.L #00000000H, [R0]
000007F0                         L231:	; bb189
000007F0 EC01                    		MOV.L [R0], R1
000007F2 6101                    		CMP #00H, R1
000007F4 10                   S  		BEQ L233
000007F5                         L232:	; bb193
000007F5 F80601                  		MOV.L #00000001H, [R0]
000007F8 08                   S  		BRA L234
000007F9                         L233:	; bb194
000007F9 F80600                  		MOV.L #00000000H, [R0]
000007FC                         L234:	; bb195
000007FC EC01                    		MOV.L [R0], R1
000007FE 6101                    		CMP #00H, R1
00000800 A981                    		MOV.L 18H[R0], R1
00000802 21rr                    		BNE L222
00000804                         L235:	; bb201
                                 ;     966     }
                                 ;     967     if( (active_and_full_block != -1) && (nextup_block == -1) )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",967
00000804 7501FF                  		CMP #0FFFFFFFFH, R1
00000807 3Brrrr               W  		BNE L273
0000080A 38rrrr               W  		BRA L275
0000080D                         L236:	; bb202
                                 ;     968     {
                                 ;     969         /* This catches the case between the FULL flag being written in one block and the NEXTUP flag being written in 
                                 ;     970            the other block.  In this case just a defrag is needed */        
                                 ;     971         /* Release state so defrag can start */
                                 ;     972         g_vee_state = VEE_DEFRAG;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",972
0000080D FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00000813 F8E604                  		MOV.L #00000004H, [R14]
00000816                         L237:	; bb202.split
                                 ;     973         
                                 ;     974         /* Init for defrag */
                                 ;     975         g_vee_current_record.ID = 0xFF;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",975
00000816 FB12rrrrrrrr            		MOV.L #__$g_vee_current_record, R1
0000081C 3D10FF                  		MOV.W #00FFH, 00H[R1]
0000081F                         L238:	; bb202.split5
                                 ;     976         
                                 ;     977         /* Start Defrag */
                                 ;     978         vee_defrag_block(sector, 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",978
0000081F B789                    		MOVU.B 1FH[R0], R1
00000821 EF1E                    		MOV.L R1, R14
00000823 751E14                  		MUL #14H, R14
00000826 FB22rrrrrrrr            		MOV.L #_g_vee_Sectors, R2
0000082C 4BE2                    		ADD R14, R2
0000082E B02C                    		MOVU.B 01H[R2], R4
00000830 A982                    		MOV.L 18H[R0], R2
00000832 712301                  		ADD #01H, R2, R3
00000835 EF3E                    		MOV.L R3, R14
00000837 FC234E                  		DIV R4, R14
0000083A 4F4E                    		MUL R4, R14
0000083C 43E3                    		SUB R14, R3
0000083E 39rrrr               W  		BSR __$vee_defrag_block
00000841                         L239:	; bb202.split6
                                 ;     979                          (uint32_t)active_and_full_block, 
                                 ;     980                          (uint32_t)((active_and_full_block+1)%g_vee_Sectors[sector].num_VEE_blocks));        
                                 ;     981         
                                 ;     982         /* Return that a process is now ongoing */
                                 ;     983         return VEE_BUSY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",983
00000841 3C0702                  		MOV.B #02H, 07H[R0]
00000844 38rrrr               W  		BRA L278
00000847                         L240:	; bb217
                                 ;     984     }
                                 ;     985     else if( (active_block != -1) && 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",985
00000847 A901                    		MOV.L 10H[R0], R1
00000849 7501FF                  		CMP #0FFFFFFFFH, R1
0000084C 3Brrrr               W  		BNE L265
0000084F 38rrrr               W  		BRA L267
00000852                         L241:	; bb219
                                 ;     986              (active_and_full_block == -1) && 
                                 ;     987              (nextup_block == -1) )
                                 ;     988     {
                                 ;     989         /* Active block found, make sure it's ready to write. If there was a power down during a record program then it 
                                 ;     990            could cause an error here */        
                                 ;     991         if( vee_check_block(sector, (uint32_t)active_block) == VEE_SUCCESS )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",991
00000852 A902                    		MOV.L 10H[R0], R2
00000854 B789                    		MOVU.B 1FH[R0], R1
00000856 39rrrr               W  		BSR __$vee_check_block
00000859 6101                    		CMP #00H, R1
0000085B 18                   S  		BNE L243
0000085C                         L242:	; bb220
                                 ;     992         {
                                 ;     993             /* Block is good and ready to use */
                                 ;     994             return VEE_SUCCESS;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",994
0000085C 3C0700                  		MOV.B #00H, 07H[R0]
0000085F 38rrrr               W  		BRA L278
00000862                         L243:	; bb222
                                 ;     995         }
                                 ;     996         else
                                 ;     997         {
                                 ;     998             /* Bad record was found or block was full, defrag needed */
                                 ;     999             /* Release state so defrag can start */
                                 ;    1000             g_vee_state = VEE_DEFRAG;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1000
00000862 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00000868 F8E604                  		MOV.L #00000004H, [R14]
0000086B                         L244:	; bb222.split
                                 ;    1001             
                                 ;    1002             /* Init for defrag */
                                 ;    1003             g_vee_current_record.ID = 0xFF;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1003
0000086B FB12rrrrrrrr            		MOV.L #__$g_vee_current_record, R1
00000871 3D10FF                  		MOV.W #00FFH, 00H[R1]
00000874                         L245:	; bb222.split7
                                 ;    1004             
                                 ;    1005             /* Start Defrag */
                                 ;    1006             vee_defrag_block(sector, 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1006
00000874 B789                    		MOVU.B 1FH[R0], R1
00000876 EF1E                    		MOV.L R1, R14
00000878 751E14                  		MUL #14H, R14
0000087B FB22rrrrrrrr            		MOV.L #_g_vee_Sectors, R2
00000881 4BE2                    		ADD R14, R2
00000883 B02C                    		MOVU.B 01H[R2], R4
00000885 A902                    		MOV.L 10H[R0], R2
00000887 712301                  		ADD #01H, R2, R3
0000088A EF3E                    		MOV.L R3, R14
0000088C FC234E                  		DIV R4, R14
0000088F 4F4E                    		MUL R4, R14
00000891 43E3                    		SUB R14, R3
00000893 39rrrr               W  		BSR __$vee_defrag_block
00000896                         L246:	; bb222.split8
                                 ;    1007                              (uint32_t)active_block, 
                                 ;    1008                              (uint32_t)((active_block+1)%g_vee_Sectors[sector].num_VEE_blocks));
                                 ;    1009             
                                 ;    1010             /* Defrag is process */
                                 ;    1011             return VEE_BUSY;                
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1011
00000896 3C0702                  		MOV.B #02H, 07H[R0]
00000899 38rrrr               W  		BRA L278
0000089C                         L247:	; bb245
                                 ;    1012         }
                                 ;    1013     }
                                 ;    1014     else if( (active_and_full_block == -1) &&
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1014
0000089C A981                    		MOV.L 18H[R0], R1
0000089E 7501FF                  		CMP #0FFFFFFFFH, R1
000008A1 20rr                    		BEQ L257
000008A3 2Err                 B  		BRA L259
000008A5                         L248:	; bb247
                                 ;    1015              (nextup_block == -1) && 
                                 ;    1016              (active_block == -1) )
                                 ;    1017     {
                                 ;    1018         /* This means that the sector should be empty */
                                 ;    1019         
                                 ;    1020         /* If user is requesting defrag then we should ignore since sector is empty */
                                 ;    1021         if( g_vee_state == VEE_DEFRAG )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1021
000008A5 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
000008AB ECEE                    		MOV.L [R14], R14
000008AD 614E                    		CMP #04H, R14
000008AF 18                   S  		BNE L250
000008B0                         L249:	; bb248
                                 ;    1022         {     
                                 ;    1023             /* No ACTIVE block found, defrag ignored */
                                 ;    1024             return VEE_NOT_FOUND;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1024
000008B0 3C0704                  		MOV.B #04H, 07H[R0]
000008B3 38rrrr               W  		BRA L278
000008B6                         L250:	; bb254
                                 ;    1025         }           
                                 ;    1026         
                                 ;    1027         /* Init some global state for blank checking */
                                 ;    1028         g_vee_blank_check_block_current = g_vee_Sectors[sector].df_blocks[0][0];
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1028
000008B6 B789                    		MOVU.B 1FH[R0], R1
000008B8 751114                  		MUL #14H, R1
000008BB FB22rrrrrrrr            		MOV.L #_g_vee_Sectors, R2
000008C1 4B12                    		ADD R1, R2
000008C3 A921                    		MOV.L 10H[R2], R1
000008C5 FBE2rrrrrrrr            		MOV.L #__$g_vee_blank_check_block_current, R14
000008CB E01E                    		MOV.L [R1], [R14]
000008CD                         L251:	; bb254.split
                                 ;    1029         g_vee_blank_check_block_end = g_vee_Sectors[sector].df_blocks[0][1];
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1029
000008CD B789                    		MOVU.B 1FH[R0], R1
000008CF 751114                  		MUL #14H, R1
000008D2 FB22rrrrrrrr            		MOV.L #_g_vee_Sectors, R2
000008D8 4B12                    		ADD R1, R2
000008DA A921                    		MOV.L 10H[R2], R1
000008DC FBE2rrrrrrrr            		MOV.L #__$g_vee_blank_check_block_end, R14
000008E2 E11E01                  		MOV.L 04H[R1], [R14]
000008E5                         L252:	; bb254.split9
                                 ;    1030         g_vee_current_sector = sector;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1030
000008E5 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
000008EB C10E1F                  		MOV.B 1FH[R0], [R14]
000008EE                         L253:	; bb254.split10
                                 ;    1031         
                                 ;    1032         /* Verify that the sector is empty */
                                 ;    1033         if( vee_blank_check_block( g_vee_blank_check_block_current ) == VEE_SUCCESS )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1033
000008EE FBE2rrrrrrrr            		MOV.L #__$g_vee_blank_check_block_current, R14
000008F4 ECE1                    		MOV.L [R14], R1
000008F6 05rrrrrr             A  		BSR _vee_blank_check_block
000008FA 6101                    		CMP #00H, R1
000008FC 18                   S  		BNE L255
000008FD                         L254:	; bb275
                                 ;    1034         {        
                                 ;    1035             /* No ACTIVE block found, blank check in progress */
                                 ;    1036             return VEE_NOT_FOUND;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1036
000008FD 3C0704                  		MOV.B #04H, 07H[R0]
00000900 38rrrr               W  		BRA L278
00000903                         L255:	; bb277
                                 ;    1037         }
                                 ;    1038         else
                                 ;    1039         {
                                 ;    1040             /* Problem with FlashAPI */
                                 ;    1041             FlashError();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1041
00000903 05rrrrrr             A  		BSR _FlashError
00000907 2Err                 B  		BRA L277
00000909                         L256:	; bb285
                                 ;    1042         }
                                 ;    1043     }
                                 ;    1044     else
                                 ;    1045     {
                                 ;    1046         /* This should never happen, this means that you found a NEXTUP block that was not yet marked ACTIVE and did not 
                                 ;    1047            find another block marked ACTIVE or (ACTIVE and FULL). */
                                 ;    1048         FlashError();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1048
00000909 05rrrrrr             A  		BSR _FlashError
0000090D 2Err                 B  		BRA L277
0000090F                         L257:	; bb289
0000090F A909                    		MOV.L 14H[R0], R1
00000911 7501FF                  		CMP #0FFFFFFFFH, R1
00000914 18                   S  		BNE L259
00000915                         L258:	; bb293
00000915 F80601                  		MOV.L #00000001H, [R0]
00000918 08                   S  		BRA L260
00000919                         L259:	; bb294
00000919 F80600                  		MOV.L #00000000H, [R0]
0000091C                         L260:	; bb295
0000091C EC01                    		MOV.L [R0], R1
0000091E 6101                    		CMP #00H, R1
00000920 20rr                    		BEQ L263
00000922                         L261:	; bb299
00000922 A901                    		MOV.L 10H[R0], R1
00000924 7501FF                  		CMP #0FFFFFFFFH, R1
00000927 18                   S  		BNE L263
00000928                         L262:	; bb303
00000928 F80601                  		MOV.L #00000001H, [R0]
0000092B 08                   S  		BRA L264
0000092C                         L263:	; bb304
0000092C F80600                  		MOV.L #00000000H, [R0]
0000092F                         L264:	; bb305
0000092F EC01                    		MOV.L [R0], R1
00000931 6101                    		CMP #00H, R1
00000933 3Brrrr               W  		BNE L248
00000936 2Err                 B  		BRA L256
00000938                         L265:	; bb314
00000938 A981                    		MOV.L 18H[R0], R1
0000093A 7501FF                  		CMP #0FFFFFFFFH, R1
0000093D 18                   S  		BNE L267
0000093E                         L266:	; bb318
0000093E F80601                  		MOV.L #00000001H, [R0]
00000941 08                   S  		BRA L268
00000942                         L267:	; bb319
00000942 F80600                  		MOV.L #00000000H, [R0]
00000945                         L268:	; bb320
00000945 EC01                    		MOV.L [R0], R1
00000947 6101                    		CMP #00H, R1
00000949 20rr                    		BEQ L271
0000094B                         L269:	; bb324
0000094B A909                    		MOV.L 14H[R0], R1
0000094D 7501FF                  		CMP #0FFFFFFFFH, R1
00000950 18                   S  		BNE L271
00000951                         L270:	; bb328
00000951 F80601                  		MOV.L #00000001H, [R0]
00000954 08                   S  		BRA L272
00000955                         L271:	; bb329
00000955 F80600                  		MOV.L #00000000H, [R0]
00000958                         L272:	; bb330
00000958 EC01                    		MOV.L [R0], R1
0000095A 6101                    		CMP #00H, R1
0000095C 3Brrrr               W  		BNE L241
0000095F 38rrrr               W  		BRA L247
00000962                         L273:	; bb339
00000962 A909                    		MOV.L 14H[R0], R1
00000964 7501FF                  		CMP #0FFFFFFFFH, R1
00000967 18                   S  		BNE L275
00000968                         L274:	; bb343
00000968 F80601                  		MOV.L #00000001H, [R0]
0000096B 08                   S  		BRA L276
0000096C                         L275:	; bb344
0000096C F80600                  		MOV.L #00000000H, [R0]
0000096F                         L276:	; bb345
0000096F EC01                    		MOV.L [R0], R1
00000971 6101                    		CMP #00H, R1
00000973 3Brrrr               W  		BNE L236
00000976 38rrrr               W  		BRA L240
00000979                         L277:	; bb350
                                 ;    1049     }
                                 ;    1050     
                                 ;    1051     /* Dummy return to make sure nothing happens if FlashError() returns */
                                 ;    1052     return VEE_BUSY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1052
00000979 3C0702                  		MOV.B #02H, 07H[R0]
0000097C                         L278:	; bb352
0000097C C500071E                		MOV.B 07H[R0], 1EH[R0]
                                 ;    1053 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1053
00000980 B781                    		MOVU.B 1EH[R0], R1
00000982 6708                    		RTSD #20H
00000984                         __$vee_check_block:
                                 		.STACK	__$vee_check_block=28
                                 ;    1054 /***********************************************************************************************************************
                                 ;    1055 End of function vee_check_sector
                                 ;    1056 ***********************************************************************************************************************/
                                 ;    1057 
                                 ;    1058 /***********************************************************************************************************************
                                 ;    1059 * Function Name: vee_check_block
                                 ;    1060 * Description  : Checks for errors in a VEE Block
                                 ;    1061 * Arguments    : sector - 
                                 ;    1062 *                    Which VEE Sector this block is in
                                 ;    1063 *                block - 
                                 ;    1064 *                    Which VEE Block to check
                                 ;    1065 * Return Value : VEE_SUCCESS -  
                                 ;    1066 *                    Successful, VEE Block is valid and ready
                                 ;    1067 *                VEE_FAILURE -  
                                 ;    1068 *                    Block has a bad record
                                 ;    1069 *                VEE_NO_ROOM -   
                                 ;    1070 *                    Block is valid, but full
                                 ;    1071 ***********************************************************************************************************************/
                                 ;    1072 VEE_STATIC uint8_t vee_check_block (uint8_t sector, uint32_t block)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1072
00000984 7100E8                  		ADD #0FFFFFFE8H, R0
00000987 8589                    		MOV.B R1, 17H[R0]
00000989 A102                    		MOV.L R2, 10H[R0]
                                 ;    1073 {
                                 ;    1074     /* Pointers for searching */
                                 ;    1075     vee_record_t *ptr, *end_addr;        
                                 ;    1076     
                                 ;    1077     /* Move past flags at beginning */
                                 ;    1078     ptr = (vee_record_t *)(((uint8_t *)g_vee_Sectors[sector].VEE_block_addr[block]) +
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1078
0000098B B589                    		MOVU.B 17H[R0], R1
0000098D 751114                  		MUL #14H, R1
00000990 FB32rrrrrrrr            		MOV.L #_g_vee_Sectors, R3
00000996 4B13                    		ADD R1, R3
00000998 A8B1                    		MOV.L 08H[R3], R1
0000099A FE6211                  		MOV.L [R2,R1], R1
0000099D 6281                    		ADD #08H, R1
0000099F A009                    		MOV.L R1, 04H[R0]
000009A1                         L280:	; entry.split
                                 ;    1079                            ((VEE_BLOCK_STATE_NEXTUP+1)*sizeof(vee_var_min_t)));
                                 ;    1080     /* Flags are at beginning of block so end is the real end */
                                 ;    1081     end_addr =  (vee_record_t *)(((uint8_t *)g_vee_Sectors[sector].VEE_block_addr[block]) + 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1081
000009A1 B589                    		MOVU.B 17H[R0], R1
000009A3 751114                  		MUL #14H, R1
000009A6 FB22rrrrrrrr            		MOV.L #_g_vee_Sectors, R2
000009AC 4B12                    		ADD R1, R2
000009AE A8A1                    		MOV.L 08H[R2], R1
000009B0 A903                    		MOV.L 10H[R0], R3
000009B2 FE6311                  		MOV.L [R3,R1], R1
000009B5 06892101                		ADD 04H[R2].L, R1
000009B9 A081                    		MOV.L R1, 08H[R0]
000009BB 2Err                 B  		BRA L290
000009BD                         L281:	; bb32
                                 ;    1082                                              g_vee_Sectors[sector].VEE_block_size);
                                 ;    1083     
                                 ;    1084     /* Search until end of block */
                                 ;    1085     while(ptr < end_addr )
                                 ;    1086     {
                                 ;    1087         /* Make sure this address is not empty */
                                 ;    1088         if( vee_blank_check_address((uint8_t *)ptr) == VEE_SUCCESS )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1088
000009BD A809                    		MOV.L 04H[R0], R1
000009BF 05rrrrrr             A  		BSR _vee_blank_check_address
000009C3 6101                    		CMP #00H, R1
000009C5 21rr                    		BNE L286
000009C7                         L282:	; bb33
                                 ;    1089         {
                                 ;    1090             /* Address was blank so search is done */ 
                                 ;    1091             /* Fill in NextAddress cache */
                                 ;    1092             g_vee_next_address[sector].address = (uint8_t *)ptr;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1092
000009C7 B589                    		MOVU.B 17H[R0], R1
000009C9 63C1                    		MUL #0CH, R1
000009CB FB22rrrrrrrr            		MOV.L #__$g_vee_next_address, R2
000009D1 4B12                    		ADD R1, R2
000009D3 E5020102                		MOV.L 04H[R0], 08H[R2]
000009D7                         L283:	; bb33.split
                                 ;    1093             g_vee_next_address[sector].block = block;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1093
000009D7 B589                    		MOVU.B 17H[R0], R1
000009D9 63C1                    		MUL #0CH, R1
000009DB FB22rrrrrrrr            		MOV.L #__$g_vee_next_address, R2
000009E1 4B12                    		ADD R1, R2
000009E3 E5020401                		MOV.L 10H[R0], 04H[R2]
000009E7                         L284:	; bb33.split1
                                 ;    1094             g_vee_next_address[sector].valid = VEE_CACHE_ENTRY_VALID;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1094
000009E7 B589                    		MOVU.B 17H[R0], R1
000009E9 63C1                    		MUL #0CH, R1
000009EB FBE2rrrrrrrr            		MOV.L #__$g_vee_next_address, R14
000009F1 FBF685                  		MOV.L #0FFFFFF85H, R15
000009F4 FE0E1F                  		MOV.B R15, [R14,R1]
000009F7                         L285:	; bb33.split2
                                 ;    1095             
                                 ;    1096             /* Blank address was found which is what we want */
                                 ;    1097             return VEE_SUCCESS;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1097
000009F7 3C0300                  		MOV.B #00H, 03H[R0]
000009FA 2Err                 B  		BRA L292
000009FC                         L286:	; bb57
                                 ;    1098         }
                                 ;    1099         
                                 ;    1100         /* Check to make sure record is valid */
                                 ;    1101         if( vee_check_record(ptr) == VEE_FAILURE )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1101
000009FC A809                    		MOV.L 04H[R0], R1
000009FE 05rrrrrr             A  		BSR _vee_check_record
00000A02 6111                    		CMP #01H, R1
00000A04 18                   S  		BNE L288
00000A05                         L287:	; bb58
                                 ;    1102         {            
                                 ;    1103             /* Record is invalid */
                                 ;    1104             return VEE_FAILURE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1104
00000A05 3C0301                  		MOV.B #01H, 03H[R0]
00000A08 2Err                 B  		BRA L292
00000A0A                         L288:	; bb66
                                 ;    1105         }
                                 ;    1106                    
                                 ;    1107         /* Move on to next record */
                                 ;    1108         ptr = (vee_record_t *)(((uint8_t *)&ptr->pData) + ptr->size);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1108
00000A0A A809                    		MOV.L 04H[R0], R1
00000A0C 06C91101                		ADD 02H[R1].UW, R1
00000A10 6281                    		ADD #08H, R1
00000A12 A009                    		MOV.L R1, 04H[R0]
00000A14                         L289:	; bb66.split3
                                 ;    1109         
                                 ;    1110         /* Only need to check boundary if minimum write size is larger than 1 byte */
                                 ;    1111         if( sizeof(vee_var_min_t) > 1 )
                                 ;    1112         {
                                 ;    1113             /* Due to program sizes on some data flashes we need to make sure that we are on a program boundary */
                                 ;    1114             ptr = ( vee_record_t *)vee_move_to_boundary((uint32_t)ptr); 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1114
00000A14 A809                    		MOV.L 04H[R0], R1
00000A16 05rrrrrr             A  		BSR _vee_move_to_boundary
00000A1A A009                    		MOV.L R1, 04H[R0]
00000A1C                         L290:	; bb83
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1085
00000A1C A809                    		MOV.L 04H[R0], R1
00000A1E 06850102                		CMP 08H[R0].L, R1
00000A22 23rr                    		BLTU L281
00000A24                         L291:	; bb89
                                 ;    1115         }
                                 ;    1116     }
                                 ;    1117     
                                 ;    1118     /* Block is valid, but full */
                                 ;    1119     return VEE_NO_ROOM;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1119
00000A24 3C0303                  		MOV.B #03H, 03H[R0]
00000A27                         L292:	; bb91
00000A27 C500030F                		MOV.B 03H[R0], 0FH[R0]
                                 ;    1120 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1120
00000A2B B389                    		MOVU.B 0FH[R0], R1
00000A2D 6706                    		RTSD #18H
00000A2F                         _R_VEE_Erase:
                                 		.STACK	_R_VEE_Erase=24
                                 ;    1121 /***********************************************************************************************************************
                                 ;    1122 End of function vee_check_block
                                 ;    1123 ***********************************************************************************************************************/
                                 ;    1124 
                                 ;    1125 /***********************************************************************************************************************
                                 ;    1126 * Function Name: R_VEE_Erase
                                 ;    1127 * Description  : Attempts to erase a VEE Sector
                                 ;    1128 * Arguments    : sector - 
                                 ;    1129 *                    Which VEE Sector to erase
                                 ;    1130 * Return Value : VEE_SUCCESS -    
                                 ;    1131 *                    Successful, sector erase in progress
                                 ;    1132 *                VEE_BUSY -    
                                 ;    1133 *                    Other flash operation is on going
                                 ;    1134 *                VEE_FAILURE -    
                                 ;    1135 *                    Failure
                                 ;    1136 *                VEE_INVALID_INPUT -
                                 ;    1137 *                    Invalid sector input.
                                 ;    1138 ***********************************************************************************************************************/
                                 ;    1139 uint8_t R_VEE_Erase (uint8_t sector)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1139
00000A2F 7100EC                  		ADD #0FFFFFFECH, R0
00000A32 8489                    		MOV.B R1, 13H[R0]
                                 ;    1140 {
                                 ;    1141     /* Loop variables */
                                 ;    1142     uint32_t i;
                                 ;    1143     /* Structure pointer for VEE Block info */
                                 ;    1144     vee_block_info_t block_info;
                                 ;    1145 
                                 ;    1146     /* Check input. */
                                 ;    1147     if (VEE_SUCCESS != vee_check_input_sector(sector))
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1147
00000A34 B489                    		MOVU.B 13H[R0], R1
00000A36 39rrrr               W  		BSR __$vee_check_input_sector
00000A39 6101                    		CMP #00H, R1
00000A3B 10                   S  		BEQ L295
00000A3C                         L294:	; bb4
                                 ;    1148     {
                                 ;    1149         /* Invalid sector input. */
                                 ;    1150         return VEE_INVALID_INPUT;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1150
00000A3C 3C0706                  		MOV.B #06H, 07H[R0]
00000A3F 38rrrr               W  		BRA L320
00000A42                         L295:	; bb12
00000A42 6631                    		MOV.L #00000003H, R1
                                 ;    1151     }
                                 ;    1152     
                                 ;    1153     /* Try to grab VEE State */
                                 ;    1154     if( vee_grab_state(VEE_ERASING) != VEE_SUCCESS )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1154
00000A44 39rrrr               W  		BSR __$vee_grab_state
00000A47 6101                    		CMP #00H, R1
00000A49 10                   S  		BEQ L297
00000A4A                         L296:	; bb13
                                 ;    1155     {
                                 ;    1156         /* Could not grab state */
                                 ;    1157         return VEE_BUSY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1157
00000A4A 3C0702                  		MOV.B #02H, 07H[R0]
00000A4D 38rrrr               W  		BRA L320
00000A50                         L297:	; bb20
                                 ;    1158     }
                                 ;    1159 
                                 ;    1160     /* Invalidate valid indicator for next valid address in this sector. */
                                 ;    1161     g_vee_next_address[sector].valid = VEE_CACHE_ENTRY_INVALID;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1161
00000A50 B489                    		MOVU.B 13H[R0], R1
00000A52 63C1                    		MUL #0CH, R1
00000A54 FBE2rrrrrrrr            		MOV.L #__$g_vee_next_address, R14
00000A5A 660F                    		MOV.L #00000000H, R15
00000A5C FE0E1F                  		MOV.B R15, [R14,R1]
00000A5F                         L298:	; bb20.split
                                 ;    1162      
                                 ;    1163     /* Loop through VEE Blocks in sector and erase */
                                 ;    1164     for(i = 0; i < g_vee_Sectors[sector].num_VEE_blocks; i++)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1164
00000A5F 3E0200                  		MOV.L #00000000H, 08H[R0]
00000A62 2Err                 B  		BRA L316
00000A64                         L299:	; bb25
                                 ;    1165     {
                                 ;    1166         /* Get information from status flags about this block */
                                 ;    1167         vee_get_block_info(sector, i, &block_info);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1167
00000A64 A882                    		MOV.L 08H[R0], R2
00000A66 B489                    		MOVU.B 13H[R0], R1
00000A68 71030E                  		ADD #0EH, R0, R3
00000A6B 05rrrrrr             A  		BSR _vee_get_block_info
00000A6F                         L300:	; bb25.split
                                 ;    1168         
                                 ;    1169         /* Check to see if block is empty */
                                 ;    1170         if( (block_info.active  == VEE_BLOCK_FLAG_SET) ||
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1170
00000A6F B389                    		MOVU.B 0FH[R0], R1
00000A71 6111                    		CMP #01H, R1
00000A73 20rr                    		BEQ L304
00000A75 2Err                 B  		BRA L303
00000A77                         L301:	; bb30
                                 ;    1171             (block_info.full    == VEE_BLOCK_FLAG_SET) ||
                                 ;    1172             (block_info.nextup  == VEE_BLOCK_FLAG_SET) ||
                                 ;    1173             (block_info.erasing == VEE_BLOCK_FLAG_SET) )
                                 ;    1174         {
                                 ;    1175             /* Mark cache entries from this sector as invalid */
                                 ;    1176             vee_invalidate_cache(sector);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1176
00000A77 B489                    		MOVU.B 13H[R0], R1
00000A79 39rrrr               W  		BSR __$vee_invalidate_cache
00000A7C                         L302:	; bb30.split
                                 ;    1177 
                                 ;    1178             /* At least onen flag is set so this VEE Block is not empty */
                                 ;    1179             return vee_erase_block(sector, i);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1179
00000A7C A882                    		MOV.L 08H[R0], R2
00000A7E B489                    		MOVU.B 13H[R0], R1
00000A80 39rrrr               W  		BSR __$vee_erase_block
00000A83 8189                    		MOV.B R1, 07H[R0]
00000A85 2Err                 B  		BRA L320
00000A87                         L303:	; bb42
00000A87 B401                    		MOVU.B 10H[R0], R1
00000A89 6111                    		CMP #01H, R1
00000A8B 18                   S  		BNE L305
00000A8C                         L304:	; bb48
00000A8C F80601                  		MOV.L #00000001H, [R0]
00000A8F 08                   S  		BRA L306
00000A90                         L305:	; bb49
00000A90 F80600                  		MOV.L #00000000H, [R0]
00000A93                         L306:	; bb50
00000A93 EC01                    		MOV.L [R0], R1
00000A95 6101                    		CMP #00H, R1
00000A97 18                   S  		BNE L308
00000A98                         L307:	; bb54
00000A98 B409                    		MOVU.B 11H[R0], R1
00000A9A 6111                    		CMP #01H, R1
00000A9C 18                   S  		BNE L309
00000A9D                         L308:	; bb60
00000A9D F80601                  		MOV.L #00000001H, [R0]
00000AA0 08                   S  		BRA L310
00000AA1                         L309:	; bb61
00000AA1 F80600                  		MOV.L #00000000H, [R0]
00000AA4                         L310:	; bb62
00000AA4 EC01                    		MOV.L [R0], R1
00000AA6 6101                    		CMP #00H, R1
00000AA8 18                   S  		BNE L312
00000AA9                         L311:	; bb66
00000AA9 B381                    		MOVU.B 0EH[R0], R1
00000AAB 6111                    		CMP #01H, R1
00000AAD 18                   S  		BNE L313
00000AAE                         L312:	; bb72
00000AAE F80601                  		MOV.L #00000001H, [R0]
00000AB1 08                   S  		BRA L314
00000AB2                         L313:	; bb73
00000AB2 F80600                  		MOV.L #00000000H, [R0]
00000AB5                         L314:	; bb74
00000AB5 EC01                    		MOV.L [R0], R1
00000AB7 6101                    		CMP #00H, R1
00000AB9 21rr                    		BNE L301
00000ABB                         L315:	; bb79
00000ABB A881                    		MOV.L 08H[R0], R1
00000ABD 6211                    		ADD #01H, R1
00000ABF A081                    		MOV.L R1, 08H[R0]
00000AC1                         L316:	; bb82
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1164
00000AC1 B489                    		MOVU.B 13H[R0], R1
00000AC3 751114                  		MUL #14H, R1
00000AC6 FB22rrrrrrrr            		MOV.L #_g_vee_Sectors, R2
00000ACC 4B12                    		ADD R1, R2
00000ACE B029                    		MOVU.B 01H[R2], R1
00000AD0 06850102                		CMP 08H[R0].L, R1
00000AD4 24rr                    		BGTU L299
00000AD6                         L317:	; bb93
                                 ;    1180         }                
                                 ;    1181     }
                                 ;    1182     
                                 ;    1183     /* If we get here then all blocks were already erased */
                                 ;    1184     /* Release state */
                                 ;    1185     g_vee_state = VEE_READY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1185
00000AD6 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00000ADC F8E600                  		MOV.L #00000000H, [R14]
00000ADF                         L318:	; bb93.split
                                 ;    1186 
                                 ;    1187     /* Still need to call callback function since code might be waiting. */
                                 ;    1188     #ifdef VEE_CALLBACK_FUNCTION
                                 ;    1189     /* Call user's callback function */
                                 ;    1190     VEE_CALLBACK_FUNCTION();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1190
00000ADF 05rrrrrr             A  		BSR _VEE_OperationDone_Callback
00000AE3                         L319:	; bb93.split1
                                 ;    1191     #endif
                                 ;    1192     
                                 ;    1193     /* All blocks are erased */
                                 ;    1194     return VEE_SUCCESS;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1194
00000AE3 3C0700                  		MOV.B #00H, 07H[R0]
00000AE6                         L320:	; bb95
00000AE6 C5000712                		MOV.B 07H[R0], 12H[R0]
                                 ;    1195 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1195
00000AEA B481                    		MOVU.B 12H[R0], R1
00000AEC 6705                    		RTSD #14H
00000AEE                         __$vee_erase_block:
                                 		.STACK	__$vee_erase_block=16
                                 ;    1196 /***********************************************************************************************************************
                                 ;    1197 End of function R_VEE_Erase
                                 ;    1198 ***********************************************************************************************************************/
                                 ;    1199 
                                 ;    1200 /***********************************************************************************************************************
                                 ;    1201 * Function Name: vee_erase_block
                                 ;    1202 * Description  : Attempts to erase a VEE Block
                                 ;    1203 * Arguments    : sector - 
                                 ;    1204 *                    Which VEE Sector the VEE Block is in
                                 ;    1205 *                block  - 
                                 ;    1206 *                    Which VEE Block to erase
                                 ;    1207 * Return Value : VEE_SUCCESS -  
                                 ;    1208 *                    Successful, block erase in progress
                                 ;    1209 *                VEE_FAILURE -  
                                 ;    1210 *                    Failure
                                 ;    1211 ***********************************************************************************************************************/
                                 ;    1212 VEE_STATIC uint8_t vee_erase_block (uint8_t sector, uint32_t block)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1212
00000AEE 60C0                    		SUB #0CH, R0
00000AF0 8289                    		MOV.B R1, 0BH[R0]
00000AF2 A00A                    		MOV.L R2, 04H[R0]
                                 ;    1213 {
                                 ;    1214     /* Set global variables which will allow us to erase multiple blocks without user intervention */
                                 ;    1215     g_vee_erase_block_current = g_vee_Sectors[sector].df_blocks[block][0];
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1215
00000AF4 B289                    		MOVU.B 0BH[R0], R1
00000AF6 751114                  		MUL #14H, R1
00000AF9 FBE2rrrrrrrr            		MOV.L #_g_vee_Sectors, R14
00000AFF 4B1E                    		ADD R1, R14
00000B01 6C32                    		SHLL #03H, R2
00000B03 0689E204                		ADD 10H[R14].L, R2
00000B07 FBE2rrrrrrrr            		MOV.L #__$g_vee_erase_block_current, R14
00000B0D E02E                    		MOV.L [R2], [R14]
00000B0F                         L322:	; entry.split
                                 ;    1216     g_vee_erase_block_end = g_vee_Sectors[sector].df_blocks[block][1];        
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1216
00000B0F B289                    		MOVU.B 0BH[R0], R1
00000B11 751114                  		MUL #14H, R1
00000B14 FBE2rrrrrrrr            		MOV.L #_g_vee_Sectors, R14
00000B1A 4B1E                    		ADD R1, R14
00000B1C A809                    		MOV.L 04H[R0], R1
00000B1E 6C31                    		SHLL #03H, R1
00000B20 0689E104                		ADD 10H[R14].L, R1
00000B24 FBE2rrrrrrrr            		MOV.L #__$g_vee_erase_block_end, R14
00000B2A E11E01                  		MOV.L 04H[R1], [R14]
00000B2D                         L323:	; entry.split1
                                 ;    1217     
                                 ;    1218     /* Set write state so we know to start erase after write is done */
                                 ;    1219     g_vee_write_state = VEE_WRITE_DONE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1219
00000B2D FBE2rrrrrrrr            		MOV.L #__$g_vee_write_state, R14
00000B33 F8E60A                  		MOV.L #0000000AH, [R14]
00000B36                         L324:	; entry.split2
                                 ;    1220     
                                 ;    1221     /* Start erase by first writing the ERASING flag in the block that is getting erased */
                                 ;    1222     if( VEE_SUCCESS != vee_write_flag(sector, block, VEE_BLOCK_STATE_ERASING, VEE_BLOCK_FLAG_ERASING) )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1222
00000B36 A80A                    		MOV.L 04H[R0], R2
00000B38 B289                    		MOVU.B 0BH[R0], R1
00000B3A FB4EAAAA00              		MOV.L #0000AAAAH, R4
00000B3F 6603                    		MOV.L #00000000H, R3
00000B41 39rrrr               W  		BSR __$vee_write_flag
00000B44 6101                    		CMP #00H, R1
00000B46 20rr                    		BEQ L327
00000B48                         L325:	; bb24
                                 ;    1223     {
                                 ;    1224         /* Flag had already been written, proceed with erase */       
                                 ;    1225         if( R_FlashErase(g_vee_erase_block_end) != FLASH_SUCCESS )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1225
00000B48 FBE2rrrrrrrr            		MOV.L #__$g_vee_erase_block_end, R14
00000B4E ECE1                    		MOV.L [R14], R1
00000B50 05rrrrrr             A  		BSR _R_FlashErase
00000B54 6101                    		CMP #00H, R1
00000B56 10                   S  		BEQ L327
00000B57                         L326:	; bb25
                                 ;    1226         {            
                                 ;    1227             /* Something failed in the FlashAPI */
                                 ;    1228             FlashError();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1228
00000B57 05rrrrrr             A  		BSR _FlashError
00000B5B                         L327:	; bb40
                                 ;    1229         }     
                                 ;    1230     }
                                 ;    1231     
                                 ;    1232     /* Block is being erased */
                                 ;    1233     return VEE_SUCCESS;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1233
00000B5B 3C0300                  		MOV.B #00H, 03H[R0]
00000B5E B089                    		MOVU.B 03H[R0], R1
00000B60                         L328:	; bb40.split
                                 ;    1234 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1234
00000B60 5B11                    		MOVU.B R1, R1
00000B62 6703                    		RTSD #0CH
00000B64                         __$vee_erase_and_defrag:
                                 		.STACK	__$vee_erase_and_defrag=20
                                 ;    1235 /***********************************************************************************************************************
                                 ;    1236 End of function vee_erase_block
                                 ;    1237 ***********************************************************************************************************************/
                                 ;    1238 
                                 ;    1239 /***********************************************************************************************************************
                                 ;    1240 * Function Name: vee_erase_and_defrag
                                 ;    1241 * Description  : Attempts to erase a VEE Block and then resume a defrag
                                 ;    1242 * Arguments    : sector - 
                                 ;    1243 *                    Which VEE Sector the VEE Block is in
                                 ;    1244 *                active - 
                                 ;    1245 *                    Which VEE Block is marked ACTIVE
                                 ;    1246 *                nextup - 
                                 ;    1247 *                    The block was marked as NEXTUP but never became ACTIVE due to reset
                                 ;    1248 * Return Value : VEE_SUCCESS -  
                                 ;    1249 *                    Successful, block erase in progress
                                 ;    1250 *                VEE_FAILURE -  
                                 ;    1251 *                    Failure
                                 ;    1252 ***********************************************************************************************************************/
                                 ;    1253 VEE_STATIC uint8_t vee_erase_and_defrag (uint8_t sector, uint32_t active, uint32_t nextup)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1253
00000B64 7100F0                  		ADD #0FFFFFFF0H, R0
00000B67 8389                    		MOV.B R1, 0FH[R0]
00000B69 A082                    		MOV.L R2, 08H[R0]
00000B6B A00B                    		MOV.L R3, 04H[R0]
                                 ;    1254 {
                                 ;    1255     /* Mark state */
                                 ;    1256     g_vee_state = VEE_ERASE_AND_DEFRAG;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1256
00000B6D FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00000B73 F8E605                  		MOV.L #00000005H, [R14]
00000B76                         L330:	; entry.split
                                 ;    1257     
                                 ;    1258     /* Set which sector is active for later defrag */
                                 ;    1259     g_vee_current_sector = sector;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1259
00000B76 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
00000B7C C10E0F                  		MOV.B 0FH[R0], [R14]
00000B7F                         L331:	; entry.split1
                                 ;    1260     
                                 ;    1261     /* Set which blocks are active and nextup */
                                 ;    1262     g_vee_current_block_active = active;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1262
00000B7F FBE2rrrrrrrr            		MOV.L #__$g_vee_current_block_active, R14
00000B85 E10E02                  		MOV.L 08H[R0], [R14]
00000B88                         L332:	; entry.split2
                                 ;    1263     g_vee_current_block_nextup = nextup;     
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1263
00000B88 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_block_nextup, R14
00000B8E E10E01                  		MOV.L 04H[R0], [R14]
00000B91                         L333:	; entry.split3
                                 ;    1264     
                                 ;    1265     /* Invalidate cache */
                                 ;    1266     vee_invalidate_cache(sector);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1266
00000B91 B389                    		MOVU.B 0FH[R0], R1
00000B93 39rrrr               W  		BSR __$vee_invalidate_cache
00000B96                         L334:	; entry.split4
                                 ;    1267 
                                 ;    1268     /* Start erase of old NEXTUP block */
                                 ;    1269     return vee_erase_block(sector, nextup);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1269
00000B96 A80A                    		MOV.L 04H[R0], R2
00000B98 B389                    		MOVU.B 0FH[R0], R1
00000B9A 39rrrr               W  		BSR __$vee_erase_block
00000B9D 8089                    		MOV.B R1, 03H[R0]
00000B9F B089                    		MOVU.B 03H[R0], R1
00000BA1                         L335:	; entry.split5
                                 ;    1270 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1270
00000BA1 5B11                    		MOVU.B R1, R1
00000BA3 6704                    		RTSD #10H
00000BA5                         _R_VEE_Defrag:
                                 		.STACK	_R_VEE_Defrag=24
                                 ;    1271 /***********************************************************************************************************************
                                 ;    1272 End of function vee_erase_and_defrag
                                 ;    1273 ***********************************************************************************************************************/
                                 ;    1274 
                                 ;    1275 
                                 ;    1276 /***********************************************************************************************************************
                                 ;    1277 * Function Name: R_VEE_Defrag
                                 ;    1278 * Description  : Defrags a sector. The user might want to do a defrag when not required during idle time so that a 
                                 ;    1279 *                defrag has less chance of happening during a more busy writing phase.  This function only starts the 
                                 ;    1280 *                defrag.
                                 ;    1281 * Arguments    : sector - 
                                 ;    1282 *                    Which VEE Sector to defrag
                                 ;    1283 * Return Value : VEE_SUCCESS -  
                                 ;    1284 *                    Successful, defrag in progress
                                 ;    1285 *                VEE_BUSY -  
                                 ;    1286 *                    Other VEE operation in progress
                                 ;    1287 *                VEE_NOT_FOUND -  
                                 ;    1288 *                    No ACTIVE block found to defrag  
                                 ;    1289 *                VEE_INVALID_INPUT -
                                 ;    1290 *                    Invalid sector input.
                                 ;    1291 ***********************************************************************************************************************/
                                 ;    1292 uint8_t R_VEE_Defrag (uint8_t sector)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1292
00000BA5 7100EC                  		ADD #0FFFFFFECH, R0
00000BA8 8489                    		MOV.B R1, 13H[R0]
                                 ;    1293 {
                                 ;    1294     /* Local variables */
                                 ;    1295     uint32_t i;
                                 ;    1296     uint8_t  ret;
                                 ;    1297     /* Structure pointer for VEE Block info */
                                 ;    1298     vee_block_info_t block_info;    
                                 ;    1299 
                                 ;    1300     /* Check input. */
                                 ;    1301     if (VEE_SUCCESS != vee_check_input_sector(sector))
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1301
00000BAA B489                    		MOVU.B 13H[R0], R1
00000BAC 39rrrr               W  		BSR __$vee_check_input_sector
00000BAF 6101                    		CMP #00H, R1
00000BB1 10                   S  		BEQ L338
00000BB2                         L337:	; bb5
                                 ;    1302     {
                                 ;    1303         /* Invalid sector input. */
                                 ;    1304         return VEE_INVALID_INPUT;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1304
00000BB2 3C0706                  		MOV.B #06H, 07H[R0]
00000BB5 38rrrr               W  		BRA L364
00000BB8                         L338:	; bb13
                                 ;    1305     }
                                 ;    1306     
                                 ;    1307     /* Check to see if defrag is already in process */
                                 ;    1308     if( g_vee_state == VEE_DEFRAG )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1308
00000BB8 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00000BBE ECEE                    		MOV.L [R14], R14
00000BC0 614E                    		CMP #04H, R14
00000BC2 18                   S  		BNE L340
00000BC3                         L339:	; bb14
                                 ;    1309     {
                                 ;    1310         /* Defrag already in process */
                                 ;    1311         return VEE_BUSY;        
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1311
00000BC3 3C0702                  		MOV.B #02H, 07H[R0]
00000BC6 38rrrr               W  		BRA L364
00000BC9                         L340:	; bb17
                                 ;    1312     }
                                 ;    1313     else
                                 ;    1314     {
                                 ;    1315         /* Grab state if we do not already have it */
                                 ;    1316         if( g_vee_state != VEE_WRITE_AND_DEFRAG )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1316
00000BC9 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00000BCF ECEE                    		MOV.L [R14], R14
00000BD1 616E                    		CMP #06H, R14
00000BD3 20rr                    		BEQ L343
00000BD5                         L341:	; bb19
00000BD5 6641                    		MOV.L #00000004H, R1
                                 ;    1317         {
                                 ;    1318             /* Try to grab VEE State */
                                 ;    1319             if( vee_grab_state(VEE_DEFRAG) != VEE_SUCCESS )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1319
00000BD7 39rrrr               W  		BSR __$vee_grab_state
00000BDA 6101                    		CMP #00H, R1
00000BDC 10                   S  		BEQ L343
00000BDD                         L342:	; bb20
                                 ;    1320             {
                                 ;    1321                 /* Could not grab state */
                                 ;    1322                 return VEE_BUSY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1322
00000BDD 3C0702                  		MOV.B #02H, 07H[R0]
00000BE0 38rrrr               W  		BRA L364
00000BE3                         L343:	; bb33
                                 ;    1323             }
                                 ;    1324         }
                                 ;    1325         
                                 ;    1326         /* Check to see if the next available address cached */
                                 ;    1327         if( g_vee_next_address[sector].valid != VEE_CACHE_ENTRY_VALID )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1327
00000BE3 B489                    		MOVU.B 13H[R0], R1
00000BE5 63C1                    		MUL #0CH, R1
00000BE7 FBE2rrrrrrrr            		MOV.L #__$g_vee_next_address, R14
00000BED FECE1E                  		MOVU.B [R14,R1], R14
00000BF0 755E85                  		CMP #85H, R14
00000BF3 20rr                    		BEQ L350
00000BF5                         L344:	; bb34
                                 ;    1328         {
                                 ;    1329             /* Next available write address not in cache.  This means that this is the first write or defrag that has 
                                 ;    1330                been issued.  At this point error checking be done on this VEE Sector to see if a power down occurred 
                                 ;    1331                during a program or erasure.  If a error is detected, the API will start the process of fixing the 
                                 ;    1332                problem. If no error is detected then this defrag can proceed on. */
                                 ;    1333             ret = vee_check_sector(sector);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1333
00000BF5 B489                    		MOVU.B 13H[R0], R1
00000BF7 39rrrr               W  		BSR __$vee_check_sector
00000BFA 8309                    		MOV.B R1, 0DH[R0]
00000BFC                         L345:	; bb34.split
                                 ;    1334             
                                 ;    1335             /* Check return value */
                                 ;    1336             if( ret == VEE_BUSY )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1336
00000BFC B309                    		MOVU.B 0DH[R0], R1
00000BFE 6121                    		CMP #02H, R1
00000C00 18                   S  		BNE L347
00000C01                         L346:	; bb38
                                 ;    1337             {
                                 ;    1338                 /* Something had to be fixed or initialized, come back later */
                                 ;    1339                 return VEE_BUSY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1339
00000C01 3C0702                  		MOV.B #02H, 07H[R0]
00000C04 38rrrr               W  		BRA L364
00000C07                         L347:	; bb41
                                 ;    1340             }                       
                                 ;    1341             else if( ret == VEE_NOT_FOUND )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1341
00000C07 B309                    		MOVU.B 0DH[R0], R1
00000C09 6141                    		CMP #04H, R1
00000C0B 21rr                    		BNE L350
00000C0D                         L348:	; bb42
                                 ;    1342             {
                                 ;    1343                 /* Release state */
                                 ;    1344                 g_vee_state = VEE_READY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1344
00000C0D FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00000C13 F8E600                  		MOV.L #00000000H, [R14]
00000C16                         L349:	; bb42.split
                                 ;    1345                 
                                 ;    1346                 /* Sector was blank, nothing to defrag */
                                 ;    1347                 return VEE_NOT_FOUND;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1347
00000C16 3C0704                  		MOV.B #04H, 07H[R0]
00000C19 38rrrr               W  		BRA L364
00000C1C                         L350:	; bb65
                                 ;    1348             }      
                                 ;    1349         }        
                                 ;    1350         
                                 ;    1351         /* Find ACTIVE block */
                                 ;    1352         /* Loop through VEE Blocks in this VEE Sector */
                                 ;    1353         for(i = 0; i < g_vee_Sectors[sector].num_VEE_blocks; i++)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1353
00000C1C 3E0200                  		MOV.L #00000000H, 08H[R0]
00000C1F 2Err                 B  		BRA L361
00000C21                         L351:	; bb66
                                 ;    1354         {
                                 ;    1355             /* Get information from status flags about this block */
                                 ;    1356             vee_get_block_info(sector, i, &block_info);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1356
00000C21 A882                    		MOV.L 08H[R0], R2
00000C23 B489                    		MOVU.B 13H[R0], R1
00000C25 71030E                  		ADD #0EH, R0, R3
00000C28 05rrrrrr             A  		BSR _vee_get_block_info
00000C2C                         L352:	; bb66.split
                                 ;    1357                 
                                 ;    1358             if( (block_info.active == VEE_BLOCK_FLAG_SET) &&
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1358
00000C2C B389                    		MOVU.B 0FH[R0], R1
00000C2E 6111                    		CMP #01H, R1
00000C30 20rr                    		BEQ L356
00000C32 2Err                 B  		BRA L358
00000C34                         L353:	; bb72
                                 ;    1359                 (block_info.full   == VEE_BLOCK_FLAG_NOT_SET) )
                                 ;    1360             {
                                 ;    1361                 /* Found ACTIVE block */
                                 ;    1362                 
                                 ;    1363                 /* Only init state if we do not have a record to write */
                                 ;    1364                 if( g_vee_state != VEE_WRITE_AND_DEFRAG )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1364
00000C34 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00000C3A ECEE                    		MOV.L [R14], R14
00000C3C 616E                    		CMP #06H, R14
00000C3E 10                   S  		BEQ L355
00000C3F                         L354:	; bb73
                                 ;    1365                 {
                                 ;    1366                     /* Init global state used */
                                 ;    1367                     g_vee_current_record.ID = 0xFF;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1367
00000C3F FB12rrrrrrrr            		MOV.L #__$g_vee_current_record, R1
00000C45 3D10FF                  		MOV.W #00FFH, 00H[R1]
00000C48                         L355:	; bb78
                                 ;    1368                 }
                                 ;    1369                 
                                 ;    1370                 /* Start defrag process */                                
                                 ;    1371                 return vee_defrag_block( sector, 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1371
00000C48 B489                    		MOVU.B 13H[R0], R1
00000C4A EF1E                    		MOV.L R1, R14
00000C4C 751E14                  		MUL #14H, R14
00000C4F FB22rrrrrrrr            		MOV.L #_g_vee_Sectors, R2
00000C55 4BE2                    		ADD R14, R2
00000C57 B02C                    		MOVU.B 01H[R2], R4
00000C59 A882                    		MOV.L 08H[R0], R2
00000C5B 712301                  		ADD #01H, R2, R3
00000C5E EF3E                    		MOV.L R3, R14
00000C60 FC274E                  		DIVU R4, R14
00000C63 4F4E                    		MUL R4, R14
00000C65 43E3                    		SUB R14, R3
00000C67 39rrrr               W  		BSR __$vee_defrag_block
00000C6A 8189                    		MOV.B R1, 07H[R0]
00000C6C 2Err                 B  		BRA L364
00000C6E                         L356:	; bb98
00000C6E B401                    		MOVU.B 10H[R0], R1
00000C70 6101                    		CMP #00H, R1
00000C72 18                   S  		BNE L358
00000C73                         L357:	; bb104
00000C73 F80601                  		MOV.L #00000001H, [R0]
00000C76 08                   S  		BRA L359
00000C77                         L358:	; bb105
00000C77 F80600                  		MOV.L #00000000H, [R0]
00000C7A                         L359:	; bb106
00000C7A EC01                    		MOV.L [R0], R1
00000C7C 6101                    		CMP #00H, R1
00000C7E 21rr                    		BNE L353
00000C80                         L360:	; bb111
00000C80 A881                    		MOV.L 08H[R0], R1
00000C82 6211                    		ADD #01H, R1
00000C84 A081                    		MOV.L R1, 08H[R0]
00000C86                         L361:	; bb114
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1353
00000C86 B489                    		MOVU.B 13H[R0], R1
00000C88 751114                  		MUL #14H, R1
00000C8B FB22rrrrrrrr            		MOV.L #_g_vee_Sectors, R2
00000C91 4B12                    		ADD R1, R2
00000C93 B029                    		MOVU.B 01H[R2], R1
00000C95 06850102                		CMP 08H[R0].L, R1
00000C99 24rr                    		BGTU L351
00000C9B                         L362:	; bb125
                                 ;    1372                        i,
                                 ;    1373                        (i+1)%g_vee_Sectors[sector].num_VEE_blocks );
                                 ;    1374             }
                                 ;    1375         }
                                 ;    1376         
                                 ;    1377         /* If we got to here then no ACTIVE block was found */
                                 ;    1378         g_vee_state = VEE_READY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1378
00000C9B FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00000CA1 F8E600                  		MOV.L #00000000H, [R14]
00000CA4                         L363:	; bb125.split
                                 ;    1379         
                                 ;    1380         /* Return ACTIVE block was not found */
                                 ;    1381         return VEE_NOT_FOUND;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1381
00000CA4 3C0704                  		MOV.B #04H, 07H[R0]
00000CA7                         L364:	; bb132
00000CA7 C5000712                		MOV.B 07H[R0], 12H[R0]
                                 ;    1382     }
                                 ;    1383 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1383
00000CAB B481                    		MOVU.B 12H[R0], R1
00000CAD 6705                    		RTSD #14H
00000CAF                         __$vee_defrag_block:
                                 		.STACK	__$vee_defrag_block=40
                                 ;    1384 /***********************************************************************************************************************
                                 ;    1385 End of function R_VEE_Defrag
                                 ;    1386 ***********************************************************************************************************************/
                                 ;    1387 
                                 ;    1388 /***********************************************************************************************************************
                                 ;    1389 * Function Name: vee_defrag_block
                                 ;    1390 * Description  : This continues the defrag.  It goes through the records one by one to see if they need to be moved.
                                 ;    1391 * Arguments    : sector - 
                                 ;    1392 *                    Which VEE Sector we are dealing with
                                 ;    1393 *                active - 
                                 ;    1394 *                    The ACTIVE VEE Block being defragged
                                 ;    1395 *                nextup - 
                                 ;    1396 *                    The new VEE Block that will become ACTIVE
                                 ;    1397 * Return Value : VEE_SUCCESS -  
                                 ;    1398 *                    Successful, defrag in progress
                                 ;    1399 *                VEE_BUSY -  
                                 ;    1400 *                    Other VEE operation in progress
                                 ;    1401 *                VEE_FAILURE -  
                                 ;    1402 *                    g_vee_state should already be in defrag mode
                                 ;    1403 ***********************************************************************************************************************/
                                 ;    1404 VEE_STATIC uint8_t vee_defrag_block (uint8_t sector, uint32_t active, uint32_t nextup)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1404
00000CAF 7100DC                  		ADD #0FFFFFFDCH, R0
00000CB2 C70123                  		MOV.B R1, 23H[R0]
00000CB5 A18A                    		MOV.L R2, 1CH[R0]
00000CB7 A183                    		MOV.L R3, 18H[R0]
                                 ;    1405 {
                                 ;    1406     /* Temp structure */
                                 ;    1407     vee_record_t vee_temp;
                                 ;    1408     
                                 ;    1409     /* Check to see if defrag is already in process */
                                 ;    1410     if( (g_vee_state != VEE_DEFRAG) &&
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1410
00000CB9 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00000CBF ECEE                    		MOV.L [R14], R14
00000CC1 614E                    		CMP #04H, R14
00000CC3 3Brrrr               W  		BNE L402
00000CC6 38rrrr               W  		BRA L404
00000CC9                         L366:	; bb5
                                 ;    1411         (g_vee_state != VEE_WRITE_AND_DEFRAG) )
                                 ;    1412     {
                                 ;    1413         /* The g_vee_state should already be in defrag mode by now */
                                 ;    1414         return VEE_FAILURE;        
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1414
00000CC9 3C0701                  		MOV.B #01H, 07H[R0]
00000CCC 38rrrr               W  		BRA L407
00000CCF                         L367:	; bb8
                                 ;    1415     }
                                 ;    1416     else if( (g_vee_current_record.ID == 0xFF) ||
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1416
00000CCF FBE2rrrrrrrr            		MOV.L #__$g_vee_current_record, R14
00000CD5 5CEE                    		MOVU.W [R14], R14
00000CD7 755EFF                  		CMP #0FFH, R14
00000CDA 3Arrrr               W  		BEQ L399
00000CDD 38rrrr               W  		BRA L398
00000CE0                         L368:	; bb9
                                 ;    1417              (g_vee_state == VEE_WRITE_AND_DEFRAG) )
                                 ;    1418     {
                                 ;    1419         /* This is first time into function, need to write FULL and NEXTUP flags first */      
                                 ;    1420            
                                 ;    1421         /* Save which sector and blocks is being defragged */
                                 ;    1422         g_vee_current_sector = sector;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1422
00000CE0 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
00000CE6 C10E23                  		MOV.B 23H[R0], [R14]
00000CE9                         L369:	; bb9.split
                                 ;    1423         g_vee_current_block_active = active;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1423
00000CE9 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_block_active, R14
00000CEF E10E07                  		MOV.L 1CH[R0], [R14]
00000CF2                         L370:	; bb9.split1
                                 ;    1424         g_vee_current_block_nextup = nextup;      
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1424
00000CF2 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_block_nextup, R14
00000CF8 E10E06                  		MOV.L 18H[R0], [R14]
00000CFB                         L371:	; bb9.split2
                                 ;    1425 
                                 ;    1426         /* Init some global state for blank checking */
                                 ;    1427         g_vee_blank_check_block_current = g_vee_Sectors[sector].df_blocks[nextup][0];
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1427
00000CFB 590123                  		MOVU.B 23H[R0], R1
00000CFE 751114                  		MUL #14H, R1
00000D01 FBE2rrrrrrrr            		MOV.L #_g_vee_Sectors, R14
00000D07 4B1E                    		ADD R1, R14
00000D09 A981                    		MOV.L 18H[R0], R1
00000D0B 6C31                    		SHLL #03H, R1
00000D0D 0689E104                		ADD 10H[R14].L, R1
00000D11 FBE2rrrrrrrr            		MOV.L #__$g_vee_blank_check_block_current, R14
00000D17 E01E                    		MOV.L [R1], [R14]
00000D19                         L372:	; bb9.split3
                                 ;    1428         g_vee_blank_check_block_end = g_vee_Sectors[sector].df_blocks[nextup][1];        
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1428
00000D19 590123                  		MOVU.B 23H[R0], R1
00000D1C 751114                  		MUL #14H, R1
00000D1F FBE2rrrrrrrr            		MOV.L #_g_vee_Sectors, R14
00000D25 4B1E                    		ADD R1, R14
00000D27 A981                    		MOV.L 18H[R0], R1
00000D29 6C31                    		SHLL #03H, R1
00000D2B 0689E104                		ADD 10H[R14].L, R1
00000D2F FBE2rrrrrrrr            		MOV.L #__$g_vee_blank_check_block_end, R14
00000D35 E11E01                  		MOV.L 04H[R1], [R14]
00000D38                         L373:	; bb9.split4
                                 ;    1429                       
                                 ;    1430         /* Verify NEXTUP block is empty */
                                 ;    1431         if( vee_blank_check_block( g_vee_blank_check_block_current ) != VEE_SUCCESS)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1431
00000D38 FBE2rrrrrrrr            		MOV.L #__$g_vee_blank_check_block_current, R14
00000D3E ECE1                    		MOV.L [R14], R1
00000D40 05rrrrrr             A  		BSR _vee_blank_check_block
00000D44 6101                    		CMP #00H, R1
00000D46 3Arrrr               W  		BEQ L406
00000D49                         L374:	; bb34
                                 ;    1432         {
                                 ;    1433             /* Flash error when trying to perform blank check */
                                 ;    1434             FlashError();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1434
00000D49 05rrrrrr             A  		BSR _FlashError
00000D4D 38rrrr               W  		BRA L406
00000D50                         L375:	; bb42
                                 ;    1435         }                                      
                                 ;    1436     }
                                 ;    1437     /* Check to see if we have more records to move */
                                 ;    1438     else if( (g_vee_current_record.ID >= VEE_MAX_RECORD_ID) &&
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1438
00000D50 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_record, R14
00000D56 5CEE                    		MOVU.W [R14], R14
00000D58 617E                    		CMP #07H, R14
00000D5A 2Brr                  * 		BGT L394
         38rrrr                  
00000D5F 38rrrr               W  		BRA L396
00000D62                         L376:	; bb44
                                 ;    1439              (g_vee_current_record.ID != 0xFF) )
                                 ;    1440     {        
                                 ;    1441         /* Now that the records have been moved, we need to write the ACTIVE flag in the NEXTUP block and then erase 
                                 ;    1442            the old ACTIVE block */          
                                 ;    1443                               
                                 ;    1444         /* Write ACTIVE flag */                                        
                                 ;    1445         if(VEE_FAILURE == vee_write_flag(g_vee_current_sector, 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1445
00000D62 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_block_nextup, R14
00000D68 ECE2                    		MOV.L [R14], R2
00000D6A FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
00000D70 58E1                    		MOVU.B [R14], R1
00000D72 FB4EBBBB00              		MOV.L #0000BBBBH, R4
00000D77 6613                    		MOV.L #00000001H, R3
00000D79 39rrrr               W  		BSR __$vee_write_flag
00000D7C 6111                    		CMP #01H, R1
00000D7E 18                   S  		BNE L378
00000D7F                         L377:	; bb45
                                 ;    1446                                          g_vee_current_block_nextup, 
                                 ;    1447                                          VEE_BLOCK_STATE_ACTIVE,
                                 ;    1448                                          VEE_BLOCK_FLAG_ACTIVE) )
                                 ;    1449         {
                                 ;    1450             /* Problem writing flag */
                                 ;    1451             FlashError();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1451
00000D7F 05rrrrrr             A  		BSR _FlashError
00000D83                         L378:	; bb53
                                 ;    1452         }
                                 ;    1453         
                                 ;    1454         /* Set write state to write the ERASING flag next */
                                 ;    1455         g_vee_write_state = VEE_WRITE_FLAG_ERASING;                                                
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1455
00000D83 FBE2rrrrrrrr            		MOV.L #__$g_vee_write_state, R14
00000D89 F8E601                  		MOV.L #00000001H, [R14]
00000D8C 38rrrr               W  		BRA L406
00000D8F                         L379:	; bb56
                                 ;    1456     }
                                 ;    1457     else
                                 ;    1458     {
                                 ;    1459         /* Find next record in this sector that might need to be moved */
                                 ;    1460         while(VEE_MAX_RECORD_ID > g_vee_current_record.ID)
                                 ;    1461         {
                                 ;    1462             /* See if this record resides in the sector being defragged */
                                 ;    1463             if(g_vee_RecordLocations[g_vee_current_record.ID] == g_vee_current_sector)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1463
00000D8F FBE2rrrrrrrr            		MOV.L #__$g_vee_current_record, R14
00000D95 5CEE                    		MOVU.W [R14], R14
00000D97 FBF2rrrrrrrr            		MOV.L #_g_vee_RecordLocations, R15
00000D9D FECFEE                  		MOVU.B [R15,R14], R14
00000DA0 FBF2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R15
00000DA6 44FE                    		CMP [R15].UB, R14
00000DA8 3Brrrr               W  		BNE L389
00000DAB                         L380:	; bb58
                                 ;    1464             {
                                 ;    1465                 /* Found a record to be moved! */
                                 ;    1466                 /* Continue on with defrag */        
                                 ;    1467                 if( g_vee_cache.entries[g_vee_current_record.ID].valid == VEE_CACHE_ENTRY_VALID )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1467
00000DAB FBE2rrrrrrrr            		MOV.L #__$g_vee_current_record, R14
00000DB1 5CEE                    		MOVU.W [R14], R14
00000DB3 63CE                    		MUL #0CH, R14
00000DB5 FB12rrrrrrrr            		MOV.L #__$g_vee_cache, R1
00000DBB 4BE1                    		ADD R14, R1
00000DBD B111                    		MOVU.B 04H[R1], R1
00000DBF 755185                  		CMP #85H, R1
00000DC2 21rr                    		BNE L385
00000DC4                         L381:	; bb60
                                 ;    1468                 {
                                 ;    1469                     /* Check to see if record is already in NEXTUP block */
                                 ;    1470                     if( g_vee_cache.entries[g_vee_current_record.ID].block != nextup )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1470
00000DC4 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_record, R14
00000DCA 5CEE                    		MOVU.W [R14], R14
00000DCC 63CE                    		MUL #0CH, R14
00000DCE FB12rrrrrrrr            		MOV.L #__$g_vee_cache, R1
00000DD4 4BE1                    		ADD R14, R1
00000DD6 A891                    		MOV.L 08H[R1], R1
00000DD8 06850106                		CMP 18H[R0].L, R1
00000DDC 20rr                    		BEQ L389
00000DDE                         L382:	; bb61
                                 ;    1471                     {
                                 ;    1472                         /* Record needs to be moved */                                        
                                 ;    1473                         memcpy((uint8_t far *)(&vee_temp), 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1473
00000DDE FBE2rrrrrrrr            		MOV.L #__$g_vee_current_record, R14
00000DE4 5CEE                    		MOVU.W [R14], R14
00000DE6 63CE                    		MUL #0CH, R14
00000DE8 FB12rrrrrrrr            		MOV.L #__$g_vee_cache, R1
00000DEE 4BE1                    		ADD R14, R1
00000DF0 A899                    		MOV.L 0CH[R1], R1
00000DF2 E5100204                		MOV.L 08H[R1], 10H[R0]
00000DF6 E5100103                		MOV.L 04H[R1], 0CH[R0]
00000DFA E41002                  		MOV.L [R1], 08H[R0]
00000DFD                         L383:	; bb61.split
                                 ;    1474                                (uint8_t far *)(g_vee_cache.entries[g_vee_current_record.ID].address), 
                                 ;    1475                                sizeof(vee_record_t));
                                 ;    1476             
                                 ;    1477                         /* Copy over data so that pData is correct */                           
                                 ;    1478                         vee_temp.pData = (uint8_t far *)&((vee_record_t far *)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1478
00000DFD FBE2rrrrrrrr            		MOV.L #__$g_vee_current_record, R14
00000E03 5CEE                    		MOVU.W [R14], R14
00000E05 63CE                    		MUL #0CH, R14
00000E07 FB12rrrrrrrr            		MOV.L #__$g_vee_cache, R1
00000E0D 4BE1                    		ADD R14, R1
00000E0F A899                    		MOV.L 0CH[R1], R1
00000E11 6281                    		ADD #08H, R1
00000E13 A101                    		MOV.L R1, 10H[R0]
00000E15                         L384:	; bb61.split5
00000E15 710108                  		ADD #08H, R0, R1
                                 ;    1479                                          (g_vee_cache.entries[g_vee_current_record.ID].address))->pData;
                                 ;    1480                         
                                 ;    1481                         /* Issue write */
                                 ;    1482                         return vee_start_write(&vee_temp);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1482
00000E18 39rrrr               W  		BSR __$vee_start_write
00000E1B 8189                    		MOV.B R1, 07H[R0]
00000E1D 38rrrr               W  		BRA L407
00000E20                         L385:	; bb90
                                 ;    1483                     }
                                 ;    1484                     /* Else block has already been moved */
                                 ;    1485                 }
                                 ;    1486                 else
                                 ;    1487                 {
                                 ;    1488                     /* Check to see if entire cache is valid, if so then this record is empty */
                                 ;    1489                     if(g_vee_cache.valid != VEE_CACHE_ENTRY_VALID)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1489
00000E20 FBE2rrrrrrrr            		MOV.L #__$g_vee_cache, R14
00000E26 58EE                    		MOVU.B [R14], R14
00000E28 755E85                  		CMP #85H, R14
00000E2B 20rr                    		BEQ L389
00000E2D                         L386:	; bb92
                                 ;    1490                     {
                                 ;    1491                         /* Cache is not filled, we need to seek for record */
                                 ;    1492                         if( vee_find_record(sector, active, &g_vee_current_record) == VEE_SUCCESS )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1492
00000E2D A98A                    		MOV.L 1CH[R0], R2
00000E2F 590123                  		MOVU.B 23H[R0], R1
00000E32 FB32rrrrrrrr            		MOV.L #__$g_vee_current_record, R3
00000E38 39rrrr               W  		BSR __$vee_find_record
00000E3B 6101                    		CMP #00H, R1
00000E3D 21rr                    		BNE L389
00000E3F                         L387:	; bb93
                                 ;    1493                         {
                                 ;    1494                             /* Record was found, move it to NEXTUP block */
                                 ;    1495                             g_vee_current_record.block = nextup;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1495
00000E3F A981                    		MOV.L 18H[R0], R1
00000E41 FB22rrrrrrrr            		MOV.L #__$g_vee_current_record, R2
00000E47 90A9                    		MOV.W R1, 06H[R2]
00000E49                         L388:	; bb93.split
                                 ;    1496                 
                                 ;    1497                             /* Issue write */
                                 ;    1498                             return vee_start_write(&g_vee_current_record);                    
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1498
00000E49 FB12rrrrrrrr            		MOV.L #__$g_vee_current_record, R1
00000E4F 39rrrr               W  		BSR __$vee_start_write
00000E52 8189                    		MOV.B R1, 07H[R0]
00000E54 38rrrr               W  		BRA L407
00000E57                         L389:	; bb132
                                 ;    1499                         }
                                 ;    1500                         /* Else this record was not found in the ACTIVE block */                
                                 ;    1501                     }
                                 ;    1502                     /* Else this record is not in the system */
                                 ;    1503                 }
                                 ;    1504             }
                                 ;    1505     
                                 ;    1506             /* This record does not need to be moved, move to next one */
                                 ;    1507             g_vee_current_record.ID++;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1507
00000E57 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_record, R14
00000E5D DCEF                    		MOV.W [R14], R15
00000E5F 621F                    		ADD #01H, R15
00000E61 D3EF                    		MOV.W R15, [R14]
00000E63                         L390:	; bb135
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1460
00000E63 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_record, R14
00000E69 5CEE                    		MOVU.W [R14], R14
00000E6B 618E                    		CMP #08H, R14
00000E6D 28rr                  * 		BLT L379
         38rrrr                  
00000E72                         L391:	; bb142
                                 ;    1508         }
                                 ;    1509 
                                 ;    1510         /* Now that the records have been moved, we need to write the ACTIVE flag in the NEXTUP block and then 
                                 ;    1511            erase the old ACTIVE block */          
                                 ;    1512 
                                 ;    1513         /* Write NEXTUP flag */                                        
                                 ;    1514         if(VEE_FAILURE == vee_write_flag(g_vee_current_sector, 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1514
00000E72 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_block_nextup, R14
00000E78 ECE2                    		MOV.L [R14], R2
00000E7A FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
00000E80 58E1                    		MOVU.B [R14], R1
00000E82 FB4EBBBB00              		MOV.L #0000BBBBH, R4
00000E87 6613                    		MOV.L #00000001H, R3
00000E89 39rrrr               W  		BSR __$vee_write_flag
00000E8C 6111                    		CMP #01H, R1
00000E8E 18                   S  		BNE L393
00000E8F                         L392:	; bb143
                                 ;    1515                                          g_vee_current_block_nextup,
                                 ;    1516                                          VEE_BLOCK_STATE_ACTIVE,
                                 ;    1517                                          VEE_BLOCK_FLAG_ACTIVE) )
                                 ;    1518         {
                                 ;    1519             /* Problem writing flag */
                                 ;    1520             FlashError();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1520
00000E8F 05rrrrrr             A  		BSR _FlashError
00000E93                         L393:	; bb151
                                 ;    1521         }
                                 ;    1522 
                                 ;    1523         /* Set write state to write the ERASING flag next */
                                 ;    1524         g_vee_write_state = VEE_WRITE_FLAG_ERASING; 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1524
00000E93 FBE2rrrrrrrr            		MOV.L #__$g_vee_write_state, R14
00000E99 F8E601                  		MOV.L #00000001H, [R14]
00000E9C 2Err                 B  		BRA L406
00000E9E                         L394:	; bb156
00000E9E FBE2rrrrrrrr            		MOV.L #__$g_vee_current_record, R14
00000EA4 5CEE                    		MOVU.W [R14], R14
00000EA6 755EFF                  		CMP #0FFH, R14
00000EA9 10                   S  		BEQ L396
00000EAA                         L395:	; bb161
00000EAA F80601                  		MOV.L #00000001H, [R0]
00000EAD 08                   S  		BRA L397
00000EAE                         L396:	; bb162
00000EAE F80600                  		MOV.L #00000000H, [R0]
00000EB1                         L397:	; bb163
00000EB1 EC01                    		MOV.L [R0], R1
00000EB3 6101                    		CMP #00H, R1
00000EB5 3Brrrr               W  		BNE L376
00000EB8 2Err                 B  		BRA L390
00000EBA                         L398:	; bb173
00000EBA FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00000EC0 ECEE                    		MOV.L [R14], R14
00000EC2 616E                    		CMP #06H, R14
00000EC4 18                   S  		BNE L400
00000EC5                         L399:	; bb177
00000EC5 F80601                  		MOV.L #00000001H, [R0]
00000EC8 08                   S  		BRA L401
00000EC9                         L400:	; bb178
00000EC9 F80600                  		MOV.L #00000000H, [R0]
00000ECC                         L401:	; bb179
00000ECC EC01                    		MOV.L [R0], R1
00000ECE 6101                    		CMP #00H, R1
00000ED0 3Brrrr               W  		BNE L368
00000ED3 38rrrr               W  		BRA L375
00000ED6                         L402:	; bb188
00000ED6 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00000EDC ECEE                    		MOV.L [R14], R14
00000EDE 616E                    		CMP #06H, R14
00000EE0 10                   S  		BEQ L404
00000EE1                         L403:	; bb192
00000EE1 F80601                  		MOV.L #00000001H, [R0]
00000EE4 08                   S  		BRA L405
00000EE5                         L404:	; bb193
00000EE5 F80600                  		MOV.L #00000000H, [R0]
00000EE8                         L405:	; bb194
00000EE8 EC01                    		MOV.L [R0], R1
00000EEA 6101                    		CMP #00H, R1
00000EEC 3Brrrr               W  		BNE L366
00000EEF 38rrrr               W  		BRA L367
00000EF2                         L406:	; bb199
                                 ;    1525     }
                                 ;    1526     /* Continue on with defrag */
                                 ;    1527     return VEE_SUCCESS;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1527
00000EF2 3C0700                  		MOV.B #00H, 07H[R0]
00000EF5                         L407:	; bb201
00000EF5 C5000717                		MOV.B 07H[R0], 17H[R0]
                                 ;    1528 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1528
00000EF9 B589                    		MOVU.B 17H[R0], R1
00000EFB 6709                    		RTSD #24H
00000EFD                         __$vee_write_flag:
                                 		.STACK	__$vee_write_flag=28
                                 ;    1529 /***********************************************************************************************************************
                                 ;    1530 End of function vee_defrag_block
                                 ;    1531 ***********************************************************************************************************************/
                                 ;    1532 
                                 ;    1533 /***********************************************************************************************************************
                                 ;    1534 * Function Name: vee_write_flag
                                 ;    1535 * Description  : Writes a flag to a VEE Block
                                 ;    1536 * Arguments    : sector - 
                                 ;    1537 *                    Which VEE Sector we are dealing with
                                 ;    1538 *                block - 
                                 ;    1539 *                    Which VEE Block to write to
                                 ;    1540 *                flag - 
                                 ;    1541 *                    Which flag to write
                                 ;    1542 *                value - 
                                 ;    1543 *                    What to write
                                 ;    1544 * Return Value : VEE_SUCCESS -  
                                 ;    1545 *                    Successful, write in progress
                                 ;    1546 *                VEE_FAILURE -  
                                 ;    1547 *                    Problem in FlashAPI or flag already written
                                 ;    1548 ***********************************************************************************************************************/
                                 ;    1549 VEE_STATIC uint8_t vee_write_flag (uint8_t sector, uint32_t block, uint8_t flag, vee_var_min_t value)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1549
00000EFD 7100E8                  		ADD #0FFFFFFE8H, R0
00000F00 8589                    		MOV.B R1, 17H[R0]
00000F02 A102                    		MOV.L R2, 10H[R0]
00000F04 838B                    		MOV.B R3, 0FH[R0]
00000F06 9184                    		MOV.W R4, 0CH[R0]
                                 ;    1550 {
                                 ;    1551     /* Pointer used for writing flag */
                                 ;    1552     uint32_t ptr;        
                                 ;    1553                                         
                                 ;    1554     /* Get pointer to base of VEE Block */               
                                 ;    1555     ptr = g_vee_Sectors[sector].VEE_block_addr[block];
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1555
00000F08 B589                    		MOVU.B 17H[R0], R1
00000F0A 751114                  		MUL #14H, R1
00000F0D FB22rrrrrrrr            		MOV.L #_g_vee_Sectors, R2
00000F13 4B12                    		ADD R1, R2
00000F15 A8A1                    		MOV.L 08H[R2], R1
00000F17 A902                    		MOV.L 10H[R0], R2
00000F19 FE6211                  		MOV.L [R2,R1], R1
00000F1C A009                    		MOV.L R1, 04H[R0]
00000F1E                         L409:	; entry.split
                                 ;    1556     /* Move to flag */
                                 ;    1557     ptr += (flag*sizeof(vee_var_min_t));        
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1557
00000F1E B389                    		MOVU.B 0FH[R0], R1
00000F20 6C11                    		SHLL #01H, R1
00000F22 06890101                		ADD 04H[R0].L, R1
00000F26 A009                    		MOV.L R1, 04H[R0]
00000F28                         L410:	; entry.split1
                                 ;    1558     
                                 ;    1559     /* Should perform blank check on flag to make sure we are not writing on already written data which will cause a 
                                 ;    1560        flash error */
                                 ;    1561     if( vee_blank_check_address( (uint8_t *)ptr ) != VEE_SUCCESS )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1561
00000F28 A809                    		MOV.L 04H[R0], R1
00000F2A 05rrrrrr             A  		BSR _vee_blank_check_address
00000F2E 6101                    		CMP #00H, R1
00000F30 A809                    		MOV.L 04H[R0], R1
00000F32 20rr                    		BEQ L414
00000F34                         L411:	; bb20
                                 ;    1562     {
                                 ;    1563         /* Flag has already been written. Check to see if it is the correct value. The value would already be set when 
                                 ;    1564            the VEE system is recovering from a unexpected reset. Example, if the FULL flag was written and a power down 
                                 ;    1565            occured before NEXTUP was written. */
                                 ;    1566         if (*(vee_var_min_t *)ptr != value)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1566
00000F34 5C1E                    		MOVU.W [R1], R14
00000F36 06C50E06                		CMP 0CH[R0].UW, R14
00000F3A 10                   S  		BEQ L413
00000F3B                         L412:	; bb21
                                 ;    1567         {
                                 ;    1568             /* In this case the flag address has already been written and it is not the correct value. */                    
                                 ;    1569             return VEE_FAILURE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1569
00000F3B 3C0301                  		MOV.B #01H, 03H[R0]
00000F3E 2Err                 B  		BRA L417
00000F40                         L413:	; bb23
                                 ;    1570         }
                                 ;    1571         else
                                 ;    1572         {
                                 ;    1573             /* The flag value does match the expected value. Continue on as if the write completed successfully. Extra 
                                 ;    1574                care will need to be taken in this situation since a write was not actually performed and the 
                                 ;    1575                FlashWriteDone() function will not be called automatically by the Flash API. */
                                 ;    1576             return VEE_BUSY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1576
00000F40 3C0302                  		MOV.B #02H, 03H[R0]
00000F43 2Err                 B  		BRA L417
00000F45                         L414:	; bb42
00000F45 6623                    		MOV.L #00000002H, R3
00000F47 71020C                  		ADD #0CH, R0, R2
                                 ;    1577         }
                                 ;    1578     }  
                                 ;    1579     
                                 ;    1580     /* Write flag */
                                 ;    1581     if( R_FlashWrite( (FLASH_PTR_TYPE)ptr, (BUF_PTR_TYPE)&value, sizeof(value)) == FLASH_SUCCESS )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1581
00000F4A 05rrrrrr             A  		BSR _R_FlashWrite
00000F4E 6101                    		CMP #00H, R1
00000F50 18                   S  		BNE L416
00000F51                         L415:	; bb43
                                 ;    1582     {
                                 ;    1583         /* Write was started successfully */
                                 ;    1584         return VEE_SUCCESS;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1584
00000F51 3C0300                  		MOV.B #00H, 03H[R0]
00000F54 08                   S  		BRA L417
00000F55                         L416:	; bb45
                                 ;    1585     }
                                 ;    1586     else
                                 ;    1587     {
                                 ;    1588         /* There was a problem with the FlashAPI */
                                 ;    1589         return VEE_FAILURE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1589
00000F55 3C0301                  		MOV.B #01H, 03H[R0]
00000F58                         L417:	; bb55
00000F58 C500030B                		MOV.B 03H[R0], 0BH[R0]
                                 ;    1590     }
                                 ;    1591 
                                 ;    1592 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1592
00000F5C B289                    		MOVU.B 0BH[R0], R1
00000F5E 6706                    		RTSD #18H
00000F60                         _FlashEraseDone:
                                 		.STACK	_FlashEraseDone=8
                                 ;    1593 /***********************************************************************************************************************
                                 ;    1594 End of function vee_write_flag
                                 ;    1595 ***********************************************************************************************************************/
                                 ;    1596 
                                 ;    1597 
                                 ;    1598 /***********************************************************************************************************************
                                 ;    1599 * Function Name: FlashEraseDone
                                 ;    1600 * Description  : Callback function from FlashAPI that signifies that the requested erase has finished. This function is 
                                 ;    1601 *                called from a interrupt.
                                 ;    1602 * Arguments    : none
                                 ;    1603 * Return Value : none
                                 ;    1604 ***********************************************************************************************************************/
                                 ;    1605 void FlashEraseDone (void)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1605
00000F60 6040                    		SUB #04H, R0
                                 ;    1606 {
                                 ;    1607     /* Check to see if there are any more data flash blocks to erase */
                                 ;    1608     if( g_vee_erase_block_current != g_vee_erase_block_end )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1608
00000F62 FBE2rrrrrrrr            		MOV.L #__$g_vee_erase_block_current, R14
00000F68 ECEE                    		MOV.L [R14], R14
00000F6A FBF2rrrrrrrr            		MOV.L #__$g_vee_erase_block_end, R15
00000F70 0684FE                  		CMP [R15].L, R14
00000F73 20rr                    		BEQ L422
00000F75                         L419:	; bb1
                                 ;    1609     {
                                 ;    1610         /* There are more blocks to erase, keep going */
                                 ;    1611         g_vee_erase_block_end--;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1611
00000F75 FBE2rrrrrrrr            		MOV.L #__$g_vee_erase_block_end, R14
00000F7B ECEF                    		MOV.L [R14], R15
00000F7D 601F                    		SUB #01H, R15
00000F7F E3EF                    		MOV.L R15, [R14]
00000F81                         L420:	; bb1.split
                                 ;    1612         
                                 ;    1613         /* Issue next erase */
                                 ;    1614         if( R_FlashErase(g_vee_erase_block_end) != FLASH_SUCCESS )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1614
00000F81 FBE2rrrrrrrr            		MOV.L #__$g_vee_erase_block_end, R14
00000F87 ECE1                    		MOV.L [R14], R1
00000F89 05rrrrrr             A  		BSR _R_FlashErase
00000F8D 6101                    		CMP #00H, R1
00000F8F 3Arrrr               W  		BEQ L446
00000F92                         L421:	; bb4
                                 ;    1615         {            
                                 ;    1616             /* Error has occurred */
                                 ;    1617             FlashError();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1617
00000F92 05rrrrrr             A  		BSR _FlashError
00000F96 6701                    		RTSD #04H
00000F98                         L422:	; bb12
                                 ;    1618         }        
                                 ;    1619     }  
                                 ;    1620     else
                                 ;    1621     {
                                 ;    1622         /* Check to see if defrag was also needed */
                                 ;    1623         if( (g_vee_state == VEE_ERASE_AND_DEFRAG) ||
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1623
00000F98 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00000F9E ECEE                    		MOV.L [R14], R14
00000FA0 615E                    		CMP #05H, R14
00000FA2 3Arrrr               W  		BEQ L443
00000FA5 38rrrr               W  		BRA L442
00000FA8                         L423:	; bb14
                                 ;    1624             (g_vee_state == VEE_WRITE_AND_DEFRAG) )
                                 ;    1625         {
                                 ;    1626             if(g_vee_state == VEE_ERASE_AND_DEFRAG) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1626
00000FA8 615E                    		CMP #05H, R14
00000FAA 18                   S  		BNE L425
00000FAB                         L424:	; bb15
                                 ;    1627                 /* Defrag needed now */
                                 ;    1628                 g_vee_state = VEE_DEFRAG;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1628
00000FAB FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00000FB1 F8E604                  		MOV.L #00000004H, [R14]
00000FB4                         L425:	; bb20
                                 ;    1629             }
                                 ;    1630             
                                 ;    1631             /* Write NEXTUP flag */                                        
                                 ;    1632             vee_write_flag(g_vee_current_sector, 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1632
00000FB4 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_block_nextup, R14
00000FBA ECE2                    		MOV.L [R14], R2
00000FBC FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
00000FC2 58E1                    		MOVU.B [R14], R1
00000FC4 FB4EDDDD00              		MOV.L #0000DDDDH, R4
00000FC9 6633                    		MOV.L #00000003H, R3
00000FCB 39rrrr               W  		BSR __$vee_write_flag
00000FCE                         L426:	; bb20.split
                                 ;    1633                            g_vee_current_block_nextup,
                                 ;    1634                            VEE_BLOCK_STATE_NEXTUP,
                                 ;    1635                            VEE_BLOCK_FLAG_NEXTUP); 
                                 ;    1636                           
                                 ;    1637             /* Update next available write location */
                                 ;    1638             /* Move past flags at beginning */
                                 ;    1639             g_vee_next_address[g_vee_current_sector].address = (uint8_t far *)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1639
00000FCE FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
00000FD4 58EE                    		MOVU.B [R14], R14
00000FD6 EFEF                    		MOV.L R14, R15
00000FD8 63CF                    		MUL #0CH, R15
00000FDA FB12rrrrrrrr            		MOV.L #__$g_vee_next_address, R1
00000FE0 4BF1                    		ADD R15, R1
00000FE2 751E14                  		MUL #14H, R14
00000FE5 FB22rrrrrrrr            		MOV.L #_g_vee_Sectors, R2
00000FEB 4BE2                    		ADD R14, R2
00000FED ED2E02                  		MOV.L 08H[R2], R14
00000FF0 FBF2rrrrrrrr            		MOV.L #__$g_vee_current_block_nextup, R15
00000FF6 ECFF                    		MOV.L [R15], R15
00000FF8 FE6FEE                  		MOV.L [R15,R14], R14
00000FFB 628E                    		ADD #08H, R14
00000FFD E71E02                  		MOV.L R14, 08H[R1]
00001000                         L427:	; bb20.split1
                                 ;    1640                 (g_vee_Sectors[g_vee_current_sector].VEE_block_addr[g_vee_current_block_nextup] +
                                 ;    1641                 ((VEE_BLOCK_STATE_NEXTUP+1)*sizeof(vee_var_min_t)));
                                 ;    1642             
                                 ;    1643             /* Update block and valid fields */
                                 ;    1644             g_vee_next_address[g_vee_current_sector].block = g_vee_current_block_nextup;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1644
00001000 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
00001006 58EE                    		MOVU.B [R14], R14
00001008 63CE                    		MUL #0CH, R14
0000100A FBF2rrrrrrrr            		MOV.L #__$g_vee_next_address, R15
00001010 4BEF                    		ADD R14, R15
00001012 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_block_nextup, R14
00001018 E4EF01                  		MOV.L [R14], 04H[R15]
0000101B                         L428:	; bb20.split2
                                 ;    1645             g_vee_next_address[g_vee_current_sector].valid = VEE_CACHE_ENTRY_VALID;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1645
0000101B FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
00001021 58EE                    		MOVU.B [R14], R14
00001023 63CE                    		MUL #0CH, R14
00001025 FBF2rrrrrrrr            		MOV.L #__$g_vee_next_address, R15
0000102B FB5685                  		MOV.L #0FFFFFF85H, R5
0000102E FE0FE5                  		MOV.B R5, [R15,R14]
00001031                         L429:	; bb20.split3
                                 ;    1646                                           
                                 ;    1647             /* Next time we will start moving records */
                                 ;    1648             g_vee_write_state = VEE_WRITE_START_DEFRAG;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1648
00001031 FBE2rrrrrrrr            		MOV.L #__$g_vee_write_state, R14
00001037 F8E604                  		MOV.L #00000004H, [R14]
0000103A                         L430:	; bb20.split4
                                 ;    1649         
                                 ;    1650             return;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1650
0000103A 6701                    		RTSD #04H
0000103C                         L431:	; bb49
                                 ;    1651             
                                 ;    1652         }
                                 ;    1653         else if( g_vee_state == VEE_ERASE_AND_WRITE )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1653
0000103C 617E                    		CMP #07H, R14
0000103E 3Brrrr               W  		BNE L440
00001041                         L432:	; bb50
                                 ;    1654         {
                                 ;    1655             /* Block was erased, now write the record */
                                 ;    1656             g_vee_state = VEE_WRITING;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1656
00001041 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00001047 F8E602                  		MOV.L #00000002H, [R14]
0000104A                         L433:	; bb50.split
                                 ;    1657             
                                 ;    1658             /* In this state we are about to make a block ACTIVE */
                                 ;    1659             /* Make first block ACTIVE */
                                 ;    1660             if( VEE_SUCCESS == vee_write_flag( g_vee_current_sector, 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1660
0000104A FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
00001050 58E1                    		MOVU.B [R14], R1
00001052 FB4EBBBB00              		MOV.L #0000BBBBH, R4
00001057 6613                    		MOV.L #00000001H, R3
00001059 6602                    		MOV.L #00000000H, R2
0000105B 39rrrr               W  		BSR __$vee_write_flag
0000105E 6101                    		CMP #00H, R1
00001060 21rr                    		BNE L439
00001062                         L434:	; bb52
                                 ;    1661                                                0,
                                 ;    1662                                                VEE_BLOCK_STATE_ACTIVE, 
                                 ;    1663                                                VEE_BLOCK_FLAG_ACTIVE) )
                                 ;    1664             {
                                 ;    1665                 /* Write record after this */
                                 ;    1666                 g_vee_write_state = VEE_WRITE_ID;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1666
00001062 FBE2rrrrrrrr            		MOV.L #__$g_vee_write_state, R14
00001068 F8E605                  		MOV.L #00000005H, [R14]
0000106B                         L435:	; bb52.split
                                 ;    1667     
                                 ;    1668                 /* Set up next address cache */
                                 ;    1669                 g_vee_next_address[g_vee_current_sector].address = (uint8_t far *)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1669
0000106B FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
00001071 58EE                    		MOVU.B [R14], R14
00001073 EFEF                    		MOV.L R14, R15
00001075 63CF                    		MUL #0CH, R15
00001077 FB12rrrrrrrr            		MOV.L #__$g_vee_next_address, R1
0000107D 4BF1                    		ADD R15, R1
0000107F 751E14                  		MUL #14H, R14
00001082 FB22rrrrrrrr            		MOV.L #_g_vee_Sectors, R2
00001088 4BE2                    		ADD R14, R2
0000108A ED2E02                  		MOV.L 08H[R2], R14
0000108D ECEE                    		MOV.L [R14], R14
0000108F 628E                    		ADD #08H, R14
00001091 E71E02                  		MOV.L R14, 08H[R1]
00001094                         L436:	; bb52.split5
                                 ;    1670                     g_vee_Sectors[g_vee_current_sector].VEE_block_addr[0] + 
                                 ;    1671                     ((VEE_BLOCK_STATE_NEXTUP+1)*sizeof(vee_var_min_t));
                                 ;    1672                 g_vee_next_address[g_vee_current_sector].block = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1672
00001094 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
0000109A 58EE                    		MOVU.B [R14], R14
0000109C 63CE                    		MUL #0CH, R14
0000109E FB12rrrrrrrr            		MOV.L #__$g_vee_next_address, R1
000010A4 4BE1                    		ADD R14, R1
000010A6 3E1100                  		MOV.L #00000000H, 04H[R1]
000010A9                         L437:	; bb52.split6
                                 ;    1673                 g_vee_next_address[g_vee_current_sector].valid = VEE_CACHE_ENTRY_VALID;            
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1673
000010A9 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
000010AF 58EE                    		MOVU.B [R14], R14
000010B1 63CE                    		MUL #0CH, R14
000010B3 FBF2rrrrrrrr            		MOV.L #__$g_vee_next_address, R15
000010B9 FB5685                  		MOV.L #0FFFFFF85H, R5
000010BC FE0FE5                  		MOV.B R5, [R15,R14]
000010BF                         L438:	; bb52.split7
                                 ;    1674     
                                 ;    1675                 /* Writing state flag */
                                 ;    1676                 return;                
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1676
000010BF 6701                    		RTSD #04H
000010C1                         L439:	; bb75
                                 ;    1677             }
                                 ;    1678             else
                                 ;    1679             {
                                 ;    1680                 /* Problem with Flash API */
                                 ;    1681                 FlashError();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1681
000010C1 05rrrrrr             A  		BSR _FlashError
000010C5 6701                    		RTSD #04H
000010C7                         L440:	; bb83
                                 ;    1682             }            
                                 ;    1683         }
                                 ;    1684         else
                                 ;    1685         {                        
                                 ;    1686             /* All erases are done, release state */        
                                 ;    1687             g_vee_state = VEE_READY;    
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1687
000010C7 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
000010CD F8E600                  		MOV.L #00000000H, [R14]
000010D0                         L441:	; bb83.split
                                 ;    1688 
                                 ;    1689             #ifdef VEE_CALLBACK_FUNCTION
                                 ;    1690             /* Call user's callback function */
                                 ;    1691             VEE_CALLBACK_FUNCTION();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1691
000010D0 05rrrrrr             A  		BSR _VEE_OperationDone_Callback
000010D4 6701                    		RTSD #04H
000010D6                         L442:	; bb92
000010D6 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
000010DC ECEE                    		MOV.L [R14], R14
000010DE 616E                    		CMP #06H, R14
000010E0 18                   S  		BNE L444
000010E1                         L443:	; bb96
000010E1 F80601                  		MOV.L #00000001H, [R0]
000010E4 08                   S  		BRA L445
000010E5                         L444:	; bb97
000010E5 F80600                  		MOV.L #00000000H, [R0]
000010E8                         L445:	; bb98
000010E8 EC0E                    		MOV.L [R0], R14
000010EA 610E                    		CMP #00H, R14
000010EC FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
000010F2 ECEE                    		MOV.L [R14], R14
000010F4 3Brrrr               W  		BNE L423
000010F7 38rrrr               W  		BRA L431
000010FA                         L446:	; return
                                 ;    1692             #endif            
                                 ;    1693         }
                                 ;    1694     }
                                 ;    1695 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1695
000010FA 6701                    		RTSD #04H
000010FC                         _FlashWriteDone:
                                 		.STACK	_FlashWriteDone=12
                                 ;    1696 /***********************************************************************************************************************
                                 ;    1697 End of function FlashEraseDone
                                 ;    1698 ***********************************************************************************************************************/
                                 ;    1699 
                                 ;    1700 /***********************************************************************************************************************
                                 ;    1701 * Function Name: FlashWriteDone
                                 ;    1702 * Description  : Callback function from FlashAPI that signifies that the requested write has finished. This function is 
                                 ;    1703 *                called from a interrupt.
                                 ;    1704 * Arguments    : none
                                 ;    1705 * Return Value : none
                                 ;    1706 ***********************************************************************************************************************/
                                 ;    1707 void FlashWriteDone (void)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1707
000010FC 7EA6                    		PUSH.L R6
000010FE 6040                    		SUB #04H, R0
                                 ;    1708 {    
                                 ;    1709     /* Check Write State to see what needs to be done */
                                 ;    1710     if( g_vee_write_state != VEE_WRITE_DONE )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1710
00001100 FBE2rrrrrrrr            		MOV.L #__$g_vee_write_state, R14
00001106 ECEE                    		MOV.L [R14], R14
00001108 61AE                    		CMP #0AH, R14
0000110A 3Arrrr               W  		BEQ L495
0000110D                         L448:	; bb1
                                 ;    1711     {
                                 ;    1712         switch( g_vee_write_state )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1712
0000110D FBE2rrrrrrrr            		MOV.L #__$g_vee_write_state, R14
00001113 ECEE                    		MOV.L [R14], R14
00001115 619E                    		CMP #09H, R14
00001117 3Arrrr               W  		BEQ L479
0000111A                         L449:	; bb1
0000111A 613E                    		CMP #03H, R14
0000111C 20rr                    		BEQ L461
0000111E                         L450:	; bb1
0000111E 614E                    		CMP #04H, R14
00001120 3Arrrr               W  		BEQ L467
00001123                         L451:	; bb1
00001123 615E                    		CMP #05H, R14
00001125 3Arrrr               W  		BEQ L471
00001128                         L452:	; bb1
00001128 616E                    		CMP #06H, R14
0000112A 3Arrrr               W  		BEQ L473
0000112D                         L453:	; bb1
0000112D 617E                    		CMP #07H, R14
0000112F 3Arrrr               W  		BEQ L476
00001132                         L454:	; bb1
00001132 618E                    		CMP #08H, R14
00001134 3Arrrr               W  		BEQ L482
00001137                         L455:	; bb1
00001137 611E                    		CMP #01H, R14
00001139 3Brrrr               W  		BNE L493
0000113C                         L456:	; bb3
                                 ;    1713         {
                                 ;    1714             case VEE_WRITE_FLAG_ERASING:
                                 ;    1715             
                                 ;    1716                 /* Start erase */
                                 ;    1717                 if(VEE_FAILURE == vee_erase_block(g_vee_current_sector, g_vee_current_block_active) )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1717
0000113C FBE2rrrrrrrr            		MOV.L #__$g_vee_current_block_active, R14
00001142 ECE2                    		MOV.L [R14], R2
00001144 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
0000114A 58E1                    		MOVU.B [R14], R1
0000114C 39rrrr               W  		BSR __$vee_erase_block
0000114F 6111                    		CMP #01H, R1
00001151 18                   S  		BNE L458
00001152                         L457:	; bb4
                                 ;    1718                 {
                                 ;    1719                     /* Problem writing flag */
                                 ;    1720                     FlashError();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1720
00001152 05rrrrrr             A  		BSR _FlashError
00001156                         L458:	; bb11
                                 ;    1721                 }
                                 ;    1722                 
                                 ;    1723                 /* Set state so when write is done we know to start erasing */
                                 ;    1724                 g_vee_state = VEE_ERASING;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1724
00001156 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
0000115C F8E603                  		MOV.L #00000003H, [R14]
0000115F                         L459:	; bb11.split
                                 ;    1725             
                                 ;    1726                 /* Write is done */
                                 ;    1727                 g_vee_write_state = VEE_WRITE_DONE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1727
0000115F FBE2rrrrrrrr            		MOV.L #__$g_vee_write_state, R14
00001165 F8E60A                  		MOV.L #0000000AH, [R14]
00001168                         L460:	; bb11.split1
                                 ;    1728                                         
                                 ;    1729                 return;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1729
00001168 3F6602                  		RTSD #08H, R6-R6
0000116B                         L461:	; bb13
                                 ;    1730             
                                 ;    1731             case VEE_WRITE_FLAG_NEXTUP:
                                 ;    1732             
                                 ;    1733                 /* Write NEXTUP flag */                                        
                                 ;    1734                 vee_write_flag(g_vee_current_sector, 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1734
0000116B FBE2rrrrrrrr            		MOV.L #__$g_vee_current_block_nextup, R14
00001171 ECE2                    		MOV.L [R14], R2
00001173 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
00001179 58E1                    		MOVU.B [R14], R1
0000117B FB4EDDDD00              		MOV.L #0000DDDDH, R4
00001180 6633                    		MOV.L #00000003H, R3
00001182 39rrrr               W  		BSR __$vee_write_flag
00001185                         L462:	; bb13.split
                                 ;    1735                                g_vee_current_block_nextup,
                                 ;    1736                                VEE_BLOCK_STATE_NEXTUP,
                                 ;    1737                                VEE_BLOCK_FLAG_NEXTUP); 
                                 ;    1738                               
                                 ;    1739                 /* Update next available write location */
                                 ;    1740                 /* Move past flags at beginning */
                                 ;    1741                 g_vee_next_address[g_vee_current_sector].address = (uint8_t far *)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1741
00001185 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
0000118B 58EE                    		MOVU.B [R14], R14
0000118D EFEF                    		MOV.L R14, R15
0000118F 63CF                    		MUL #0CH, R15
00001191 FB12rrrrrrrr            		MOV.L #__$g_vee_next_address, R1
00001197 4BF1                    		ADD R15, R1
00001199 751E14                  		MUL #14H, R14
0000119C FB22rrrrrrrr            		MOV.L #_g_vee_Sectors, R2
000011A2 4BE2                    		ADD R14, R2
000011A4 A8A2                    		MOV.L 08H[R2], R2
000011A6 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_block_nextup, R14
000011AC ECEE                    		MOV.L [R14], R14
000011AE FE6E22                  		MOV.L [R14,R2], R2
000011B1 6282                    		ADD #08H, R2
000011B3 A092                    		MOV.L R2, 08H[R1]
000011B5                         L463:	; bb13.split2
                                 ;    1742                     (g_vee_Sectors[g_vee_current_sector].VEE_block_addr[g_vee_current_block_nextup] +
                                 ;    1743                     ((VEE_BLOCK_STATE_NEXTUP+1)*sizeof(vee_var_min_t)));
                                 ;    1744                 
                                 ;    1745                 /* Update block and valid fields */
                                 ;    1746                 g_vee_next_address[g_vee_current_sector].block = g_vee_current_block_nextup;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1746
000011B5 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
000011BB 58EE                    		MOVU.B [R14], R14
000011BD 63CE                    		MUL #0CH, R14
000011BF FBF2rrrrrrrr            		MOV.L #__$g_vee_next_address, R15
000011C5 4BEF                    		ADD R14, R15
000011C7 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_block_nextup, R14
000011CD E4EF01                  		MOV.L [R14], 04H[R15]
000011D0                         L464:	; bb13.split3
                                 ;    1747                 g_vee_next_address[g_vee_current_sector].valid = VEE_CACHE_ENTRY_VALID;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1747
000011D0 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
000011D6 58EE                    		MOVU.B [R14], R14
000011D8 63CE                    		MUL #0CH, R14
000011DA FBF2rrrrrrrr            		MOV.L #__$g_vee_next_address, R15
000011E0 FB5685                  		MOV.L #0FFFFFF85H, R5
000011E3 FE0FE5                  		MOV.B R5, [R15,R14]
000011E6                         L465:	; bb13.split4
                                 ;    1748                                               
                                 ;    1749                 /* Next time we will start moving records */
                                 ;    1750                 g_vee_write_state = VEE_WRITE_START_DEFRAG;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1750
000011E6 FBE2rrrrrrrr            		MOV.L #__$g_vee_write_state, R14
000011EC F8E604                  		MOV.L #00000004H, [R14]
000011EF                         L466:	; bb13.split5
                                 ;    1751             
                                 ;    1752                 return;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1752
000011EF 3F6602                  		RTSD #08H, R6-R6
000011F2                         L467:	; bb42
                                 ;    1753                 
                                 ;    1754             case VEE_WRITE_START_DEFRAG:
                                 ;    1755             
                                 ;    1756                 /* Check to see if we need to write a new record before defrag */
                                 ;    1757                 if( g_vee_state == VEE_WRITE_AND_DEFRAG )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1757
000011F2 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
000011F8 ECEE                    		MOV.L [R14], R14
000011FA 616E                    		CMP #06H, R14
000011FC 21rr                    		BNE L469
000011FE                         L468:	; bb43
                                 ;    1758                 {
                                 ;    1759                     /* We need to write a new record before starting defrag */
                                 ;    1760                     vee_start_write(&g_vee_current_record);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1760
000011FE FB12rrrrrrrr            		MOV.L #__$g_vee_current_record, R1
00001204 39rrrr               W  		BSR __$vee_start_write
00001207 3F6602                  		RTSD #08H, R6-R6
0000120A                         L469:	; bb45
                                 ;    1761                 }
                                 ;    1762                 else
                                 ;    1763                 {                    
                                 ;    1764                     /* Init defrag search */
                                 ;    1765                     g_vee_current_record.ID = 0;                                
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1765
0000120A FBE2rrrrrrrr            		MOV.L #__$g_vee_current_record, R14
00001210 F8E500                  		MOV.W #0000H, [R14]
00001213                         L470:	; bb45.split
                                 ;    1766                 
                                 ;    1767                     /* Start looking for records to be moved */
                                 ;    1768                     vee_defrag_block(g_vee_current_sector, g_vee_current_block_active, g_vee_current_block_nextup);  
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1768
00001213 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_block_nextup, R14
00001219 ECE3                    		MOV.L [R14], R3
0000121B FBE2rrrrrrrr            		MOV.L #__$g_vee_current_block_active, R14
00001221 ECE2                    		MOV.L [R14], R2
00001223 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
00001229 58E1                    		MOVU.B [R14], R1
0000122B 39rrrr               W  		BSR __$vee_defrag_block
0000122E 3F6602                  		RTSD #08H, R6-R6
00001231                         L471:	; bb56
                                 ;    1769                 }              
                                 ;    1770             
                                 ;    1771                 return;
                                 ;    1772             
                                 ;    1773             case VEE_WRITE_ID:
                                 ;    1774             
                                 ;    1775                 /* Prepare for rest of write and write 'ID' field */
                                 ;    1776                 vee_start_write(&g_vee_current_record);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1776
00001231 FB12rrrrrrrr            		MOV.L #__$g_vee_current_record, R1
00001237 39rrrr               W  		BSR __$vee_start_write
0000123A                         L472:	; bb56.split
                                 ;    1777                 
                                 ;    1778                 return;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1778
0000123A 3F6602                  		RTSD #08H, R6-R6
0000123D                         L473:	; bb59
                                 ;    1779                 
                                 ;    1780             case VEE_WRITE_SIZE:
                                 ;    1781             
                                 ;    1782                 /* Write 'size' structure member */
                                 ;    1783                 R_FlashWrite( (FLASH_PTR_TYPE)&g_vee_write_address->size, 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1783
0000123D FBE2rrrrrrrr            		MOV.L #__$g_vee_write_address, R14
00001243 ECE1                    		MOV.L [R14], R1
00001245 FB22rrrrrrrr            		MOV.L #__$g_vee_current_record, R2
0000124B 6222                    		ADD #02H, R2
0000124D 6221                    		ADD #02H, R1
0000124F 6623                    		MOV.L #00000002H, R3
00001251 05rrrrrr             A  		BSR _R_FlashWrite
00001255                         L474:	; bb59.split
                                 ;    1784                               (BUF_PTR_TYPE)&g_vee_current_record.size,
                                 ;    1785                               sizeof(g_vee_current_record.size) );
                                 ;    1786 
                                 ;    1787                 /* Next time in we will write the 'block' field */
                                 ;    1788                 g_vee_write_state = VEE_WRITE_BLOCK;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1788
00001255 FBE2rrrrrrrr            		MOV.L #__$g_vee_write_state, R14
0000125B F8E607                  		MOV.L #00000007H, [R14]
0000125E                         L475:	; bb59.split6
                                 ;    1789                 
                                 ;    1790                 return;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1790
0000125E 3F6602                  		RTSD #08H, R6-R6
00001261                         L476:	; bb65
                                 ;    1791             
                                 ;    1792             case VEE_WRITE_BLOCK:
                                 ;    1793             
                                 ;    1794                 /* Write 'block' structure member */
                                 ;    1795                 R_FlashWrite( (FLASH_PTR_TYPE)&g_vee_write_address->block, 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1795
00001261 FBE2rrrrrrrr            		MOV.L #__$g_vee_write_address, R14
00001267 ECE1                    		MOV.L [R14], R1
00001269 FB22rrrrrrrr            		MOV.L #__$g_vee_current_record, R2
0000126F 6262                    		ADD #06H, R2
00001271 6261                    		ADD #06H, R1
00001273 6623                    		MOV.L #00000002H, R3
00001275 05rrrrrr             A  		BSR _R_FlashWrite
00001279                         L477:	; bb65.split
                                 ;    1796                               (BUF_PTR_TYPE)&g_vee_current_record.block,
                                 ;    1797                               sizeof(g_vee_current_record.block) );
                                 ;    1798 
                                 ;    1799                 /* Next time in we will write the 'data' field */
                                 ;    1800                 g_vee_write_state = VEE_WRITE_DATA;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1800
00001279 FBE2rrrrrrrr            		MOV.L #__$g_vee_write_state, R14
0000127F F8E609                  		MOV.L #00000009H, [R14]
00001282                         L478:	; bb65.split7
                                 ;    1801                 
                                 ;    1802                 return;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1802
00001282 3F6602                  		RTSD #08H, R6-R6
00001285                         L479:	; bb73.split
                                 ;    1803                 
                                 ;    1804             case VEE_WRITE_DATA:
                                 ;    1805             
                                 ;    1806                 /* Write 'pData' structure member */
                                 ;    1807                 if(sizeof(vee_var_min_t) > 1)
                                 ;    1808                 {
                                 ;    1809                     /* We have to be careful that we send the FlashAPI a buffer size that is an integer multiple of its 
                                 ;    1810                        programming size. For example: on the RX62N the data flash can program in 8 byte increments.  If 
                                 ;    1811                        we have 13 bytes of data we actually need to send 16 to the FlashAPI */
                                 ;    1812                     R_FlashWrite( (FLASH_PTR_TYPE)&g_vee_write_address->pData, 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1812
00001285 FB12rrrrrrrr            		MOV.L #__$g_vee_current_record, R1
0000128B B81B                    		MOVU.W 02H[R1], R3
0000128D A892                    		MOV.L 08H[R1], R2
0000128F FBE2rrrrrrrr            		MOV.L #__$g_vee_write_address, R14
00001295 ECE1                    		MOV.L [R14], R1
00001297 EF3E                    		MOV.L R3, R14
00001299 641E                    		AND #01H, R14
0000129B 662F                    		MOV.L #00000002H, R15
0000129D 43EF                    		SUB R14, R15
0000129F 641F                    		AND #01H, R15
000012A1 4BF3                    		ADD R15, R3
000012A3 5F33                    		MOVU.W R3, R3
000012A5 6281                    		ADD #08H, R1
000012A7 05rrrrrr             A  		BSR _R_FlashWrite
000012AB                         L480:	; bb73.split8
                                 ;    1813                         (BUF_PTR_TYPE)g_vee_current_record.pData,
                                 ;    1814                         (uint16_t)(g_vee_current_record.size + 
                                 ;    1815                         ((sizeof(vee_var_min_t) - (g_vee_current_record.size % sizeof(vee_var_min_t))) % 
                                 ;    1816                         sizeof(vee_var_min_t))));
                                 ;    1817                 }
                                 ;    1818                 else
                                 ;    1819                 {
                                 ;    1820                     /* If the program size is 1 then no worries */
                                 ;    1821                     R_FlashWrite( (FLASH_PTR_TYPE)&g_vee_write_address->pData,
                                 ;    1822                                   (BUF_PTR_TYPE)g_vee_current_record.pData,
                                 ;    1823                                   g_vee_current_record.size);
                                 ;    1824                 }
                                 ;    1825 
                                 ;    1826                 /* Next time in we will write the 'block' field */
                                 ;    1827                 g_vee_write_state = VEE_WRITE_CHECK;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1827
000012AB FBE2rrrrrrrr            		MOV.L #__$g_vee_write_state, R14
000012B1 F8E608                  		MOV.L #00000008H, [R14]
000012B4                         L481:	; bb73.split9
                                 ;    1828                 
                                 ;    1829                 return;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1829
000012B4 3F6602                  		RTSD #08H, R6-R6
000012B7                         L482:	; bb99
                                 ;    1830                 
                                 ;    1831             case VEE_WRITE_CHECK:
                                 ;    1832             
                                 ;    1833                 /* Write 'check' structure member */
                                 ;    1834                 R_FlashWrite( (FLASH_PTR_TYPE)&g_vee_write_address->check, 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1834
000012B7 FBE2rrrrrrrr            		MOV.L #__$g_vee_write_address, R14
000012BD ECE1                    		MOV.L [R14], R1
000012BF FB22rrrrrrrr            		MOV.L #__$g_vee_current_record, R2
000012C5 6242                    		ADD #04H, R2
000012C7 6241                    		ADD #04H, R1
000012C9 6623                    		MOV.L #00000002H, R3
000012CB 05rrrrrr             A  		BSR _R_FlashWrite
000012CF                         L483:	; bb99.split
                                 ;    1835                               (BUF_PTR_TYPE)&g_vee_current_record.check,
                                 ;    1836                               sizeof(g_vee_current_record.check));
                                 ;    1837                             
                                 ;    1838                 /* Update cache */
                                 ;    1839                 g_vee_cache.entries[g_vee_current_record.ID].address = g_vee_write_address;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1839
000012CF FBE2rrrrrrrr            		MOV.L #__$g_vee_current_record, R14
000012D5 5CEE                    		MOVU.W [R14], R14
000012D7 63CE                    		MUL #0CH, R14
000012D9 FBF2rrrrrrrr            		MOV.L #__$g_vee_cache, R15
000012DF 4BEF                    		ADD R14, R15
000012E1 FBE2rrrrrrrr            		MOV.L #__$g_vee_write_address, R14
000012E7 E4EF03                  		MOV.L [R14], 0CH[R15]
000012EA                         L484:	; bb99.split10
                                 ;    1840                 g_vee_cache.entries[g_vee_current_record.ID].block = g_vee_current_record.block;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1840
000012EA FB12rrrrrrrr            		MOV.L #__$g_vee_current_record, R1
000012F0 5C1E                    		MOVU.W [R1], R14
000012F2 63CE                    		MUL #0CH, R14
000012F4 FB22rrrrrrrr            		MOV.L #__$g_vee_cache, R2
000012FA 4BE2                    		ADD R14, R2
000012FC B899                    		MOVU.W 06H[R1], R1
000012FE A0A1                    		MOV.L R1, 08H[R2]
00001300                         L485:	; bb99.split11
                                 ;    1841                 g_vee_cache.entries[g_vee_current_record.ID].valid = VEE_CACHE_ENTRY_VALID;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1841
00001300 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_record, R14
00001306 5CEE                    		MOVU.W [R14], R14
00001308 63CE                    		MUL #0CH, R14
0000130A FB12rrrrrrrr            		MOV.L #__$g_vee_cache, R1
00001310 4BE1                    		ADD R14, R1
00001312 3C1485                  		MOV.B #85H, 04H[R1]
00001315                         L486:	; bb99.split13
                                 ;    1842                 
                                 ;    1843                 /* Update next available write location */
                                 ;    1844                 if( sizeof(vee_var_min_t) == 1 )
                                 ;    1845                 {
                                 ;    1846                     /* No need to align write boundary */
                                 ;    1847                     g_vee_next_address[g_vee_current_sector].address = (uint8_t far *)
                                 ;    1848                         ( ((uint8_t far *)&g_vee_write_address->pData) + 
                                 ;    1849                           g_vee_current_record.size );
                                 ;    1850                 }
                                 ;    1851                 else
                                 ;    1852                 {
                                 ;    1853                     /* Need to align write boundary */
                                 ;    1854                     g_vee_next_address[g_vee_current_sector].address = (uint8_t far *)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1854
00001315 FBE2rrrrrrrr            		MOV.L #__$g_vee_write_address, R14
0000131B ECE1                    		MOV.L [R14], R1
0000131D FBE2rrrrrrrr            		MOV.L #__$g_vee_current_record, R14
00001323 06C9E101                		ADD 02H[R14].UW, R1
00001327 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
0000132D 58E6                    		MOVU.B [R14], R6
0000132F 6281                    		ADD #08H, R1
00001331 05rrrrrr             A  		BSR _vee_move_to_boundary
00001335 63C6                    		MUL #0CH, R6
00001337 FB22rrrrrrrr            		MOV.L #__$g_vee_next_address, R2
0000133D 4B62                    		ADD R6, R2
0000133F A0A1                    		MOV.L R1, 08H[R2]
00001341                         L487:	; bb99.split14
                                 ;    1855                         vee_move_to_boundary(((uint32_t)&g_vee_write_address->pData) + g_vee_current_record.size);
                                 ;    1856                 }
                                 ;    1857                 
                                 ;    1858                 /* Update block and valid fields */
                                 ;    1859                 g_vee_next_address[g_vee_current_sector].block = g_vee_current_record.block;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1859
00001341 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
00001347 58EE                    		MOVU.B [R14], R14
00001349 63CE                    		MUL #0CH, R14
0000134B FB12rrrrrrrr            		MOV.L #__$g_vee_next_address, R1
00001351 4BE1                    		ADD R14, R1
00001353 FB22rrrrrrrr            		MOV.L #__$g_vee_current_record, R2
00001359 B8AA                    		MOVU.W 06H[R2], R2
0000135B A01A                    		MOV.L R2, 04H[R1]
0000135D                         L488:	; bb99.split15
                                 ;    1860                 g_vee_next_address[g_vee_current_sector].valid = VEE_CACHE_ENTRY_VALID;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1860
0000135D FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
00001363 58EE                    		MOVU.B [R14], R14
00001365 63CE                    		MUL #0CH, R14
00001367 FBF2rrrrrrrr            		MOV.L #__$g_vee_next_address, R15
0000136D FB5685                  		MOV.L #0FFFFFF85H, R5
00001370 FE0FE5                  		MOV.B R5, [R15,R14]
00001373                         L489:	; bb99.split16
                                 ;    1861 
                                 ;    1862                 /* Check to see if we need to defrag now */
                                 ;    1863                 if( g_vee_state != VEE_WRITE_AND_DEFRAG )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1863
00001373 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00001379 ECEE                    		MOV.L [R14], R14
0000137B 616E                    		CMP #06H, R14
0000137D 20rr                    		BEQ L491
0000137F                         L490:	; bb156
                                 ;    1864                 {
                                 ;    1865                     /* Write is done */
                                 ;    1866                     g_vee_write_state = VEE_WRITE_DONE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1866
0000137F FBE2rrrrrrrr            		MOV.L #__$g_vee_write_state, R14
00001385 F8E60A                  		MOV.L #0000000AH, [R14]
00001388 3F6602                  		RTSD #08H, R6-R6
0000138B                         L491:	; bb157
                                 ;    1867                 }
                                 ;    1868                 else
                                 ;    1869                 {
                                 ;    1870                     /* Write is done, set state to DEFRAG */
                                 ;    1871                     g_vee_state = VEE_DEFRAG;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1871
0000138B FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00001391 F8E604                  		MOV.L #00000004H, [R14]
00001394                         L492:	; bb157.split
                                 ;    1872                     
                                 ;    1873                     /* Next time we will start moving records */
                                 ;    1874                     g_vee_write_state = VEE_WRITE_START_DEFRAG;                    
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1874
00001394 FBE2rrrrrrrr            		MOV.L #__$g_vee_write_state, R14
0000139A F8E604                  		MOV.L #00000004H, [R14]
0000139D 3F6602                  		RTSD #08H, R6-R6
000013A0                         L493:	; bb164
                                 ;    1875                 }
                                 ;    1876                 
                                 ;    1877                 return;
                                 ;    1878             
                                 ;    1879             default:
                                 ;    1880                 
                                 ;    1881                 /* Should never get here */
                                 ;    1882                 FlashError();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1882
000013A0 05rrrrrr             A  		BSR _FlashError
000013A4                         L494:	; bb164.split
                                 ;    1883                 
                                 ;    1884                 return;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1884
000013A4 3F6602                  		RTSD #08H, R6-R6
000013A7                         L495:	; bb168
                                 ;    1885                 
                                 ;    1886         }                       
                                 ;    1887     }
                                 ;    1888     else
                                 ;    1889     {
                                 ;    1890         /* The record has been written, if we were just writing one record then we are done.  If a defrag is occurring 
                                 ;    1891            then there could be more records to move. */
                                 ;    1892         if( g_vee_state == VEE_DEFRAG )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1892
000013A7 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
000013AD ECEE                    		MOV.L [R14], R14
000013AF 614E                    		CMP #04H, R14
000013B1 21rr                    		BNE L498
000013B3                         L496:	; bb169
                                 ;    1893         {
                                 ;    1894             /* Update g_vee_current_record for next record */
                                 ;    1895             g_vee_current_record.ID++;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1895
000013B3 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_record, R14
000013B9 DCEF                    		MOV.W [R14], R15
000013BB 621F                    		ADD #01H, R15
000013BD D3EF                    		MOV.W R15, [R14]
000013BF                         L497:	; bb169.split
                                 ;    1896             
                                 ;    1897             /* See if anything else needs to be done */
                                 ;    1898             vee_defrag_block(g_vee_current_sector, g_vee_current_block_active, g_vee_current_block_nextup);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1898
000013BF FBE2rrrrrrrr            		MOV.L #__$g_vee_current_block_nextup, R14
000013C5 ECE3                    		MOV.L [R14], R3
000013C7 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_block_active, R14
000013CD ECE2                    		MOV.L [R14], R2
000013CF FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
000013D5 58E1                    		MOVU.B [R14], R1
000013D7 39rrrr               W  		BSR __$vee_defrag_block
000013DA 3F6602                  		RTSD #08H, R6-R6
000013DD                         L498:	; bb177
                                 ;    1899         }
                                 ;    1900         else if( (g_vee_state == VEE_ERASING) || 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1900
000013DD FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
000013E3 ECEE                    		MOV.L [R14], R14
000013E5 613E                    		CMP #03H, R14
000013E7 20rr                    		BEQ L504
000013E9 2Err                 B  		BRA L503
000013EB                         L499:	; bb179
                                 ;    1901                  (g_vee_state == VEE_ERASE_AND_DEFRAG) ||
                                 ;    1902                  (g_vee_state == VEE_ERASE_AND_WRITE) )
                                 ;    1903         {
                                 ;    1904             /* ERASING flag has been written, start erase */
                                 ;    1905             if( R_FlashErase(g_vee_erase_block_end) != FLASH_SUCCESS )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1905
000013EB FBE2rrrrrrrr            		MOV.L #__$g_vee_erase_block_end, R14
000013F1 ECE1                    		MOV.L [R14], R1
000013F3 05rrrrrr             A  		BSR _R_FlashErase
000013F7 6101                    		CMP #00H, R1
000013F9 20rr                    		BEQ L511
000013FB                         L500:	; bb180
                                 ;    1906             {            
                                 ;    1907                 /* Something failed in the FlashAPI */
                                 ;    1908                 FlashError();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1908
000013FB 05rrrrrr             A  		BSR _FlashError
000013FF 3F6602                  		RTSD #08H, R6-R6
00001402                         L501:	; bb188
                                 ;    1909             }       
                                 ;    1910         }        
                                 ;    1911         else
                                 ;    1912         {
                                 ;    1913             /* Release State */
                                 ;    1914             g_vee_state = VEE_READY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1914
00001402 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00001408 F8E600                  		MOV.L #00000000H, [R14]
0000140B                         L502:	; bb188.split
                                 ;    1915             
                                 ;    1916             #ifdef VEE_CALLBACK_FUNCTION
                                 ;    1917             /* Call user's callback function */
                                 ;    1918             VEE_CALLBACK_FUNCTION();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1918
0000140B 05rrrrrr             A  		BSR _VEE_OperationDone_Callback
0000140F 3F6602                  		RTSD #08H, R6-R6
00001412                         L503:	; bb192
00001412 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00001418 ECEE                    		MOV.L [R14], R14
0000141A 615E                    		CMP #05H, R14
0000141C 18                   S  		BNE L505
0000141D                         L504:	; bb196
0000141D F80601                  		MOV.L #00000001H, [R0]
00001420 08                   S  		BRA L506
00001421                         L505:	; bb197
00001421 F80600                  		MOV.L #00000000H, [R0]
00001424                         L506:	; bb198
00001424 EC01                    		MOV.L [R0], R1
00001426 6101                    		CMP #00H, R1
00001428 21rr                    		BNE L508
0000142A                         L507:	; bb202
0000142A FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00001430 ECEE                    		MOV.L [R14], R14
00001432 617E                    		CMP #07H, R14
00001434 18                   S  		BNE L509
00001435                         L508:	; bb206
00001435 F80601                  		MOV.L #00000001H, [R0]
00001438 08                   S  		BRA L510
00001439                         L509:	; bb207
00001439 F80600                  		MOV.L #00000000H, [R0]
0000143C                         L510:	; bb208
0000143C EC01                    		MOV.L [R0], R1
0000143E 6101                    		CMP #00H, R1
00001440 21rr                    		BNE L499
00001442 2Err                 B  		BRA L501
00001444                         L511:	; return
                                 ;    1919             #endif
                                 ;    1920         }
                                 ;    1921     }
                                 ;    1922 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1922
00001444 3F6602                  		RTSD #08H, R6-R6
00001447                         _FlashBlankCheckDone:
                                 		.STACK	_FlashBlankCheckDone=12
                                 ;    1923 /***********************************************************************************************************************
                                 ;    1924 End of function FlashWriteDone
                                 ;    1925 ***********************************************************************************************************************/
                                 ;    1926 
                                 ;    1927 /***********************************************************************************************************************
                                 ;    1928 * Function Name: FlashBlankCheckDone
                                 ;    1929 * Description  : Callback function from FlashAPI that signifies that the requested blank check has finished.  This 
                                 ;    1930 *                function is called from an interrupt.
                                 ;    1931 * Arguments    : result - 
                                 ;    1932 *                    FLASH_BLANK if block was blank 
                                 ;    1933 *                    FLASH_NOT_BLANK if it was not
                                 ;    1934 * Return Value : none
                                 ;    1935 ***********************************************************************************************************************/
                                 ;    1936 void FlashBlankCheckDone (uint8_t result)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1936
00001447 6080                    		SUB #08H, R0
00001449 8189                    		MOV.B R1, 07H[R0]
                                 ;    1937 {
                                 ;    1938     /* Used for checking return value. */
                                 ;    1939     uint8_t ret;
                                 ;    1940 
                                 ;    1941     /* Check to see if we have checked all blocks, if the last block was not blank then it does not matter anyways. */
                                 ;    1942     if( result == FLASH_BLANK )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1942
0000144B 6101                    		CMP #00H, R1
0000144D 3Brrrr               W  		BNE L538
00001450                         L513:	; bb4
                                 ;    1943     {        
                                 ;    1944         /* Last block checked was blank, do we have more to check? */
                                 ;    1945         if( g_vee_blank_check_block_current != g_vee_blank_check_block_end )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1945
00001450 FBE2rrrrrrrr            		MOV.L #__$g_vee_blank_check_block_current, R14
00001456 ECEE                    		MOV.L [R14], R14
00001458 FBF2rrrrrrrr            		MOV.L #__$g_vee_blank_check_block_end, R15
0000145E 0684FE                  		CMP [R15].L, R14
00001461 20rr                    		BEQ L517
00001463                         L514:	; bb5
                                 ;    1946         {
                                 ;    1947             /* Advance to next block to check */
                                 ;    1948             g_vee_blank_check_block_current++;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1948
00001463 FBE2rrrrrrrr            		MOV.L #__$g_vee_blank_check_block_current, R14
00001469 ECEF                    		MOV.L [R14], R15
0000146B 621F                    		ADD #01H, R15
0000146D E3EF                    		MOV.L R15, [R14]
0000146F                         L515:	; bb5.split
                                 ;    1949             
                                 ;    1950             /* Check next block */
                                 ;    1951             if( VEE_SUCCESS != vee_blank_check_block(g_vee_blank_check_block_current))
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1951
0000146F FBE2rrrrrrrr            		MOV.L #__$g_vee_blank_check_block_current, R14
00001475 ECE1                    		MOV.L [R14], R1
00001477 05rrrrrr             A  		BSR _vee_blank_check_block
0000147B 6101                    		CMP #00H, R1
0000147D 3Arrrr               W  		BEQ L549
00001480                         L516:	; bb8
                                 ;    1952             {
                                 ;    1953                 /* Flash Error */
                                 ;    1954                 FlashError();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1954
00001480 05rrrrrr             A  		BSR _FlashError
00001484 6702                    		RTSD #08H
00001486                         L517:	; bb17
                                 ;    1955             }
                                 ;    1956             
                                 ;    1957             /* Wait for this blank check to finish */
                                 ;    1958             return;
                                 ;    1959         }
                                 ;    1960         else
                                 ;    1961         {
                                 ;    1962             /* All blocks were confirmed blank */
                                 ;    1963             if( g_vee_state == VEE_WRITING )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1963
00001486 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
0000148C ECEE                    		MOV.L [R14], R14
0000148E 612E                    		CMP #02H, R14
00001490 21rr                    		BNE L525
00001492                         L518:	; bb19
                                 ;    1964             {
                                 ;    1965                 /* In this state we are about to make a block ACTIVE */
                                 ;    1966                 /* Make first block ACTIVE */
                                 ;    1967                 if( VEE_SUCCESS == vee_write_flag( g_vee_current_sector, 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1967
00001492 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
00001498 58E1                    		MOVU.B [R14], R1
0000149A FB4EBBBB00              		MOV.L #0000BBBBH, R4
0000149F 6613                    		MOV.L #00000001H, R3
000014A1 6602                    		MOV.L #00000000H, R2
000014A3 39rrrr               W  		BSR __$vee_write_flag
000014A6 6101                    		CMP #00H, R1
000014A8 21rr                    		BNE L524
000014AA                         L519:	; bb20
                                 ;    1968                                                    0,
                                 ;    1969                                                    VEE_BLOCK_STATE_ACTIVE, 
                                 ;    1970                                                    VEE_BLOCK_FLAG_ACTIVE) )
                                 ;    1971                 {
                                 ;    1972                     /* Write record after this */
                                 ;    1973                     g_vee_write_state = VEE_WRITE_ID;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1973
000014AA FBE2rrrrrrrr            		MOV.L #__$g_vee_write_state, R14
000014B0 F8E605                  		MOV.L #00000005H, [R14]
000014B3                         L520:	; bb20.split
                                 ;    1974             
                                 ;    1975                     /* Set up next address cache */
                                 ;    1976                     g_vee_next_address[g_vee_current_sector].address = (uint8_t far *)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1976
000014B3 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
000014B9 58EE                    		MOVU.B [R14], R14
000014BB EFEF                    		MOV.L R14, R15
000014BD 63CF                    		MUL #0CH, R15
000014BF FB12rrrrrrrr            		MOV.L #__$g_vee_next_address, R1
000014C5 4BF1                    		ADD R15, R1
000014C7 751E14                  		MUL #14H, R14
000014CA FB22rrrrrrrr            		MOV.L #_g_vee_Sectors, R2
000014D0 4BE2                    		ADD R14, R2
000014D2 A8A2                    		MOV.L 08H[R2], R2
000014D4 EC22                    		MOV.L [R2], R2
000014D6 6282                    		ADD #08H, R2
000014D8 A092                    		MOV.L R2, 08H[R1]
000014DA                         L521:	; bb20.split1
                                 ;    1977                         g_vee_Sectors[g_vee_current_sector].VEE_block_addr[0] + 
                                 ;    1978                         ((VEE_BLOCK_STATE_NEXTUP+1)*sizeof(vee_var_min_t));
                                 ;    1979                     g_vee_next_address[g_vee_current_sector].block = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1979
000014DA FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
000014E0 58EE                    		MOVU.B [R14], R14
000014E2 63CE                    		MUL #0CH, R14
000014E4 FB12rrrrrrrr            		MOV.L #__$g_vee_next_address, R1
000014EA 4BE1                    		ADD R14, R1
000014EC 3E1100                  		MOV.L #00000000H, 04H[R1]
000014EF                         L522:	; bb20.split2
                                 ;    1980                     g_vee_next_address[g_vee_current_sector].valid = VEE_CACHE_ENTRY_VALID;            
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1980
000014EF FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
000014F5 58EE                    		MOVU.B [R14], R14
000014F7 63CE                    		MUL #0CH, R14
000014F9 FBF2rrrrrrrr            		MOV.L #__$g_vee_next_address, R15
000014FF FB5685                  		MOV.L #0FFFFFF85H, R5
00001502 FE0FE5                  		MOV.B R5, [R15,R14]
00001505                         L523:	; bb20.split3
                                 ;    1981             
                                 ;    1982                     /* Writing state flag */
                                 ;    1983                     return;                
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1983
00001505 6702                    		RTSD #08H
00001507                         L524:	; bb43
                                 ;    1984                 }
                                 ;    1985                 else
                                 ;    1986                 {
                                 ;    1987                     /* Problem with Flash API */
                                 ;    1988                     FlashError();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1988
00001507 05rrrrrr             A  		BSR _FlashError
0000150B 6702                    		RTSD #08H
0000150D                         L525:	; bb52
                                 ;    1989                 }
                                 ;    1990             }
                                 ;    1991             else if( (g_vee_state == VEE_DEFRAG) ||
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1991
0000150D FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00001513 ECEE                    		MOV.L [R14], R14
00001515 614E                    		CMP #04H, R14
00001517 20rr                    		BEQ L535
00001519 2Err                 B  		BRA L534
0000151B                         L526:	; bb53
                                 ;    1992                      (g_vee_state == VEE_WRITE_AND_DEFRAG) )
                                 ;    1993             {
                                 ;    1994                 /* NEXTUP block is blank */  
                                 ;    1995                 /* Write FULL flag in current ACTIVE */
                                 ;    1996                 ret = vee_write_flag(g_vee_current_sector, 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",1996
0000151B FBE2rrrrrrrr            		MOV.L #__$g_vee_current_block_active, R14
00001521 ECE2                    		MOV.L [R14], R2
00001523 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
00001529 58E1                    		MOVU.B [R14], R1
0000152B FB4ECCCC00              		MOV.L #0000CCCCH, R4
00001530 6623                    		MOV.L #00000002H, R3
00001532 39rrrr               W  		BSR __$vee_write_flag
00001535 8181                    		MOV.B R1, 06H[R0]
00001537                         L527:	; bb53.split
                                 ;    1997                                      g_vee_current_block_active,
                                 ;    1998                                      VEE_BLOCK_STATE_FULL,
                                 ;    1999                                      VEE_BLOCK_FLAG_FULL);
                                 ;    2000                                   
                                 ;    2001                 /* Check outcome of writing FULL flag. */
                                 ;    2002                 if (VEE_SUCCESS == ret)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2002
00001537 B181                    		MOVU.B 06H[R0], R1
00001539 6101                    		CMP #00H, R1
0000153B 21rr                    		BNE L529
0000153D                         L528:	; bb58
                                 ;    2003                 {
                                 ;    2004                     /* Flag is being written. */
                                 ;    2005                     /* Next time in we will write the NEXTUP flag */
                                 ;    2006                     g_vee_write_state = VEE_WRITE_FLAG_NEXTUP;                                    
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2006
0000153D FBE2rrrrrrrr            		MOV.L #__$g_vee_write_state, R14
00001543 F8E603                  		MOV.L #00000003H, [R14]
00001546 6702                    		RTSD #08H
00001548                         L529:	; bb60
                                 ;    2007                 }
                                 ;    2008                 else if (VEE_BUSY == ret)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2008
00001548 B181                    		MOVU.B 06H[R0], R1
0000154A 6121                    		CMP #02H, R1
0000154C 21rr                    		BNE L532
0000154E                         L530:	; bb61
                                 ;    2009                 {
                                 ;    2010                     /* Flag was already written. Since Flash API will not be calling FlashWriteDone(), we must set the 
                                 ;    2011                        state and call it as if the Flash API did. */
                                 ;    2012                     g_vee_write_state = VEE_WRITE_FLAG_NEXTUP;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2012
0000154E FBE2rrrrrrrr            		MOV.L #__$g_vee_write_state, R14
00001554 F8E603                  		MOV.L #00000003H, [R14]
00001557                         L531:	; bb61.split
                                 ;    2013                     
                                 ;    2014                     /* Call FlashWriteDone() as Flash API would have. */
                                 ;    2015                     FlashWriteDone();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2015
00001557 39rrrr               W  		BSR _FlashWriteDone
0000155A 6702                    		RTSD #08H
0000155C                         L532:	; bb62
                                 ;    2016                 }
                                 ;    2017                 else
                                 ;    2018                 {
                                 ;    2019                     /* Error in writing FULL flag */
                                 ;    2020                     FlashError();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2020
0000155C 05rrrrrr             A  		BSR _FlashError
00001560 6702                    		RTSD #08H
00001562                         L533:	; bb75
                                 ;    2021                 }                                                                                                     
                                 ;    2022             }
                                 ;    2023             else
                                 ;    2024             {
                                 ;    2025                 /* Error should never get here */
                                 ;    2026                 FlashError();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2026
00001562 05rrrrrr             A  		BSR _FlashError
00001566 6702                    		RTSD #08H
00001568                         L534:	; bb79
00001568 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
0000156E ECEE                    		MOV.L [R14], R14
00001570 616E                    		CMP #06H, R14
00001572 18                   S  		BNE L536
00001573                         L535:	; bb83
00001573 F80601                  		MOV.L #00000001H, [R0]
00001576 08                   S  		BRA L537
00001577                         L536:	; bb84
00001577 F80600                  		MOV.L #00000000H, [R0]
0000157A                         L537:	; bb85
0000157A EC01                    		MOV.L [R0], R1
0000157C 6101                    		CMP #00H, R1
0000157E 21rr                    		BNE L526
00001580 2Err                 B  		BRA L533
00001582                         L538:	; bb103
                                 ;    2027             }
                                 ;    2028         }
                                 ;    2029     }
                                 ;    2030     else
                                 ;    2031     {
                                 ;    2032         /* Block was found to be not blank, erase sector */
                                 ;    2033         if( g_vee_state == VEE_WRITING )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2033
00001582 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00001588 ECEE                    		MOV.L [R14], R14
0000158A 612E                    		CMP #02H, R14
0000158C 21rr                    		BNE L542
0000158E                         L539:	; bb104
                                 ;    2034         {            
                                 ;    2035             /* Set state to erase and write so that record can be written after erase */
                                 ;    2036             g_vee_state = VEE_ERASE_AND_WRITE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2036
0000158E FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00001594 F8E607                  		MOV.L #00000007H, [R14]
00001597                         L540:	; bb104.split
                                 ;    2037             
                                 ;    2038             /* Sector had no ACTIVE blocks but block 0 was not empty, erase it */               
                                 ;    2039             vee_erase_block(g_vee_current_sector, 0);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2039
00001597 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
0000159D 58E1                    		MOVU.B [R14], R1
0000159F 6602                    		MOV.L #00000000H, R2
000015A1 39rrrr               W  		BSR __$vee_erase_block
000015A4                         L541:	; bb104.split4
                                 ;    2040             
                                 ;    2041             return;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2041
000015A4 6702                    		RTSD #08H
000015A6                         L542:	; bb109
                                 ;    2042         }
                                 ;    2043         else if( g_vee_state == VEE_DEFRAG)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2043
000015A6 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
000015AC ECEE                    		MOV.L [R14], R14
000015AE 614E                    		CMP #04H, R14
000015B0 21rr                    		BNE L545
000015B2                         L543:	; bb111
                                 ;    2044         {
                                 ;    2045             /* NEXTUP block needs to be erased before defrag can occur */
                                 ;    2046             if( VEE_SUCCESS != vee_erase_and_defrag(g_vee_current_sector, 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2046
000015B2 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_block_nextup, R14
000015B8 ECE3                    		MOV.L [R14], R3
000015BA FBE2rrrrrrrr            		MOV.L #__$g_vee_current_block_active, R14
000015C0 ECE2                    		MOV.L [R14], R2
000015C2 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
000015C8 58E1                    		MOVU.B [R14], R1
000015CA 39rrrr               W  		BSR __$vee_erase_and_defrag
000015CD 6101                    		CMP #00H, R1
000015CF 20rr                    		BEQ L549
000015D1                         L544:	; bb112
                                 ;    2047                                                     g_vee_current_block_active, 
                                 ;    2048                                                     g_vee_current_block_nextup) )
                                 ;    2049             {
                                 ;    2050                 /* Flash Error */
                                 ;    2051                 FlashError();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2051
000015D1 05rrrrrr             A  		BSR _FlashError
000015D5 6702                    		RTSD #08H
000015D7                         L545:	; bb124
                                 ;    2052             }
                                 ;    2053             
                                 ;    2054             /* Erase started */
                                 ;    2055             return;
                                 ;    2056         }
                                 ;    2057         else if(g_vee_state == VEE_WRITE_AND_DEFRAG)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2057
000015D7 FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
000015DD ECEE                    		MOV.L [R14], R14
000015DF 616E                    		CMP #06H, R14
000015E1 21rr                    		BNE L548
000015E3                         L546:	; bb126
                                 ;    2058         {
                                 ;    2059             /* NEXTUP block needs to be erased before we can write record, and then defrag */
                                 ;    2060             if( VEE_SUCCESS != vee_erase_block(g_vee_current_sector, g_vee_current_block_nextup) )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2060
000015E3 FBE2rrrrrrrr            		MOV.L #__$g_vee_current_block_nextup, R14
000015E9 ECE2                    		MOV.L [R14], R2
000015EB FBE2rrrrrrrr            		MOV.L #__$g_vee_current_sector, R14
000015F1 58E1                    		MOVU.B [R14], R1
000015F3 39rrrr               W  		BSR __$vee_erase_block
000015F6 6101                    		CMP #00H, R1
000015F8 20rr                    		BEQ L549
000015FA                         L547:	; bb127
                                 ;    2061             {
                                 ;    2062                 /* Problem with erase */
                                 ;    2063                 FlashError();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2063
000015FA 05rrrrrr             A  		BSR _FlashError
000015FE 6702                    		RTSD #08H
00001600                         L548:	; bb137
                                 ;    2064             }
                                 ;    2065             
                                 ;    2066             /* Erase started */
                                 ;    2067             return;
                                 ;    2068         }
                                 ;    2069         else
                                 ;    2070         {
                                 ;    2071             /* Error should never get here */
                                 ;    2072             FlashError();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2072
00001600 05rrrrrr             A  		BSR _FlashError
00001604 6702                    		RTSD #08H
00001606                         L549:	; return
                                 ;    2073         }
                                 ;    2074     
                                 ;    2075     }                   
                                 ;    2076 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2076
00001606 6702                    		RTSD #08H
00001608                         _R_VEE_GetVersion:
                                 		.STACK	_R_VEE_GetVersion=8
                                 ;    2077 /***********************************************************************************************************************
                                 ;    2078 End of function FlashBlankCheckDone
                                 ;    2079 ***********************************************************************************************************************/
                                 ;    2080 
                                 ;    2081 /***********************************************************************************************************************
                                 ;    2082 * Function Name: R_VEE_GetVersion
                                 ;    2083 * Description  : Returns the current version of this module. The version number is encoded where the top 2 bytes are the
                                 ;    2084 *                major version number and the bottom 2 bytes are the minor version number. For example, Version 4.25 
                                 ;    2085 *                would be returned as 0x00040019.
                                 ;    2086 * Arguments    : none
                                 ;    2087 * Return Value : Version of this module.
                                 ;    2088 ***********************************************************************************************************************/
                                 ;    2089 uint32_t R_VEE_GetVersion (void)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2089
00001608 6040                    		SUB #04H, R0
                                 ;    2090 {
                                 ;    2091     /* These version macros are defined in r_vee_if.h. */
                                 ;    2092     return ((((uint32_t)VEE_VERSION_MAJOR) << 16) | (uint32_t)VEE_VERSION_MINOR);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2092
0000160A F80E460001              		MOV.L #00010046H, [R0]
0000160F FB1E460001              		MOV.L #00010046H, R1
00001614                         L551:	; entry.split
                                 ;    2093 } 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2093
00001614 6701                    		RTSD #04H
00001616                         __$vee_check_input_record:
                                 		.STACK	__$vee_check_input_record=16
                                 ;    2094 /***********************************************************************************************************************
                                 ;    2095 End of function R_VEE_GetVersion
                                 ;    2096 ***********************************************************************************************************************/
                                 ;    2097 
                                 ;    2098 /***********************************************************************************************************************
                                 ;    2099 * Function Name: vee_check_input_record
                                 ;    2100 * Description  : Check an input record to make sure its data is valid.
                                 ;    2101 * Arguments    : vee_temp - 
                                 ;    2102 *                    Structure with record information
                                 ;    2103 *                read_operation -
                                 ;    2104 *                    Is this a read or write operation. Checking differs for each.
                                 ;    2105 * Return Value : VEE_SUCCESS -  
                                 ;    2106 *                    Successful, record appears okay
                                 ;    2107 *                VEE_INVALID_INPUT -
                                 ;    2108 *                    Failure, record has invalid data
                                 ;    2109 ***********************************************************************************************************************/
                                 ;    2110 VEE_STATIC uint8_t vee_check_input_record (vee_record_t * vee_temp, bool read_operation)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2110
00001616 60C0                    		SUB #0CH, R0
00001618 A081                    		MOV.L R1, 08H[R0]
0000161A 818A                    		MOV.B R2, 07H[R0]
                                 ;    2111 {
                                 ;    2112     uint8_t ret;
                                 ;    2113 
                                 ;    2114     ret = VEE_SUCCESS;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2114
0000161C 3C0500                  		MOV.B #00H, 05H[R0]
0000161F                         L553:	; entry.split
                                 ;    2115 
                                 ;    2116     if (vee_temp->ID >= VEE_MAX_RECORD_ID)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2116
0000161F A881                    		MOV.L 08H[R0], R1
00001621 5C1E                    		MOVU.W [R1], R14
00001623 618E                    		CMP #08H, R14
00001625 29rr                    		BLT L555
00001627                         L554:	; bb4
                                 ;    2117     {
                                 ;    2118         /* Invalid record ID. */
                                 ;    2119         ret = VEE_FAILURE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2119
00001627 3C0501                  		MOV.B #01H, 05H[R0]
0000162A                         L555:	; bb12
                                 ;    2120     }
                                 ;    2121 
                                 ;    2122     if ((read_operation == false) && (vee_temp->size == 0))
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2122
0000162A B189                    		MOVU.B 07H[R0], R1
0000162C 6101                    		CMP #00H, R1
0000162E 10                   S  		BEQ L557
0000162F 2Err                 B  		BRA L559
00001631                         L556:	; bb13
                                 ;    2123     {
                                 ;    2124         /* Must write at least 1 byte. */
                                 ;    2125         ret = VEE_FAILURE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2125
00001631 3C0501                  		MOV.B #01H, 05H[R0]
00001634 2Err                 B  		BRA L561
00001636                         L557:	; bb18
00001636 A881                    		MOV.L 08H[R0], R1
00001638 B819                    		MOVU.W 02H[R1], R1
0000163A 6101                    		CMP #00H, R1
0000163C 18                   S  		BNE L559
0000163D                         L558:	; bb25
0000163D F80601                  		MOV.L #00000001H, [R0]
00001640 08                   S  		BRA L560
00001641                         L559:	; bb26
00001641 F80600                  		MOV.L #00000000H, [R0]
00001644                         L560:	; bb27
00001644 EC01                    		MOV.L [R0], R1
00001646 6101                    		CMP #00H, R1
00001648 21rr                    		BNE L556
0000164A                         L561:	; bb32
                                 ;    2126     }
                                 ;    2127 
                                 ;    2128     return ret;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2128
0000164A C5000506                		MOV.B 05H[R0], 06H[R0]
0000164E B181                    		MOVU.B 06H[R0], R1
00001650                         L562:	; bb32.split
                                 ;    2129 } 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2129
00001650 5B11                    		MOVU.B R1, R1
00001652 6703                    		RTSD #0CH
00001654                         __$vee_check_input_sector:
                                 		.STACK	__$vee_check_input_sector=8
                                 ;    2130 /***********************************************************************************************************************
                                 ;    2131 End of function vee_check_input_record
                                 ;    2132 ***********************************************************************************************************************/
                                 ;    2133 
                                 ;    2134 /***********************************************************************************************************************
                                 ;    2135 * Function Name: vee_check_input_sector
                                 ;    2136 * Description  : Check an input sector number to make sure it is valid
                                 ;    2137 * Arguments    : sector - 
                                 ;    2138 *                    Sector number to use.
                                 ;    2139 * Return Value : VEE_SUCCESS -  
                                 ;    2140 *                    Successful, valid sector number
                                 ;    2141 *                VEE_INVALID_INPUT -
                                 ;    2142 *                    Failure, invalid sector number
                                 ;    2143 ***********************************************************************************************************************/
                                 ;    2144 VEE_STATIC uint8_t vee_check_input_sector (uint8_t sector)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2144
00001654 6040                    		SUB #04H, R0
00001656 8089                    		MOV.B R1, 03H[R0]
                                 ;    2145 {
                                 ;    2146     uint8_t ret;
                                 ;    2147 
                                 ;    2148     ret = VEE_SUCCESS;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2148
00001658 3C0100                  		MOV.B #00H, 01H[R0]
0000165B                         L564:	; entry.split
                                 ;    2149 
                                 ;    2150     if (sector >= VEE_NUM_SECTORS)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2150
0000165B B089                    		MOVU.B 03H[R0], R1
0000165D 6101                    		CMP #00H, R1
0000165F 2Brr                    		BLE L566
00001661                         L565:	; bb3
                                 ;    2151     {
                                 ;    2152         ret = VEE_INVALID_INPUT;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2152
00001661 3C0106                  		MOV.B #06H, 01H[R0]
00001664                         L566:	; bb8
                                 ;    2153     }
                                 ;    2154 
                                 ;    2155     return ret;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2155
00001664 C5000102                		MOV.B 01H[R0], 02H[R0]
00001668 B081                    		MOVU.B 02H[R0], R1
0000166A                         L567:	; bb8.split
                                 ;    2156 } 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2156
0000166A 5B11                    		MOVU.B R1, R1
0000166C 6701                    		RTSD #04H
0000166E                         _R_VEE_Control:
                                 		.STACK	_R_VEE_Control=16
                                 ;    2157 /***********************************************************************************************************************
                                 ;    2158 End of function vee_check_input_sector
                                 ;    2159 ***********************************************************************************************************************/
                                 ;    2160 
                                 ;    2161 /***********************************************************************************************************************
                                 ;    2162 * Function Name: R_VEE_Control
                                 ;    2163 * Description  : Performs various VEE tasks based on input command and data.
                                 ;    2164 * Arguments    : command -
                                 ;    2165 *                    Command to be processed.
                                 ;    2166 *                pdata - 
                                 ;    2167 *                    Pointer to send data in, output data, or both.
                                 ;    2168 * Return Value : VEE_SUCCESS -
                                 ;    2169 *                    Successful, command processed.
                                 ;    2170 *                VEE_BUSY - 
                                 ;    2171 *                    Data flash is busy, try again later
                                 ;    2172 *                VEE_INVALID_INPUT -
                                 ;    2173 *                    Command not supported or bad input data.
                                 ;    2174 ***********************************************************************************************************************/
                                 ;    2175 uint8_t R_VEE_Control (vee_command_t command, void * pdata)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2175
0000166E 60C0                    		SUB #0CH, R0
00001670 A081                    		MOV.L R1, 08H[R0]
00001672 A00A                    		MOV.L R2, 04H[R0]
                                 ;    2176 {
                                 ;    2177     uint8_t ret;
                                 ;    2178 
                                 ;    2179     ret = VEE_SUCCESS;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2179
00001674 3C0200                  		MOV.B #00H, 02H[R0]
00001677                         L569:	; entry.split
                                 ;    2180 
                                 ;    2181     switch (command)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2181
00001677 A881                    		MOV.L 08H[R0], R1
00001679 6101                    		CMP #00H, R1
0000167B 21rr                    		BNE L574
0000167D                         L570:	; bb5
0000167D 6691                    		MOV.L #00000009H, R1
                                 ;    2182     {
                                 ;    2183         case VEE_CMD_RESET:
                                 ;    2184             /* Reset the VEE to a working state. This assumes that the FCU has already been reset. If using the Flash 
                                 ;    2185                API then it will reset itself when a flash error is detected. */
                                 ;    2186             /* VEE_RESET has priority in taking state, but there may already be another task that is inside the 
                                 ;    2187                vee_grab_state function so we have to make sure we have sole access. */
                                 ;    2188             if( vee_grab_state(VEE_RESET) != VEE_SUCCESS )
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2188
0000167F 39rrrr               W  		BSR __$vee_grab_state
00001682 6101                    		CMP #00H, R1
00001684 10                   S  		BEQ L572
00001685                         L571:	; bb6
                                 ;    2189             {
                                 ;    2190                 /* Could not acquire state */
                                 ;    2191                 return VEE_BUSY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2191
00001685 3C0102                  		MOV.B #02H, 01H[R0]
00001688 2Err                 B  		BRA L576
0000168A                         L572:	; bb12
                                 ;    2192             }
                                 ;    2193 
                                 ;    2194             /* Reset VEE. */
                                 ;    2195             vee_reset();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2195
0000168A 39rrrr               W  		BSR __$vee_reset
0000168D                         L573:	; bb12.split
                                 ;    2196 
                                 ;    2197             g_vee_state = VEE_READY;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2197
0000168D FBE2rrrrrrrr            		MOV.L #__$g_vee_state, R14
00001693 F8E600                  		MOV.L #00000000H, [R14]
00001696 08                   S  		BRA L575
00001697                         L574:	; bb13
                                 ;    2198         break;
                                 ;    2199         default:
                                 ;    2200             /* Input command not supported. */
                                 ;    2201             ret = VEE_INVALID_INPUT;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2201
00001697 3C0206                  		MOV.B #06H, 02H[R0]
0000169A                         L575:	; bb14
                                 ;    2202         break;
                                 ;    2203     }
                                 ;    2204 
                                 ;    2205     return ret;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2205
0000169A C5000201                		MOV.B 02H[R0], 01H[R0]
0000169E                         L576:	; bb17
0000169E C5000103                		MOV.B 01H[R0], 03H[R0]
                                 ;    2206 } 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2206
000016A2 B089                    		MOVU.B 03H[R0], R1
000016A4 6703                    		RTSD #0CH
000016A6                         __$vee_invalidate_cache:
                                 		.STACK	__$vee_invalidate_cache=16
                                 ;    2207 /***********************************************************************************************************************
                                 ;    2208 End of function R_VEE_GetVersion
                                 ;    2209 ***********************************************************************************************************************/
                                 ;    2210 
                                 ;    2211 /***********************************************************************************************************************
                                 ;    2212 * Function Name: vee_invalidate_cache
                                 ;    2213 * Description  : Invalidates the record cache for a given sector
                                 ;    2214 * Arguments    : sector - 
                                 ;    2215 *                    Sector number to use.
                                 ;    2216 * Return Value : VEE_SUCCESS -  
                                 ;    2217 *                    Successful, cache is now marked as invalid
                                 ;    2218 ***********************************************************************************************************************/
                                 ;    2219 VEE_STATIC uint8_t vee_invalidate_cache (uint8_t sector)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2219
000016A6 60C0                    		SUB #0CH, R0
000016A8 8289                    		MOV.B R1, 0BH[R0]
                                 ;    2220 {
                                 ;    2221     uint8_t  ret;
                                 ;    2222     uint32_t i;
                                 ;    2223 
                                 ;    2224     ret = VEE_SUCCESS;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2224
000016AA 3C0300                  		MOV.B #00H, 03H[R0]
000016AD                         L578:	; entry.split
                                 ;    2225 
                                 ;    2226     /* Invalidate next address structure. */
                                 ;    2227     g_vee_next_address[sector].valid = VEE_CACHE_ENTRY_INVALID;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2227
000016AD B289                    		MOVU.B 0BH[R0], R1
000016AF 63C1                    		MUL #0CH, R1
000016B1 FBE2rrrrrrrr            		MOV.L #__$g_vee_next_address, R14
000016B7 660F                    		MOV.L #00000000H, R15
000016B9 FE0E1F                  		MOV.B R15, [R14,R1]
000016BC                         L579:	; entry.split1
                                 ;    2228 
                                 ;    2229     /* Invalidate cache entries for this sector. */
                                 ;    2230     g_vee_cache.valid = VEE_CACHE_ENTRY_INVALID;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2230
000016BC FBE2rrrrrrrr            		MOV.L #__$g_vee_cache, R14
000016C2 F8E400                  		MOV.B #00H, [R14]
000016C5                         L580:	; entry.split2
                                 ;    2231     
                                 ;    2232     for (i = 0; i < VEE_MAX_RECORD_ID; i++)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2232
000016C5 3E0100                  		MOV.L #00000000H, 04H[R0]
000016C8 2Err                 B  		BRA L584
000016CA                         L581:	; bb8
                                 ;    2233     {
                                 ;    2234         /* See if this record is in this sector */
                                 ;    2235         if (g_vee_RecordLocations[i] == sector)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2235
000016CA A809                    		MOV.L 04H[R0], R1
000016CC FBE2rrrrrrrr            		MOV.L #_g_vee_RecordLocations, R14
000016D2 FECE1E                  		MOVU.B [R14,R1], R14
000016D5 450E0B                  		CMP 0BH[R0].UB, R14
000016D8 21rr                    		BNE L583
000016DA                         L582:	; bb9
                                 ;    2236         {
                                 ;    2237             g_vee_cache.entries[i].valid = VEE_CACHE_ENTRY_INVALID;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2237
000016DA A809                    		MOV.L 04H[R0], R1
000016DC 63C1                    		MUL #0CH, R1
000016DE FB22rrrrrrrr            		MOV.L #__$g_vee_cache, R2
000016E4 4B12                    		ADD R1, R2
000016E6 3C2400                  		MOV.B #00H, 04H[R2]
000016E9                         L583:	; bb21
000016E9 A809                    		MOV.L 04H[R0], R1
000016EB 6211                    		ADD #01H, R1
000016ED A009                    		MOV.L R1, 04H[R0]
000016EF                         L584:	; bb24
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2232
000016EF A809                    		MOV.L 04H[R0], R1
000016F1 6181                    		CMP #08H, R1
000016F3 23rr                    		BLTU L581
000016F5                         L585:	; bb29
                                 ;    2238         }
                                 ;    2239     }
                                 ;    2240 
                                 ;    2241     return ret;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2241
000016F5 C500030A                		MOV.B 03H[R0], 0AH[R0]
000016F9 B281                    		MOVU.B 0AH[R0], R1
000016FB                         L586:	; bb29.split
                                 ;    2242 } 
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\r_vee\src\r_vee.c",2242
000016FB 5B11                    		MOVU.B R1, R1
000016FD 6703                    		RTSD #0CH
                                 ;    2243 /***********************************************************************************************************************
                                 ;    2244 End of function vee_invalidate_cache
                                 ;    2245 ***********************************************************************************************************************/
                                 ;    2246 
                                 ;    2247 
                                 		.SECTION	C,ROMDATA,ALIGN=4
00000000                         _g_vee_sect0_block_addresses:
00000000 00001000                		.lword	00100000H
00000004 00401000                		.lword	00104000H
00000008                         _g_vee_sect0_df_blocks:
00000008 46000000                		.lword	00000046H
0000000C 4D000000                		.lword	0000004DH
00000010 4E000000                		.lword	0000004EH
00000014 54000000                		.lword	00000054H
00000018                         _g_vee_Sectors:
00000018 00                      		.byte	00H
00000019 02                      		.byte	02H
0000001A 00                      		.byte	0
0000001B 00                      		.byte	0
0000001C 00400000                		.lword	00004000H
00000020 rrrrrrrr                		.lword	_g_vee_sect0_block_addresses
00000024 08                      		.byte	08H
00000025 00                      		.byte	0
00000026 00                      		.byte	0
00000027 00                      		.byte	0
00000028 rrrrrrrr                		.lword	_g_vee_sect0_df_blocks
                                 		.SECTION	C_1,ROMDATA
00000000                         _g_vee_RecordLocations:
00000000 00                      		.byte	0
00000001 00                      		.byte	0
00000002 00                      		.byte	0
00000003 00                      		.byte	0
00000004 00                      		.byte	0
00000005 00                      		.byte	0
00000006 00                      		.byte	0
00000007 00                      		.byte	0
                                 		.SECTION	D,ROMDATA,ALIGN=4
00000000                         __$g_vee_state:
00000000 00000000                		.lword	00000000H
                                 		.SECTION	B,DATA,ALIGN=4
00000000                         __$g_vee_cache:
00000000(00000064H)              		.blkl	25
00000064                         __$g_vee_next_address:
00000064(0000000CH)              		.blkl	3
00000070                         __$g_vee_erase_block_current:
00000070(00000004H)              		.blkl	1
00000074                         __$g_vee_erase_block_end:
00000074(00000004H)              		.blkl	1
00000078                         __$g_vee_write_state:
00000078(00000004H)              		.blkl	1
0000007C                         __$g_vee_current_record:
0000007C(0000000CH)              		.blkl	3
00000088                         __$g_vee_current_block_active:
00000088(00000004H)              		.blkl	1
0000008C                         __$g_vee_current_block_nextup:
0000008C(00000004H)              		.blkl	1
00000090                         __$g_vee_blank_check_block_current:
00000090(00000004H)              		.blkl	1
00000094                         __$g_vee_blank_check_block_end:
00000094(00000004H)              		.blkl	1
00000098                         __$g_vee_write_address:
00000098(00000004H)              		.blkl	1
0000009C                         __$g_vee_lock:
0000009C(00000004H)              		.blkl	1
                                 		.SECTION	B_1,DATA
00000000                         __$g_vee_current_sector:
00000000(00000001H)              		.blkb	1
00000001                         __$g_vee_df_enabled:
00000001(00000001H)              		.blkb	1
                                 		.END

Information List

TOTAL ERROR(S)    00000
TOTAL WARNING(S)  00000
TOTAL LINE(S)     05498   LINES

Section List

Attr         Size               Name
CODE     0000005887(000016FFH)  P
ROMDATA  0000000044(0000002CH)  C
ROMDATA  0000000008(00000008H)  C_1
ROMDATA  0000000004(00000004H)  D
DATA     0000000160(000000A0H)  B
DATA     0000000002(00000002H)  B_1

Cpu Type

-ISA=RXV1 -FPU

Command Parameter

-subcommand=C:\Users\LAFONS~1\AppData\Local\Temp\$ccrx12DB\$ccrx\r_vee.src.cmd
    -nologo
    -isa=rxv1
    -fpu
    -show=conditionals,definitions,expansions
    -define=__RXV1=1
    -fint_register=0
    -debug
    -endian=little
-listfile=C:\Workspace\e2studio\git\MT01\CompactaXP_build\r_vee.lst
-output=C:\Workspace\e2studio\git\MT01\CompactaXP_build\r_vee\src\r_vee.obj
