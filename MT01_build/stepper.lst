* RX FAMILY ASSEMBLER V2.03.00.01 [24 Oct 2014] *  SOURCE LIST  Tue Mar 14 17:28:32 2017

LOC.     OBJ.              0XMDA SOURCE STATEMENT

                                 ;RX Family C/C++ Compiler (V2.03.00.03 [04 Dec 2014])  14-Mar-2017 17:28:32
                                 
                                 ;*** CPU TYPE ***
                                 
                                 ;-ISA=RXV1
                                 
                                 ;*** COMMAND PARAMETER ***
                                 
                                 ;-output=src=stepper.src
                                 ;-lang=c99
                                 ;-include=C:\PROGRA~2\Renesas\RX\2_3_0/include,C:\Workspace\e2studio\git\MT01_master\r_lvd_rx,C:\Workspace\e2studio\git\MT01_master\r_lvd_rx\src,C:/Workspace/e2studio/
                                 ;-debug
                                 ;-show=source,conditionals,definitions,expansions
                                 ;-listfile=stepper.lst
                                 ;-isa=rxv1
                                 ;-optimize=0
                                 ;-fpu
                                 ;-alias=noansi
                                 ;-nologo
                                 ;-nomessage
                                 ;-define=__RX,COMPACTAXP=0,EASYMAK=1,MOBILE=0,FREE_RTOS_PP
                                 ;stepper.c
                                 
                                 		.glb	__Stderr
                                 		.glb	_en
                                 		.glb	_cm
                                 		.glb	_mr
                                 		.glb	_timerDwell
                                 		.glb	_zinhibitor
                                 		.glb	_configVarOx
                                 		.glb	_configVarMaq
                                 		.glb	_configFlags
                                 		.glb	_g_maq
                                 		.glb	_tempoDwell
                                 		.glb	_st_cfg
                                 		.glb	_st_pre
                                 		.glb	_isDwell
                                 		.glb	_zmoved
                                 		.glb	_zmove
                                 		.glb	_z_step_pulse
                                 		.glb	_restart_stepper
                                 		.glb	_R_TMR_CreateOneShot
                                 		.glb	_R_TMR_CreatePeriodic
                                 		.glb	_R_CMT_Control
                                 		.glb	_stepper_init
                                 		.glb	_stepper_init_assertions
                                 		.glb	_R_CMT_CreatePeriodic
                                 		.glb	_stepper_test_assertions
                                 		.glb	_st_runtime_isbusy
                                 		.glb	_st_reset
                                 		.glb	_mp_set_steps_to_runtime_position
                                 		.glb	_st_clc
                                 		.glb	_st_energize_motors
                                 		.glb	_st_deenergize_motors
                                 		.glb	_st_motor_power_callback
                                 		.glb	_timer_dda_callback
                                 		.glb	_timer_dwell_callback
                                 		.glb	_SysTickTimer_getValue
                                 		.glb	_cm_get_combined_state
                                 		.glb	_sr_request_status_report
                                 		.glb	_R_TMR_Control
                                 		.glb	_mp_set_runtime_position
                                 		.glb	_delay_thcStartStop
                                 		.glb	_st_request_exec_move
                                 		.glb	_exec_timer_num
                                 		.glb	_load_timer_num
                                 		.glb	_mp_exec_move
                                 		.glb	_mp_runtime_command
                                 		.glb	_st_prep_line
                                 		.glb	_cm_hard_alarm
                                 		.glb	__FDclass
                                 		.glb	_min3
                                 		.glb	_max3
                                 		.glb	_round
                                 		.glb	_st_prep_null
                                 		.glb	_st_prep_command
                                 		.glb	_st_prep_dwell
                                 		.glb	_st_set_sa
                                 		.glb	_set_flt
                                 		.glb	_st_set_tr
                                 		.glb	_set_flu
                                 		.glb	_st_set_mi
                                 		.glb	_nv_add_conditional_message
                                 		.glb	_set_int
                                 		.glb	_st_set_pm
                                 		.glb	_set_ui8
                                 		.glb	_st_set_pl
                                 		.glb	_st_get_pwr
                                 		.glb	_st_set_mt
                                 		.glb	_fminf
                                 		.glb	_fmaxf
                                 		.glb	_st_set_md
                                 		.glb	_st_set_me
                                 		.glb	_st_command_dwell
                                 		.glb	_st_get_dwell_elapsed_time
                                 		.glb	_st_set_dwell_elapsed_time
                                 		.glb	_st_print_mt
                                 		.glb	_text_print_flt
                                 		.glb	_st_print_me
                                 		.glb	_text_print_nul
                                 		.glb	_st_print_md
                                 		.glb	_fprintf
                                 		.glb	_st_print_ma
                                 		.glb	_st_print_sa
                                 		.glb	_st_print_tr
                                 		.glb	_cm_get_units_mode
                                 		.glb	_st_print_mi
                                 		.glb	_st_print_po
                                 		.glb	_st_print_pm
                                 		.glb	_st_print_pl
                                 		.glb	_st_print_pwr
                                 ;LineNo. C-SOURCE STATEMENT
                                 
                                 		.SECTION	P,CODE
00000000                         _restart_stepper:
                                 		.STACK	_restart_stepper=4
                                 ;       1 /*
                                 ;       2  * stepper.c - stepper motor controls
                                 ;       3  * This file is part of the TinyG project
                                 ;       4  *
                                 ;       5  * Copyright (c) 2010 - 2015 Alden S. Hart, Jr.
                                 ;       6  * Copyright (c) 2013 - 2015 Robert Giseburt
                                 ;       7  *
                                 ;       8  * This file ("the software") is free software: you can redistribute it and/or modify
                                 ;       9  * it under the terms of the GNU General Public License, version 2 as published by the
                                 ;      10  * Free Software Foundation. You should have received a copy of the GNU General Public
                                 ;      11  * License, version 2 along with the software.  If not, see <http://www.gnu.org/licenses/>.
                                 ;      12  *
                                 ;      13  * As a special exception, you may use this file as part of a software library without
                                 ;      14  * restriction. Specifically, if other files instantiate templates or use macros or
                                 ;      15  * inline functions from this file, or you compile this file and link it with  other
                                 ;      16  * files to produce an executable, this file does not by itself cause the resulting
                                 ;      17  * executable to be covered by the GNU General Public License. This exception does not
                                 ;      18  * however invalidate any other reasons why the executable file might be covered by the
                                 ;      19  * GNU General Public License.
                                 ;      20  *
                                 ;      21  * THE SOFTWARE IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT WITHOUT ANY
                                 ;      22  * WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
                                 ;      23  * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT
                                 ;      24  * SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
                                 ;      25  * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF
                                 ;      26  * OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
                                 ;      27  */
                                 ;      28 /* 	This module provides the low-level stepper drivers and some related functions.
                                 ;      29  *	See stepper.h for a detailed explanation of this module.
                                 ;      30  */
                                 ;      31 
                                 ;      32 #include "tinyg.h"
                                 ;      33 #include "config.h"
                                 ;      34 #include "stepper.h"
                                 ;      35 #include "encoder.h"
                                 ;      36 #include "planner.h"
                                 ;      37 #include "report.h"
                                 ;      38 #include "hardware.h"
                                 ;      39 #include "text_parser.h"
                                 ;      40 #include "util.h"
                                 ;      41 #include "lcd.h"
                                 ;      42 #include "plasma.h"
                                 ;      43 #include "switch.h"
                                 ;      44 #include "settings.h"
                                 ;      45 
                                 ;      46 #include "macros.h"
                                 ;      47 #include "eeprom.h"
                                 ;      48 
                                 ;      49 /**** Allocate structures ****/
                                 ;      50 
                                 ;      51 stConfig_t st_cfg;
                                 ;      52 stPrepSingleton_t st_pre;
                                 ;      53 static stRunSingleton_t st_run;
                                 ;      54 bool isDwell = false;
                                 ;      55 extern bool zmoved;
                                 ;      56 extern float zmove;
                                 ;      57 float z_step_pulse;
                                 ;      58 /**** Setup local functions ****/
                                 ;      59 
                                 ;      60 static void _load_move(void);
                                 ;      61 static void _request_load_move(void);
                                 ;      62 #ifdef __ARM
                                 ;      63 static void _set_motor_power_level(const uint8_t motor, const float power_level);
                                 ;      64 #endif
                                 ;      65 #ifdef __RX
                                 ;      66 void timer_dda_callback(void *pdata);
                                 ;      67 void timer_dwell_callback(void *pdata);
                                 ;      68 void exec_timer_num(void *pdata);
                                 ;      69 void load_timer_num(void *pdata);
                                 ;      70 
                                 ;      71 #endif
                                 ;      72 // handy macro
                                 ;      73 #define _f_to_period(f) (uint16_t)((float)F_CPU / (float)f)
                                 ;      74 
                                 ;      75 /**** Setup motate ****/
                                 ;      76 
                                 ;      77 #ifdef __ARM
                                 ;      78 using namespace Motate;
                                 ;      79 
                                 ;      80 OutputPin<kGRBL_CommonEnablePinNumber> common_enable;	 // shorter form of the above
                                 ;      81 OutputPin<kDebug1_PinNumber> dda_debug_pin1;
                                 ;      82 OutputPin<kDebug2_PinNumber> dda_debug_pin2;
                                 ;      83 OutputPin<kDebug3_PinNumber> dda_debug_pin3;
                                 ;      84 
                                 ;      85 // Example with prefixed name::
                                 ;      86 //Motate::Timer<dda_timer_num> dda_timer(kTimerUpToMatch, FREQUENCY_DDA);// stepper pulse generation
                                 ;      87 Timer<dda_timer_num> dda_timer(kTimerUpToMatch, FREQUENCY_DDA);			// stepper pulse generation
                                 ;      88 Timer<dwell_timer_num> dwell_timer(kTimerUpToMatch, FREQUENCY_DWELL);	// dwell timer
                                 ;      89 Timer<load_timer_num> load_timer;		// triggers load of next stepper segment
                                 ;      90 Timer<exec_timer_num> exec_timer;		// triggers calculation of next+1 stepper segment
                                 ;      91 
                                 ;      92 // Motor structures
                                 ;      93 template<pin_number step_num,			// Setup a stepper template to hold our pins
                                 ;      94 		 pin_number dir_num,
                                 ;      95 		 pin_number enable_num,
                                 ;      96 		 pin_number ms0_num,
                                 ;      97 		 pin_number ms1_num,
                                 ;      98 		 pin_number ms2_num,
                                 ;      99 		 pin_number vref_num>
                                 ;     100 
                                 ;     101 struct Stepper {
                                 ;     102 	/* stepper pin assignments */
                                 ;     103 
                                 ;     104 	OutputPin<step_num> step;
                                 ;     105 	OutputPin<dir_num> dir;
                                 ;     106 	OutputPin<enable_num> enable;
                                 ;     107 	OutputPin<ms0_num> ms0;
                                 ;     108 	OutputPin<ms1_num> ms1;
                                 ;     109 	OutputPin<ms2_num> ms2;
                                 ;     110 	PWMOutputPin<vref_num> vref;
                                 ;     111 
                                 ;     112 	/* stepper default values */
                                 ;     113 
                                 ;     114 	// sets default pwm freq for all motor vrefs (comment line also sets HiZ)
                                 ;     115 	Stepper(const uint32_t frequency = 500000) : vref(frequency) {};
                                 ;     116 //	Stepper(const uint32_t frequency = 100000) : vref(kDriveLowOnly, frequency) {};
                                 ;     117 
                                 ;     118 	/* functions bound to stepper structures */
                                 ;     119 
                                 ;     120 	void setMicrosteps(const uint8_t microsteps)
                                 ;     121 	{
                                 ;     122 		switch (microsteps) {
                                 ;     123 			case ( 1): { ms2=0; ms1=0; ms0=0; break; }
                                 ;     124 			case ( 2): { ms2=0; ms1=0; ms0=1; break; }
                                 ;     125 			case ( 4): { ms2=0; ms1=1; ms0=0; break; }
                                 ;     126 			case ( 8): { ms2=0; ms1=1; ms0=1; break; }
                                 ;     127 			case (16): { ms2=1; ms1=0; ms0=0; break; }
                                 ;     128 			case (32): { ms2=1; ms1=0; ms0=1; break; }
                                 ;     129 		}
                                 ;     130 	};
                                 ;     131 
                                 ;     132 	void energize(const uint8_t motor)
                                 ;     133 	{
                                 ;     134 		if (st_cfg.mot[motor].power_mode != MOTOR_DISABLED) {
                                 ;     135 			enable.clear();
                                 ;     136 			st_run.mot[motor].power_state = MOTOR_POWER_TIMEOUT_START;
                                 ;     137 		}
                                 ;     138 	};
                                 ;     139 };
                                 ;     140 
                                 ;     141 Stepper<kSocket1_StepPinNumber,
                                 ;     142 		kSocket1_DirPinNumber,
                                 ;     143 		kSocket1_EnablePinNumber,
                                 ;     144 		kSocket1_Microstep_0PinNumber,
                                 ;     145 		kSocket1_Microstep_1PinNumber,
                                 ;     146 		kSocket1_Microstep_2PinNumber,
                                 ;     147 		kSocket1_VrefPinNumber> motor_1;
                                 ;     148 
                                 ;     149 Stepper<kSocket2_StepPinNumber,
                                 ;     150 		kSocket2_DirPinNumber,
                                 ;     151 		kSocket2_EnablePinNumber,
                                 ;     152 		kSocket2_Microstep_0PinNumber,
                                 ;     153 		kSocket2_Microstep_1PinNumber,
                                 ;     154 		kSocket2_Microstep_2PinNumber,
                                 ;     155 		kSocket2_VrefPinNumber> motor_2;
                                 ;     156 
                                 ;     157 Stepper<kSocket3_StepPinNumber,
                                 ;     158 		kSocket3_DirPinNumber,
                                 ;     159 		kSocket3_EnablePinNumber,
                                 ;     160 		kSocket3_Microstep_0PinNumber,
                                 ;     161 		kSocket3_Microstep_1PinNumber,
                                 ;     162 		kSocket3_Microstep_2PinNumber,
                                 ;     163 		kSocket3_VrefPinNumber> motor_3;
                                 ;     164 
                                 ;     165 Stepper<kSocket4_StepPinNumber,
                                 ;     166 		kSocket4_DirPinNumber,
                                 ;     167 		kSocket4_EnablePinNumber,
                                 ;     168 		kSocket4_Microstep_0PinNumber,
                                 ;     169 		kSocket4_Microstep_1PinNumber,
                                 ;     170 		kSocket4_Microstep_2PinNumber,
                                 ;     171 		kSocket4_VrefPinNumber> motor_4;
                                 ;     172 
                                 ;     173 Stepper<kSocket5_StepPinNumber,
                                 ;     174 		kSocket5_DirPinNumber,
                                 ;     175 		kSocket5_EnablePinNumber,
                                 ;     176 		kSocket5_Microstep_0PinNumber,
                                 ;     177 		kSocket5_Microstep_1PinNumber,
                                 ;     178 		kSocket5_Microstep_2PinNumber,
                                 ;     179 		kSocket5_VrefPinNumber> motor_5;
                                 ;     180 
                                 ;     181 Stepper<kSocket6_StepPinNumber,
                                 ;     182 		kSocket6_DirPinNumber,
                                 ;     183 		kSocket6_EnablePinNumber,
                                 ;     184 		kSocket6_Microstep_0PinNumber,
                                 ;     185 		kSocket6_Microstep_1PinNumber,
                                 ;     186 		kSocket6_Microstep_2PinNumber,
                                 ;     187 		kSocket6_VrefPinNumber> motor_6;
                                 ;     188 
                                 ;     189 #endif // __ARM
                                 ;     190 
                                 ;     191 /************************************************************************************
                                 ;     192  **** CODE **************************************************************************
                                 ;     193  ************************************************************************************/
                                 ;     194 void restart_stepper()
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",194
00000000 754360                  		MOV.L #00000060H, R3
00000003 6602                    		MOV.L #00000000H, R2
                                 ;     195 {
                                 ;     196 	memset(&st_run, 0, sizeof(st_run));			// clear all values, pointers and status
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",196
00000005 FB12rrrrrrrr            		MOV.L #__$st_run, R1
0000000B 7F88                    		SSTR.B
0000000D                         L12:	; entry.split
                                 ;     197 	stepper_init_assertions();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",197
0000000D 39rrrr               W  		BSR _stepper_init_assertions
00000010                         L13:	; entry.split1
00000010 6623                    		MOV.L #00000002H, R3
                                 ;     198     R_TMR_CreateOneShot((uint8_t)(1000000/FREQUENCY_SGI),exec_timer_num,TIMER_EXEC);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",198
00000012 FB22rrrrrrrr            		MOV.L #_exec_timer_num, R2
00000018 6651                    		MOV.L #00000005H, R1
0000001A 05rrrrrr             A  		BSR _R_TMR_CreateOneShot
0000001E                         L14:	; entry.split2
0000001E 6603                    		MOV.L #00000000H, R3
                                 ;     199     R_TMR_CreatePeriodic(2*FREQUENCY_DDA,timer_dda_callback,TIMER_DDA);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",199
00000020 FB22rrrrrrrr            		MOV.L #_timer_dda_callback, R2
00000026 FB1E400D03              		MOV.L #00030D40H, R1
0000002B 05rrrrrr             A  		BSR _R_TMR_CreatePeriodic
0000002F                         L15:	; entry.split3
0000002F 6613                    		MOV.L #00000001H, R3
                                 ;     200     R_TMR_CreateOneShot((uint8_t)(1000000/FREQUENCY_SGI),load_timer_num,TIMER_LOAD);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",200
00000031 FB22rrrrrrrr            		MOV.L #_load_timer_num, R2
00000037 6651                    		MOV.L #00000005H, R1
00000039 05rrrrrr             A  		BSR _R_TMR_CreateOneShot
0000003D                         L16:	; entry.split4
                                 ;     201  //   R_CMT_CreatePeriodic(FREQUENCY_DWELL,timer_dwell_callback,&timerDwell);
                                 ;     202     R_CMT_Control(timerDwell,CMT_RX_CMD_PAUSE,0);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",202
0000003D FBE2rrrrrrrr            		MOV.L #_timerDwell, R14
00000043 ECE1                    		MOV.L [R14], R1
00000045 6603                    		MOV.L #00000000H, R3
00000047 6612                    		MOV.L #00000001H, R2
00000049 05rrrrrr             A  		BSR _R_CMT_Control
0000004D                         L17:	; entry.split5
                                 ;     203 	st_pre.buffer_state = PREP_BUFFER_OWNED_BY_EXEC;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",203
0000004D FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000053 3C1201                  		MOV.B #01H, 02H[R1]
00000056 02                      		RTS
00000057                         _stepper_init:
                                 		.STACK	_stepper_init=4
                                 ;     204 }
                                 ;     205 /*
                                 ;     206  * stepper_init() - initialize stepper motor subsystem
                                 ;     207  *
                                 ;     208  *	Notes:
                                 ;     209  *	  - This init requires sys_init() to be run beforehand
                                 ;     210  * 	  - microsteps are setup during config_init()
                                 ;     211  *	  - motor polarity is setup during config_init()
                                 ;     212  *	  - high level interrupts must be enabled in main() once all inits are complete
                                 ;     213  */
                                 ;     214 /*	NOTE: This is the bare code that the Motate timer calls replace.
                                 ;     215  *	NB: requires: #include <component_tc.h>
                                 ;     216  *
                                 ;     217  *	REG_TC1_WPMR = 0x54494D00;			// enable write to registers
                                 ;     218  *	TC_Configure(TC_BLOCK_DDA, TC_CHANNEL_DDA, TC_CMR_DDA);
                                 ;     219  *	REG_RC_DDA = TC_RC_DDA;				// set frequency
                                 ;     220  *	REG_IER_DDA = TC_IER_DDA;			// enable interrupts
                                 ;     221  *	NVIC_EnableIRQ(TC_IRQn_DDA);
                                 ;     222  *	pmc_enable_periph_clk(TC_ID_DDA);
                                 ;     223  *	TC_Start(TC_BLOCK_DDA, TC_CHANNEL_DDA);
                                 ;     224  */
                                 ;     225 
                                 ;     226 void stepper_init()
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",226
00000057 754360                  		MOV.L #00000060H, R3
0000005A 6602                    		MOV.L #00000000H, R2
                                 ;     227 {
                                 ;     228 	memset(&st_run, 0, sizeof(st_run));			// clear all values, pointers and status
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",228
0000005C FB12rrrrrrrr            		MOV.L #__$st_run, R1
00000062 7F88                    		SSTR.B
00000064                         L19:	; entry.split
                                 ;     229 	stepper_init_assertions();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",229
00000064 39rrrr               W  		BSR _stepper_init_assertions
00000067                         L20:	; entry.split1
00000067 6623                    		MOV.L #00000002H, R3
                                 ;     230 
                                 ;     231 #ifdef __AVR
                                 ;     232 	// Configure virtual ports
                                 ;     233 	PORTCFG.VPCTRLA = PORTCFG_VP0MAP_PORT_MOTOR_1_gc | PORTCFG_VP1MAP_PORT_MOTOR_2_gc;
                                 ;     234 	PORTCFG.VPCTRLB = PORTCFG_VP2MAP_PORT_MOTOR_3_gc | PORTCFG_VP3MAP_PORT_MOTOR_4_gc;
                                 ;     235 
                                 ;     236 	// setup ports and data structures
                                 ;     237 	for (uint8_t i=0; i<MOTORS; i++) {
                                 ;     238 		hw.st_port[i]->DIR = MOTOR_PORT_DIR_gm;  // sets outputs for motors & GPIO1, and GPIO2 inputs
                                 ;     239 		hw.st_port[i]->OUT = MOTOR_ENABLE_BIT_bm;// zero port bits AND disable motor
                                 ;     240 	}
                                 ;     241 	// setup DDA timer
                                 ;     242 	TIMER_DDA.CTRLA = STEP_TIMER_DISABLE;		// turn timer off
                                 ;     243 	TIMER_DDA.CTRLB = STEP_TIMER_WGMODE;		// waveform mode
                                 ;     244 	TIMER_DDA.INTCTRLA = TIMER_DDA_INTLVL;		// interrupt mode
                                 ;     245 
                                 ;     246 	// setup DWELL timer
                                 ;     247 	TIMER_DWELL.CTRLA = STEP_TIMER_DISABLE;		// turn timer off
                                 ;     248 	TIMER_DWELL.CTRLB = STEP_TIMER_WGMODE;		// waveform mode
                                 ;     249 	TIMER_DWELL.INTCTRLA = TIMER_DWELL_INTLVL;	// interrupt mode
                                 ;     250 
                                 ;     251 	// setup software interrupt load timer
                                 ;     252 	TIMER_LOAD.CTRLA = LOAD_TIMER_DISABLE;		// turn timer off
                                 ;     253 	TIMER_LOAD.CTRLB = LOAD_TIMER_WGMODE;		// waveform mode
                                 ;     254 	TIMER_LOAD.INTCTRLA = TIMER_LOAD_INTLVL;	// interrupt mode
                                 ;     255 	TIMER_LOAD.PER = LOAD_TIMER_PERIOD;			// set period
                                 ;     256 
                                 ;     257 	// setup software interrupt exec timer
                                 ;     258 	TIMER_EXEC.CTRLA = EXEC_TIMER_DISABLE;		// turn timer off
                                 ;     259 	TIMER_EXEC.CTRLB = EXEC_TIMER_WGMODE;		// waveform mode
                                 ;     260 	TIMER_EXEC.INTCTRLA = TIMER_EXEC_INTLVL;	// interrupt mode
                                 ;     261 	TIMER_EXEC.PER = EXEC_TIMER_PERIOD;			// set period
                                 ;     262 
                                 ;     263 	st_pre.buffer_state = PREP_BUFFER_OWNED_BY_EXEC;
                                 ;     264 	st_reset();									// reset steppers to known state
                                 ;     265 #endif // __AVR
                                 ;     266 
                                 ;     267 #ifdef __ARM
                                 ;     268 	// setup DDA timer (see FOOTNOTE)
                                 ;     269 	dda_timer.setInterrupts(kInterruptOnOverflow | kInterruptOnMatchA | kInterruptPriorityHighest);
                                 ;     270 	dda_timer.setDutyCycleA(0.25);
                                 ;     271 
                                 ;     272 	// setup DWELL timer
                                 ;     273 	dwell_timer.setInterrupts(kInterruptOnOverflow | kInterruptPriorityHighest);
                                 ;     274 
                                 ;     275 	// setup software interrupt load timer
                                 ;     276 	load_timer.setInterrupts(kInterruptOnSoftwareTrigger | kInterruptPriorityLow);
                                 ;     277 
                                 ;     278 	// setup software interrupt exec timer & initial condition
                                 ;     279 	exec_timer.setInterrupts(kInterruptOnSoftwareTrigger | kInterruptPriorityLowest);
                                 ;     280 	st_pre.buffer_state = PREP_BUFFER_OWNED_BY_EXEC;
                                 ;     281 
                                 ;     282 	// setup motor power levels and apply power level to stepper drivers
                                 ;     283 	for (uint8_t motor=0; motor<MOTORS; motor++) {
                                 ;     284 		_set_motor_power_level(motor, st_cfg.mot[motor].power_level_scaled);
                                 ;     285 		st_run.mot[motor].power_level_dynamic = st_cfg.mot[motor].power_level_scaled;
                                 ;     286 	}
                                 ;     287 //	motor_1.vref = 0.25; // example of how to set vref duty cycle directly. Freq already set to 500000 Hz.
                                 ;     288 #endif // __ARM
                                 ;     289 
                                 ;     290 #ifdef __RX
                                 ;     291     R_TMR_CreateOneShot((uint8_t)(1000000/FREQUENCY_SGI),exec_timer_num,TIMER_EXEC);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",291
00000069 FB22rrrrrrrr            		MOV.L #_exec_timer_num, R2
0000006F 6651                    		MOV.L #00000005H, R1
00000071 05rrrrrr             A  		BSR _R_TMR_CreateOneShot
00000075                         L21:	; entry.split2
00000075 6603                    		MOV.L #00000000H, R3
                                 ;     292     R_TMR_CreatePeriodic(2*FREQUENCY_DDA,timer_dda_callback,TIMER_DDA);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",292
00000077 FB22rrrrrrrr            		MOV.L #_timer_dda_callback, R2
0000007D FB1E400D03              		MOV.L #00030D40H, R1
00000082 05rrrrrr             A  		BSR _R_TMR_CreatePeriodic
00000086                         L22:	; entry.split3
00000086 6613                    		MOV.L #00000001H, R3
                                 ;     293     R_TMR_CreateOneShot((uint8_t)(1000000/FREQUENCY_SGI),load_timer_num,TIMER_LOAD);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",293
00000088 FB22rrrrrrrr            		MOV.L #_load_timer_num, R2
0000008E 6651                    		MOV.L #00000005H, R1
00000090 05rrrrrr             A  		BSR _R_TMR_CreateOneShot
00000094                         L23:	; entry.split4
                                 ;     294     R_CMT_CreatePeriodic(FREQUENCY_DWELL,timer_dwell_callback,&timerDwell);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",294
00000094 FB32rrrrrrrr            		MOV.L #_timerDwell, R3
0000009A FB22rrrrrrrr            		MOV.L #_timer_dwell_callback, R2
000000A0 FB1A1027                		MOV.L #00002710H, R1
000000A4 05rrrrrr             A  		BSR _R_CMT_CreatePeriodic
000000A8                         L24:	; entry.split5
                                 ;     295     R_CMT_Control(timerDwell,CMT_RX_CMD_PAUSE,0);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",295
000000A8 FBE2rrrrrrrr            		MOV.L #_timerDwell, R14
000000AE ECE1                    		MOV.L [R14], R1
000000B0 6603                    		MOV.L #00000000H, R3
000000B2 6612                    		MOV.L #00000001H, R2
000000B4 05rrrrrr             A  		BSR _R_CMT_Control
000000B8                         L25:	; entry.split6
                                 ;     296 
                                 ;     297 	// setup software interrupt load timer
                                 ;     298 
                                 ;     299 	// setup software interrupt exec timer & initial condition
                                 ;     300 
                                 ;     301 
                                 ;     302 	st_pre.buffer_state = PREP_BUFFER_OWNED_BY_EXEC;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",302
000000B8 FB12rrrrrrrr            		MOV.L #_st_pre, R1
000000BE 3C1201                  		MOV.B #01H, 02H[R1]
000000C1                         L26:	; entry.split7
                                 ;     303 	st_reset();									// reset steppers to known state
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",303
000000C1 39rrrr               W  		BSR _st_reset
000000C4 02                      		RTS
000000C5                         _stepper_init_assertions:
                                 		.STACK	_stepper_init_assertions=4
                                 ;     304 
                                 ;     305 #endif // __RX
                                 ;     306 }
                                 ;     307 
                                 ;     308 /*
                                 ;     309  * stepper_init_assertions() - test assertions, return error code if violation exists
                                 ;     310  * stepper_test_assertions() - test assertions, return error code if violation exists
                                 ;     311  */
                                 ;     312 
                                 ;     313 void stepper_init_assertions()
                                 ;     314 {
                                 ;     315 	st_run.magic_end = MAGICNUM;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",315
000000C5 FBE2rrrrrrrr            		MOV.L #__$st_run, R14
000000CB F9E92EEF12              		MOV.W #12EFH, 5CH[R14]
000000D0                         L28:	; entry.split
                                 ;     316 	st_run.magic_start = MAGICNUM;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",316
000000D0 FBE2rrrrrrrr            		MOV.L #__$st_run, R14
000000D6 F8E9EF12                		MOV.W #12EFH, [R14]
000000DA                         L29:	; entry.split1
                                 ;     317 	st_pre.magic_end = MAGICNUM;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",317
000000DA FBE2rrrrrrrr            		MOV.L #_st_pre, R14
000000E0 F9E942EF12              		MOV.W #12EFH, 84H[R14]
000000E5                         L30:	; entry.split2
                                 ;     318 	st_pre.magic_start = MAGICNUM;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",318
000000E5 FBE2rrrrrrrr            		MOV.L #_st_pre, R14
000000EB F8E9EF12                		MOV.W #12EFH, [R14]
000000EF 02                      		RTS
000000F0                         _stepper_test_assertions:
                                 		.STACK	_stepper_test_assertions=8
                                 ;     319 }
                                 ;     320 
                                 ;     321 stat_t stepper_test_assertions()
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",321
000000F0 6040                    		SUB #04H, R0
                                 ;     322 {
                                 ;     323 	if (st_run.magic_end	!= MAGICNUM) return (STAT_STEPPER_ASSERTION_FAILURE);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",323
000000F2 FBE2rrrrrrrr            		MOV.L #__$st_run, R14
000000F8 5DEE2E                  		MOVU.W 5CH[R14], R14
000000FB 760EEF12                		CMP #12EFH, R14
000000FF 10                   S  		BEQ L33
00000100                         L32:	; bb1
00000100 3C025D                  		MOV.B #5DH, 02H[R0]
00000103 2Err                 B  		BRA L40
00000105                         L33:	; bb8
                                 ;     324 	if (st_run.magic_start	!= MAGICNUM) return (STAT_STEPPER_ASSERTION_FAILURE);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",324
00000105 FBE2rrrrrrrr            		MOV.L #__$st_run, R14
0000010B 5CEE                    		MOVU.W [R14], R14
0000010D 760EEF12                		CMP #12EFH, R14
00000111 10                   S  		BEQ L35
00000112                         L34:	; bb9
00000112 3C025D                  		MOV.B #5DH, 02H[R0]
00000115 2Err                 B  		BRA L40
00000117                         L35:	; bb17
                                 ;     325 	if (st_pre.magic_end	!= MAGICNUM) return (STAT_STEPPER_ASSERTION_FAILURE);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",325
00000117 FBE2rrrrrrrr            		MOV.L #_st_pre, R14
0000011D 5DEE42                  		MOVU.W 84H[R14], R14
00000120 760EEF12                		CMP #12EFH, R14
00000124 10                   S  		BEQ L37
00000125                         L36:	; bb18
00000125 3C025D                  		MOV.B #5DH, 02H[R0]
00000128 2Err                 B  		BRA L40
0000012A                         L37:	; bb26
                                 ;     326 	if (st_pre.magic_start	!= MAGICNUM) return (STAT_STEPPER_ASSERTION_FAILURE);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",326
0000012A FBE2rrrrrrrr            		MOV.L #_st_pre, R14
00000130 5CEE                    		MOVU.W [R14], R14
00000132 760EEF12                		CMP #12EFH, R14
00000136 10                   S  		BEQ L39
00000137                         L38:	; bb27
00000137 3C025D                  		MOV.B #5DH, 02H[R0]
0000013A 08                   S  		BRA L40
0000013B                         L39:	; bb34
                                 ;     327 	return (STAT_OK);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",327
0000013B 3C0200                  		MOV.B #00H, 02H[R0]
0000013E                         L40:	; bb36
0000013E C5000203                		MOV.B 02H[R0], 03H[R0]
                                 ;     328 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",328
00000142 B089                    		MOVU.B 03H[R0], R1
00000144 6701                    		RTSD #04H
00000146                         _st_runtime_isbusy:
                                 		.STACK	_st_runtime_isbusy=8
                                 ;     329 
                                 ;     330 /*
                                 ;     331  * st_runtime_isbusy() - return TRUE if runtime is busy:
                                 ;     332  *
                                 ;     333  *	Busy conditions:
                                 ;     334  *	- motors are running
                                 ;     335  *	- dwell is running
                                 ;     336  */
                                 ;     337 
                                 ;     338 uint8_t st_runtime_isbusy()
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",338
00000146 6040                    		SUB #04H, R0
                                 ;     339 {
                                 ;     340 	if (st_run.dda_ticks_downcount == 0) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",340
00000148 FB12rrrrrrrr            		MOV.L #__$st_run, R1
0000014E A819                    		MOV.L 04H[R1], R1
00000150 6101                    		CMP #00H, R1
00000152 18                   S  		BNE L43
00000153                         L42:	; bb1
                                 ;     341 		return (false);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",341
00000153 3C0200                  		MOV.B #00H, 02H[R0]
00000156 08                   S  		BRA L44
00000157                         L43:	; bb6
                                 ;     342 	}
                                 ;     343 	return (true);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",343
00000157 3C0201                  		MOV.B #01H, 02H[R0]
0000015A                         L44:	; bb8
0000015A C5000203                		MOV.B 02H[R0], 03H[R0]
                                 ;     344 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",344
0000015E B089                    		MOVU.B 03H[R0], R1
00000160 6701                    		RTSD #04H
00000162                         _st_reset:
                                 		.STACK	_st_reset=8
                                 ;     345 
                                 ;     346 /*
                                 ;     347  * st_reset() - reset stepper internals
                                 ;     348  */
                                 ;     349 
                                 ;     350 void st_reset()
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",350
00000162 6040                    		SUB #04H, R0
                                 ;     351 {
                                 ;     352 	for (uint8_t motor=0; motor<MOTORS; motor++) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",352
00000164 3C0300                  		MOV.B #00H, 03H[R0]
00000167 2Err                 B  		BRA L49
00000169                         L46:	; bb
                                 ;     353 		st_pre.mot[motor].prev_direction = STEP_INITIAL_DIRECTION;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",353
00000169 B089                    		MOVU.B 03H[R0], R1
0000016B 75111C                  		MUL #1CH, R1
0000016E FB22rrrrrrrr            		MOV.L #_st_pre, R2
00000174 4B12                    		ADD R1, R2
00000176 3CA900                  		MOV.B #00H, 19H[R2]
00000179                         L47:	; bb.split
                                 ;     354 		st_run.mot[motor].substep_accumulator = 0;	// will become max negative during per-motor setup;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",354
00000179 B089                    		MOVU.B 03H[R0], R1
0000017B 751114                  		MUL #14H, R1
0000017E FB22rrrrrrrr            		MOV.L #__$st_run, R2
00000184 4B12                    		ADD R1, R2
00000186 3E2400                  		MOV.L #00000000H, 10H[R2]
00000189                         L48:	; bb.split1
                                 ;     355 		st_pre.mot[motor].corrected_steps = 0;		// diagnostic only - no action effect
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",355
00000189 B089                    		MOVU.B 03H[R0], R1
0000018B 75111C                  		MUL #1CH, R1
0000018E FB22rrrrrrrr            		MOV.L #_st_pre, R2
00000194 4B12                    		ADD R1, R2
00000196 3E2800                  		MOV.L #00000000H, 20H[R2]
00000199 B089                    		MOVU.B 03H[R0], R1
0000019B 6211                    		ADD #01H, R1
0000019D 8089                    		MOV.B R1, 03H[R0]
0000019F                         L49:	; bb15
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",352
0000019F B089                    		MOVU.B 03H[R0], R1
000001A1 6141                    		CMP #04H, R1
000001A3 29rr                    		BLT L46
000001A5                         L50:	; bb20
                                 ;     356 	}
                                 ;     357 	mp_set_steps_to_runtime_position();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",357
000001A5 05rrrrrr             A  		BSR _mp_set_steps_to_runtime_position
000001A9 6701                    		RTSD #04H
000001AB                         _st_clc:
                                 		.STACK	_st_clc=12
                                 ;     358 }
                                 ;     359 
                                 ;     360 /*
                                 ;     361  * st_clc() - clear counters
                                 ;     362  */
                                 ;     363 
                                 ;     364 stat_t st_clc(nvObj_t *nv)	// clear diagnostic counters, reset stepper prep
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",364
000001AB 6080                    		SUB #08H, R0
000001AD A009                    		MOV.L R1, 04H[R0]
                                 ;     365 {
                                 ;     366 	st_reset();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",366
000001AF 39rrrr               W  		BSR _st_reset
000001B2                         L52:	; entry.split
                                 ;     367 	return(STAT_OK);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",367
000001B2 3C0300                  		MOV.B #00H, 03H[R0]
000001B5 B089                    		MOVU.B 03H[R0], R1
000001B7                         L53:	; entry.split1
                                 ;     368 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",368
000001B7 5B11                    		MOVU.B R1, R1
000001B9 6702                    		RTSD #08H
000001BB                         __$_motor_is_enabled:
                                 		.STACK	__$_motor_is_enabled=8
                                 ;     369 
                                 ;     370 /*
                                 ;     371  * Motor power management functions
                                 ;     372  *
                                 ;     373  * _deenergize_motor()		 - remove power from a motor
                                 ;     374  * _energize_motor()		 - apply power to a motor
                                 ;     375  * _set_motor_power_level()	 - set the actual Vref to a specified power level
                                 ;     376  *
                                 ;     377  * st_energize_motors()		 - apply power to all motors
                                 ;     378  * st_deenergize_motors()	 - remove power from all motors
                                 ;     379  * st_motor_power_callback() - callback to manage motor power sequencing
                                 ;     380  */
                                 ;     381 
                                 ;     382 static uint8_t _motor_is_enabled(uint8_t motor)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",382
000001BB 6040                    		SUB #04H, R0
000001BD 8089                    		MOV.B R1, 03H[R0]
                                 ;     383 {
                                 ;     384 //RXMOD	uint8_t port;
                                 ;     385 //	switch(motor) {
                                 ;     386 //		case (MOTOR_1): { port = PORT_MOTOR_1_VPORT.OUT; break; }
                                 ;     387 //		case (MOTOR_2): { port = PORT_MOTOR_2_VPORT.OUT; break; }
                                 ;     388 //		case (MOTOR_3): { port = PORT_MOTOR_3_VPORT.OUT; break; }
                                 ;     389 //		case (MOTOR_4): { port = PORT_MOTOR_4_VPORT.OUT; break; }
                                 ;     390 //		default: port = 0xff;	// defaults to disabled for bad motor input value
                                 ;     391 //	}
                                 ;     392 //	return ((port & MOTOR_ENABLE_BIT_bm) ? 0 : 1);	// returns 1 if motor is enabled (motor is actually active low)
                                 ;     393 	return 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",393
000001BF 3C0200                  		MOV.B #00H, 02H[R0]
000001C2 B081                    		MOVU.B 02H[R0], R1
000001C4                         L55:	; entry.split
                                 ;     394 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",394
000001C4 5B11                    		MOVU.B R1, R1
000001C6 6701                    		RTSD #04H
000001C8                         __$_deenergize_motor:
                                 		.STACK	__$_deenergize_motor=8
                                 ;     395 
                                 ;     396 static void _deenergize_motor(const uint8_t motor)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",396
000001C8 6040                    		SUB #04H, R0
000001CA 8089                    		MOV.B R1, 03H[R0]
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",417
000001CC 6701                    		RTSD #04H
000001CE                         __$_energize_motor:
                                 		.STACK	__$_energize_motor=8
                                 ;     397 {
                                 ;     398 #ifdef __AVR
                                 ;     399 	switch (motor) {
                                 ;     400 		case (MOTOR_1): { PORT_MOTOR_1_VPORT.OUT |= MOTOR_ENABLE_BIT_bm; break; }
                                 ;     401 		case (MOTOR_2): { PORT_MOTOR_2_VPORT.OUT |= MOTOR_ENABLE_BIT_bm; break; }
                                 ;     402 		case (MOTOR_3): { PORT_MOTOR_3_VPORT.OUT |= MOTOR_ENABLE_BIT_bm; break; }
                                 ;     403 		case (MOTOR_4): { PORT_MOTOR_4_VPORT.OUT |= MOTOR_ENABLE_BIT_bm; break; }
                                 ;     404 	}
                                 ;     405 	st_run.mot[motor].power_state = MOTOR_OFF;
                                 ;     406 #endif
                                 ;     407 #ifdef __ARM
                                 ;     408 	// Motors that are not defined are not compiled. Saves some ugly #ifdef code
                                 ;     409 	if (!motor_1.enable.isNull()) if (motor == MOTOR_1) motor_1.enable.set();	// set disables the motor
                                 ;     410 	if (!motor_2.enable.isNull()) if (motor == MOTOR_2) motor_2.enable.set();
                                 ;     411 	if (!motor_3.enable.isNull()) if (motor == MOTOR_3) motor_3.enable.set();
                                 ;     412 	if (!motor_4.enable.isNull()) if (motor == MOTOR_4) motor_4.enable.set();
                                 ;     413 	if (!motor_5.enable.isNull()) if (motor == MOTOR_5) motor_5.enable.set();
                                 ;     414 	if (!motor_6.enable.isNull()) if (motor == MOTOR_6) motor_6.enable.set();
                                 ;     415 	st_run.mot[motor].power_state = MOTOR_OFF;
                                 ;     416 #endif
                                 ;     417 }
                                 ;     418 
                                 ;     419 static void _energize_motor(const uint8_t motor)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",419
000001CE 6040                    		SUB #04H, R0
000001D0 8089                    		MOV.B R1, 03H[R0]
                                 ;     420 {
                                 ;     421 	if (st_cfg.mot[motor].power_mode == MOTOR_DISABLED) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",421
000001D2 B089                    		MOVU.B 03H[R0], R1
000001D4 751124                  		MUL #24H, R1
000001D7 FB22rrrrrrrr            		MOV.L #_st_cfg, R2
000001DD 4B12                    		ADD R1, R2
000001DF B329                    		MOVU.B 0DH[R2], R1
000001E1 6101                    		CMP #00H, R1
000001E3 18                   S  		BNE L60
000001E4                         L58:	; bb2
                                 ;     422 		_deenergize_motor(motor);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",422
000001E4 B089                    		MOVU.B 03H[R0], R1
000001E6 39rrrr               W  		BSR __$_deenergize_motor
000001E9                         L59:	; bb2.split
                                 ;     423 		return;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",423
000001E9 6701                    		RTSD #04H
000001EB                         L60:	; bb12
                                 ;     424 	}
                                 ;     425 #ifdef __AVR
                                 ;     426 	switch(motor) {
                                 ;     427 		case (MOTOR_1): { PORT_MOTOR_1_VPORT.OUT &= ~MOTOR_ENABLE_BIT_bm; break; }
                                 ;     428 		case (MOTOR_2): { PORT_MOTOR_2_VPORT.OUT &= ~MOTOR_ENABLE_BIT_bm; break; }
                                 ;     429 		case (MOTOR_3): { PORT_MOTOR_3_VPORT.OUT &= ~MOTOR_ENABLE_BIT_bm; break; }
                                 ;     430 		case (MOTOR_4): { PORT_MOTOR_4_VPORT.OUT &= ~MOTOR_ENABLE_BIT_bm; break; }
                                 ;     431 	}
                                 ;     432 #endif
                                 ;     433 #ifdef __ARM
                                 ;     434 	// Motors that are not defined are not compiled. Saves some ugly #ifdef code
                                 ;     435 	//	case (MOTOR_1): { motor_1.energize(MOTOR_1); break; }
                                 ;     436 	if (!motor_1.enable.isNull()) if (motor == MOTOR_1) motor_1.energize(MOTOR_1);
                                 ;     437 	if (!motor_2.enable.isNull()) if (motor == MOTOR_2) motor_2.energize(MOTOR_2);
                                 ;     438 	if (!motor_3.enable.isNull()) if (motor == MOTOR_3) motor_3.energize(MOTOR_3);
                                 ;     439 	if (!motor_4.enable.isNull()) if (motor == MOTOR_4) motor_4.energize(MOTOR_4);
                                 ;     440 	if (!motor_5.enable.isNull()) if (motor == MOTOR_5) motor_5.energize(MOTOR_5);
                                 ;     441 	if (!motor_6.enable.isNull()) if (motor == MOTOR_6) motor_6.energize(MOTOR_6);
                                 ;     442 #endif
                                 ;     443 	st_run.mot[motor].power_state = MOTOR_POWER_TIMEOUT_START;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",443
000001EB B089                    		MOVU.B 03H[R0], R1
000001ED 751114                  		MUL #14H, R1
000001F0 FB22rrrrrrrr            		MOV.L #__$st_run, R2
000001F6 4B12                    		ADD R1, R2
000001F8 3CA403                  		MOV.B #03H, 14H[R2]
000001FB 6701                    		RTSD #04H
000001FD                         _st_energize_motors:
                                 		.STACK	_st_energize_motors=8
                                 ;     444 }
                                 ;     445 
                                 ;     446 /*
                                 ;     447  * _set_motor_power_level()	- applies the power level to the requested motor.
                                 ;     448  *
                                 ;     449  *	The power_level must be a compensated PWM value - presumably one of:
                                 ;     450  *		st_cfg.mot[motor].power_level_scaled
                                 ;     451  *		st_run.mot[motor].power_level_dynamic
                                 ;     452  */
                                 ;     453 #ifdef __ARM
                                 ;     454 static void _set_motor_power_level(const uint8_t motor, const float power_level)
                                 ;     455 {
                                 ;     456 	// power_level must be scaled properly for the driver's Vref voltage requirements
                                 ;     457 	if (!motor_1.enable.isNull()) if (motor == MOTOR_1) motor_1.vref = power_level;
                                 ;     458 	if (!motor_2.enable.isNull()) if (motor == MOTOR_2) motor_2.vref = power_level;
                                 ;     459 	if (!motor_3.enable.isNull()) if (motor == MOTOR_3) motor_3.vref = power_level;
                                 ;     460 	if (!motor_4.enable.isNull()) if (motor == MOTOR_4) motor_4.vref = power_level;
                                 ;     461 	if (!motor_5.enable.isNull()) if (motor == MOTOR_5) motor_5.vref = power_level;
                                 ;     462 	if (!motor_6.enable.isNull()) if (motor == MOTOR_6) motor_6.vref = power_level;
                                 ;     463 }
                                 ;     464 #endif
                                 ;     465 
                                 ;     466 void st_energize_motors()
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",466
000001FD 6040                    		SUB #04H, R0
                                 ;     467 {
                                 ;     468 	for (uint8_t motor = MOTOR_1; motor < MOTORS; motor++) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",468
000001FF 3C0300                  		MOV.B #00H, 03H[R0]
00000202 2Err                 B  		BRA L64
00000204                         L62:	; bb
                                 ;     469 		_energize_motor(motor);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",469
00000204 B089                    		MOVU.B 03H[R0], R1
00000206 39rrrr               W  		BSR __$_energize_motor
00000209                         L63:	; bb.split
                                 ;     470 		st_run.mot[motor].power_state = MOTOR_POWER_TIMEOUT_START;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",470
00000209 B089                    		MOVU.B 03H[R0], R1
0000020B 751114                  		MUL #14H, R1
0000020E FB22rrrrrrrr            		MOV.L #__$st_run, R2
00000214 4B12                    		ADD R1, R2
00000216 3CA403                  		MOV.B #03H, 14H[R2]
00000219 B089                    		MOVU.B 03H[R0], R1
0000021B 6211                    		ADD #01H, R1
0000021D 8089                    		MOV.B R1, 03H[R0]
0000021F                         L64:	; bb8
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",468
0000021F B089                    		MOVU.B 03H[R0], R1
00000221 6141                    		CMP #04H, R1
00000223 29rr                    		BLT L62
00000225                         L65:	; return
                                 ;     471 	}
                                 ;     472 #ifdef __ARM
                                 ;     473 	common_enable.clear();			// enable gShield common enable
                                 ;     474 #endif
                                 ;     475 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",475
00000225 6701                    		RTSD #04H
00000227                         _st_deenergize_motors:
                                 		.STACK	_st_deenergize_motors=8
                                 ;     476 
                                 ;     477 void st_deenergize_motors()
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",477
00000227 6040                    		SUB #04H, R0
                                 ;     478 {
                                 ;     479 	for (uint8_t motor = MOTOR_1; motor < MOTORS; motor++) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",479
00000229 3C0300                  		MOV.B #00H, 03H[R0]
0000022C 2Err                 B  		BRA L68
0000022E                         L67:	; bb
                                 ;     480 		_deenergize_motor(motor);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",480
0000022E B089                    		MOVU.B 03H[R0], R1
00000230 39rrrr               W  		BSR __$_deenergize_motor
00000233 B089                    		MOVU.B 03H[R0], R1
00000235 6211                    		ADD #01H, R1
00000237 8089                    		MOV.B R1, 03H[R0]
00000239                         L68:	; bb4
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",479
00000239 B089                    		MOVU.B 03H[R0], R1
0000023B 6141                    		CMP #04H, R1
0000023D 29rr                    		BLT L67
0000023F                         L69:	; return
                                 ;     481 	}
                                 ;     482 #ifdef __ARM
                                 ;     483 	common_enable.set();			// disable gShield common enable
                                 ;     484 #endif
                                 ;     485 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",485
0000023F 6701                    		RTSD #04H
00000241                         _st_motor_power_callback:
                                 		.STACK	_st_motor_power_callback=16
                                 ;     486 
                                 ;     487 /*
                                 ;     488  * st_motor_power_callback() - callback to manage motor power sequencing
                                 ;     489  *
                                 ;     490  *	Handles motor power-down timing, low-power idle, and adaptive motor power
                                 ;     491  */
                                 ;     492 stat_t st_motor_power_callback() 	// called by controller
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",492
00000241 7EA6                    		PUSH.L R6
00000243 6080                    		SUB #08H, R0
                                 ;     493 {
                                 ;     494 	// manage power for each motor individually
                                 ;     495 	for (uint8_t m = MOTOR_1; m < MOTORS; m++) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",495
00000245 3C0600                  		MOV.B #00H, 06H[R0]
00000248 38rrrr               W  		BRA L95
0000024B                         L71:	; bb2
                                 ;     496 
                                 ;     497 		// de-energize motor if it's set to MOTOR_DISABLED
                                 ;     498 		if (st_cfg.mot[m].power_mode == MOTOR_DISABLED) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",498
0000024B B181                    		MOVU.B 06H[R0], R1
0000024D 751124                  		MUL #24H, R1
00000250 FB22rrrrrrrr            		MOV.L #_st_cfg, R2
00000256 4B12                    		ADD R1, R2
00000258 B329                    		MOVU.B 0DH[R2], R1
0000025A 6101                    		CMP #00H, R1
0000025C 18                   S  		BNE L73
0000025D                         L72:	; bb3
                                 ;     499 			_deenergize_motor(m);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",499
0000025D B181                    		MOVU.B 06H[R0], R1
0000025F 39rrrr               W  		BSR __$_deenergize_motor
00000262 38rrrr               W  		BRA L94
00000265                         L73:	; bb15
                                 ;     500 			continue;
                                 ;     501 		}
                                 ;     502 
                                 ;     503 		// energize motor if it's set to MOTOR_ALWAYS_POWERED
                                 ;     504 		if (st_cfg.mot[m].power_mode == MOTOR_ALWAYS_POWERED) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",504
00000265 B181                    		MOVU.B 06H[R0], R1
00000267 751124                  		MUL #24H, R1
0000026A FB22rrrrrrrr            		MOV.L #_st_cfg, R2
00000270 4B12                    		ADD R1, R2
00000272 B329                    		MOVU.B 0DH[R2], R1
00000274 6111                    		CMP #01H, R1
00000276 21rr                    		BNE L79
00000278                         L74:	; bb17
                                 ;     505 			if (! _motor_is_enabled(m)) _energize_motor(m);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",505
00000278 B181                    		MOVU.B 06H[R0], R1
0000027A 39rrrr               W  		BSR __$_motor_is_enabled
0000027D 6101                    		CMP #00H, R1
0000027F 21rr                    		BNE L76
00000281 2Err                 B  		BRA L77
00000283                         L75:	; bb18
00000283 B181                    		MOVU.B 06H[R0], R1
00000285 39rrrr               W  		BSR __$_energize_motor
00000288 38rrrr               W  		BRA L94
0000028B                         L76:	; bb25
0000028B F80600                  		MOV.L #00000000H, [R0]
0000028E 08                   S  		BRA L78
0000028F                         L77:	; bb26
0000028F F80601                  		MOV.L #00000001H, [R0]
00000292                         L78:	; bb27
00000292 EC01                    		MOV.L [R0], R1
00000294 6101                    		CMP #00H, R1
00000296 21rr                    		BNE L75
00000298 38rrrr               W  		BRA L94
0000029B                         L79:	; bb43
                                 ;     506 			continue;
                                 ;     507 		}
                                 ;     508 
                                 ;     509 		// start a countdown if MOTOR_POWERED_IN_CYCLE or MOTOR_POWERED_ONLY_WHEN_MOVING
                                 ;     510 		if (st_run.mot[m].power_state == MOTOR_POWER_TIMEOUT_START) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",510
0000029B B181                    		MOVU.B 06H[R0], R1
0000029D 751114                  		MUL #14H, R1
000002A0 FB22rrrrrrrr            		MOV.L #__$st_run, R2
000002A6 4B12                    		ADD R1, R2
000002A8 B521                    		MOVU.B 14H[R2], R1
000002AA 6131                    		CMP #03H, R1
000002AC 21rr                    		BNE L87
000002AE                         L80:	; bb44
                                 ;     511 			st_run.mot[m].power_state = MOTOR_POWER_TIMEOUT_COUNTDOWN;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",511
000002AE B181                    		MOVU.B 06H[R0], R1
000002B0 751114                  		MUL #14H, R1
000002B3 FB22rrrrrrrr            		MOV.L #__$st_run, R2
000002B9 4B12                    		ADD R1, R2
000002BB 3CA404                  		MOV.B #04H, 14H[R2]
000002BE                         L81:	; bb44.split
                                 ;     512 			st_run.mot[m].power_systick = SysTickTimer_getValue() +
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",512
000002BE B186                    		MOVU.B 06H[R0], R6
000002C0 05rrrrrr             A  		BSR _SysTickTimer_getValue
000002C4 751614                  		MUL #14H, R6
000002C7 FB22rrrrrrrr            		MOV.L #__$st_run, R2
000002CD 4B62                    		ADD R6, R2
000002CF FBE2rrrrrrrr            		MOV.L #_st_cfg, R14
000002D5 ECEE                    		MOV.L [R14], R14
000002D7 FD723E00007A44          		FMUL #447A0000H, R14
000002DE 7DF1                    		BTST #1FH, R1
000002E0 20rr                    		BEQ L83
000002E2                         L82:	; bb44.split
000002E2 FD811F                  		SHLR #01H, R1, R15
000002E5 6411                    		AND #01H, R1
000002E7 57F1                    		OR R15, R1
000002E9 FC471F                  		ITOF R1, R15
000002EC FC8BFF                  		FADD R15, R15
000002EF 08                   S  		BRA L84
000002F0                         L83:	; bb44.split
000002F0 FC471F                  		ITOF R1, R15
000002F3                         L84:	; bb44.split
000002F3 FC8BEF                  		FADD R14, R15
000002F6 FD721F0000004F          		FCMP #4F000000H, R15
000002FD 29rr                    		BLT L86
000002FF                         L85:	; bb44.split
000002FF FD722F000080CF          		FADD #0CF800000H, R15
00000306                         L86:	; bb44.split
00000306 FC97F1                  		FTOI R15, R1
00000309 A1A1                    		MOV.L R1, 18H[R2]
0000030B                         L87:	; bb69
                                 ;     513 											(st_cfg.motor_power_timeout * 1000);
                                 ;     514 		}
                                 ;     515 
                                 ;     516 		// do not process countdown if in a feedhold
                                 ;     517 		if (cm_get_combined_state() == COMBINED_HOLD) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",517
0000030B 05rrrrrr             A  		BSR _cm_get_combined_state
0000030F 6161                    		CMP #06H, R1
00000311 20rr                    		BEQ L94
00000313                         L88:	; bb78
                                 ;     518 			continue;
                                 ;     519 		}
                                 ;     520 
                                 ;     521 		// do not process countdown if in a feedhold
                                 ;     522 		if (cm_get_combined_state() == COMBINED_HOLD) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",522
00000313 05rrrrrr             A  		BSR _cm_get_combined_state
00000317 6161                    		CMP #06H, R1
00000319 20rr                    		BEQ L94
0000031B                         L89:	; bb87
                                 ;     523 			continue;
                                 ;     524 		}
                                 ;     525 
                                 ;     526 		// run the countdown if you are in a countdown
                                 ;     527 		if (st_run.mot[m].power_state == MOTOR_POWER_TIMEOUT_COUNTDOWN) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",527
0000031B B181                    		MOVU.B 06H[R0], R1
0000031D 751114                  		MUL #14H, R1
00000320 FB22rrrrrrrr            		MOV.L #__$st_run, R2
00000326 4B12                    		ADD R1, R2
00000328 B521                    		MOVU.B 14H[R2], R1
0000032A 6141                    		CMP #04H, R1
0000032C 21rr                    		BNE L94
0000032E                         L90:	; bb89
                                 ;     528 			if (SysTickTimer_getValue() > st_run.mot[m].power_systick ) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",528
0000032E 05rrrrrr             A  		BSR _SysTickTimer_getValue
00000332 B182                    		MOVU.B 06H[R0], R2
00000334 751214                  		MUL #14H, R2
00000337 FBE2rrrrrrrr            		MOV.L #__$st_run, R14
0000033D 4B2E                    		ADD R2, R14
0000033F 0685E106                		CMP 18H[R14].L, R1
00000343 25rr                    		BLEU L94
00000345                         L91:	; bb90
                                 ;     529 				st_run.mot[m].power_state = MOTOR_IDLE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",529
00000345 B181                    		MOVU.B 06H[R0], R1
00000347 751114                  		MUL #14H, R1
0000034A FB22rrrrrrrr            		MOV.L #__$st_run, R2
00000350 4B12                    		ADD R1, R2
00000352 3CA401                  		MOV.B #01H, 14H[R2]
00000355                         L92:	; bb90.split
                                 ;     530 				_deenergize_motor(m);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",530
00000355 B181                    		MOVU.B 06H[R0], R1
00000357 39rrrr               W  		BSR __$_deenergize_motor
0000035A                         L93:	; bb90.split1
0000035A 6601                    		MOV.L #00000000H, R1
                                 ;     531                 sr_request_status_report(SR_TIMED_REQUEST);		// request a status report when motors shut down
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",531
0000035C 05rrrrrr             A  		BSR _sr_request_status_report
00000360                         L94:	; bb117
00000360 B181                    		MOVU.B 06H[R0], R1
00000362 6211                    		ADD #01H, R1
00000364 8181                    		MOV.B R1, 06H[R0]
00000366                         L95:	; bb120
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",495
00000366 B181                    		MOVU.B 06H[R0], R1
00000368 6141                    		CMP #04H, R1
0000036A 28rr                  * 		BLT L71
         38rrrr                  
0000036F                         L96:	; bb126
                                 ;     532 			}
                                 ;     533 		}
                                 ;     534 	}
                                 ;     535 	return (STAT_OK);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",535
0000036F 3C0700                  		MOV.B #00H, 07H[R0]
00000372 B189                    		MOVU.B 07H[R0], R1
00000374                         L97:	; bb126.split
                                 ;     536 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",536
00000374 5B11                    		MOVU.B R1, R1
00000376 3F6603                  		RTSD #0CH, R6-R6
00000379                         _timer_dda_callback:
                                 		.STACK	_timer_dda_callback=12
                                 ;     537 
                                 ;     538 
                                 ;     539 /******************************
                                 ;     540  * Interrupt Service Routines *
                                 ;     541  ******************************/
                                 ;     542 
                                 ;     543 /***** Stepper Interrupt Service Routine ************************************************
                                 ;     544  * ISR - DDA timer interrupt routine - service ticks from DDA timer
                                 ;     545  */
                                 ;     546 
                                 ;     547 #ifdef __AVR
                                 ;     548 /*
                                 ;     549  *	Uses direct struct addresses and literal values for hardware devices - it's faster than
                                 ;     550  *	using indexed timer and port accesses. I checked. Even when -0s or -03 is used.
                                 ;     551  */
                                 ;     552 ISR(TIMER_DDA_ISR_vect)
                                 ;     553 {
                                 ;     554 	if ((st_run.mot[MOTOR_1].substep_accumulator += st_run.mot[MOTOR_1].substep_increment) > 0) {
                                 ;     555 		PORT_MOTOR_1_VPORT.OUT |= STEP_BIT_bm;		// turn step bit on
                                 ;     556 		st_run.mot[MOTOR_1].substep_accumulator -= st_run.dda_ticks_X_substeps;
                                 ;     557 		INCREMENT_ENCODER(MOTOR_1);
                                 ;     558 	}
                                 ;     559 	if ((st_run.mot[MOTOR_2].substep_accumulator += st_run.mot[MOTOR_2].substep_increment) > 0) {
                                 ;     560 		PORT_MOTOR_2_VPORT.OUT |= STEP_BIT_bm;
                                 ;     561 		st_run.mot[MOTOR_2].substep_accumulator -= st_run.dda_ticks_X_substeps;
                                 ;     562 		INCREMENT_ENCODER(MOTOR_2);
                                 ;     563 	}
                                 ;     564 	if ((st_run.mot[MOTOR_3].substep_accumulator += st_run.mot[MOTOR_3].substep_increment) > 0) {
                                 ;     565 		PORT_MOTOR_3_VPORT.OUT |= STEP_BIT_bm;
                                 ;     566 		st_run.mot[MOTOR_3].substep_accumulator -= st_run.dda_ticks_X_substeps;
                                 ;     567 		INCREMENT_ENCODER(MOTOR_3);
                                 ;     568 	}
                                 ;     569 	if ((st_run.mot[MOTOR_4].substep_accumulator += st_run.mot[MOTOR_4].substep_increment) > 0) {
                                 ;     570 		PORT_MOTOR_4_VPORT.OUT |= STEP_BIT_bm;
                                 ;     571 		st_run.mot[MOTOR_4].substep_accumulator -= st_run.dda_ticks_X_substeps;
                                 ;     572 		INCREMENT_ENCODER(MOTOR_4);
                                 ;     573 	}
                                 ;     574 
                                 ;     575 	// pulse stretching for using external drivers.- turn step bits off
                                 ;     576 	PORT_MOTOR_1_VPORT.OUT &= ~STEP_BIT_bm;				// ~ 5 uSec pulse width
                                 ;     577 	PORT_MOTOR_2_VPORT.OUT &= ~STEP_BIT_bm;				// ~ 4 uSec
                                 ;     578 	PORT_MOTOR_3_VPORT.OUT &= ~STEP_BIT_bm;				// ~ 3 uSec
                                 ;     579 	PORT_MOTOR_4_VPORT.OUT &= ~STEP_BIT_bm;				// ~ 2 uSec
                                 ;     580 
                                 ;     581 	if (--st_run.dda_ticks_downcount != 0) return;
                                 ;     582 
                                 ;     583 	TIMER_DDA.CTRLA = STEP_TIMER_DISABLE;				// disable DDA timer
                                 ;     584 	_load_move();										// load the next move
                                 ;     585 }
                                 ;     586 #endif // __AVR
                                 ;     587 
                                 ;     588 #ifdef __ARM
                                 ;     589 /*
                                 ;     590  *	This interrupt is really 2 interrupts. It fires on timer overflow and also on match.
                                 ;     591  *	Overflow interrupts are used to set step pins, match interrupts clear step pins.
                                 ;     592  *	This way the duty cycle of the stepper pulse can be controlled by setting the match value.
                                 ;     593  *
                                 ;     594  *	Note that the motor_N.step.isNull() tests are compile-time tests, not run-time tests.
                                 ;     595  *	If motor_N is not defined that if{} clause (i.e. that motor) drops out of the complied code.
                                 ;     596  */
                                 ;     597 namespace Motate {			// Must define timer interrupts inside the Motate namespace
                                 ;     598 MOTATE_TIMER_INTERRUPT(dda_timer_num)
                                 ;     599 {
                                 ;     600 //    dda_debug_pin1 = 1;
                                 ;     601 	uint32_t interrupt_cause = dda_timer.getInterruptCause();	// also clears interrupt condition
                                 ;     602 
                                 ;     603 	if (interrupt_cause == kInterruptOnOverflow) {
                                 ;     604 
                                 ;     605 		if (!motor_1.step.isNull() && (st_run.mot[MOTOR_1].substep_accumulator += st_run.mot[MOTOR_1].substep_increment) > 0) {
                                 ;     606 			motor_1.step.set();		// turn step bit on
                                 ;     607 			st_run.mot[MOTOR_1].substep_accumulator -= st_run.dda_ticks_X_substeps;
                                 ;     608 			INCREMENT_ENCODER(MOTOR_1);
                                 ;     609 		}
                                 ;     610 		if (!motor_2.step.isNull() && (st_run.mot[MOTOR_2].substep_accumulator += st_run.mot[MOTOR_2].substep_increment) > 0) {
                                 ;     611 			motor_2.step.set();
                                 ;     612 			st_run.mot[MOTOR_2].substep_accumulator -= st_run.dda_ticks_X_substeps;
                                 ;     613 			INCREMENT_ENCODER(MOTOR_2);
                                 ;     614 		}
                                 ;     615 		if (!motor_3.step.isNull() && (st_run.mot[MOTOR_3].substep_accumulator += st_run.mot[MOTOR_3].substep_increment) > 0) {
                                 ;     616 			motor_3.step.set();
                                 ;     617 			st_run.mot[MOTOR_3].substep_accumulator -= st_run.dda_ticks_X_substeps;
                                 ;     618 			INCREMENT_ENCODER(MOTOR_3);
                                 ;     619 		}
                                 ;     620 		if (!motor_4.step.isNull() && (st_run.mot[MOTOR_4].substep_accumulator += st_run.mot[MOTOR_4].substep_increment) > 0) {
                                 ;     621 			motor_4.step.set();
                                 ;     622 			st_run.mot[MOTOR_4].substep_accumulator -= st_run.dda_ticks_X_substeps;
                                 ;     623 			INCREMENT_ENCODER(MOTOR_4);
                                 ;     624 		}
                                 ;     625 		if (!motor_5.step.isNull() && (st_run.mot[MOTOR_5].substep_accumulator += st_run.mot[MOTOR_5].substep_increment) > 0) {
                                 ;     626 			motor_5.step.set();
                                 ;     627 			st_run.mot[MOTOR_5].substep_accumulator -= st_run.dda_ticks_X_substeps;
                                 ;     628 			INCREMENT_ENCODER(MOTOR_5);
                                 ;     629 		}
                                 ;     630 		if (!motor_6.step.isNull() && (st_run.mot[MOTOR_6].substep_accumulator += st_run.mot[MOTOR_6].substep_increment) > 0) {
                                 ;     631 			motor_6.step.set();
                                 ;     632 			st_run.mot[MOTOR_6].substep_accumulator -= st_run.dda_ticks_X_substeps;
                                 ;     633 			INCREMENT_ENCODER(MOTOR_6);
                                 ;     634 		}
                                 ;     635 
                                 ;     636 	} else if (interrupt_cause == kInterruptOnMatchA) {
                                 ;     637 //		dda_debug_pin2 = 1;
                                 ;     638 		motor_1.step.clear();							// turn step bits off
                                 ;     639 		motor_2.step.clear();
                                 ;     640 		motor_3.step.clear();
                                 ;     641 		motor_4.step.clear();
                                 ;     642 		motor_5.step.clear();
                                 ;     643 		motor_6.step.clear();
                                 ;     644 
                                 ;     645 		if (--st_run.dda_ticks_downcount != 0) return;
                                 ;     646 
                                 ;     647 		// process end of segment
                                 ;     648 		dda_timer.stop();								// turn it off or it will keep stepping out the last segment
                                 ;     649 		_load_move();									// load the next move at the current interrupt level
                                 ;     650 //		dda_debug_pin2 = 0;
                                 ;     651 	}
                                 ;     652 //    dda_debug_pin1 = 0;
                                 ;     653 } // MOTATE_TIMER_INTERRUPT
                                 ;     654 } // namespace Motate
                                 ;     655 
                                 ;     656 #endif // __ARM
                                 ;     657 
                                 ;     658 #ifdef __RX
                                 ;     659 void timer_dda_callback(void *pdata)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",659
00000379 6080                    		SUB #08H, R0
0000037B A009                    		MOV.L R1, 04H[R0]
                                 ;     660 {
                                 ;     661 	static bool flag_dda = 1;
                                 ;     662 
                                 ;     663 	flag_dda ^= 1;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",663
0000037D FBE2rrrrrrrr            		MOV.L #__$flag_dda$1, R14
00000383 661F                    		MOV.L #00000001H, R15
00000385 FC34EF                  		XOR [R14].UB, R15
00000388 610F                    		CMP #00H, R15
0000038A FCD0E1                  		SCNE.B [R14]
0000038D                         L99:	; entry.split
                                 ;     664 	if (!flag_dda)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",664
0000038D FBE2rrrrrrrr            		MOV.L #__$flag_dda$1, R14
00000393 58EE                    		MOVU.B [R14], R14
00000395 610E                    		CMP #00H, R14
00000397 3Brrrr               W  		BNE L127
0000039A 38rrrr               W  		BRA L128
0000039D                         L100:	; bb8
                                 ;     665 	{
                                 ;     666 		if ((st_run.mot[MOTOR_1].substep_accumulator += st_run.mot[MOTOR_1].substep_increment) > 0) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",666
0000039D FB12rrrrrrrr            		MOV.L #__$st_run, R1
000003A3 A912                    		MOV.L 10H[R1], R2
000003A5 06891203                		ADD 0CH[R1].L, R2
000003A9 A112                    		MOV.L R2, 10H[R1]
000003AB 6102                    		CMP #00H, R2
000003AD 2Brr                    		BLE L108
000003AF                         L101:	; bb10
                                 ;     667 			if(!zinhibitor){
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",667
000003AF FBE2rrrrrrrr            		MOV.L #_zinhibitor, R14
000003B5 58EE                    		MOVU.B [R14], R14
000003B7 610E                    		CMP #00H, R14
000003B9 21rr                    		BNE L103
000003BB 2Err                 B  		BRA L104
000003BD                         L102:	; bb11
000003BD FBEE2EC008              		MOV.L #0008C02EH, R14
                                 ;     668 				MOTOR1_STEP = TRUE;		// turn step bit on
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",668
000003C2 F0EC                    		BCLR #04H, [R14].B
000003C4 2Err                 B  		BRA L106
000003C6                         L103:	; bb19
000003C6 F80600                  		MOV.L #00000000H, [R0]
000003C9 08                   S  		BRA L105
000003CA                         L104:	; bb20
000003CA F80601                  		MOV.L #00000001H, [R0]
000003CD                         L105:	; bb21
000003CD EC01                    		MOV.L [R0], R1
000003CF 6101                    		CMP #00H, R1
000003D1 21rr                    		BNE L102
000003D3                         L106:	; bb24
                                 ;     669 			}
                                 ;     670 			st_run.mot[MOTOR_1].substep_accumulator -= st_run.dda_ticks_X_substeps;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",670
000003D3 FB12rrrrrrrr            		MOV.L #__$st_run, R1
000003D9 A912                    		MOV.L 10H[R1], R2
000003DB 06811202                		SUB 08H[R1].L, R2
000003DF A112                    		MOV.L R2, 10H[R1]
000003E1                         L107:	; bb24.split
                                 ;     671 			INCREMENT_ENCODER(MOTOR_1);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",671
000003E1 FB12rrrrrrrr            		MOV.L #_en, R1
000003E7 989A                    		MOV.W 06H[R1], R2
000003E9 06091204                		ADD 04H[R1].B, R2
000003ED 909A                    		MOV.W R2, 06H[R1]
000003EF                         L108:	; bb42
                                 ;     672 		}
                                 ;     673 		if ((st_run.mot[MOTOR_2].substep_accumulator += st_run.mot[MOTOR_2].substep_increment) > 0) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",673
000003EF FB12rrrrrrrr            		MOV.L #__$st_run, R1
000003F5 AA1A                    		MOV.L 24H[R1], R2
000003F7 06891208                		ADD 20H[R1].L, R2
000003FB A21A                    		MOV.L R2, 24H[R1]
000003FD 6102                    		CMP #00H, R2
000003FF 2Brr                    		BLE L112
00000401                         L109:	; bb43
00000401 FBEE2EC008              		MOV.L #0008C02EH, R14
                                 ;     674 			MOTOR2_STEP = TRUE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",674
00000406 F0EE                    		BCLR #06H, [R14].B
00000408                         L110:	; bb43.split
                                 ;     675 			st_run.mot[MOTOR_2].substep_accumulator -= st_run.dda_ticks_X_substeps;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",675
00000408 FB12rrrrrrrr            		MOV.L #__$st_run, R1
0000040E AA1A                    		MOV.L 24H[R1], R2
00000410 06811202                		SUB 08H[R1].L, R2
00000414 A21A                    		MOV.L R2, 24H[R1]
00000416                         L111:	; bb43.split1
                                 ;     676 			INCREMENT_ENCODER(MOTOR_2);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",676
00000416 FB12rrrrrrrr            		MOV.L #_en, R1
0000041C 999A                    		MOV.W 0EH[R1], R2
0000041E 0609120C                		ADD 0CH[R1].B, R2
00000422 919A                    		MOV.W R2, 0EH[R1]
00000424                         L112:	; bb65
                                 ;     677 		}
                                 ;     678 		if ((st_run.mot[MOTOR_3].substep_accumulator += st_run.mot[MOTOR_3].substep_increment) > 0) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",678
00000424 FB12rrrrrrrr            		MOV.L #__$st_run, R1
0000042A AB92                    		MOV.L 38H[R1], R2
0000042C 0689120D                		ADD 34H[R1].L, R2
00000430 A392                    		MOV.L R2, 38H[R1]
00000432 6102                    		CMP #00H, R2
00000434 2Brr                    		BLE L116
00000436                         L113:	; bb66
00000436 FBEE2AC008              		MOV.L #0008C02AH, R14
                                 ;     679 			MOTOR3_STEP = TRUE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",679
0000043B F0EA                    		BCLR #02H, [R14].B
0000043D                         L114:	; bb66.split
                                 ;     680 			st_run.mot[MOTOR_3].substep_accumulator -= st_run.dda_ticks_X_substeps;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",680
0000043D FB12rrrrrrrr            		MOV.L #__$st_run, R1
00000443 AB92                    		MOV.L 38H[R1], R2
00000445 06811202                		SUB 08H[R1].L, R2
00000449 A392                    		MOV.L R2, 38H[R1]
0000044B                         L115:	; bb66.split2
                                 ;     681 			INCREMENT_ENCODER(MOTOR_3);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",681
0000044B FB12rrrrrrrr            		MOV.L #_en, R1
00000451 9A9A                    		MOV.W 16H[R1], R2
00000453 06091214                		ADD 14H[R1].B, R2
00000457 929A                    		MOV.W R2, 16H[R1]
00000459                         L116:	; bb87
                                 ;     682 		}
                                 ;     683 		if ((st_run.mot[MOTOR_4].substep_accumulator += st_run.mot[MOTOR_4].substep_increment) > 0) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",683
00000459 FB12rrrrrrrr            		MOV.L #__$st_run, R1
0000045F AC9A                    		MOV.L 4CH[R1], R2
00000461 06891212                		ADD 48H[R1].L, R2
00000465 A49A                    		MOV.L R2, 4CH[R1]
00000467 6102                    		CMP #00H, R2
00000469 2Brr                    		BLE L130
0000046B                         L117:	; bb88
0000046B FBEE2AC008              		MOV.L #0008C02AH, R14
                                 ;     684 			MOTOR4_STEP = TRUE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",684
00000470 F0E8                    		BCLR #00H, [R14].B
00000472                         L118:	; bb88.split
                                 ;     685 			st_run.mot[MOTOR_4].substep_accumulator -= st_run.dda_ticks_X_substeps;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",685
00000472 FB12rrrrrrrr            		MOV.L #__$st_run, R1
00000478 AC9A                    		MOV.L 4CH[R1], R2
0000047A 06811202                		SUB 08H[R1].L, R2
0000047E A49A                    		MOV.L R2, 4CH[R1]
00000480                         L119:	; bb88.split3
                                 ;     686 			INCREMENT_ENCODER(MOTOR_4);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",686
00000480 FB12rrrrrrrr            		MOV.L #_en, R1
00000486 9B9A                    		MOV.W 1EH[R1], R2
00000488 0609121C                		ADD 1CH[R1].B, R2
0000048C 939A                    		MOV.W R2, 1EH[R1]
0000048E 6702                    		RTSD #08H
00000490                         L120:	; bb109
00000490 FBEE2EC008              		MOV.L #0008C02EH, R14
                                 ;     687 		}
                                 ;     688 	}
                                 ;     689 	else
                                 ;     690 	{
                                 ;     691 		// pulse stretching for using external drivers.- turn step bits off
                                 ;     692 		MOTOR1_STEP = FALSE;				// ~ 5 uSec pulse width
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",692
00000495 F0E4                    		BSET #04H, [R14].B
00000497                         L121:	; bb109.split
00000497 FBEE2EC008              		MOV.L #0008C02EH, R14
                                 ;     693 		MOTOR2_STEP = FALSE;				// ~ 4 uSec
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",693
0000049C F0E6                    		BSET #06H, [R14].B
0000049E                         L122:	; bb109.split4
0000049E FBEE2AC008              		MOV.L #0008C02AH, R14
                                 ;     694 		MOTOR3_STEP = FALSE;				// ~ 3 uSec
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",694
000004A3 F0E2                    		BSET #02H, [R14].B
000004A5                         L123:	; bb109.split5
000004A5 FBEE2AC008              		MOV.L #0008C02AH, R14
                                 ;     695 		MOTOR4_STEP = FALSE;				// ~ 2 uSec
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",695
000004AA F0E0                    		BSET #00H, [R14].B
000004AC                         L124:	; bb109.split6
                                 ;     696 
                                 ;     697 		if (--st_run.dda_ticks_downcount != 0) return;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",697
000004AC FB12rrrrrrrr            		MOV.L #__$st_run, R1
000004B2 A81A                    		MOV.L 04H[R1], R2
000004B4 6012                    		SUB #01H, R2
000004B6 A01A                    		MOV.L R2, 04H[R1]
000004B8 6102                    		CMP #00H, R2
000004BA 21rr                    		BNE L130
000004BC                         L125:	; bb131
000004BC 6612                    		MOV.L #00000001H, R2
000004BE 6601                    		MOV.L #00000000H, R1
                                 ;     698 
                                 ;     699 		R_TMR_Control(TIMER_DDA, TMR_CLEAR, 0);				// disable DDA timer
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",699
000004C0 EF13                    		MOV.L R1, R3
000004C2 05rrrrrr             A  		BSR _R_TMR_Control
000004C6                         L126:	; bb131.split
                                 ;     700 		_load_move();										// load the next move
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",700
000004C6 39rrrr               W  		BSR __$_load_move
000004C9 6702                    		RTSD #08H
000004CB                         L127:	; bb137
000004CB F80600                  		MOV.L #00000000H, [R0]
000004CE 08                   S  		BRA L129
000004CF                         L128:	; bb138
000004CF F80601                  		MOV.L #00000001H, [R0]
000004D2                         L129:	; bb139
000004D2 EC01                    		MOV.L [R0], R1
000004D4 6101                    		CMP #00H, R1
000004D6 3Brrrr               W  		BNE L100
000004D9 2Err                 B  		BRA L120
000004DB                         L130:	; return
                                 ;     701 	}
                                 ;     702 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",702
000004DB 6702                    		RTSD #08H
000004DD                         _timer_dwell_callback:
                                 		.STACK	_timer_dwell_callback=12
                                 ;     703 
                                 ;     704 #endif // __ARM
                                 ;     705 /***** Dwell Interrupt Service Routine **************************************************
                                 ;     706  * ISR - DDA timer interrupt routine - service ticks from DDA timer
                                 ;     707  */
                                 ;     708 
                                 ;     709 #ifdef __AVR
                                 ;     710 ISR(TIMER_DWELL_ISR_vect) {								// DWELL timer interrupt
                                 ;     711 	if (--st_run.dda_ticks_downcount == 0) {
                                 ;     712 		TIMER_DWELL.CTRLA = STEP_TIMER_DISABLE;			// disable DWELL timer
                                 ;     713 		_load_move();
                                 ;     714 	}
                                 ;     715 }
                                 ;     716 #endif
                                 ;     717 
                                 ;     718 #ifdef __ARM
                                 ;     719 namespace Motate {			// Must define timer interrupts inside the Motate namespace
                                 ;     720 MOTATE_TIMER_INTERRUPT(dwell_timer_num)
                                 ;     721 {
                                 ;     722 	dwell_timer.getInterruptCause(); // read SR to clear interrupt condition
                                 ;     723 	if (--st_run.dda_ticks_downcount == 0) {
                                 ;     724 		dwell_timer.stop();
                                 ;     725 		_load_move();
                                 ;     726 	}
                                 ;     727 }
                                 ;     728 } // namespace Motate
                                 ;     729 #endif
                                 ;     730 
                                 ;     731 #ifdef __RX
                                 ;     732 void timer_dwell_callback(void *pdata)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",732
000004DD 6080                    		SUB #08H, R0
000004DF A009                    		MOV.L R1, 04H[R0]
                                 ;     733 {
                                 ;     734 	static uint32_t refresh = 0;
                                 ;     735 	static float step = 0;
                                 ;     736 	if(zmove<0)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",736
000004E1 FBE2rrrrrrrr            		MOV.L #_zmove, R14
000004E7 ECEE                    		MOV.L [R14], R14
000004E9 FD721E00000000          		FCMP #00000000H, R14
000004F0 26rr                    		BPZ L133
000004F2                         L132:	; bb2
000004F2 FBEE2EC008              		MOV.L #0008C02EH, R14
                                 ;     737 	{
                                 ;     738 		MOTOR1_DIR = MOTOR_FOWARD;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",738
000004F7 F0E5                    		BSET #05H, [R14].B
000004F9 08                   S  		BRA L134
000004FA                         L133:	; bb5
000004FA FBEE2EC008              		MOV.L #0008C02EH, R14
                                 ;     739 	}
                                 ;     740 	else
                                 ;     741 	{
                                 ;     742 		MOTOR1_DIR = MOTOR_REVERSE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",742
000004FF F0ED                    		BCLR #05H, [R14].B
00000501                         L134:	; bb13
                                 ;     743 	}
                                 ;     744 	if(zmove != 0){
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",744
00000501 FBE2rrrrrrrr            		MOV.L #_zmove, R14
00000507 ECEE                    		MOV.L [R14], R14
00000509 FD721E00000000          		FCMP #00000000H, R14
00000510 20rr                    		BEQ L139
00000512                         L135:	; bb14.split
00000512 FBEE2EC008              		MOV.L #0008C02EH, R14
                                 ;     745 		switch (g_maq.model)
                                 ;     746 		{
                                 ;     747 			step += z_step_pulse;
                                 ;     748 		}
                                 ;     749 		MOTOR1_STEP = !MOTOR1_STEP;		// turn step bit on
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",749
00000517 58EE                    		MOVU.B [R14], R14
00000519 684E                    		SHLR #04H, R14
0000051B 7C0E                    		BTST #00H, R14
0000051D 10                   S  		BEQ L137
0000051E                         L136:	; bb27
0000051E F80600                  		MOV.L #00000000H, [R0]
00000521 08                   S  		BRA L138
00000522                         L137:	; bb28
00000522 F80601                  		MOV.L #00000001H, [R0]
00000525                         L138:	; bb29
00000525 FBEE2EC008              		MOV.L #0008C02EH, R14
0000052A 5801                    		MOVU.B [R0], R1
0000052C 754FEF                  		MOV.L #000000EFH, R15
0000052F 50EF                    		AND [R14].UB, R15
00000531 6C41                    		SHLL #04H, R1
00000533 752110                  		AND #10H, R1
00000536 571F                    		OR R1, R15
00000538 C3EF                    		MOV.B R15, [R14]
0000053A                         L139:	; bb42
                                 ;     750 	}
                                 ;     751 
                                 ;     752 	refresh += 1;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",752
0000053A FBE2rrrrrrrr            		MOV.L #__$refresh$2, R14
00000540 ECEF                    		MOV.L [R14], R15
00000542 621F                    		ADD #01H, R15
00000544 E3EF                    		MOV.L R15, [R14]
00000546                         L140:	; bb42.split
                                 ;     753 	if(refresh == 1000){
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",753
00000546 FBE2rrrrrrrr            		MOV.L #__$refresh$2, R14
0000054C ECEE                    		MOV.L [R14], R14
0000054E 760EE803                		CMP #03E8H, R14
00000552 3Brrrr               W  		BNE L157
00000555                         L141:	; bb47
00000555 FBEE2EC008              		MOV.L #0008C02EH, R14
                                 ;     754 		if (MOTOR1_DIR == MOTOR_FOWARD)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",754
0000055A 58EE                    		MOVU.B [R14], R14
0000055C 685E                    		SHLR #05H, R14
0000055E 641E                    		AND #01H, R14
00000560 611E                    		CMP #01H, R14
00000562 FBE2rrrrrrrr            		MOV.L #_mr, R14
00000568 EDEE54                  		MOV.L 0150H[R14], R14
0000056B FBF2rrrrrrrr            		MOV.L #__$step$3, R15
00000571 ECFF                    		MOV.L [R15], R15
00000573 21rr                    		BNE L147
00000575                         L142:	; bb48
                                 ;     755 		{
                                 ;     756 			mr.gm.target[AXIS_Z] -= step;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",756
00000575 FC83FE                  		FSUB R15, R14
00000578 FBF2rrrrrrrr            		MOV.L #_mr, R15
0000057E E7FE54                  		MOV.L R14, 0150H[R15]
00000581                         L143:	; bb48.split
                                 ;     757 			if(configFlags[MODOMAQUINA] == MODO_OXICORTE)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",757
00000581 FBE2rrrrrrrr            		MOV.L #_configFlags, R14
00000587 ECEE                    		MOV.L [R14], R14
00000589 611E                    		CMP #01H, R14
0000058B 3Brrrr               W  		BNE L152
0000058E                         L144:	; bb53
                                 ;     758 			{
                                 ;     759 				/* Atualizando a altura de corte*/
                                 ;     760 				configVarOx[OX_CONFIG_ALTURA_CORTE] -= step;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",760
0000058E FBF2rrrrrrrr            		MOV.L #_configVarOx, R15
00000594 EDFE01                  		MOV.L 04H[R15], R14
00000597 FB52rrrrrrrr            		MOV.L #__$step$3, R5
0000059D FC805E                  		FSUB [R5].L, R14
000005A0 E7FE01                  		MOV.L R14, 04H[R15]
000005A3                         L145:	; bb53.split
                                 ;     761 				configVarOx[OX_CONFIG_ALTURA_PERFURACAO] -= step;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",761
000005A3 FBE2rrrrrrrr            		MOV.L #_configVarOx, R14
000005A9 ECEF                    		MOV.L [R14], R15
000005AB FB52rrrrrrrr            		MOV.L #__$step$3, R5
000005B1 FC805F                  		FSUB [R5].L, R15
000005B4 E3EF                    		MOV.L R15, [R14]
000005B6                         L146:	; bb53.split1
                                 ;     762 				configVarMaq[CFG_MAQUINA_ALT_DESLOCAMENTO] -= step;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",762
000005B6 FBE2rrrrrrrr            		MOV.L #_configVarMaq, R14
000005BC ECEF                    		MOV.L [R14], R15
000005BE FB52rrrrrrrr            		MOV.L #__$step$3, R5
000005C4 FC805F                  		FSUB [R5].L, R15
000005C7 E3EF                    		MOV.L R15, [R14]
000005C9 2Err                 B  		BRA L152
000005CB                         L147:	; bb68
                                 ;     763 			}
                                 ;     764 		}
                                 ;     765 		else
                                 ;     766 		{
                                 ;     767 			mr.gm.target[AXIS_Z] += step;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",767
000005CB FC8BFE                  		FADD R15, R14
000005CE FBF2rrrrrrrr            		MOV.L #_mr, R15
000005D4 E7FE54                  		MOV.L R14, 0150H[R15]
000005D7                         L148:	; bb68.split
                                 ;     768 			if(configFlags[MODOMAQUINA] == MODO_OXICORTE)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",768
000005D7 FBE2rrrrrrrr            		MOV.L #_configFlags, R14
000005DD ECEE                    		MOV.L [R14], R14
000005DF 611E                    		CMP #01H, R14
000005E1 21rr                    		BNE L152
000005E3                         L149:	; bb73
                                 ;     769 			{
                                 ;     770 				/* Atualizando a altura de corte*/
                                 ;     771 				configVarOx[OX_CONFIG_ALTURA_CORTE] += step;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",771
000005E3 FBE2rrrrrrrr            		MOV.L #__$step$3, R14
000005E9 ECE1                    		MOV.L [R14], R1
000005EB FB22rrrrrrrr            		MOV.L #_configVarOx, R2
000005F1 FC892101                		FADD 04H[R2].L, R1
000005F5 A029                    		MOV.L R1, 04H[R2]
000005F7                         L150:	; bb73.split
                                 ;     772 				configVarOx[OX_CONFIG_ALTURA_PERFURACAO] += step;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",772
000005F7 FBE2rrrrrrrr            		MOV.L #_configVarOx, R14
000005FD ECEF                    		MOV.L [R14], R15
000005FF FB52rrrrrrrr            		MOV.L #__$step$3, R5
00000605 FC885F                  		FADD [R5].L, R15
00000608 E3EF                    		MOV.L R15, [R14]
0000060A                         L151:	; bb73.split2
                                 ;     773 				configVarMaq[CFG_MAQUINA_ALT_DESLOCAMENTO] += step;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",773
0000060A FBE2rrrrrrrr            		MOV.L #_configVarMaq, R14
00000610 ECEF                    		MOV.L [R14], R15
00000612 FB52rrrrrrrr            		MOV.L #__$step$3, R5
00000618 FC885F                  		FADD [R5].L, R15
0000061B E3EF                    		MOV.L R15, [R14]
0000061D                         L152:	; bb95
                                 ;     774 			}
                                 ;     775 		}
                                 ;     776 
                                 ;     777 		mp_set_runtime_position(AXIS_Z,mr.gm.target[AXIS_Z]);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",777
0000061D FBE2rrrrrrrr            		MOV.L #_mr, R14
00000623 EDE254                  		MOV.L 0150H[R14], R2
00000626 6621                    		MOV.L #00000002H, R1
00000628 05rrrrrr             A  		BSR _mp_set_runtime_position
0000062C                         L153:	; bb95.split
                                 ;     778 		if(step != 0)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",778
0000062C FBE2rrrrrrrr            		MOV.L #__$step$3, R14
00000632 ECEE                    		MOV.L [R14], R14
00000634 FD721E00000000          		FCMP #00000000H, R14
0000063B 10                   S  		BEQ L155
0000063C                         L154:	; bb98
                                 ;     779 			zmoved = true;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",779
0000063C FBE2rrrrrrrr            		MOV.L #_zmoved, R14
00000642 F8E401                  		MOV.B #01H, [R14]
00000645                         L155:	; bb103
                                 ;     780 		refresh = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",780
00000645 FBE2rrrrrrrr            		MOV.L #__$refresh$2, R14
0000064B F8E600                  		MOV.L #00000000H, [R14]
0000064E                         L156:	; bb103.split
                                 ;     781 		step = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",781
0000064E FBE2rrrrrrrr            		MOV.L #__$step$3, R14
00000654 F8E600                  		MOV.L #00000000H, [R14]
00000657                         L157:	; bb109
                                 ;     782 	}
                                 ;     783 	if (--st_run.dda_ticks_downcount == 0) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",783
00000657 FB12rrrrrrrr            		MOV.L #__$st_run, R1
0000065D A81A                    		MOV.L 04H[R1], R2
0000065F 6012                    		SUB #01H, R2
00000661 A01A                    		MOV.L R2, 04H[R1]
00000663 6102                    		CMP #00H, R2
00000665 21rr                    		BNE L167
00000667                         L158:	; bb110
                                 ;     784 		isDwell = false;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",784
00000667 FBE2rrrrrrrr            		MOV.L #_isDwell, R14
0000066D F8E400                  		MOV.B #00H, [R14]
00000670                         L159:	; bb110.split
                                 ;     785 		refresh = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",785
00000670 FBE2rrrrrrrr            		MOV.L #__$refresh$2, R14
00000676 F8E600                  		MOV.L #00000000H, [R14]
00000679                         L160:	; bb110.split3
                                 ;     786 
                                 ;     787 		step = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",787
00000679 FBE2rrrrrrrr            		MOV.L #__$step$3, R14
0000067F F8E600                  		MOV.L #00000000H, [R14]
00000682                         L161:	; bb110.split4
                                 ;     788 		if (st_pre.mot[MOTOR_1].direction == DIRECTION_CW)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",788
00000682 FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000688 8E11                    		MOV.B 18H[R1], R1
0000068A 6101                    		CMP #00H, R1
0000068C 18                   S  		BNE L163
0000068D                         L162:	; bb112
0000068D FBEE2EC008              		MOV.L #0008C02EH, R14
                                 ;     789 			MOTOR1_DIR = MOTOR_REVERSE; else
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",789
00000692 F0ED                    		BCLR #05H, [R14].B
00000694 08                   S  		BRA L164
00000695                         L163:	; bb116
00000695 FBEE2EC008              		MOV.L #0008C02EH, R14
                                 ;     790 		MOTOR1_DIR = MOTOR_FOWARD;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",790
0000069A F0E5                    		BSET #05H, [R14].B
0000069C                         L164:	; bb125
                                 ;     791 		//TIMER_DWELL.CTRLA = STEP_TIMER_DISABLE;			// disable DWELL timer
                                 ;     792 		R_CMT_Control(timerDwell,CMT_RX_CMD_PAUSE,0);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",792
0000069C FBE2rrrrrrrr            		MOV.L #_timerDwell, R14
000006A2 ECE1                    		MOV.L [R14], R1
000006A4 6603                    		MOV.L #00000000H, R3
000006A6 6612                    		MOV.L #00000001H, R2
000006A8 05rrrrrr             A  		BSR _R_CMT_Control
000006AC                         L165:	; bb125.split
000006AC 6611                    		MOV.L #00000001H, R1
                                 ;     793 		delay_thcStartStop(true);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",793
000006AE 05rrrrrr             A  		BSR _delay_thcStartStop
000006B2                         L166:	; bb125.split5
                                 ;     794 		_load_move();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",794
000006B2 39rrrr               W  		BSR __$_load_move
000006B5 6702                    		RTSD #08H
000006B7                         L167:	; return
                                 ;     795 	}
                                 ;     796 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",796
000006B7 6702                    		RTSD #08H
000006B9                         _st_request_exec_move:
                                 		.STACK	_st_request_exec_move=4
                                 ;     797 #endif
                                 ;     798 
                                 ;     799 /****************************************************************************************
                                 ;     800  * Exec sequencing code		- computes and prepares next load segment
                                 ;     801  * st_request_exec_move()	- SW interrupt to request to execute a move
                                 ;     802  * exec_timer interrupt		- interrupt handler for calling exec function
                                 ;     803  */
                                 ;     804 
                                 ;     805 #ifdef __AVR
                                 ;     806 void st_request_exec_move()
                                 ;     807 {
                                 ;     808 	if (st_pre.buffer_state == PREP_BUFFER_OWNED_BY_EXEC) {// bother interrupting
                                 ;     809 		TIMER_EXEC.PER = EXEC_TIMER_PERIOD;
                                 ;     810 		TIMER_EXEC.CTRLA = EXEC_TIMER_ENABLE;				// trigger a LO interrupt
                                 ;     811 	}
                                 ;     812 }
                                 ;     813 
                                 ;     814 ISR(TIMER_EXEC_ISR_vect) {								// exec move SW interrupt
                                 ;     815 	TIMER_EXEC.CTRLA = EXEC_TIMER_DISABLE;				// disable SW interrupt timer
                                 ;     816 
                                 ;     817 	// exec_move
                                 ;     818 	if (st_pre.buffer_state == PREP_BUFFER_OWNED_BY_EXEC) {
                                 ;     819 		if (mp_exec_move() != STAT_NOOP) {
                                 ;     820 			st_pre.buffer_state = PREP_BUFFER_OWNED_BY_LOADER; // flip it back
                                 ;     821 			_request_load_move();
                                 ;     822 		}
                                 ;     823 	}
                                 ;     824 }
                                 ;     825 #endif // __AVR
                                 ;     826 
                                 ;     827 #ifdef __ARM
                                 ;     828 void st_request_exec_move()
                                 ;     829 {
                                 ;     830 	if (st_pre.buffer_state == PREP_BUFFER_OWNED_BY_EXEC) {// bother interrupting
                                 ;     831 		exec_timer.setInterruptPending();
                                 ;     832 	}
                                 ;     833 }
                                 ;     834 
                                 ;     835 namespace Motate {	// Define timer inside Motate namespace
                                 ;     836 	MOTATE_TIMER_INTERRUPT(exec_timer_num)				// exec move SW interrupt
                                 ;     837 	{
                                 ;     838 		exec_timer.getInterruptCause();					// clears the interrupt condition
                                 ;     839 		if (st_pre.buffer_state == PREP_BUFFER_OWNED_BY_EXEC) {
                                 ;     840 			if (mp_exec_move() != STAT_NOOP) {
                                 ;     841 				st_pre.buffer_state = PREP_BUFFER_OWNED_BY_LOADER; // flip it back
                                 ;     842 				_request_load_move();
                                 ;     843 			}
                                 ;     844 		}
                                 ;     845 	}
                                 ;     846 } // namespace Motate
                                 ;     847 
                                 ;     848 #endif // __ARM
                                 ;     849 
                                 ;     850 #ifdef __RX
                                 ;     851 void st_request_exec_move()
                                 ;     852 {
                                 ;     853 	if (st_pre.buffer_state == PREP_BUFFER_OWNED_BY_EXEC) {// bother interrupting
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",853
000006B9 FB12rrrrrrrr            		MOV.L #_st_pre, R1
000006BF B091                    		MOVU.B 02H[R1], R1
000006C1 6111                    		CMP #01H, R1
000006C3 21rr                    		BNE L170
000006C5                         L169:	; bb1
000006C5 6602                    		MOV.L #00000000H, R2
000006C7 6621                    		MOV.L #00000002H, R1
                                 ;     854 		R_TMR_Control(TIMER_EXEC, TMR_START, 0); // trigger a LO interrupt
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",854
000006C9 EF23                    		MOV.L R2, R3
000006CB 05rrrrrr             A  		BSR _R_TMR_Control
000006CF 02                      		RTS
000006D0                         L170:	; return
                                 ;     855 	}
                                 ;     856 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",856
000006D0 02                      		RTS
000006D1                         _exec_timer_num:
                                 		.STACK	_exec_timer_num=8
                                 ;     857 
                                 ;     858 void exec_timer_num(void *pdata)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",858
000006D1 6040                    		SUB #04H, R0
000006D3 E301                    		MOV.L R1, [R0]
                                 ;     859 {
                                 ;     860 	// exec_move
                                 ;     861 	if (st_pre.buffer_state == PREP_BUFFER_OWNED_BY_EXEC) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",861
000006D5 FB12rrrrrrrr            		MOV.L #_st_pre, R1
000006DB B091                    		MOVU.B 02H[R1], R1
000006DD 6111                    		CMP #01H, R1
000006DF 21rr                    		BNE L175
000006E1                         L172:	; bb3
                                 ;     862 		if (mp_exec_move() != STAT_NOOP) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",862
000006E1 05rrrrrr             A  		BSR _mp_exec_move
000006E5 6131                    		CMP #03H, R1
000006E7 20rr                    		BEQ L175
000006E9                         L173:	; bb4
                                 ;     863 			st_pre.buffer_state = PREP_BUFFER_OWNED_BY_LOADER; // flip it back
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",863
000006E9 FB12rrrrrrrr            		MOV.L #_st_pre, R1
000006EF 3C1200                  		MOV.B #00H, 02H[R1]
000006F2                         L174:	; bb4.split
                                 ;     864 			_request_load_move();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",864
000006F2 39rrrr               W  		BSR __$_request_load_move
000006F5 6701                    		RTSD #04H
000006F7                         L175:	; return
                                 ;     865 		}
                                 ;     866 	}
                                 ;     867 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",867
000006F7 6701                    		RTSD #04H
000006F9                         __$_request_load_move:
                                 		.STACK	__$_request_load_move=4
                                 ;     868 #endif
                                 ;     869 
                                 ;     870 /****************************************************************************************
                                 ;     871  * Loader sequencing code
                                 ;     872  * st_request_load_move() - fires a software interrupt (timer) to request to load a move
                                 ;     873  * load_move interrupt	  - interrupt handler for running the loader
                                 ;     874  *
                                 ;     875  *	_load_move() can only be called be called from an ISR at the same or higher level as
                                 ;     876  *	the DDA or dwell ISR. A software interrupt has been provided to allow a non-ISR to
                                 ;     877  *	request a load (see st_request_load_move())
                                 ;     878  */
                                 ;     879 
                                 ;     880 #ifdef __AVR
                                 ;     881 static void _request_load_move()
                                 ;     882 {
                                 ;     883 	if (st_runtime_isbusy()) {
                                 ;     884 		return;													// don't request a load if the runtime i
                                 ;     885 	}
                                 ;     886 	if (st_pre.buffer_state == PREP_BUFFER_OWNED_BY_LOADER) {	// bother interrupting
                                 ;     887 		TIMER_LOAD.PER = LOAD_TIMER_PERIOD;
                                 ;     888 		TIMER_LOAD.CTRLA = LOAD_TIMER_ENABLE;					// trigger a HI interrupt
                                 ;     889 	}
                                 ;     890 }
                                 ;     891 
                                 ;     892 ISR(TIMER_LOAD_ISR_vect) {										// load steppers SW interrupt
                                 ;     893 	TIMER_LOAD.CTRLA = LOAD_TIMER_DISABLE;						// disable SW interrupt timer
                                 ;     894 	_load_move();
                                 ;     895 }
                                 ;     896 #endif // __AVR
                                 ;     897 
                                 ;     898 #ifdef __ARM
                                 ;     899 static void _request_load_move()
                                 ;     900 {
                                 ;     901 	if (st_runtime_isbusy()) {
                                 ;     902 		return;													// don't request a load if the runtime i
                                 ;     903 	}
                                 ;     904 	if (st_pre.buffer_state == PREP_BUFFER_OWNED_BY_LOADER) {	// bother interrupting
                                 ;     905 		load_timer.setInterruptPending();
                                 ;     906 	}
                                 ;     907 }
                                 ;     908 
                                 ;     909 namespace Motate {	// Define timer inside Motate namespace
                                 ;     910 	MOTATE_TIMER_INTERRUPT(load_timer_num)						// load steppers SW interrupt
                                 ;     911 	{
                                 ;     912 		load_timer.getInterruptCause();							// read SR to clear interrupt condition
                                 ;     913 		_load_move();
                                 ;     914 	}
                                 ;     915 } // namespace Motate
                                 ;     916 #endif // __ARM
                                 ;     917 
                                 ;     918 #ifdef __RX
                                 ;     919 static void _request_load_move()
                                 ;     920 {
                                 ;     921 	if (st_runtime_isbusy()) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",921
000006F9 39rrrr               W  		BSR _st_runtime_isbusy
000006FC 6101                    		CMP #00H, R1
000006FE 21rr                    		BNE L179
00000700                         L177:	; bb7
                                 ;     922 		return;													// don't request a load if the runtime i
                                 ;     923 	}
                                 ;     924 	if (st_pre.buffer_state == PREP_BUFFER_OWNED_BY_LOADER) {	// bother interrupting
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",924
00000700 FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000706 B091                    		MOVU.B 02H[R1], R1
00000708 6101                    		CMP #00H, R1
0000070A 21rr                    		BNE L179
0000070C                         L178:	; bb8
0000070C 6602                    		MOV.L #00000000H, R2
0000070E 6611                    		MOV.L #00000001H, R1
                                 ;     925 		R_TMR_Control(TIMER_LOAD, TMR_START, 0);					// trigger a HI interrupt
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",925
00000710 EF23                    		MOV.L R2, R3
00000712 05rrrrrr             A  		BSR _R_TMR_Control
00000716 02                      		RTS
00000717                         L179:	; return
                                 ;     926 	}
                                 ;     927 
                                 ;     928 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",928
00000717 02                      		RTS
00000718                         _load_timer_num:
                                 		.STACK	_load_timer_num=8
                                 ;     929 
                                 ;     930 void load_timer_num(void *pdata)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",930
00000718 6040                    		SUB #04H, R0
0000071A E301                    		MOV.L R1, [R0]
                                 ;     931 {								// load timer interrupt
                                 ;     932 	_load_move();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",932
0000071C 39rrrr               W  		BSR __$_load_move
0000071F 6701                    		RTSD #04H
00000721                         __$_load_move:
                                 		.STACK	__$_load_move=8
                                 ;     933 }
                                 ;     934 #endif
                                 ;     935 
                                 ;     936 /****************************************************************************************
                                 ;     937  * _load_move() - Dequeue move and load into stepper struct
                                 ;     938  *
                                 ;     939  *	This routine can only be called be called from an ISR at the same or
                                 ;     940  *	higher level as the DDA or dwell ISR. A software interrupt has been
                                 ;     941  *	provided to allow a non-ISR to request a load (see st_request_load_move())
                                 ;     942  *
                                 ;     943  *	In aline() code:
                                 ;     944  *	 - All axes must set steps and compensate for out-of-range pulse phasing.
                                 ;     945  *	 - If axis has 0 steps the direction setting can be omitted
                                 ;     946  *	 - If axis has 0 steps the motor must not be enabled to support power mode = 1
                                 ;     947  */
                                 ;     948 /****** WARNING - THIS CODE IS SPECIFIC TO AVR. SEE G2 FOR ARM CODE ******/
                                 ;     949 
                                 ;     950 static void _load_move()
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",950
00000721 6040                    		SUB #04H, R0
                                 ;     951 {
                                 ;     952 	// Be aware that dda_ticks_downcount must equal zero for the loader to run.
                                 ;     953 	// So the initial load must also have this set to zero as part of initialization
                                 ;     954 	if (st_runtime_isbusy()) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",954
00000723 39rrrr               W  		BSR _st_runtime_isbusy
00000726 6101                    		CMP #00H, R1
00000728 3Brrrr               W  		BNE L267
0000072B                         L182:	; bb8
                                 ;     955 		return;													// exit if the runtime is busy
                                 ;     956 	}
                                 ;     957 	if (st_pre.buffer_state != PREP_BUFFER_OWNED_BY_LOADER) {	// if there are no moves to load...
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",957
0000072B FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000731 B091                    		MOVU.B 02H[R1], R1
00000733 6101                    		CMP #00H, R1
00000735 20rr                    		BEQ L186
00000737                         L183:	; bb9
                                 ;     958 		for (uint8_t motor = MOTOR_1; motor < MOTORS; motor++) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",958
00000737 3C0300                  		MOV.B #00H, 03H[R0]
0000073A 2Err                 B  		BRA L185
0000073C                         L184:	; bb10
                                 ;     959 			st_run.mot[motor].power_state = MOTOR_POWER_TIMEOUT_START;	// ...start motor power timeouts
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",959
0000073C B089                    		MOVU.B 03H[R0], R1
0000073E 751114                  		MUL #14H, R1
00000741 FB22rrrrrrrr            		MOV.L #__$st_run, R2
00000747 4B12                    		ADD R1, R2
00000749 3CA403                  		MOV.B #03H, 14H[R2]
0000074C B089                    		MOVU.B 03H[R0], R1
0000074E 6211                    		ADD #01H, R1
00000750 8089                    		MOV.B R1, 03H[R0]
00000752                         L185:	; bb17
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",958
00000752 B089                    		MOVU.B 03H[R0], R1
00000754 6141                    		CMP #04H, R1
00000756 29rr                    		BLT L184
00000758 38rrrr               W  		BRA L267
0000075B                         L186:	; bb31
                                 ;     960 		}
                                 ;     961 		return;
                                 ;     962 	}
                                 ;     963 	// handle aline loads first (most common case)
                                 ;     964 	if (st_pre.move_type == MOVE_TYPE_ALINE) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",964
0000075B FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000761 B211                    		MOVU.B 08H[R1], R1
00000763 6111                    		CMP #01H, R1
00000765 3Brrrr               W  		BNE L258
00000768                         L187:	; bb32
                                 ;     965 
                                 ;     966 		//**** setup the new segment ****
                                 ;     967 
                                 ;     968 		st_run.dda_ticks_downcount = st_pre.dda_ticks;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",968
00000768 FBE2rrrrrrrr            		MOV.L #__$st_run, R14
0000076E FBF2rrrrrrrr            		MOV.L #_st_pre, R15
00000774 E5FE0301                		MOV.L 0CH[R15], 04H[R14]
00000778                         L188:	; bb32.split
                                 ;     969 		st_run.dda_ticks_X_substeps = st_pre.dda_ticks_X_substeps;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",969
00000778 FBE2rrrrrrrr            		MOV.L #__$st_run, R14
0000077E FBF2rrrrrrrr            		MOV.L #_st_pre, R15
00000784 E5FE0402                		MOV.L 10H[R15], 08H[R14]
00000788                         L189:	; bb32.split1
                                 ;     970 
                                 ;     971 		//**** MOTOR_1 LOAD ****
                                 ;     972 
                                 ;     973 		// These sections are somewhat optimized for execution speed. The whole load operation
                                 ;     974 		// is supposed to take < 10 uSec (Xmega). Be careful if you mess with this.
                                 ;     975 
                                 ;     976 		// the following if() statement sets the runtime substep increment value or zeroes it
                                 ;     977 		if ((st_run.mot[MOTOR_1].substep_increment = st_pre.mot[MOTOR_1].substep_increment) != 0) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",977
00000788 FB12rrrrrrrr            		MOV.L #_st_pre, R1
0000078E A919                    		MOV.L 14H[R1], R1
00000790 FB22rrrrrrrr            		MOV.L #__$st_run, R2
00000796 A0A9                    		MOV.L R1, 0CH[R2]
00000798 6101                    		CMP #00H, R1
0000079A 3Arrrr               W  		BEQ L202
0000079D                         L190:	; bb37
                                 ;     978 
                                 ;     979 			// NB: If motor has 0 steps the following is all skipped. This ensures that state comparisons
                                 ;     980 			//	   always operate on the last segment actually run by this motor, regardless of how many
                                 ;     981 			//	   segments it may have been inactive in between.
                                 ;     982 
                                 ;     983 			// Apply accumulator correction if the time base has changed since previous segment
                                 ;     984 			if (st_pre.mot[MOTOR_1].accumulator_correction_flag == true) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",984
0000079D FBE2rrrrrrrr            		MOV.L #_st_pre, R14
000007A3 59EE2C                  		MOVU.B 2CH[R14], R14
000007A6 611E                    		CMP #01H, R14
000007A8 21rr                    		BNE L193
000007AA                         L191:	; bb38
                                 ;     985 				st_pre.mot[MOTOR_1].accumulator_correction_flag = false;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",985
000007AA FBE2rrrrrrrr            		MOV.L #_st_pre, R14
000007B0 F9E42C00                		MOV.B #00H, 2CH[R14]
000007B4                         L192:	; bb38.split
                                 ;     986 				st_run.mot[MOTOR_1].substep_accumulator *= st_pre.mot[MOTOR_1].accumulator_correction;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",986
000007B4 FB12rrrrrrrr            		MOV.L #__$st_run, R1
000007BA 06A1111E04              		ITOF 10H[R1].L, R14
000007BF FBF2rrrrrrrr            		MOV.L #_st_pre, R15
000007C5 FC8DFE0A                		FMUL 28H[R15].L, R14
000007C9 FC97E2                  		FTOI R14, R2
000007CC A112                    		MOV.L R2, 10H[R1]
000007CE                         L193:	; bb50
                                 ;     987 			}
                                 ;     988 
                                 ;     989 			// Detect direction change and if so:
                                 ;     990 			//	- Set the direction bit in hardware.
                                 ;     991 			//	- Compensate for direction change by flipping substep accumulator value about its midpoint.
                                 ;     992 
                                 ;     993 			if (st_pre.mot[MOTOR_1].direction != st_pre.mot[MOTOR_1].prev_direction) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",993
000007CE FB12rrrrrrrr            		MOV.L #_st_pre, R1
000007D4 8E12                    		MOV.B 18H[R1], R2
000007D6 451219                  		CMP 19H[R1].UB, R2
000007D9 20rr                    		BEQ L199
000007DB                         L194:	; bb51
                                 ;     994 				st_pre.mot[MOTOR_1].prev_direction = st_pre.mot[MOTOR_1].direction;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",994
000007DB FBE2rrrrrrrr            		MOV.L #_st_pre, R14
000007E1 C5EE1819                		MOV.B 18H[R14], 19H[R14]
000007E5                         L195:	; bb51.split
                                 ;     995 				st_run.mot[MOTOR_1].substep_accumulator = -(st_run.dda_ticks_X_substeps + st_run.mot[MOTOR_1].substep_accumulator);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",995
000007E5 FB12rrrrrrrr            		MOV.L #__$st_run, R1
000007EB A892                    		MOV.L 08H[R1], R2
000007ED 06891204                		ADD 10H[R1].L, R2
000007F1 7E12                    		NEG R2
000007F3 A112                    		MOV.L R2, 10H[R1]
000007F5                         L196:	; bb51.split2
                                 ;     996 				if (st_pre.mot[MOTOR_1].direction == DIRECTION_CW)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",996
000007F5 FB12rrrrrrrr            		MOV.L #_st_pre, R1
000007FB 8E11                    		MOV.B 18H[R1], R1
000007FD 6101                    		CMP #00H, R1
000007FF 18                   S  		BNE L198
00000800                         L197:	; bb58
00000800 FBEE2EC008              		MOV.L #0008C02EH, R14
                                 ;     997 					MOTOR1_DIR = MOTOR_REVERSE; else
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",997
00000805 F0ED                    		BCLR #05H, [R14].B
00000807 08                   S  		BRA L199
00000808                         L198:	; bb62
00000808 FBEE2EC008              		MOV.L #0008C02EH, R14
                                 ;     998 				MOTOR1_DIR = MOTOR_FOWARD;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",998
0000080D F0E5                    		BSET #05H, [R14].B
0000080F                         L199:	; bb79
                                 ;     999 //RXMOD				PORT_MOTOR_1_VPORT.OUT &= ~DIRECTION_BIT_bm; else
                                 ;    1000 //				PORT_MOTOR_1_VPORT.OUT |= DIRECTION_BIT_bm;
                                 ;    1001 			}
                                 ;    1002 			SET_ENCODER_STEP_SIGN(MOTOR_1, st_pre.mot[MOTOR_1].step_sign);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1002
0000080F FBE2rrrrrrrr            		MOV.L #_en, R14
00000815 FBF2rrrrrrrr            		MOV.L #_st_pre, R15
0000081B C5FE1A04                		MOV.B 1AH[R15], 04H[R14]
0000081F                         L200:	; bb79.split
                                 ;    1003 
                                 ;    1004 			// Enable the stepper and start motor power management
                                 ;    1005 			if (st_cfg.mot[MOTOR_1].power_mode != MOTOR_DISABLED) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1005
0000081F FB12rrrrrrrr            		MOV.L #_st_cfg, R1
00000825 B319                    		MOVU.B 0DH[R1], R1
00000827 6101                    		CMP #00H, R1
00000829 20rr                    		BEQ L204
0000082B                         L201:	; bb82
                                 ;    1006 //RXMOD					PORT_MOTOR_1_VPORT.OUT &= ~MOTOR_ENABLE_BIT_bm;             // energize motor
                                 ;    1007 				st_run.mot[MOTOR_1].power_state = MOTOR_POWER_TIMEOUT_START;// set power management state
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1007
0000082B FB12rrrrrrrr            		MOV.L #__$st_run, R1
00000831 3C9403                  		MOV.B #03H, 14H[R1]
00000834 2Err                 B  		BRA L204
00000836                         L202:	; bb90
                                 ;    1008 			}
                                 ;    1009 
                                 ;    1010 		} else {  // Motor has 0 steps; might need to energize motor for power mode processing
                                 ;    1011 			if (st_cfg.mot[MOTOR_1].power_mode == MOTOR_POWERED_IN_CYCLE) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1011
00000836 FB12rrrrrrrr            		MOV.L #_st_cfg, R1
0000083C B319                    		MOVU.B 0DH[R1], R1
0000083E 6121                    		CMP #02H, R1
00000840 18                   S  		BNE L204
00000841                         L203:	; bb91
                                 ;    1012 ////RXMOD					PORT_MOTOR_1_VPORT.OUT &= ~MOTOR_ENABLE_BIT_bm;             // energize motor
                                 ;    1013 				st_run.mot[MOTOR_1].power_state = MOTOR_POWER_TIMEOUT_START;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1013
00000841 FB12rrrrrrrr            		MOV.L #__$st_run, R1
00000847 3C9403                  		MOV.B #03H, 14H[R1]
0000084A                         L204:	; bb103
                                 ;    1014 			}
                                 ;    1015 		}
                                 ;    1016 		// accumulate counted steps to the step position and zero out counted steps for the segment currently being loaded
                                 ;    1017 		ACCUMULATE_ENCODER(MOTOR_1);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1017
0000084A FB12rrrrrrrr            		MOV.L #_en, R1
00000850 A892                    		MOV.L 08H[R1], R2
00000852 06491203                		ADD 06H[R1].W, R2
00000856 A092                    		MOV.L R2, 08H[R1]
00000858                         L205:	; bb103.split
00000858 FB12rrrrrrrr            		MOV.L #_en, R1
0000085E 3D1300                  		MOV.W #0000H, 06H[R1]
00000861                         L206:	; bb103.split3
                                 ;    1018 
                                 ;    1019 #if (MOTORS >= 2)	//**** MOTOR_2 LOAD ****
                                 ;    1020 		if ((st_run.mot[MOTOR_2].substep_increment = st_pre.mot[MOTOR_2].substep_increment) != 0) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1020
00000861 FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000867 AB11                    		MOV.L 30H[R1], R1
00000869 FB22rrrrrrrr            		MOV.L #__$st_run, R2
0000086F A221                    		MOV.L R1, 20H[R2]
00000871 6101                    		CMP #00H, R1
00000873 3Arrrr               W  		BEQ L219
00000876                         L207:	; bb110
                                 ;    1021 			if (st_pre.mot[MOTOR_2].accumulator_correction_flag == true) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1021
00000876 FBE2rrrrrrrr            		MOV.L #_st_pre, R14
0000087C 59EE48                  		MOVU.B 48H[R14], R14
0000087F 611E                    		CMP #01H, R14
00000881 21rr                    		BNE L210
00000883                         L208:	; bb111
                                 ;    1022 				st_pre.mot[MOTOR_2].accumulator_correction_flag = false;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1022
00000883 FBE2rrrrrrrr            		MOV.L #_st_pre, R14
00000889 F9E44800                		MOV.B #00H, 48H[R14]
0000088D                         L209:	; bb111.split
                                 ;    1023 				st_run.mot[MOTOR_2].substep_accumulator *= st_pre.mot[MOTOR_2].accumulator_correction;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1023
0000088D FB12rrrrrrrr            		MOV.L #__$st_run, R1
00000893 06A1111E09              		ITOF 24H[R1].L, R14
00000898 FBF2rrrrrrrr            		MOV.L #_st_pre, R15
0000089E FC8DFE11                		FMUL 44H[R15].L, R14
000008A2 FC97E2                  		FTOI R14, R2
000008A5 A21A                    		MOV.L R2, 24H[R1]
000008A7                         L210:	; bb123
                                 ;    1024 			}
                                 ;    1025 			if (st_pre.mot[MOTOR_2].direction != st_pre.mot[MOTOR_2].prev_direction) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1025
000008A7 FBE2rrrrrrrr            		MOV.L #_st_pre, R14
000008AD CDEF34                  		MOV.B 34H[R14], R15
000008B0 45EF35                  		CMP 35H[R14].UB, R15
000008B3 20rr                    		BEQ L216
000008B5                         L211:	; bb124
                                 ;    1026 				st_pre.mot[MOTOR_2].prev_direction = st_pre.mot[MOTOR_2].direction;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1026
000008B5 FBE2rrrrrrrr            		MOV.L #_st_pre, R14
000008BB C5EE3435                		MOV.B 34H[R14], 35H[R14]
000008BF                         L212:	; bb124.split
                                 ;    1027 				st_run.mot[MOTOR_2].substep_accumulator = -(st_run.dda_ticks_X_substeps + st_run.mot[MOTOR_2].substep_accumulator);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1027
000008BF FB12rrrrrrrr            		MOV.L #__$st_run, R1
000008C5 A892                    		MOV.L 08H[R1], R2
000008C7 06891209                		ADD 24H[R1].L, R2
000008CB 7E12                    		NEG R2
000008CD A21A                    		MOV.L R2, 24H[R1]
000008CF                         L213:	; bb124.split4
                                 ;    1028 				if (st_pre.mot[MOTOR_2].direction == DIRECTION_CW)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1028
000008CF FBE2rrrrrrrr            		MOV.L #_st_pre, R14
000008D5 CDEE34                  		MOV.B 34H[R14], R14
000008D8 610E                    		CMP #00H, R14
000008DA 18                   S  		BNE L215
000008DB                         L214:	; bb131
000008DB FBEE2EC008              		MOV.L #0008C02EH, R14
                                 ;    1029 					MOTOR2_DIR = MOTOR_REVERSE; else
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1029
000008E0 F0EF                    		BCLR #07H, [R14].B
000008E2 08                   S  		BRA L216
000008E3                         L215:	; bb135
000008E3 FBEE2EC008              		MOV.L #0008C02EH, R14
                                 ;    1030 				MOTOR2_DIR = MOTOR_FOWARD;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1030
000008E8 F0E7                    		BSET #07H, [R14].B
000008EA                         L216:	; bb152
                                 ;    1031 			}
                                 ;    1032 			SET_ENCODER_STEP_SIGN(MOTOR_2, st_pre.mot[MOTOR_2].step_sign);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1032
000008EA FBE2rrrrrrrr            		MOV.L #_en, R14
000008F0 FBF2rrrrrrrr            		MOV.L #_st_pre, R15
000008F6 C5FE360C                		MOV.B 36H[R15], 0CH[R14]
000008FA                         L217:	; bb152.split
                                 ;    1033 			if (st_cfg.mot[MOTOR_2].power_mode != MOTOR_DISABLED) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1033
000008FA FBE2rrrrrrrr            		MOV.L #_st_cfg, R14
00000900 59EE31                  		MOVU.B 31H[R14], R14
00000903 610E                    		CMP #00H, R14
00000905 20rr                    		BEQ L221
00000907                         L218:	; bb155
                                 ;    1034 //RXMOD					PORT_MOTOR_2_VPORT.OUT &= ~MOTOR_ENABLE_BIT_bm;
                                 ;    1035 				st_run.mot[MOTOR_2].power_state = MOTOR_POWER_TIMEOUT_START;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1035
00000907 FBE2rrrrrrrr            		MOV.L #__$st_run, R14
0000090D F9E42803                		MOV.B #03H, 28H[R14]
00000911 2Err                 B  		BRA L221
00000913                         L219:	; bb163
                                 ;    1036 			}
                                 ;    1037 		} else {
                                 ;    1038 			if (st_cfg.mot[MOTOR_2].power_mode == MOTOR_POWERED_IN_CYCLE) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1038
00000913 FBE2rrrrrrrr            		MOV.L #_st_cfg, R14
00000919 59EE31                  		MOVU.B 31H[R14], R14
0000091C 612E                    		CMP #02H, R14
0000091E 21rr                    		BNE L221
00000920                         L220:	; bb164
                                 ;    1039 //RXMOD					PORT_MOTOR_2_VPORT.OUT &= ~MOTOR_ENABLE_BIT_bm;
                                 ;    1040 				st_run.mot[MOTOR_2].power_state = MOTOR_POWER_TIMEOUT_START;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1040
00000920 FBE2rrrrrrrr            		MOV.L #__$st_run, R14
00000926 F9E42803                		MOV.B #03H, 28H[R14]
0000092A                         L221:	; bb176
                                 ;    1041 			}
                                 ;    1042 		}
                                 ;    1043 		ACCUMULATE_ENCODER(MOTOR_2);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1043
0000092A FB12rrrrrrrr            		MOV.L #_en, R1
00000930 A912                    		MOV.L 10H[R1], R2
00000932 06491207                		ADD 0EH[R1].W, R2
00000936 A112                    		MOV.L R2, 10H[R1]
00000938                         L222:	; bb176.split
00000938 FB12rrrrrrrr            		MOV.L #_en, R1
0000093E 3D1700                  		MOV.W #0000H, 0EH[R1]
00000941                         L223:	; bb176.split5
                                 ;    1044 #endif
                                 ;    1045 #if (MOTORS >= 3)	//**** MOTOR_3 LOAD ****
                                 ;    1046 		if ((st_run.mot[MOTOR_3].substep_increment = st_pre.mot[MOTOR_3].substep_increment) != 0) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1046
00000941 FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000947 AC99                    		MOV.L 4CH[R1], R1
00000949 FB22rrrrrrrr            		MOV.L #__$st_run, R2
0000094F A329                    		MOV.L R1, 34H[R2]
00000951 6101                    		CMP #00H, R1
00000953 3Arrrr               W  		BEQ L236
00000956                         L224:	; bb183
                                 ;    1047 			if (st_pre.mot[MOTOR_3].accumulator_correction_flag == true) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1047
00000956 FBE2rrrrrrrr            		MOV.L #_st_pre, R14
0000095C 59EE64                  		MOVU.B 64H[R14], R14
0000095F 611E                    		CMP #01H, R14
00000961 21rr                    		BNE L227
00000963                         L225:	; bb184
                                 ;    1048 				st_pre.mot[MOTOR_3].accumulator_correction_flag = false;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1048
00000963 FBE2rrrrrrrr            		MOV.L #_st_pre, R14
00000969 F9E46400                		MOV.B #00H, 64H[R14]
0000096D                         L226:	; bb184.split
                                 ;    1049 				st_run.mot[MOTOR_3].substep_accumulator *= st_pre.mot[MOTOR_3].accumulator_correction;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1049
0000096D FB12rrrrrrrr            		MOV.L #__$st_run, R1
00000973 06A1111E0E              		ITOF 38H[R1].L, R14
00000978 FBF2rrrrrrrr            		MOV.L #_st_pre, R15
0000097E FC8DFE18                		FMUL 60H[R15].L, R14
00000982 FC97E2                  		FTOI R14, R2
00000985 A392                    		MOV.L R2, 38H[R1]
00000987                         L227:	; bb196
                                 ;    1050 			}
                                 ;    1051 			if (st_pre.mot[MOTOR_3].direction != st_pre.mot[MOTOR_3].prev_direction) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1051
00000987 FBE2rrrrrrrr            		MOV.L #_st_pre, R14
0000098D CDEF50                  		MOV.B 50H[R14], R15
00000990 45EF51                  		CMP 51H[R14].UB, R15
00000993 20rr                    		BEQ L233
00000995                         L228:	; bb197
                                 ;    1052 				st_pre.mot[MOTOR_3].prev_direction = st_pre.mot[MOTOR_3].direction;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1052
00000995 FBE2rrrrrrrr            		MOV.L #_st_pre, R14
0000099B C5EE5051                		MOV.B 50H[R14], 51H[R14]
0000099F                         L229:	; bb197.split
                                 ;    1053 				st_run.mot[MOTOR_3].substep_accumulator = -(st_run.dda_ticks_X_substeps + st_run.mot[MOTOR_3].substep_accumulator);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1053
0000099F FB12rrrrrrrr            		MOV.L #__$st_run, R1
000009A5 A892                    		MOV.L 08H[R1], R2
000009A7 0689120E                		ADD 38H[R1].L, R2
000009AB 7E12                    		NEG R2
000009AD A392                    		MOV.L R2, 38H[R1]
000009AF                         L230:	; bb197.split6
                                 ;    1054 				if (st_pre.mot[MOTOR_3].direction == DIRECTION_CW)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1054
000009AF FBE2rrrrrrrr            		MOV.L #_st_pre, R14
000009B5 CDEE50                  		MOV.B 50H[R14], R14
000009B8 610E                    		CMP #00H, R14
000009BA 18                   S  		BNE L232
000009BB                         L231:	; bb204
000009BB FBEE2AC008              		MOV.L #0008C02AH, R14
                                 ;    1055 					MOTOR3_DIR = MOTOR_REVERSE; else
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1055
000009C0 F0EB                    		BCLR #03H, [R14].B
000009C2 08                   S  		BRA L233
000009C3                         L232:	; bb208
000009C3 FBEE2AC008              		MOV.L #0008C02AH, R14
                                 ;    1056 				MOTOR3_DIR = MOTOR_FOWARD;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1056
000009C8 F0E3                    		BSET #03H, [R14].B
000009CA                         L233:	; bb225
                                 ;    1057 			}
                                 ;    1058 			SET_ENCODER_STEP_SIGN(MOTOR_3, st_pre.mot[MOTOR_3].step_sign);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1058
000009CA FBE2rrrrrrrr            		MOV.L #_en, R14
000009D0 FBF2rrrrrrrr            		MOV.L #_st_pre, R15
000009D6 C5FE5214                		MOV.B 52H[R15], 14H[R14]
000009DA                         L234:	; bb225.split
                                 ;    1059 			if (st_cfg.mot[MOTOR_3].power_mode != MOTOR_DISABLED) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1059
000009DA FBE2rrrrrrrr            		MOV.L #_st_cfg, R14
000009E0 59EE55                  		MOVU.B 55H[R14], R14
000009E3 610E                    		CMP #00H, R14
000009E5 20rr                    		BEQ L238
000009E7                         L235:	; bb228
                                 ;    1060 //RXMOD					PORT_MOTOR_3_VPORT.OUT &= ~MOTOR_ENABLE_BIT_bm;
                                 ;    1061 				st_run.mot[MOTOR_3].power_state = MOTOR_POWER_TIMEOUT_START;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1061
000009E7 FBE2rrrrrrrr            		MOV.L #__$st_run, R14
000009ED F9E43C03                		MOV.B #03H, 3CH[R14]
000009F1 2Err                 B  		BRA L238
000009F3                         L236:	; bb236
                                 ;    1062 			}
                                 ;    1063 		} else {
                                 ;    1064 			if (st_cfg.mot[MOTOR_3].power_mode == MOTOR_POWERED_IN_CYCLE) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1064
000009F3 FBE2rrrrrrrr            		MOV.L #_st_cfg, R14
000009F9 59EE55                  		MOVU.B 55H[R14], R14
000009FC 612E                    		CMP #02H, R14
000009FE 21rr                    		BNE L238
00000A00                         L237:	; bb237
                                 ;    1065 //RXMOD					PORT_MOTOR_3_VPORT.OUT &= ~MOTOR_ENABLE_BIT_bm;
                                 ;    1066 				st_run.mot[MOTOR_3].power_state = MOTOR_POWER_TIMEOUT_START;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1066
00000A00 FBE2rrrrrrrr            		MOV.L #__$st_run, R14
00000A06 F9E43C03                		MOV.B #03H, 3CH[R14]
00000A0A                         L238:	; bb249
                                 ;    1067 			}
                                 ;    1068 		}
                                 ;    1069 		ACCUMULATE_ENCODER(MOTOR_3);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1069
00000A0A FB12rrrrrrrr            		MOV.L #_en, R1
00000A10 A992                    		MOV.L 18H[R1], R2
00000A12 0649120B                		ADD 16H[R1].W, R2
00000A16 A192                    		MOV.L R2, 18H[R1]
00000A18                         L239:	; bb249.split
00000A18 FB12rrrrrrrr            		MOV.L #_en, R1
00000A1E 3D1B00                  		MOV.W #0000H, 16H[R1]
00000A21                         L240:	; bb249.split7
                                 ;    1070 #endif
                                 ;    1071 #if (MOTORS >= 4)  //**** MOTOR_4 LOAD ****
                                 ;    1072 		if ((st_run.mot[MOTOR_4].substep_increment = st_pre.mot[MOTOR_4].substep_increment) != 0) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1072
00000A21 FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000A27 AE91                    		MOV.L 68H[R1], R1
00000A29 FB22rrrrrrrr            		MOV.L #__$st_run, R2
00000A2F A4A1                    		MOV.L R1, 48H[R2]
00000A31 6101                    		CMP #00H, R1
00000A33 3Arrrr               W  		BEQ L253
00000A36                         L241:	; bb256
                                 ;    1073 			if (st_pre.mot[MOTOR_4].accumulator_correction_flag == true) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1073
00000A36 FBE2rrrrrrrr            		MOV.L #_st_pre, R14
00000A3C 59EE80                  		MOVU.B 80H[R14], R14
00000A3F 611E                    		CMP #01H, R14
00000A41 21rr                    		BNE L244
00000A43                         L242:	; bb257
                                 ;    1074 				st_pre.mot[MOTOR_4].accumulator_correction_flag = false;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1074
00000A43 FBE2rrrrrrrr            		MOV.L #_st_pre, R14
00000A49 F9E48000                		MOV.B #00H, 80H[R14]
00000A4D                         L243:	; bb257.split
                                 ;    1075 				st_run.mot[MOTOR_4].substep_accumulator *= st_pre.mot[MOTOR_4].accumulator_correction;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1075
00000A4D FB12rrrrrrrr            		MOV.L #__$st_run, R1
00000A53 06A1111E13              		ITOF 4CH[R1].L, R14
00000A58 FBF2rrrrrrrr            		MOV.L #_st_pre, R15
00000A5E FC8DFE1F                		FMUL 7CH[R15].L, R14
00000A62 FC97E2                  		FTOI R14, R2
00000A65 A49A                    		MOV.L R2, 4CH[R1]
00000A67                         L244:	; bb269
                                 ;    1076 			}
                                 ;    1077 			if (st_pre.mot[MOTOR_4].direction != st_pre.mot[MOTOR_4].prev_direction) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1077
00000A67 FBE2rrrrrrrr            		MOV.L #_st_pre, R14
00000A6D CDEF6C                  		MOV.B 6CH[R14], R15
00000A70 45EF6D                  		CMP 6DH[R14].UB, R15
00000A73 20rr                    		BEQ L250
00000A75                         L245:	; bb270
                                 ;    1078 				st_pre.mot[MOTOR_4].prev_direction = st_pre.mot[MOTOR_4].direction;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1078
00000A75 FBE2rrrrrrrr            		MOV.L #_st_pre, R14
00000A7B C5EE6C6D                		MOV.B 6CH[R14], 6DH[R14]
00000A7F                         L246:	; bb270.split
                                 ;    1079 				st_run.mot[MOTOR_4].substep_accumulator = -(st_run.dda_ticks_X_substeps + st_run.mot[MOTOR_4].substep_accumulator);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1079
00000A7F FB12rrrrrrrr            		MOV.L #__$st_run, R1
00000A85 A892                    		MOV.L 08H[R1], R2
00000A87 06891213                		ADD 4CH[R1].L, R2
00000A8B 7E12                    		NEG R2
00000A8D A49A                    		MOV.L R2, 4CH[R1]
00000A8F                         L247:	; bb270.split8
                                 ;    1080 				if (st_pre.mot[MOTOR_4].direction == DIRECTION_CW)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1080
00000A8F FBE2rrrrrrrr            		MOV.L #_st_pre, R14
00000A95 CDEE6C                  		MOV.B 6CH[R14], R14
00000A98 610E                    		CMP #00H, R14
00000A9A 18                   S  		BNE L249
00000A9B                         L248:	; bb277
00000A9B FBEE2AC008              		MOV.L #0008C02AH, R14
                                 ;    1081 					MOTOR4_DIR = MOTOR_REVERSE; else
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1081
00000AA0 F0E9                    		BCLR #01H, [R14].B
00000AA2 08                   S  		BRA L250
00000AA3                         L249:	; bb281
00000AA3 FBEE2AC008              		MOV.L #0008C02AH, R14
                                 ;    1082 				MOTOR4_DIR = MOTOR_FOWARD;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1082
00000AA8 F0E1                    		BSET #01H, [R14].B
00000AAA                         L250:	; bb298
                                 ;    1083 			}
                                 ;    1084 			SET_ENCODER_STEP_SIGN(MOTOR_4, st_pre.mot[MOTOR_4].step_sign);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1084
00000AAA FBE2rrrrrrrr            		MOV.L #_en, R14
00000AB0 FBF2rrrrrrrr            		MOV.L #_st_pre, R15
00000AB6 C5FE6E1C                		MOV.B 6EH[R15], 1CH[R14]
00000ABA                         L251:	; bb298.split
                                 ;    1085 			if (st_cfg.mot[MOTOR_4].power_mode != MOTOR_DISABLED) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1085
00000ABA FBE2rrrrrrrr            		MOV.L #_st_cfg, R14
00000AC0 59EE79                  		MOVU.B 79H[R14], R14
00000AC3 610E                    		CMP #00H, R14
00000AC5 20rr                    		BEQ L255
00000AC7                         L252:	; bb301
                                 ;    1086 //RXMOD					PORT_MOTOR_4_VPORT.OUT &= ~MOTOR_ENABLE_BIT_bm;
                                 ;    1087 				st_run.mot[MOTOR_4].power_state = MOTOR_POWER_TIMEOUT_START;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1087
00000AC7 FBE2rrrrrrrr            		MOV.L #__$st_run, R14
00000ACD F9E45003                		MOV.B #03H, 50H[R14]
00000AD1 2Err                 B  		BRA L255
00000AD3                         L253:	; bb309
                                 ;    1088 			}
                                 ;    1089 		} else {
                                 ;    1090 			if (st_cfg.mot[MOTOR_4].power_mode == MOTOR_POWERED_IN_CYCLE) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1090
00000AD3 FBE2rrrrrrrr            		MOV.L #_st_cfg, R14
00000AD9 59EE79                  		MOVU.B 79H[R14], R14
00000ADC 612E                    		CMP #02H, R14
00000ADE 21rr                    		BNE L255
00000AE0                         L254:	; bb310
                                 ;    1091 //RXMOD					PORT_MOTOR_4_VPORT.OUT &= ~MOTOR_ENABLE_BIT_bm;
                                 ;    1092 				st_run.mot[MOTOR_4].power_state = MOTOR_POWER_TIMEOUT_START;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1092
00000AE0 FBE2rrrrrrrr            		MOV.L #__$st_run, R14
00000AE6 F9E45003                		MOV.B #03H, 50H[R14]
00000AEA                         L255:	; bb322
                                 ;    1093 			}
                                 ;    1094 		}
                                 ;    1095 		ACCUMULATE_ENCODER(MOTOR_4);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1095
00000AEA FB12rrrrrrrr            		MOV.L #_en, R1
00000AF0 AA12                    		MOV.L 20H[R1], R2
00000AF2 0649120F                		ADD 1EH[R1].W, R2
00000AF6 A212                    		MOV.L R2, 20H[R1]
00000AF8                         L256:	; bb322.split
00000AF8 FB12rrrrrrrr            		MOV.L #_en, R1
00000AFE 3D1F00                  		MOV.W #0000H, 1EH[R1]
00000B01                         L257:	; bb322.split9
00000B01 6601                    		MOV.L #00000000H, R1
                                 ;    1096 #endif
                                 ;    1097 #if (MOTORS >= 5)	//**** MOTOR_5 LOAD ****
                                 ;    1098 		if ((st_run.mot[MOTOR_5].substep_increment = st_pre.mot[MOTOR_5].substep_increment) != 0) {
                                 ;    1099 			if (st_pre.mot[MOTOR_5].accumulator_correction_flag == true) {
                                 ;    1100 				st_pre.mot[MOTOR_5].accumulator_correction_flag = false;
                                 ;    1101 				st_run.mot[MOTOR_5].substep_accumulator *= st_pre.mot[MOTOR_5].accumulator_correction;
                                 ;    1102 			}
                                 ;    1103 			if (st_pre.mot[MOTOR_5].direction != st_pre.mot[MOTOR_5].prev_direction) {
                                 ;    1104 				st_pre.mot[MOTOR_5].prev_direction = st_pre.mot[MOTOR_5].direction;
                                 ;    1105 				st_run.mot[MOTOR_5].substep_accumulator = -(st_run.dda_ticks_X_substeps + st_run.mot[MOTOR_5].substep_accumulator);
                                 ;    1106 				if (st_pre.mot[MOTOR_5].direction == DIRECTION_CW)
                                 ;    1107 				PORT_MOTOR_5_VPORT.OUT &= ~DIRECTION_BIT_bm; else
                                 ;    1108 				PORT_MOTOR_5_VPORT.OUT |= DIRECTION_BIT_bm;
                                 ;    1109 			}
                                 ;    1110 			PORT_MOTOR_5_VPORT.OUT &= ~MOTOR_ENABLE_BIT_bm;
                                 ;    1111 			st_run.mot[MOTOR_5].power_state = MOTOR_POWER_TIMEOUT_START;
                                 ;    1112 			SET_ENCODER_STEP_SIGN(MOTOR_5, st_pre.mot[MOTOR_5].step_sign);
                                 ;    1113 		} else {
                                 ;    1114 			if (st_cfg.mot[MOTOR_5].power_mode == MOTOR_POWERED_IN_CYCLE) {
                                 ;    1115 				PORT_MOTOR_5_VPORT.OUT &= ~MOTOR_ENABLE_BIT_bm;
                                 ;    1116 				st_run.mot[MOTOR_5].power_state = MOTOR_POWER_TIMEOUT_START;
                                 ;    1117 			}
                                 ;    1118 		}
                                 ;    1119 		ACCUMULATE_ENCODER(MOTOR_5);
                                 ;    1120 #endif
                                 ;    1121 #if (MOTORS >= 6)	//**** MOTOR_6 LOAD ****
                                 ;    1122 		if ((st_run.mot[MOTOR_6].substep_increment = st_pre.mot[MOTOR_6].substep_increment) != 0) {
                                 ;    1123 			if (st_pre.mot[MOTOR_6].accumulator_correction_flag == true) {
                                 ;    1124 				st_pre.mot[MOTOR_6].accumulator_correction_flag = false;
                                 ;    1125 				st_run.mot[MOTOR_6].substep_accumulator *= st_pre.mot[MOTOR_6].accumulator_correction;
                                 ;    1126 			}
                                 ;    1127 			if (st_pre.mot[MOTOR_6].direction != st_pre.mot[MOTOR_6].prev_direction) {
                                 ;    1128 				st_pre.mot[MOTOR_6].prev_direction = st_pre.mot[MOTOR_6].direction;
                                 ;    1129 				st_run.mot[MOTOR_6].substep_accumulator = -(st_run.dda_ticks_X_substeps + st_run.mot[MOTOR_6].substep_accumulator);
                                 ;    1130 				if (st_pre.mot[MOTOR_6].direction == DIRECTION_CW)
                                 ;    1131 				PORT_MOTOR_6_VPORT.OUT &= ~DIRECTION_BIT_bm; else
                                 ;    1132 				PORT_MOTOR_6_VPORT.OUT |= DIRECTION_BIT_bm;
                                 ;    1133 			}
                                 ;    1134 			PORT_MOTOR_6_VPORT.OUT &= ~MOTOR_ENABLE_BIT_bm;
                                 ;    1135 			st_run.mot[MOTOR_6].power_state = MOTOR_POWER_TIMEOUT_START;
                                 ;    1136 			SET_ENCODER_STEP_SIGN(MOTOR_6, st_pre.mot[MOTOR_6].step_sign);
                                 ;    1137 		} else {
                                 ;    1138 			if (st_cfg.mot[MOTOR_6].power_mode == MOTOR_POWERED_IN_CYCLE) {
                                 ;    1139 				PORT_MOTOR_6_VPORT.OUT &= ~MOTOR_ENABLE_BIT_bm;
                                 ;    1140 				st_run.mot[MOTOR_6].power_state = MOTOR_POWER_TIMEOUT_START;
                                 ;    1141 			}
                                 ;    1142 		}
                                 ;    1143 		ACCUMULATE_ENCODER(MOTOR_6);
                                 ;    1144 #endif
                                 ;    1145 		//**** do this last ****
                                 ;    1146 
                                 ;    1147 		R_TMR_Control(TIMER_DDA, TMR_START, 0);			// enable the DDA timer
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1147
00000B03 EF12                    		MOV.L R1, R2
00000B05 EF13                    		MOV.L R1, R3
00000B07 05rrrrrr             A  		BSR _R_TMR_Control
00000B0B 2Err                 B  		BRA L264
00000B0D                         L258:	; bb329
                                 ;    1148 
                                 ;    1149 	// handle dwells
                                 ;    1150 	} else if (st_pre.move_type == MOVE_TYPE_DWELL) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1150
00000B0D FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000B13 B211                    		MOVU.B 08H[R1], R1
00000B15 6121                    		CMP #02H, R1
00000B17 21rr                    		BNE L262
00000B19                         L259:	; bb330
                                 ;    1151 		isDwell = true;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1151
00000B19 FBE2rrrrrrrr            		MOV.L #_isDwell, R14
00000B1F F8E401                  		MOV.B #01H, [R14]
00000B22                         L260:	; bb330.split
                                 ;    1152 		st_run.dda_ticks_downcount = st_pre.dda_ticks;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1152
00000B22 FBE2rrrrrrrr            		MOV.L #__$st_run, R14
00000B28 FBF2rrrrrrrr            		MOV.L #_st_pre, R15
00000B2E E5FE0301                		MOV.L 0CH[R15], 04H[R14]
00000B32                         L261:	; bb330.split10
00000B32 6601                    		MOV.L #00000000H, R1
                                 ;    1153 //RXMOD			TIMER_DWELL.PER = st_pre.dda_period;			// load dwell timer period
                                 ;    1154 //		TIMER_DWELL.CTRLA = STEP_TIMER_ENABLE;			// enable the dwell timer
                                 ;    1155 //		R_CMT_Control(timerDwell,CMT_RX_CMD_RESTART,0);
                                 ;    1156 		st_command_dwell(DWELL_START);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1156
00000B34 39rrrr               W  		BSR _st_command_dwell
00000B37 2Err                 B  		BRA L264
00000B39                         L262:	; bb333
                                 ;    1157 
                                 ;    1158 	// handle synchronous commands
                                 ;    1159 	} else if (st_pre.move_type == MOVE_TYPE_COMMAND) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1159
00000B39 FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000B3F B211                    		MOVU.B 08H[R1], R1
00000B41 6131                    		CMP #03H, R1
00000B43 21rr                    		BNE L264
00000B45                         L263:	; bb334
                                 ;    1160 		mp_runtime_command(st_pre.bf);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1160
00000B45 FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000B4B A819                    		MOV.L 04H[R1], R1
00000B4D 05rrrrrr             A  		BSR _mp_runtime_command
00000B51                         L264:	; bb354
                                 ;    1161 	}
                                 ;    1162 
                                 ;    1163 	// all other cases drop to here (e.g. Null moves after Mcodes skip to here)
                                 ;    1164 	st_pre.move_type = MOVE_TYPE_NULL;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1164
00000B51 FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000B57 3C1800                  		MOV.B #00H, 08H[R1]
00000B5A                         L265:	; bb354.split
                                 ;    1165 	st_pre.buffer_state = PREP_BUFFER_OWNED_BY_EXEC;	// we are done with the prep buffer - flip the flag back
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1165
00000B5A FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000B60 3C1201                  		MOV.B #01H, 02H[R1]
00000B63                         L266:	; bb354.split11
                                 ;    1166 	st_request_exec_move();								// exec and prep next move
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1166
00000B63 39rrrr               W  		BSR _st_request_exec_move
00000B66 6701                    		RTSD #04H
00000B68                         L267:	; return
                                 ;    1167 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1167
00000B68 6701                    		RTSD #04H
00000B6A                         _st_prep_line:
                                 		.STACK	_st_prep_line=36
                                 ;    1168 
                                 ;    1169 /***********************************************************************************
                                 ;    1170  * st_prep_line() - Prepare the next move for the loader
                                 ;    1171  *
                                 ;    1172  *	This function does the math on the next pulse segment and gets it ready for
                                 ;    1173  *	the loader. It deals with all the DDA optimizations and timer setups so that
                                 ;    1174  *	loading can be performed as rapidly as possible. It works in joint space
                                 ;    1175  *	(motors) and it works in steps, not length units. All args are provided as
                                 ;    1176  *	floats and converted to their appropriate integer types for the loader.
                                 ;    1177  *
                                 ;    1178  * Args:
                                 ;    1179  *	  - travel_steps[] are signed relative motion in steps for each motor. Steps are
                                 ;    1180  *		floats that typically have fractional values (fractional steps). The sign
                                 ;    1181  *		indicates direction. Motors that are not in the move should be 0 steps on input.
                                 ;    1182  *
                                 ;    1183  *	  - following_error[] is a vector of measured errors to the step count. Used for correction.
                                 ;    1184  *
                                 ;    1185  *	  - segment_time - how many minutes the segment should run. If timing is not
                                 ;    1186  *		100% accurate this will affect the move velocity, but not the distance traveled.
                                 ;    1187  *
                                 ;    1188  * NOTE:  Many of the expressions are sensitive to casting and execution order to avoid long-term
                                 ;    1189  *		  accuracy errors due to floating point round off. One earlier failed attempt was:
                                 ;    1190  *		    dda_ticks_X_substeps = (int32_t)((microseconds/1000000) * f_dda * dda_substeps);
                                 ;    1191  */
                                 ;    1192 
                                 ;    1193 stat_t st_prep_line(float travel_steps[], float following_error[], float segment_time)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1193
00000B6A 7EA6                    		PUSH.L R6
00000B6C 7100E4                  		ADD #0FFFFFFE4H, R0
00000B6F A181                    		MOV.L R1, 18H[R0]
00000B71 A10A                    		MOV.L R2, 14H[R0]
00000B73 A103                    		MOV.L R3, 10H[R0]
                                 ;    1194 {
                                 ;    1195 	// trap conditions that would prevent queueing the line
                                 ;    1196 	if (st_pre.buffer_state != PREP_BUFFER_OWNED_BY_EXEC) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1196
00000B75 FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000B7B B091                    		MOVU.B 02H[R1], R1
00000B7D 6111                    		CMP #01H, R1
00000B7F 20rr                    		BEQ L275
00000B81                         L269:	; bb6
00000B81 754114                  		MOV.L #00000014H, R1
                                 ;    1197 		return (cm_hard_alarm(STAT_INTERNAL_ERROR));
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1197
00000B84 05rrrrrr             A  		BSR _cm_hard_alarm
00000B88 8189                    		MOV.B R1, 07H[R0]
00000B8A 38rrrr               W  		BRA L317
00000B8D                         L270:	; bb11
00000B8D 75411E                  		MOV.L #0000001EH, R1
00000B90 05rrrrrr             A  		BSR _cm_hard_alarm
00000B94 8189                    		MOV.B R1, 07H[R0]
00000B96 38rrrr               W  		BRA L317
00000B99                         L271:	; bb16
00000B99 75411F                  		MOV.L #0000001FH, R1
00000B9C 05rrrrrr             A  		BSR _cm_hard_alarm
00000BA0 8189                    		MOV.B R1, 07H[R0]
00000BA2 38rrrr               W  		BRA L317
00000BA5                         L272:	; bb20
                                 ;    1198 	} else if (isinf(segment_time)) { return (cm_hard_alarm(STAT_PREP_LINE_MOVE_TIME_IS_INFINITE));	// never supposed to happen
                                 ;    1199 	} else if (isnan(segment_time)) { return (cm_hard_alarm(STAT_PREP_LINE_MOVE_TIME_IS_NAN));		// never supposed to happen
                                 ;    1200 	} else if (segment_time < EPSILON) { return (STAT_MINIMUM_TIME_MOVE);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1200
00000BA5 A901                    		MOV.L 10H[R0], R1
00000BA7 FD7211BD378635          		FCMP #358637BDH, R1
00000BAE 26rr                    		BPZ L276
00000BB0                         L273:	; bb21
00000BB0 3C07CA                  		MOV.B #0CAH, 07H[R0]
00000BB3 38rrrr               W  		BRA L317
00000BB6                         L274:	; bb27
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1199
00000BB6 A901                    		MOV.L 10H[R0], R1
00000BB8 05rrrrrr             A  		BSR __FDclass
00000BBC E301                    		MOV.L R1, [R0]
00000BBE 6121                    		CMP #02H, R1
00000BC0 20rr                    		BEQ L271
00000BC2 2Err                 B  		BRA L272
00000BC4                         L275:	; bb45
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1198
00000BC4 A901                    		MOV.L 10H[R0], R1
00000BC6 05rrrrrr             A  		BSR __FDclass
00000BCA E301                    		MOV.L R1, [R0]
00000BCC 6111                    		CMP #01H, R1
00000BCE 20rr                    		BEQ L270
00000BD0 2Err                 B  		BRA L274
00000BD2                         L276:	; bb68
                                 ;    1201 	}
                                 ;    1202 	// setup segment parameters
                                 ;    1203 	// - dda_ticks is the integer number of DDA clock ticks needed to play out the segment
                                 ;    1204 	// - ticks_X_substeps is the maximum depth of the DDA accumulator (as a negative number)
                                 ;    1205 
                                 ;    1206 	st_pre.dda_period = _f_to_period(FREQUENCY_DDA);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1206
00000BD2 FBE2rrrrrrrr            		MOV.L #_st_pre, R14
00000BD8 F9E905C003              		MOV.W #03C0H, 0AH[R14]
00000BDD                         L277:	; bb68.split
                                 ;    1207 	st_pre.dda_ticks = (int32_t)(segment_time * 60 * FREQUENCY_DDA);// NB: converts minutes to seconds
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1207
00000BDD A901                    		MOV.L 10H[R0], R1
00000BDF FD723100007042          		FMUL #42700000H, R1
00000BE6 FD72310050C347          		FMUL #47C35000H, R1
00000BED FC9711                  		FTOI R1, R1
00000BF0 FB22rrrrrrrr            		MOV.L #_st_pre, R2
00000BF6 A0A9                    		MOV.L R1, 0CH[R2]
00000BF8                         L278:	; bb68.split1
                                 ;    1208 	st_pre.dda_ticks_X_substeps = st_pre.dda_ticks * DDA_SUBSTEPS;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1208
00000BF8 FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000BFE A89A                    		MOV.L 0CH[R1], R2
00000C00 7DF2                    		BTST #1FH, R2
00000C02 20rr                    		BEQ L280
00000C04                         L279:	; bb68.split1
00000C04 FD812E                  		SHLR #01H, R2, R14
00000C07 6412                    		AND #01H, R2
00000C09 57E2                    		OR R14, R2
00000C0B FC472E                  		ITOF R2, R14
00000C0E FC8BEE                  		FADD R14, R14
00000C11 08                   S  		BRA L281
00000C12                         L280:	; bb68.split1
00000C12 FC472E                  		ITOF R2, R14
00000C15                         L281:	; bb68.split1
00000C15 FD723EA69B444B          		FMUL #4B449BA6H, R14
00000C1C FD721E0000004F          		FCMP #4F000000H, R14
00000C23 29rr                    		BLT L283
00000C25                         L282:	; bb68.split1
00000C25 FD722E000080CF          		FADD #0CF800000H, R14
00000C2C                         L283:	; bb68.split1
00000C2C FC97E2                  		FTOI R14, R2
00000C2F A112                    		MOV.L R2, 10H[R1]
00000C31                         L284:	; bb68.split2
                                 ;    1209 
                                 ;    1210 	// setup motor parameters
                                 ;    1211 
                                 ;    1212 	float correction_steps;
                                 ;    1213 	for (uint8_t motor=0; motor<MOTORS; motor++) {	// I want to remind myself that this is motors, not axes
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1213
00000C31 3C0E00                  		MOV.B #00H, 0EH[R0]
00000C34 38rrrr               W  		BRA L313
00000C37                         L285:	; bb78
                                 ;    1214 
                                 ;    1215 		// Skip this motor if there are no new steps. Leave all other values intact.
                                 ;    1216 		if (fp_ZERO(travel_steps[motor])) { st_pre.mot[motor].substep_increment = 0; continue;}
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1216
00000C37 A981                    		MOV.L 18H[R0], R1
00000C39 B382                    		MOVU.B 0EH[R0], R2
00000C3B FE621E                  		MOV.L [R2,R1], R14
00000C3E 7BFE                    		BCLR #1FH, R14
00000C40 FD721EBD378635          		FCMP #358637BDH, R14
00000C47 26rr                    		BPZ L287
00000C49                         L286:	; bb79
00000C49 B381                    		MOVU.B 0EH[R0], R1
00000C4B 75111C                  		MUL #1CH, R1
00000C4E FB22rrrrrrrr            		MOV.L #_st_pre, R2
00000C54 4B12                    		ADD R1, R2
00000C56 3E2500                  		MOV.L #00000000H, 14H[R2]
00000C59 38rrrr               W  		BRA L312
00000C5C                         L287:	; bb95
                                 ;    1217 
                                 ;    1218 		// Setup the direction, compensating for polarity.
                                 ;    1219 		// Set the step_sign which is used by the stepper ISR to accumulate step position
                                 ;    1220 
                                 ;    1221 		if (travel_steps[motor] >= 0) {					// positive direction
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1221
00000C5C B381                    		MOVU.B 0EH[R0], R1
00000C5E EF1E                    		MOV.L R1, R14
00000C60 751E1C                  		MUL #1CH, R14
00000C63 FB22rrrrrrrr            		MOV.L #_st_pre, R2
00000C69 4BE2                    		ADD R14, R2
00000C6B 712214                  		ADD #14H, R2
00000C6E EF1E                    		MOV.L R1, R14
00000C70 751E24                  		MUL #24H, R14
00000C73 FB32rrrrrrrr            		MOV.L #_st_cfg, R3
00000C79 4BE3                    		ADD R14, R3
00000C7B A984                    		MOV.L 18H[R0], R4
00000C7D FE614E                  		MOV.L [R1,R4], R14
00000C80 FD721E00000000          		FCMP #00000000H, R14
00000C87 B331                    		MOVU.B 0CH[R3], R1
00000C89 29rr                    		BLT L290
00000C8B                         L288:	; bb96
                                 ;    1222 			st_pre.mot[motor].direction = DIRECTION_CW ^ st_cfg.mot[motor].polarity;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1222
00000C8B 8121                    		MOV.B R1, 04H[R2]
00000C8D                         L289:	; bb96.split
                                 ;    1223 			st_pre.mot[motor].step_sign = 1;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1223
00000C8D B381                    		MOVU.B 0EH[R0], R1
00000C8F 75111C                  		MUL #1CH, R1
00000C92 FB22rrrrrrrr            		MOV.L #_st_pre, R2
00000C98 4B12                    		ADD R1, R2
00000C9A 3CAA01                  		MOV.B #01H, 1AH[R2]
00000C9D 2Err                 B  		BRA L292
00000C9F                         L290:	; bb113
                                 ;    1224 		} else {
                                 ;    1225 			st_pre.mot[motor].direction = DIRECTION_CCW ^ st_cfg.mot[motor].polarity;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1225
00000C9F FDE0F1                  		BNOT #00H, R1
00000CA2 8121                    		MOV.B R1, 04H[R2]
00000CA4                         L291:	; bb113.split
                                 ;    1226 			st_pre.mot[motor].step_sign = -1;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1226
00000CA4 B381                    		MOVU.B 0EH[R0], R1
00000CA6 75111C                  		MUL #1CH, R1
00000CA9 FB22rrrrrrrr            		MOV.L #_st_pre, R2
00000CAF 4B12                    		ADD R1, R2
00000CB1 3CAAFF                  		MOV.B #0FFH, 1AH[R2]
00000CB4                         L292:	; bb139
                                 ;    1227 		}
                                 ;    1228 
                                 ;    1229 		// Detect segment time changes and setup the accumulator correction factor and flag.
                                 ;    1230 		// Putting this here computes the correct factor even if the motor was dormant for some
                                 ;    1231 		// number of previous moves. Correction is computed based on the last segment time actually used.
                                 ;    1232 
                                 ;    1233 		if (fabs(segment_time - st_pre.mot[motor].prev_segment_time) > 0.0000001) { // highly tuned FP != compare
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1233
00000CB4 B381                    		MOVU.B 0EH[R0], R1
00000CB6 75111C                  		MUL #1CH, R1
00000CB9 FBE2rrrrrrrr            		MOV.L #_st_pre, R14
00000CBF 4B1E                    		ADD R1, R14
00000CC1 A901                    		MOV.L 10H[R0], R1
00000CC3 FC81E109                		FSUB 24H[R14].L, R1
00000CC7 7BF1                    		BCLR #1FH, R1
00000CC9 FBE295BFD633            		MOV.L #33D6BF95H, R14
00000CCF FC871E                  		FCMP R1, R14
00000CD2 26rr                    		BPZ L297
00000CD4                         L293:	; bb141
                                 ;    1234 			if (fp_NOT_ZERO(st_pre.mot[motor].prev_segment_time)) {					// special case to skip first move
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1234
00000CD4 B381                    		MOVU.B 0EH[R0], R1
00000CD6 75111C                  		MUL #1CH, R1
00000CD9 FB22rrrrrrrr            		MOV.L #_st_pre, R2
00000CDF 4B12                    		ADD R1, R2
00000CE1 AA29                    		MOV.L 24H[R2], R1
00000CE3 7BF1                    		BCLR #1FH, R1
00000CE5 FBE2BD378635            		MOV.L #358637BDH, R14
00000CEB FC871E                  		FCMP R1, R14
00000CEE 26rr                    		BPZ L296
00000CF0                         L294:	; bb142
                                 ;    1235 				st_pre.mot[motor].accumulator_correction_flag = true;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1235
00000CF0 B381                    		MOVU.B 0EH[R0], R1
00000CF2 75111C                  		MUL #1CH, R1
00000CF5 FBE2rrrrrrrr            		MOV.L #_st_pre, R14
00000CFB 4B1E                    		ADD R1, R14
00000CFD F9E42C01                		MOV.B #01H, 2CH[R14]
00000D01                         L295:	; bb142.split
                                 ;    1236 				st_pre.mot[motor].accumulator_correction = segment_time / st_pre.mot[motor].prev_segment_time;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1236
00000D01 B381                    		MOVU.B 0EH[R0], R1
00000D03 75111C                  		MUL #1CH, R1
00000D06 FB22rrrrrrrr            		MOV.L #_st_pre, R2
00000D0C 4B12                    		ADD R1, R2
00000D0E A901                    		MOV.L 10H[R0], R1
00000D10 FC912109                		FDIV 24H[R2].L, R1
00000D14 A2A1                    		MOV.L R1, 28H[R2]
00000D16                         L296:	; bb167
                                 ;    1237 			}
                                 ;    1238 			st_pre.mot[motor].prev_segment_time = segment_time;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1238
00000D16 B381                    		MOVU.B 0EH[R0], R1
00000D18 75111C                  		MUL #1CH, R1
00000D1B FB22rrrrrrrr            		MOV.L #_st_pre, R2
00000D21 4B12                    		ADD R1, R2
00000D23 E5020409                		MOV.L 10H[R0], 24H[R2]
00000D27                         L297:	; bb185
                                 ;    1239 		}
                                 ;    1240 
                                 ;    1241 #ifdef __STEP_CORRECTION
                                 ;    1242 		// 'Nudge' correction strategy. Inject a single, scaled correction value then hold off
                                 ;    1243 
                                 ;    1244 		if ((--st_pre.mot[motor].correction_holdoff < 0) &&
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1244
00000D27 B381                    		MOVU.B 0EH[R0], R1
00000D29 75111C                  		MUL #1CH, R1
00000D2C FB22rrrrrrrr            		MOV.L #_st_pre, R2
00000D32 4B12                    		ADD R1, R2
00000D34 A9A9                    		MOV.L 1CH[R2], R1
00000D36 6011                    		SUB #01H, R1
00000D38 A1A9                    		MOV.L R1, 1CH[R2]
00000D3A 6101                    		CMP #00H, R1
00000D3C 29rr                    		BLT L305
00000D3E 38rrrr               W  		BRA L307
00000D41                         L298:	; bb186
                                 ;    1245 			(fabs(following_error[motor]) > STEP_CORRECTION_THRESHOLD)) {
                                 ;    1246 
                                 ;    1247 			st_pre.mot[motor].correction_holdoff = STEP_CORRECTION_HOLDOFF;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1247
00000D41 B381                    		MOVU.B 0EH[R0], R1
00000D43 75111C                  		MUL #1CH, R1
00000D46 FB22rrrrrrrr            		MOV.L #_st_pre, R2
00000D4C 4B12                    		ADD R1, R2
00000D4E 3E2705                  		MOV.L #00000005H, 1CH[R2]
00000D51                         L299:	; bb186.split
                                 ;    1248 			correction_steps = following_error[motor] * STEP_CORRECTION_FACTOR;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1248
00000D51 A909                    		MOV.L 14H[R0], R1
00000D53 B382                    		MOVU.B 0EH[R0], R2
00000D55 FE6211                  		MOV.L [R2,R1], R1
00000D58 FD72310000803E          		FMUL #3E800000H, R1
00000D5F A081                    		MOV.L R1, 08H[R0]
00000D61                         L300:	; bb186.split3
                                 ;    1249 
                                 ;    1250 			if (correction_steps > 0) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1250
00000D61 A881                    		MOV.L 08H[R0], R1
00000D63 660E                    		MOV.L #00000000H, R14
00000D65 FC871E                  		FCMP R1, R14
00000D68 A982                    		MOV.L 18H[R0], R2
00000D6A B383                    		MOVU.B 0EH[R0], R3
00000D6C FE6322                  		MOV.L [R3,R2], R2
00000D6F 26rr                    		BPZ L302
00000D71                         L301:	; bb198
                                 ;    1251 				correction_steps = min3(correction_steps, fabs(travel_steps[motor]), STEP_CORRECTION_MAX);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1251
00000D71 7BF2                    		BCLR #1FH, R2
00000D73 FB329A99193F            		MOV.L #3F19999AH, R3
00000D79 05rrrrrr             A  		BSR _min3
00000D7D A081                    		MOV.L R1, 08H[R0]
00000D7F 2Err                 B  		BRA L303
00000D81                         L302:	; bb207
                                 ;    1252 			} else {
                                 ;    1253 				correction_steps = max3(correction_steps, -fabs(travel_steps[motor]), -STEP_CORRECTION_MAX);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1253
00000D81 7BF2                    		BCLR #1FH, R2
00000D83 FDFFF2                  		BNOT #1FH, R2
00000D86 FB329A9919BF            		MOV.L #0BF19999AH, R3
00000D8C 05rrrrrr             A  		BSR _max3
00000D90 A081                    		MOV.L R1, 08H[R0]
00000D92                         L303:	; bb221
                                 ;    1254 			}
                                 ;    1255 			st_pre.mot[motor].corrected_steps += correction_steps;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1255
00000D92 B381                    		MOVU.B 0EH[R0], R1
00000D94 75111C                  		MUL #1CH, R1
00000D97 FB22rrrrrrrr            		MOV.L #_st_pre, R2
00000D9D 4B12                    		ADD R1, R2
00000D9F AA21                    		MOV.L 20H[R2], R1
00000DA1 FC890102                		FADD 08H[R0].L, R1
00000DA5 A221                    		MOV.L R1, 20H[R2]
00000DA7                         L304:	; bb221.split
                                 ;    1256 			travel_steps[motor] -= correction_steps;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1256
00000DA7 A981                    		MOV.L 18H[R0], R1
00000DA9 B382                    		MOVU.B 0EH[R0], R2
00000DAB FE621E                  		MOV.L [R2,R1], R14
00000DAE FC810E02                		FSUB 08H[R0].L, R14
00000DB2 FE221E                  		MOV.L R14, [R2,R1]
00000DB5 2Err                 B  		BRA L309
00000DB7                         L305:	; bb245
00000DB7 A909                    		MOV.L 14H[R0], R1
00000DB9 B382                    		MOVU.B 0EH[R0], R2
00000DBB FE621E                  		MOV.L [R2,R1], R14
00000DBE 7BFE                    		BCLR #1FH, R14
00000DC0 FBF200000040            		MOV.L #40000000H, R15
00000DC6 FC87EF                  		FCMP R14, R15
00000DC9 26rr                    		BPZ L307
00000DCB                         L306:	; bb254
00000DCB F80601                  		MOV.L #00000001H, [R0]
00000DCE 08                   S  		BRA L308
00000DCF                         L307:	; bb255
00000DCF F80600                  		MOV.L #00000000H, [R0]
00000DD2                         L308:	; bb256
00000DD2 EC01                    		MOV.L [R0], R1
00000DD4 6101                    		CMP #00H, R1
00000DD6 3Brrrr               W  		BNE L298
00000DD9                         L309:	; bb261
                                 ;    1257 		}
                                 ;    1258 #endif
                                 ;    1259 		// Compute substeb increment. The accumulator must be *exactly* the incoming
                                 ;    1260 		// fractional steps times the substep multiplier or positional drift will occur.
                                 ;    1261 		// Rounding is performed to eliminate a negative bias in the uint32 conversion
                                 ;    1262 		// that results in long-term negative drift. (fabs/round order doesn't matter)
                                 ;    1263 
                                 ;    1264 		st_pre.mot[motor].substep_increment = round(fabs(travel_steps[motor] * DDA_SUBSTEPS));
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1264
00000DD9 B386                    		MOVU.B 0EH[R0], R6
00000DDB A981                    		MOV.L 18H[R0], R1
00000DDD FE6611                  		MOV.L [R6,R1], R1
00000DE0 FD7231A69B444B          		FMUL #4B449BA6H, R1
00000DE7 7BF1                    		BCLR #1FH, R1
00000DE9 05rrrrrr             A  		BSR _round
00000DED 75161C                  		MUL #1CH, R6
00000DF0 FB22rrrrrrrr            		MOV.L #_st_pre, R2
00000DF6 4B62                    		ADD R6, R2
00000DF8 FD72110000004F          		FCMP #4F000000H, R1
00000DFF 29rr                    		BLT L311
00000E01                         L310:	; bb261
00000E01 FD7221000080CF          		FADD #0CF800000H, R1
00000E08                         L311:	; bb261
00000E08 FC9711                  		FTOI R1, R1
00000E0B A129                    		MOV.L R1, 14H[R2]
00000E0D                         L312:	; bb275
00000E0D B381                    		MOVU.B 0EH[R0], R1
00000E0F 6211                    		ADD #01H, R1
00000E11 8381                    		MOV.B R1, 0EH[R0]
00000E13                         L313:	; bb278
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1213
00000E13 B381                    		MOVU.B 0EH[R0], R1
00000E15 6141                    		CMP #04H, R1
00000E17 28rr                  * 		BLT L285
         38rrrr                  
00000E1C                         L314:	; bb284
                                 ;    1265 	}
                                 ;    1266 	st_pre.move_type = MOVE_TYPE_ALINE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1266
00000E1C FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000E22 3C1801                  		MOV.B #01H, 08H[R1]
00000E25                         L315:	; bb284.split
                                 ;    1267 	st_pre.buffer_state = PREP_BUFFER_OWNED_BY_LOADER;	// signal that prep buffer is ready
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1267
00000E25 FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000E2B 3C1200                  		MOV.B #00H, 02H[R1]
00000E2E                         L316:	; bb284.split4
                                 ;    1268 	return (STAT_OK);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1268
00000E2E 3C0700                  		MOV.B #00H, 07H[R0]
00000E31                         L317:	; bb286
00000E31 C500070F                		MOV.B 07H[R0], 0FH[R0]
                                 ;    1269 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1269
00000E35 B389                    		MOVU.B 0FH[R0], R1
00000E37 3F6608                  		RTSD #20H, R6-R6
00000E3A                         _st_prep_null:
                                 		.STACK	_st_prep_null=4
                                 ;    1270 
                                 ;    1271 /*
                                 ;    1272  * st_prep_null() - Keeps the loader happy. Otherwise performs no action
                                 ;    1273  */
                                 ;    1274 
                                 ;    1275 void st_prep_null()
                                 ;    1276 {
                                 ;    1277 	st_pre.move_type = MOVE_TYPE_NULL;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1277
00000E3A FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000E40 3C1800                  		MOV.B #00H, 08H[R1]
00000E43                         L319:	; entry.split
                                 ;    1278 	st_pre.buffer_state = PREP_BUFFER_OWNED_BY_EXEC;	// signal that prep buffer is empty
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1278
00000E43 FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000E49 3C1201                  		MOV.B #01H, 02H[R1]
00000E4C 02                      		RTS
00000E4D                         _st_prep_command:
                                 		.STACK	_st_prep_command=8
                                 ;    1279 }
                                 ;    1280 
                                 ;    1281 /*
                                 ;    1282  * st_prep_command() - Stage command to execution
                                 ;    1283  */
                                 ;    1284 
                                 ;    1285 void st_prep_command(void *bf)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1285
00000E4D 6040                    		SUB #04H, R0
00000E4F E301                    		MOV.L R1, [R0]
                                 ;    1286 {
                                 ;    1287 	st_pre.move_type = MOVE_TYPE_COMMAND;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1287
00000E51 FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000E57 3C1803                  		MOV.B #03H, 08H[R1]
00000E5A                         L321:	; entry.split
                                 ;    1288 	st_pre.bf = (mpBuf_t *)bf;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1288
00000E5A FBE2rrrrrrrr            		MOV.L #_st_pre, R14
00000E60 E40E01                  		MOV.L [R0], 04H[R14]
00000E63                         L322:	; entry.split1
                                 ;    1289 	st_pre.buffer_state = PREP_BUFFER_OWNED_BY_LOADER;	// signal that prep buffer is ready
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1289
00000E63 FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000E69 3C1200                  		MOV.B #00H, 02H[R1]
00000E6C 6701                    		RTSD #04H
00000E6E                         _st_prep_dwell:
                                 		.STACK	_st_prep_dwell=12
                                 ;    1290 }
                                 ;    1291 
                                 ;    1292 /*
                                 ;    1293  * st_prep_dwell() 	 - Add a dwell to the move buffer
                                 ;    1294  */
                                 ;    1295 
                                 ;    1296 void st_prep_dwell(float microseconds)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1296
00000E6E 6080                    		SUB #08H, R0
00000E70 A009                    		MOV.L R1, 04H[R0]
                                 ;    1297 {
                                 ;    1298 	float seconds;
                                 ;    1299 	seconds = (microseconds/1000);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1299
00000E72 FD724100007A44          		FDIV #447A0000H, R1
00000E79 E301                    		MOV.L R1, [R0]
00000E7B                         L324:	; entry.split
                                 ;    1300 	st_pre.move_type = MOVE_TYPE_DWELL;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1300
00000E7B FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000E81 3C1802                  		MOV.B #02H, 08H[R1]
00000E84                         L325:	; entry.split1
                                 ;    1301 	st_pre.dda_period = _f_to_period(FREQUENCY_DWELL);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1301
00000E84 FBE2rrrrrrrr            		MOV.L #_st_pre, R14
00000E8A F9E9058025              		MOV.W #2580H, 0AH[R14]
00000E8F                         L326:	; entry.split2
                                 ;    1302 	st_pre.dda_ticks = (uint32_t)((microseconds/1000) * FREQUENCY_DWELL);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1302
00000E8F A809                    		MOV.L 04H[R0], R1
00000E91 FD724100007A44          		FDIV #447A0000H, R1
00000E98 FD723100401C46          		FMUL #461C4000H, R1
00000E9F FD72110000004F          		FCMP #4F000000H, R1
00000EA6 29rr                    		BLT L328
00000EA8                         L327:	; entry.split2
00000EA8 FD7221000080CF          		FADD #0CF800000H, R1
00000EAF                         L328:	; entry.split2
00000EAF FC9711                  		FTOI R1, R1
00000EB2 FB22rrrrrrrr            		MOV.L #_st_pre, R2
00000EB8 A0A9                    		MOV.L R1, 0CH[R2]
00000EBA                         L329:	; entry.split3
                                 ;    1303 	if (configFlags[MODOMAQUINA] == MODO_OXICORTE){
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1303
00000EBA FBE2rrrrrrrr            		MOV.L #_configFlags, R14
00000EC0 ECEE                    		MOV.L [R14], R14
00000EC2 611E                    		CMP #01H, R14
00000EC4 21rr                    		BNE L334
00000EC6                         L330:	; bb9
                                 ;    1304 		if (seconds == configVarOx[OX_CONFIG_TEMPO_AQUECIMENTO])
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1304
00000EC6 FBE2rrrrrrrr            		MOV.L #_configVarOx, R14
00000ECC EC01                    		MOV.L [R0], R1
00000ECE FC85E103                		FCMP 0CH[R14].L, R1
00000ED2 21rr                    		BNE L332
00000ED4                         L331:	; bb10
                                 ;    1305 			tempoDwell = OX_CONFIG_TEMPO_AQUECIMENTO;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1305
00000ED4 FBE2rrrrrrrr            		MOV.L #_tempoDwell, R14
00000EDA F8E603                  		MOV.L #00000003H, [R14]
00000EDD 2Err                 B  		BRA L334
00000EDF                         L332:	; bb12
                                 ;    1306 		else if(seconds == configVarOx[OX_CONFIG_TEMPO_PERFURACAO])
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1306
00000EDF FBE2rrrrrrrr            		MOV.L #_configVarOx, R14
00000EE5 EC01                    		MOV.L [R0], R1
00000EE7 FC85E104                		FCMP 10H[R14].L, R1
00000EEB 18                   S  		BNE L334
00000EEC                         L333:	; bb13
                                 ;    1307 			tempoDwell = OX_CONFIG_TEMPO_PERFURACAO;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1307
00000EEC FBE2rrrrrrrr            		MOV.L #_tempoDwell, R14
00000EF2 F8E604                  		MOV.L #00000004H, [R14]
00000EF5                         L334:	; bb29
                                 ;    1308 	}
                                 ;    1309 	// Seconds st_pre.dda_ticks = (uint32_t)((microseconds/1000000) * FREQUENCY_DWELL);
                                 ;    1310 	st_pre.buffer_state = PREP_BUFFER_OWNED_BY_LOADER;	// signal that prep buffer is ready
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1310
00000EF5 FB12rrrrrrrr            		MOV.L #_st_pre, R1
00000EFB 3C1200                  		MOV.B #00H, 02H[R1]
00000EFE 6702                    		RTSD #08H
00000F00                         __$_set_hw_microsteps:
                                 		.STACK	__$_set_hw_microsteps=8
                                 ;    1311 }
                                 ;    1312 
                                 ;    1313 /*
                                 ;    1314  * _set_hw_microsteps() - set microsteps in hardware
                                 ;    1315  *
                                 ;    1316  *	For now the microsteps is the same as the microsteps (1,2,4,8)
                                 ;    1317  *	This may change if microstep morphing is implemented.
                                 ;    1318  */
                                 ;    1319 
                                 ;    1320 static void _set_hw_microsteps(const uint8_t motor, const uint8_t microsteps)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1320
00000F00 6040                    		SUB #04H, R0
00000F02 8089                    		MOV.B R1, 03H[R0]
00000F04 8082                    		MOV.B R2, 02H[R0]
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1347
00000F06 6701                    		RTSD #04H
00000F08                         __$_get_motor:
                                 		.STACK	__$_get_motor=16
                                 ;    1321 {
                                 ;    1322 #ifdef __ARM
                                 ;    1323 	switch (motor) {
                                 ;    1324 		if (!motor_1.enable.isNull()) case (MOTOR_1): { motor_1.setMicrosteps(microsteps); break; }
                                 ;    1325 		if (!motor_2.enable.isNull()) case (MOTOR_2): { motor_2.setMicrosteps(microsteps); break; }
                                 ;    1326 		if (!motor_3.enable.isNull()) case (MOTOR_3): { motor_3.setMicrosteps(microsteps); break; }
                                 ;    1327 		if (!motor_4.enable.isNull()) case (MOTOR_4): { motor_4.setMicrosteps(microsteps); break; }
                                 ;    1328 		if (!motor_5.enable.isNull()) case (MOTOR_5): { motor_5.setMicrosteps(microsteps); break; }
                                 ;    1329 		if (!motor_6.enable.isNull()) case (MOTOR_6): { motor_6.setMicrosteps(microsteps); break; }
                                 ;    1330 	}
                                 ;    1331 #endif //__ARM
                                 ;    1332 #ifdef __AVR
                                 ;    1333 	if (microsteps == 8) {
                                 ;    1334 		hw.st_port[motor]->OUTSET = MICROSTEP_BIT_0_bm;
                                 ;    1335 		hw.st_port[motor]->OUTSET = MICROSTEP_BIT_1_bm;
                                 ;    1336 	} else if (microsteps == 4) {
                                 ;    1337 		hw.st_port[motor]->OUTCLR = MICROSTEP_BIT_0_bm;
                                 ;    1338 		hw.st_port[motor]->OUTSET = MICROSTEP_BIT_1_bm;
                                 ;    1339 	} else if (microsteps == 2) {
                                 ;    1340 		hw.st_port[motor]->OUTSET = MICROSTEP_BIT_0_bm;
                                 ;    1341 		hw.st_port[motor]->OUTCLR = MICROSTEP_BIT_1_bm;
                                 ;    1342 	} else if (microsteps == 1) {
                                 ;    1343 		hw.st_port[motor]->OUTCLR = MICROSTEP_BIT_0_bm;
                                 ;    1344 		hw.st_port[motor]->OUTCLR = MICROSTEP_BIT_1_bm;
                                 ;    1345 	}
                                 ;    1346 #endif // __AVR
                                 ;    1347 }
                                 ;    1348 
                                 ;    1349 
                                 ;    1350 /***********************************************************************************
                                 ;    1351  * CONFIGURATION AND INTERFACE FUNCTIONS
                                 ;    1352  * Functions to get and set variables from the cfgArray table
                                 ;    1353  ***********************************************************************************/
                                 ;    1354 
                                 ;    1355 /* HELPERS
                                 ;    1356  * _get_motor() - helper to return motor number as an index
                                 ;    1357  */
                                 ;    1358 
                                 ;    1359 static int8_t _get_motor(const nvObj_t *nv)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1359
00000F08 60C0                    		SUB #0CH, R0
00000F0A A081                    		MOV.L R1, 08H[R0]
                                 ;    1360 {
                                 ;    1361     return ((nv->group[0] ? nv->group[0] : nv->token[0]) - 0x31);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1361
00000F0C B512                    		MOVU.B 14H[R1], R2
00000F0E 6102                    		CMP #00H, R2
00000F10 10                   S  		BEQ L338
00000F11                         L337:	; bb
00000F11 B511                    		MOVU.B 14H[R1], R1
00000F13 E301                    		MOV.L R1, [R0]
00000F15 08                   S  		BRA L339
00000F16                         L338:	; bb16
00000F16 B611                    		MOVU.B 18H[R1], R1
00000F18 E301                    		MOV.L R1, [R0]
00000F1A                         L339:	; bb23
00000F1A EC01                    		MOV.L [R0], R1
00000F1C 7111CF                  		ADD #0FFFFFFCFH, R1
00000F1F 8189                    		MOV.B R1, 07H[R0]
                                 ;    1362 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1362
00000F21 8989                    		MOV.B 07H[R0], R1
00000F23 6703                    		RTSD #0CH
00000F25                         __$_set_motor_steps_per_unit:
                                 		.STACK	__$_set_motor_steps_per_unit=12
                                 ;    1363 
                                 ;    1364 /*
                                 ;    1365  * _set_motor_steps_per_unit() - what it says
                                 ;    1366  * This function will need to be rethought if microstep morphing is implemented
                                 ;    1367  */
                                 ;    1368 
                                 ;    1369 static void _set_motor_steps_per_unit(nvObj_t *nv)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1369
00000F25 6080                    		SUB #08H, R0
00000F27 A009                    		MOV.L R1, 04H[R0]
                                 ;    1370 {
                                 ;    1371 	uint8_t m = _get_motor(nv);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1371
00000F29 39rrrr               W  		BSR __$_get_motor
00000F2C 8089                    		MOV.B R1, 03H[R0]
00000F2E                         L341:	; entry.split
                                 ;    1372 
                                 ;    1373 //	st_cfg.mot[m].units_per_step = (st_cfg.mot[m].travel_rev * st_cfg.mot[m].step_angle) / (360 * st_cfg.mot[m].microsteps); // unused
                                 ;    1374     st_cfg.mot[m].steps_per_unit = (360 * st_cfg.mot[m].microsteps) / (st_cfg.mot[m].travel_rev * st_cfg.mot[m].step_angle);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1374
00000F2E B089                    		MOVU.B 03H[R0], R1
00000F30 751124                  		MUL #24H, R1
00000F33 FB22rrrrrrrr            		MOV.L #_st_cfg, R2
00000F39 4B12                    		ADD R1, R2
00000F3B A9A1                    		MOV.L 18H[R2], R1
00000F3D FC8D2105                		FMUL 14H[R2].L, R1
00000F41 A8A3                    		MOV.L 08H[R2], R3
00000F43 76136801                		MUL #0168H, R3
00000F47 7DF3                    		BTST #1FH, R3
00000F49 20rr                    		BEQ L343
00000F4B                         L342:	; entry.split
00000F4B FD813E                  		SHLR #01H, R3, R14
00000F4E 6413                    		AND #01H, R3
00000F50 57E3                    		OR R14, R3
00000F52 FC4733                  		ITOF R3, R3
00000F55 FC8B33                  		FADD R3, R3
00000F58 08                   S  		BRA L344
00000F59                         L343:	; entry.split
00000F59 FC4733                  		ITOF R3, R3
00000F5C                         L344:	; entry.split
00000F5C FC9313                  		FDIV R1, R3
00000F5F A1AB                    		MOV.L R3, 1CH[R2]
00000F61                         L345:	; entry.split1
                                 ;    1375 	st_reset();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1375
00000F61 39rrrr               W  		BSR _st_reset
00000F64 6702                    		RTSD #08H
00000F66                         _st_set_sa:
                                 		.STACK	_st_set_sa=12
                                 ;    1376 }
                                 ;    1377 
                                 ;    1378 /* PER-MOTOR FUNCTIONS
                                 ;    1379  * st_set_sa() - set motor step angle
                                 ;    1380  * st_set_tr() - set travel per motor revolution
                                 ;    1381  * st_set_mi() - set motor microsteps
                                 ;    1382  * st_set_pm() - set motor power mode
                                 ;    1383  * st_set_pl() - set motor power level
                                 ;    1384  */
                                 ;    1385 
                                 ;    1386 stat_t st_set_sa(nvObj_t *nv)			// motor step angle
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1386
00000F66 6080                    		SUB #08H, R0
00000F68 A009                    		MOV.L R1, 04H[R0]
                                 ;    1387 {
                                 ;    1388 	set_flt(nv);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1388
00000F6A 05rrrrrr             A  		BSR _set_flt
00000F6E                         L347:	; entry.split
                                 ;    1389 	_set_motor_steps_per_unit(nv);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1389
00000F6E A809                    		MOV.L 04H[R0], R1
00000F70 39rrrr               W  		BSR __$_set_motor_steps_per_unit
00000F73                         L348:	; entry.split1
                                 ;    1390 	return(STAT_OK);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1390
00000F73 3C0300                  		MOV.B #00H, 03H[R0]
00000F76 B089                    		MOVU.B 03H[R0], R1
00000F78                         L349:	; entry.split2
                                 ;    1391 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1391
00000F78 5B11                    		MOVU.B R1, R1
00000F7A 6702                    		RTSD #08H
00000F7C                         _st_set_tr:
                                 		.STACK	_st_set_tr=12
                                 ;    1392 
                                 ;    1393 stat_t st_set_tr(nvObj_t *nv)			// motor travel per revolution
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1393
00000F7C 6080                    		SUB #08H, R0
00000F7E A009                    		MOV.L R1, 04H[R0]
                                 ;    1394 {
                                 ;    1395 	set_flu(nv);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1395
00000F80 05rrrrrr             A  		BSR _set_flu
00000F84                         L351:	; entry.split
                                 ;    1396 	_set_motor_steps_per_unit(nv);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1396
00000F84 A809                    		MOV.L 04H[R0], R1
00000F86 39rrrr               W  		BSR __$_set_motor_steps_per_unit
00000F89                         L352:	; entry.split1
                                 ;    1397 	return(STAT_OK);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1397
00000F89 3C0300                  		MOV.B #00H, 03H[R0]
00000F8C B089                    		MOVU.B 03H[R0], R1
00000F8E                         L353:	; entry.split2
                                 ;    1398 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1398
00000F8E 5B11                    		MOVU.B R1, R1
00000F90 6702                    		RTSD #08H
00000F92                         _st_set_mi:
                                 		.STACK	_st_set_mi=20
                                 ;    1399 
                                 ;    1400 stat_t st_set_mi(nvObj_t *nv)			// motor microsteps
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1400
00000F92 7100F0                  		ADD #0FFFFFFF0H, R0
00000F95 A089                    		MOV.L R1, 0CH[R0]
                                 ;    1401 {
                                 ;    1402     uint32_t mi = (uint32_t)nv->value;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1402
00000F97 A911                    		MOV.L 10H[R1], R1
00000F99 FD72110000004F          		FCMP #4F000000H, R1
00000FA0 29rr                    		BLT L356
00000FA2                         L355:	; entry
00000FA2 FD7221000080CF          		FADD #0CF800000H, R1
00000FA9                         L356:	; entry
00000FA9 FC9711                  		FTOI R1, R1
00000FAC A009                    		MOV.L R1, 04H[R0]
00000FAE                         L357:	; entry.split
                                 ;    1403 	if ((mi != 1) && (mi != 2) && (mi != 4) && (mi != 8)) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1403
00000FAE A809                    		MOV.L 04H[R0], R1
00000FB0 6111                    		CMP #01H, R1
00000FB2 21rr                    		BNE L359
00000FB4 2Err                 B  		BRA L361
00000FB6                         L358:	; bb7
                                 ;    1404 		nv_add_conditional_message((const char_t *)"*** WARNING *** Setting non-standard microstep value");
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1404
00000FB6 FB12rrrrrrrr            		MOV.L #_L10, R1
00000FBC 05rrrrrr             A  		BSR _nv_add_conditional_message
00000FC0 2Err                 B  		BRA L371
00000FC2                         L359:	; bb12
00000FC2 A809                    		MOV.L 04H[R0], R1
00000FC4 6121                    		CMP #02H, R1
00000FC6 10                   S  		BEQ L361
00000FC7                         L360:	; bb16
00000FC7 F80601                  		MOV.L #00000001H, [R0]
00000FCA 08                   S  		BRA L362
00000FCB                         L361:	; bb17
00000FCB F80600                  		MOV.L #00000000H, [R0]
00000FCE                         L362:	; bb18
00000FCE EC01                    		MOV.L [R0], R1
00000FD0 6101                    		CMP #00H, R1
00000FD2 10                   S  		BEQ L365
00000FD3                         L363:	; bb21
00000FD3 A809                    		MOV.L 04H[R0], R1
00000FD5 6141                    		CMP #04H, R1
00000FD7 10                   S  		BEQ L365
00000FD8                         L364:	; bb25
00000FD8 F80601                  		MOV.L #00000001H, [R0]
00000FDB 08                   S  		BRA L366
00000FDC                         L365:	; bb26
00000FDC F80600                  		MOV.L #00000000H, [R0]
00000FDF                         L366:	; bb27
00000FDF EC01                    		MOV.L [R0], R1
00000FE1 6101                    		CMP #00H, R1
00000FE3 10                   S  		BEQ L369
00000FE4                         L367:	; bb31
00000FE4 A809                    		MOV.L 04H[R0], R1
00000FE6 6181                    		CMP #08H, R1
00000FE8 10                   S  		BEQ L369
00000FE9                         L368:	; bb35
00000FE9 F80601                  		MOV.L #00000001H, [R0]
00000FEC 08                   S  		BRA L370
00000FED                         L369:	; bb36
00000FED F80600                  		MOV.L #00000000H, [R0]
00000FF0                         L370:	; bb37
00000FF0 EC01                    		MOV.L [R0], R1
00000FF2 6101                    		CMP #00H, R1
00000FF4 21rr                    		BNE L358
00000FF6                         L371:	; bb42
                                 ;    1405 	}
                                 ;    1406 	set_int(nv);						// set it anyway, even if it's unsupported. It could also be > 255
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1406
00000FF6 A889                    		MOV.L 0CH[R0], R1
00000FF8 05rrrrrr             A  		BSR _set_int
00000FFC                         L372:	; bb42.split
                                 ;    1407 	_set_motor_steps_per_unit(nv);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1407
00000FFC A889                    		MOV.L 0CH[R0], R1
00000FFE 39rrrr               W  		BSR __$_set_motor_steps_per_unit
00001001                         L373:	; bb42.split1
                                 ;    1408 	_set_hw_microsteps(_get_motor(nv), (uint8_t)nv->value);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1408
00001001 A889                    		MOV.L 0CH[R0], R1
00001003 39rrrr               W  		BSR __$_get_motor
00001006 A88A                    		MOV.L 0CH[R0], R2
00001008 A922                    		MOV.L 10H[R2], R2
0000100A FD72120000004F          		FCMP #4F000000H, R2
00001011 29rr                    		BLT L375
00001013                         L374:	; bb42.split1
00001013 FD7222000080CF          		FADD #0CF800000H, R2
0000101A                         L375:	; bb42.split1
0000101A FC972E                  		FTOI R2, R14
0000101D 5BE2                    		MOVU.B R14, R2
0000101F 5B11                    		MOVU.B R1, R1
00001021 39rrrr               W  		BSR __$_set_hw_microsteps
00001024                         L376:	; bb42.split2
                                 ;    1409 	return (STAT_OK);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1409
00001024 3C0B00                  		MOV.B #00H, 0BH[R0]
00001027 B289                    		MOVU.B 0BH[R0], R1
00001029                         L377:	; bb42.split3
                                 ;    1410 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1410
00001029 5B11                    		MOVU.B R1, R1
0000102B 6704                    		RTSD #10H
0000102D                         _st_set_pm:
                                 		.STACK	_st_set_pm=12
                                 ;    1411 
                                 ;    1412 stat_t st_set_pm(nvObj_t *nv)			// motor power mode
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1412
0000102D 6080                    		SUB #08H, R0
0000102F A009                    		MOV.L R1, 04H[R0]
                                 ;    1413 {
                                 ;    1414 	if ((uint8_t)nv->value >= MOTOR_POWER_MODE_MAX_VALUE)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1414
00001031 A911                    		MOV.L 10H[R1], R1
00001033 FD72110000004F          		FCMP #4F000000H, R1
0000103A 29rr                    		BLT L380
0000103C                         L379:	; entry
0000103C FD7221000080CF          		FADD #0CF800000H, R1
00001043                         L380:	; entry
00001043 FC971E                  		FTOI R1, R14
00001046 5BEE                    		MOVU.B R14, R14
00001048 614E                    		CMP #04H, R14
0000104A 29rr                    		BLT L382
0000104C                         L381:	; bb2
                                 ;    1415         return (STAT_INPUT_VALUE_RANGE_ERROR);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1415
0000104C 3C026E                  		MOV.B #6EH, 02H[R0]
0000104F 08                   S  		BRA L384
00001050                         L382:	; bb11
                                 ;    1416 	set_ui8(nv);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1416
00001050 A809                    		MOV.L 04H[R0], R1
00001052 05rrrrrr             A  		BSR _set_ui8
00001056                         L383:	; bb11.split
                                 ;    1417 	return (STAT_OK);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1417
00001056 3C0200                  		MOV.B #00H, 02H[R0]
00001059                         L384:	; bb15
00001059 C5000203                		MOV.B 02H[R0], 03H[R0]
                                 ;    1418 	// NOTE: The motor power callback makes these settings take effect immediately
                                 ;    1419 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1419
0000105D B089                    		MOVU.B 03H[R0], R1
0000105F 6702                    		RTSD #08H
00001061                         _st_set_pl:
                                 		.STACK	_st_set_pl=12
                                 ;    1420 
                                 ;    1421 /*
                                 ;    1422  * st_set_pl() - set motor power level
                                 ;    1423  *
                                 ;    1424  *	Input value may vary from 0.000 to 1.000 The setting is scaled to allowable PWM range.
                                 ;    1425  *	This function sets both the scaled and dynamic power levels, and applies the
                                 ;    1426  *	scaled value to the vref.
                                 ;    1427  */
                                 ;    1428 stat_t st_set_pl(nvObj_t *nv)	// motor power level
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1428
00001061 6080                    		SUB #08H, R0
00001063 A009                    		MOV.L R1, 04H[R0]
                                 ;    1429 {
                                 ;    1430 #ifdef __ARM
                                 ;    1431 	if (nv->value < (float)0.0) nv->value = 0.0;
                                 ;    1432 	if (nv->value > (float)1.0) {
                                 ;    1433 		if (nv->value > (float)100) nv->value = 1;
                                 ;    1434  		nv->value /= 100;		// accommodate old 0-100 inputs
                                 ;    1435 	}
                                 ;    1436 	set_flt(nv);	// set power_setting value in the motor config struct (st)
                                 ;    1437 
                                 ;    1438 	uint8_t m = _get_motor(nv);
                                 ;    1439 	st_cfg.mot[m].power_level_scaled = (nv->value * POWER_LEVEL_SCALE_FACTOR);
                                 ;    1440 	st_run.mot[m].power_level_dynamic = (st_cfg.mot[m].power_level_scaled);
                                 ;    1441 	_set_motor_power_level(m, st_cfg.mot[m].power_level_scaled);
                                 ;    1442 #endif
                                 ;    1443 	return(STAT_OK);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1443
00001065 3C0300                  		MOV.B #00H, 03H[R0]
00001068 B089                    		MOVU.B 03H[R0], R1
0000106A                         L386:	; entry.split
                                 ;    1444 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1444
0000106A 5B11                    		MOVU.B R1, R1
0000106C 6702                    		RTSD #08H
0000106E                         _st_get_pwr:
                                 		.STACK	_st_get_pwr=16
                                 ;    1445 
                                 ;    1446 /*
                                 ;    1447  * st_get_pwr()	- get motor enable power state
                                 ;    1448  */
                                 ;    1449 stat_t st_get_pwr(nvObj_t *nv)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1449
0000106E 7EA6                    		PUSH.L R6
00001070 6080                    		SUB #08H, R0
00001072 EF16                    		MOV.L R1, R6
00001074 A00E                    		MOV.L R6, 04H[R0]
                                 ;    1450 {
                                 ;    1451 	nv->value = _motor_is_enabled(_get_motor(nv));
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1451
00001076 39rrrr               W  		BSR __$_get_motor
00001079 5B11                    		MOVU.B R1, R1
0000107B 39rrrr               W  		BSR __$_motor_is_enabled
0000107E FC4711                  		ITOF R1, R1
00001081 A161                    		MOV.L R1, 10H[R6]
00001083                         L388:	; entry.split
                                 ;    1452 	nv->valuetype = TYPE_INTEGER;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1452
00001083 A809                    		MOV.L 04H[R0], R1
00001085 3C1B02                  		MOV.B #02H, 0BH[R1]
00001088                         L389:	; entry.split1
                                 ;    1453 	return (STAT_OK);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1453
00001088 3C0300                  		MOV.B #00H, 03H[R0]
0000108B B089                    		MOVU.B 03H[R0], R1
0000108D                         L390:	; entry.split2
                                 ;    1454 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1454
0000108D 5B11                    		MOVU.B R1, R1
0000108F 3F6603                  		RTSD #0CH, R6-R6
00001092                         _st_set_mt:
                                 		.STACK	_st_set_mt=12
                                 ;    1455 
                                 ;    1456 /* GLOBAL FUNCTIONS (SYSTEM LEVEL)
                                 ;    1457  *
                                 ;    1458  * st_set_mt() - set motor timeout in seconds
                                 ;    1459  * st_set_md() - disable motor power
                                 ;    1460  * st_set_me() - enable motor power
                                 ;    1461  *
                                 ;    1462  * Calling me or md with NULL will enable or disable all motors
                                 ;    1463  * Setting a value of 0 will enable or disable all motors
                                 ;    1464  * Setting a value from 1 to MOTORS will enable or disable that motor only
                                 ;    1465  */
                                 ;    1466 
                                 ;    1467 stat_t st_set_mt(nvObj_t *nv)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1467
00001092 6080                    		SUB #08H, R0
00001094 A009                    		MOV.L R1, 04H[R0]
                                 ;    1468 {
                                 ;    1469 	st_cfg.motor_power_timeout = fminf(MOTOR_TIMEOUT_SECONDS_MAX, fmaxf(nv->value, MOTOR_TIMEOUT_SECONDS_MIN));
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1469
00001096 A911                    		MOV.L 10H[R1], R1
00001098 FB22CDCCCC3D            		MOV.L #3DCCCCCDH, R2
0000109E 05rrrrrr             A  		BSR _fmaxf
000010A2 EF12                    		MOV.L R1, R2
000010A4 FB126E12834A            		MOV.L #4A83126EH, R1
000010AA 05rrrrrr             A  		BSR _fminf
000010AE FBE2rrrrrrrr            		MOV.L #_st_cfg, R14
000010B4 E3E1                    		MOV.L R1, [R14]
000010B6                         L392:	; entry.split
                                 ;    1470 	return (STAT_OK);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1470
000010B6 3C0300                  		MOV.B #00H, 03H[R0]
000010B9 B089                    		MOVU.B 03H[R0], R1
000010BB                         L393:	; entry.split1
                                 ;    1471 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1471
000010BB 5B11                    		MOVU.B R1, R1
000010BD 6702                    		RTSD #08H
000010BF                         _st_set_md:
                                 		.STACK	_st_set_md=16
                                 ;    1472 
                                 ;    1473 stat_t st_set_md(nvObj_t *nv)	// Make sure this function is not part of initialization --> f00
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1473
000010BF 60C0                    		SUB #0CH, R0
000010C1 A081                    		MOV.L R1, 08H[R0]
                                 ;    1474 {
                                 ;    1475 	if (((uint8_t)nv->value == 0) || (nv->valuetype == TYPE_NULL)) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1475
000010C3 A911                    		MOV.L 10H[R1], R1
000010C5 FD72110000004F          		FCMP #4F000000H, R1
000010CC 29rr                    		BLT L396
000010CE                         L395:	; entry
000010CE FD7221000080CF          		FADD #0CF800000H, R1
000010D5                         L396:	; entry
000010D5 FC971E                  		FTOI R1, R14
000010D8 5BEE                    		MOVU.B R14, R14
000010DA 610E                    		CMP #00H, R14
000010DC 20rr                    		BEQ L405
000010DE 2Err                 B  		BRA L404
000010E0                         L397:	; bb3
                                 ;    1476 		st_deenergize_motors();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1476
000010E0 39rrrr               W  		BSR _st_deenergize_motors
000010E3 2Err                 B  		BRA L408
000010E5                         L398:	; bb4
                                 ;    1477 	} else {
                                 ;    1478         uint8_t motor = (uint8_t)nv->value;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1478
000010E5 A881                    		MOV.L 08H[R0], R1
000010E7 A911                    		MOV.L 10H[R1], R1
000010E9 FD72110000004F          		FCMP #4F000000H, R1
000010F0 29rr                    		BLT L400
000010F2                         L399:	; bb4
000010F2 FD7221000080CF          		FADD #0CF800000H, R1
000010F9                         L400:	; bb4
000010F9 FC9711                  		FTOI R1, R1
000010FC 8181                    		MOV.B R1, 06H[R0]
000010FE                         L401:	; bb4.split
                                 ;    1479         if (motor > MOTORS) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1479
000010FE B181                    		MOVU.B 06H[R0], R1
00001100 6151                    		CMP #05H, R1
00001102 29rr                    		BLT L403
00001104                         L402:	; bb10
                                 ;    1480             return (STAT_INPUT_VALUE_RANGE_ERROR);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1480
00001104 3C056E                  		MOV.B #6EH, 05H[R0]
00001107 2Err                 B  		BRA L409
00001109                         L403:	; bb16
                                 ;    1481         }
                                 ;    1482         _deenergize_motor(motor-1);     // adjust so that motor 1 is actually 0 (etc)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1482
00001109 B181                    		MOVU.B 06H[R0], R1
0000110B 6011                    		SUB #01H, R1
0000110D 5B11                    		MOVU.B R1, R1
0000110F 39rrrr               W  		BSR __$_deenergize_motor
00001112 2Err                 B  		BRA L408
00001114                         L404:	; bb28
00001114 A881                    		MOV.L 08H[R0], R1
00001116 8A99                    		MOV.B 0BH[R1], R1
00001118 6101                    		CMP #00H, R1
0000111A 18                   S  		BNE L406
0000111B                         L405:	; bb35
0000111B F80601                  		MOV.L #00000001H, [R0]
0000111E 08                   S  		BRA L407
0000111F                         L406:	; bb36
0000111F F80600                  		MOV.L #00000000H, [R0]
00001122                         L407:	; bb37
00001122 EC01                    		MOV.L [R0], R1
00001124 6101                    		CMP #00H, R1
00001126 21rr                    		BNE L397
00001128 2Err                 B  		BRA L398
0000112A                         L408:	; bb42
                                 ;    1483 	}
                                 ;    1484 	return (STAT_OK);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1484
0000112A 3C0500                  		MOV.B #00H, 05H[R0]
0000112D                         L409:	; bb44
0000112D C5000507                		MOV.B 05H[R0], 07H[R0]
                                 ;    1485 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1485
00001131 B189                    		MOVU.B 07H[R0], R1
00001133 6703                    		RTSD #0CH
00001135                         _st_set_me:
                                 		.STACK	_st_set_me=16
                                 ;    1486 
                                 ;    1487 stat_t st_set_me(nvObj_t *nv)	// Make sure this function is not part of initialization --> f00
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1487
00001135 60C0                    		SUB #0CH, R0
00001137 A081                    		MOV.L R1, 08H[R0]
                                 ;    1488 {
                                 ;    1489 	if (((uint8_t)nv->value == 0) || (nv->valuetype == TYPE_NULL)) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1489
00001139 A911                    		MOV.L 10H[R1], R1
0000113B FD72110000004F          		FCMP #4F000000H, R1
00001142 29rr                    		BLT L412
00001144                         L411:	; entry
00001144 FD7221000080CF          		FADD #0CF800000H, R1
0000114B                         L412:	; entry
0000114B FC971E                  		FTOI R1, R14
0000114E 5BEE                    		MOVU.B R14, R14
00001150 610E                    		CMP #00H, R14
00001152 20rr                    		BEQ L421
00001154 2Err                 B  		BRA L420
00001156                         L413:	; bb3
                                 ;    1490 		st_energize_motors();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1490
00001156 39rrrr               W  		BSR _st_energize_motors
00001159 2Err                 B  		BRA L424
0000115B                         L414:	; bb4
                                 ;    1491 	} else {
                                 ;    1492         uint8_t motor = (uint8_t)nv->value;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1492
0000115B A881                    		MOV.L 08H[R0], R1
0000115D A911                    		MOV.L 10H[R1], R1
0000115F FD72110000004F          		FCMP #4F000000H, R1
00001166 29rr                    		BLT L416
00001168                         L415:	; bb4
00001168 FD7221000080CF          		FADD #0CF800000H, R1
0000116F                         L416:	; bb4
0000116F FC9711                  		FTOI R1, R1
00001172 8181                    		MOV.B R1, 06H[R0]
00001174                         L417:	; bb4.split
                                 ;    1493         if (motor > MOTORS) {
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1493
00001174 B181                    		MOVU.B 06H[R0], R1
00001176 6151                    		CMP #05H, R1
00001178 29rr                    		BLT L419
0000117A                         L418:	; bb10
                                 ;    1494             return (STAT_INPUT_VALUE_RANGE_ERROR);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1494
0000117A 3C056E                  		MOV.B #6EH, 05H[R0]
0000117D 2Err                 B  		BRA L425
0000117F                         L419:	; bb16
                                 ;    1495         }
                                 ;    1496 		_energize_motor(motor-1);     // adjust so that motor 1 is actually 0 (etc)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1496
0000117F B181                    		MOVU.B 06H[R0], R1
00001181 6011                    		SUB #01H, R1
00001183 5B11                    		MOVU.B R1, R1
00001185 39rrrr               W  		BSR __$_energize_motor
00001188 2Err                 B  		BRA L424
0000118A                         L420:	; bb28
0000118A A881                    		MOV.L 08H[R0], R1
0000118C 8A99                    		MOV.B 0BH[R1], R1
0000118E 6101                    		CMP #00H, R1
00001190 18                   S  		BNE L422
00001191                         L421:	; bb35
00001191 F80601                  		MOV.L #00000001H, [R0]
00001194 08                   S  		BRA L423
00001195                         L422:	; bb36
00001195 F80600                  		MOV.L #00000000H, [R0]
00001198                         L423:	; bb37
00001198 EC01                    		MOV.L [R0], R1
0000119A 6101                    		CMP #00H, R1
0000119C 21rr                    		BNE L413
0000119E 2Err                 B  		BRA L414
000011A0                         L424:	; bb42
                                 ;    1497 	}
                                 ;    1498 	return (STAT_OK);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1498
000011A0 3C0500                  		MOV.B #00H, 05H[R0]
000011A3                         L425:	; bb44
000011A3 C5000507                		MOV.B 05H[R0], 07H[R0]
                                 ;    1499 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1499
000011A7 B189                    		MOVU.B 07H[R0], R1
000011A9 6703                    		RTSD #0CH
000011AB                         _st_command_dwell:
                                 		.STACK	_st_command_dwell=8
                                 ;    1500 
                                 ;    1501 void st_command_dwell(st_dwell_command com)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1501
000011AB 6040                    		SUB #04H, R0
000011AD E301                    		MOV.L R1, [R0]
                                 ;    1502 {
                                 ;    1503 	switch(com)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1503
000011AF 6141                    		CMP #04H, R1
000011B1 20rr                    		BEQ L435
000011B3                         L427:	; entry
000011B3 6111                    		CMP #01H, R1
000011B5 20rr                    		BEQ L432
000011B7                         L428:	; entry
000011B7 6121                    		CMP #02H, R1
000011B9 20rr                    		BEQ L433
000011BB                         L429:	; entry
000011BB 6131                    		CMP #03H, R1
000011BD 20rr                    		BEQ L434
000011BF                         L430:	; entry
000011BF 6101                    		CMP #00H, R1
000011C1 21rr                    		BNE L436
000011C3                         L431:	; bb
                                 ;    1504 	{
                                 ;    1505 		case DWELL_START: 	R_CMT_Control(timerDwell,CMT_RX_CMD_RESTART,0);	break;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1505
000011C3 FBE2rrrrrrrr            		MOV.L #_timerDwell, R14
000011C9 ECE1                    		MOV.L [R14], R1
000011CB 6603                    		MOV.L #00000000H, R3
000011CD 6622                    		MOV.L #00000002H, R2
000011CF 05rrrrrr             A  		BSR _R_CMT_Control
000011D3 6701                    		RTSD #04H
000011D5                         L432:	; bb4
                                 ;    1506 		case DWELL_PAUSE: 	R_CMT_Control(timerDwell,CMT_RX_CMD_PAUSE,0);	break;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1506
000011D5 FBE2rrrrrrrr            		MOV.L #_timerDwell, R14
000011DB ECE1                    		MOV.L [R14], R1
000011DD 6603                    		MOV.L #00000000H, R3
000011DF 6612                    		MOV.L #00000001H, R2
000011E1 05rrrrrr             A  		BSR _R_CMT_Control
000011E5 6701                    		RTSD #04H
000011E7                         L433:	; bb7
                                 ;    1507 		case DWELL_RESTART: R_CMT_Control(timerDwell,CMT_RX_CMD_RESUME,0);  break;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1507
000011E7 FBE2rrrrrrrr            		MOV.L #_timerDwell, R14
000011ED ECE1                    		MOV.L [R14], R1
000011EF 6603                    		MOV.L #00000000H, R3
000011F1 6632                    		MOV.L #00000003H, R2
000011F3 05rrrrrr             A  		BSR _R_CMT_Control
000011F7 6701                    		RTSD #04H
000011F9                         L434:	; bb10
                                 ;    1508 		case DWELL_EXIT: 	st_run.dda_ticks_downcount = 1; 				break;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1508
000011F9 FB12rrrrrrrr            		MOV.L #__$st_run, R1
000011FF 3E1101                  		MOV.L #00000001H, 04H[R1]
00001202 6701                    		RTSD #04H
00001204                         L435:	; bb11
                                 ;    1509 		case DWELL_ZERO: 	st_run.dda_ticks_downcount = 0; 				break;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1509
00001204 FB12rrrrrrrr            		MOV.L #__$st_run, R1
0000120A 3E1100                  		MOV.L #00000000H, 04H[R1]
0000120D 6701                    		RTSD #04H
0000120F                         L436:	; return
                                 ;    1510 		default: break;
                                 ;    1511 	}
                                 ;    1512 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1512
0000120F 6701                    		RTSD #04H
00001211                         _st_get_dwell_elapsed_time:
                                 		.STACK	_st_get_dwell_elapsed_time=8
                                 ;    1513 
                                 ;    1514 float st_get_dwell_elapsed_time(void)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1514
00001211 6040                    		SUB #04H, R0
                                 ;    1515 {
                                 ;    1516 	return st_run.dda_ticks_downcount/FREQUENCY_DWELL;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1516
00001213 FB12rrrrrrrr            		MOV.L #__$st_run, R1
00001219 A819                    		MOV.L 04H[R1], R1
0000121B 7DF1                    		BTST #1FH, R1
0000121D 20rr                    		BEQ L439
0000121F                         L438:	; entry
0000121F FD811E                  		SHLR #01H, R1, R14
00001222 6411                    		AND #01H, R1
00001224 57E1                    		OR R14, R1
00001226 FC4711                  		ITOF R1, R1
00001229 FC8B11                  		FADD R1, R1
0000122C 08                   S  		BRA L440
0000122D                         L439:	; entry
0000122D FC4711                  		ITOF R1, R1
00001230                         L440:	; entry
00001230 FD724100401C46          		FDIV #461C4000H, R1
00001237 E301                    		MOV.L R1, [R0]
00001239                         L441:	; entry.split
                                 ;    1517 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1517
00001239 6701                    		RTSD #04H
0000123B                         _st_set_dwell_elapsed_time:
                                 		.STACK	_st_set_dwell_elapsed_time=12
                                 ;    1518 
                                 ;    1519 void st_set_dwell_elapsed_time(float time)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1519
0000123B 6080                    		SUB #08H, R0
0000123D A009                    		MOV.L R1, 04H[R0]
                                 ;    1520 {
                                 ;    1521 	float timeElapsed;
                                 ;    1522 	timeElapsed = (int32_t)st_run.dda_ticks_downcount + (int32_t)time*FREQUENCY_DWELL;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1522
0000123F FBE2rrrrrrrr            		MOV.L #__$st_run, R14
00001245 06A111E201              		ITOF 04H[R14].L, R2
0000124A FC971E                  		FTOI R1, R14
0000124D FC47EE                  		ITOF R14, R14
00001250 FD723E00401C46          		FMUL #461C4000H, R14
00001257 FC8BE2                  		FADD R14, R2
0000125A E302                    		MOV.L R2, [R0]
0000125C                         L443:	; entry.split
0000125C 660E                    		MOV.L #00000000H, R14
                                 ;    1523 	if(timeElapsed <= 0){
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1523
0000125E FC840E                  		FCMP [R0].L, R14
00001261 29rr                    		BLT L445
00001263                         L444:	; bb9
                                 ;    1524 		st_run.dda_ticks_downcount = 1;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1524
00001263 FB12rrrrrrrr            		MOV.L #__$st_run, R1
00001269 3E1101                  		MOV.L #00000001H, 04H[R1]
0000126C 6702                    		RTSD #08H
0000126E                         L445:	; bb10
                                 ;    1525 	}
                                 ;    1526 	else
                                 ;    1527 	{
                                 ;    1528 		st_run.dda_ticks_downcount = timeElapsed;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1528
0000126E EC01                    		MOV.L [R0], R1
00001270 FD72110000004F          		FCMP #4F000000H, R1
00001277 29rr                    		BLT L447
00001279                         L446:	; bb10
00001279 FD7221000080CF          		FADD #0CF800000H, R1
00001280                         L447:	; bb10
00001280 FC9711                  		FTOI R1, R1
00001283 FB22rrrrrrrr            		MOV.L #__$st_run, R2
00001289 A029                    		MOV.L R1, 04H[R2]
0000128B 6702                    		RTSD #08H
0000128D                         _st_print_mt:
                                 		.STACK	_st_print_mt=8
                                 ;    1529 	}
                                 ;    1530 }
                                 ;    1531 
                                 ;    1532 
                                 ;    1533 
                                 ;    1534 /***********************************************************************************
                                 ;    1535  * TEXT MODE SUPPORT
                                 ;    1536  * Functions to print variables from the cfgArray table
                                 ;    1537  ***********************************************************************************/
                                 ;    1538 
                                 ;    1539 #ifdef __TEXT_MODE
                                 ;    1540 
                                 ;    1541 static const char msg_units0[] PROGMEM = " in";	// used by generic print functions
                                 ;    1542 static const char msg_units1[] PROGMEM = " mm";
                                 ;    1543 static const char msg_units2[] PROGMEM = " deg";
                                 ;    1544 static const char *const msg_units[] PROGMEM = { msg_units0, msg_units1, msg_units2 };
                                 ;    1545 #define DEGREE_INDEX 2
                                 ;    1546 
                                 ;    1547 static const char fmt_me[] PROGMEM = "motors energized\n";
                                 ;    1548 static const char fmt_md[] PROGMEM = "motors de-energized\n";
                                 ;    1549 static const char fmt_mt[] PROGMEM = "[mt]  motor idle timeout%14.2f Sec\n";
                                 ;    1550 static const char fmt_0ma[] PROGMEM = "[%s%s] m%s map to axis%15d [0=X,1=Y,2=Z...]\n";
                                 ;    1551 static const char fmt_0sa[] PROGMEM = "[%s%s] m%s step angle%20.3f%s\n";
                                 ;    1552 static const char fmt_0tr[] PROGMEM = "[%s%s] m%s travel per revolution%10.4f%s\n";
                                 ;    1553 static const char fmt_0mi[] PROGMEM = "[%s%s] m%s microsteps%16d [1,2,4,8]\n";
                                 ;    1554 static const char fmt_0po[] PROGMEM = "[%s%s] m%s polarity%18d [0=normal,1=reverse]\n";
                                 ;    1555 static const char fmt_0pm[] PROGMEM = "[%s%s] m%s power management%10d [0=disabled,1=always on,2=in cycle,3=when moving]\n";
                                 ;    1556 static const char fmt_0pl[] PROGMEM = "[%s%s] m%s motor power level%13.3f [0.000=minimum, 1.000=maximum]\n";
                                 ;    1557 static const char fmt_pwr[] PROGMEM = "Motor %c power enabled state:%2.0f\n";
                                 ;    1558 
                                 ;    1559 void st_print_mt(nvObj_t *nv) { text_print_flt(nv, fmt_mt);}
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1559
0000128D 6040                    		SUB #04H, R0
0000128F E301                    		MOV.L R1, [R0]
00001291 FB22rrrrrrrr            		MOV.L #__$fmt_mt, R2
00001297 05rrrrrr             A  		BSR _text_print_flt
0000129B 6701                    		RTSD #04H
0000129D                         _st_print_me:
                                 		.STACK	_st_print_me=8
                                 ;    1560 void st_print_me(nvObj_t *nv) { text_print_nul(nv, fmt_me);}
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1560
0000129D 6040                    		SUB #04H, R0
0000129F E301                    		MOV.L R1, [R0]
000012A1 FB22rrrrrrrr            		MOV.L #__$fmt_me, R2
000012A7 05rrrrrr             A  		BSR _text_print_nul
000012AB 6701                    		RTSD #04H
000012AD                         _st_print_md:
                                 		.STACK	_st_print_md=8
                                 ;    1561 void st_print_md(nvObj_t *nv) { text_print_nul(nv, fmt_md);}
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1561
000012AD 6040                    		SUB #04H, R0
000012AF E301                    		MOV.L R1, [R0]
000012B1 FB22rrrrrrrr            		MOV.L #__$fmt_md, R2
000012B7 05rrrrrr             A  		BSR _text_print_nul
000012BB 6701                    		RTSD #04H
000012BD                         __$_print_motor_ui8:
                                 		.STACK	__$_print_motor_ui8=32
                                 ;    1562 
                                 ;    1563 static void _print_motor_ui8(nvObj_t *nv, const char *format)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1563
000012BD 6080                    		SUB #08H, R0
000012BF A009                    		MOV.L R1, 04H[R0]
000012C1 E302                    		MOV.L R2, [R0]
                                 ;    1564 {
                                 ;    1565 	fprintf_P(stderr, format, nv->group, nv->token, nv->group, (uint8_t)nv->value);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1565
000012C3 A809                    		MOV.L 04H[R0], R1
000012C5 A913                    		MOV.L 10H[R1], R3
000012C7 7100EC                  		ADD #0FFFFFFECH, R0
000012CA FD72130000004F          		FCMP #4F000000H, R3
000012D1 29rr                    		BLT L453
000012D3                         L452:	; entry
000012D3 FD7223000080CF          		FADD #0CF800000H, R3
000012DA                         L453:	; entry
000012DA FC973E                  		FTOI R3, R14
000012DD 5BE3                    		MOVU.B R14, R3
000012DF A103                    		MOV.L R3, 10H[R0]
000012E1 711314                  		ADD #14H, R1, R3
000012E4 A08B                    		MOV.L R3, 0CH[R0]
000012E6 711118                  		ADD #18H, R1
000012E9 A081                    		MOV.L R1, 08H[R0]
000012EB A00B                    		MOV.L R3, 04H[R0]
000012ED E302                    		MOV.L R2, [R0]
000012EF FB12rrrrrrrr            		MOV.L #__Stderr, R1
000012F5 05rrrrrr             A  		BSR _fprintf
000012F9 710014                  		ADD #14H, R0
000012FC 6702                    		RTSD #08H
000012FE                         __$_print_motor_flt_units:
                                 		.STACK	__$_print_motor_flt_units=40
                                 ;    1566 }
                                 ;    1567 
                                 ;    1568 static void _print_motor_flt_units(nvObj_t *nv, const char *format, uint8_t units)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1568
000012FE 60C0                    		SUB #0CH, R0
00001300 A081                    		MOV.L R1, 08H[R0]
00001302 A00A                    		MOV.L R2, 04H[R0]
00001304 808B                    		MOV.B R3, 03H[R0]
                                 ;    1569 {
                                 ;    1570 	fprintf_P(stderr, format, nv->group, nv->token, nv->group, nv->value, GET_TEXT_ITEM(msg_units, units));
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1570
00001306 FBE2rrrrrrrr            		MOV.L #__$msg_units, R14
0000130C B089                    		MOVU.B 03H[R0], R1
0000130E FE61E1                  		MOV.L [R1,R14], R1
00001311 A882                    		MOV.L 08H[R0], R2
00001313 A923                    		MOV.L 10H[R2], R3
00001315 A80C                    		MOV.L 04H[R0], R4
00001317 7100E8                  		ADD #0FFFFFFE8H, R0
0000131A A109                    		MOV.L R1, 14H[R0]
0000131C A103                    		MOV.L R3, 10H[R0]
0000131E 712114                  		ADD #14H, R2, R1
00001321 A089                    		MOV.L R1, 0CH[R0]
00001323 712218                  		ADD #18H, R2
00001326 A082                    		MOV.L R2, 08H[R0]
00001328 A009                    		MOV.L R1, 04H[R0]
0000132A E304                    		MOV.L R4, [R0]
0000132C FB12rrrrrrrr            		MOV.L #__Stderr, R1
00001332 05rrrrrr             A  		BSR _fprintf
00001336 710018                  		ADD #18H, R0
00001339 6703                    		RTSD #0CH
0000133B                         __$_print_motor_flt:
                                 		.STACK	__$_print_motor_flt=32
                                 ;    1571 }
                                 ;    1572 
                                 ;    1573 static void _print_motor_flt(nvObj_t *nv, const char *format)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1573
0000133B 6080                    		SUB #08H, R0
0000133D A009                    		MOV.L R1, 04H[R0]
0000133F E302                    		MOV.L R2, [R0]
                                 ;    1574 {
                                 ;    1575 	fprintf_P(stderr, format, nv->group, nv->token, nv->group, nv->value);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1575
00001341 A809                    		MOV.L 04H[R0], R1
00001343 7100EC                  		ADD #0FFFFFFECH, R0
00001346 E5100404                		MOV.L 10H[R1], 10H[R0]
0000134A 711314                  		ADD #14H, R1, R3
0000134D A08B                    		MOV.L R3, 0CH[R0]
0000134F 711118                  		ADD #18H, R1
00001352 A081                    		MOV.L R1, 08H[R0]
00001354 A00B                    		MOV.L R3, 04H[R0]
00001356 E302                    		MOV.L R2, [R0]
00001358 FB12rrrrrrrr            		MOV.L #__Stderr, R1
0000135E 05rrrrrr             A  		BSR _fprintf
00001362 710014                  		ADD #14H, R0
00001365 6702                    		RTSD #08H
00001367                         __$_print_motor_pwr:
                                 		.STACK	__$_print_motor_pwr=24
                                 ;    1576 }
                                 ;    1577 
                                 ;    1578 static void _print_motor_pwr(nvObj_t *nv, const char *format)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1578
00001367 6080                    		SUB #08H, R0
00001369 A009                    		MOV.L R1, 04H[R0]
0000136B E302                    		MOV.L R2, [R0]
                                 ;    1579 {
                                 ;    1580 	fprintf_P(stderr, format, nv->token[0], nv->value);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1580
0000136D A809                    		MOV.L 04H[R0], R1
0000136F B613                    		MOVU.B 18H[R1], R3
00001371 60C0                    		SUB #0CH, R0
00001373 E5100402                		MOV.L 10H[R1], 08H[R0]
00001377 A00B                    		MOV.L R3, 04H[R0]
00001379 E302                    		MOV.L R2, [R0]
0000137B FB12rrrrrrrr            		MOV.L #__Stderr, R1
00001381 05rrrrrr             A  		BSR _fprintf
00001385 62C0                    		ADD #0CH, R0
00001387 6702                    		RTSD #08H
00001389                         _st_print_ma:
                                 		.STACK	_st_print_ma=8
                                 ;    1581 }
                                 ;    1582 
                                 ;    1583 void st_print_ma(nvObj_t *nv) { _print_motor_ui8(nv, fmt_0ma);}
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1583
00001389 6040                    		SUB #04H, R0
0000138B E301                    		MOV.L R1, [R0]
0000138D FB22rrrrrrrr            		MOV.L #__$fmt_0ma, R2
00001393 39rrrr               W  		BSR __$_print_motor_ui8
00001396 6701                    		RTSD #04H
00001398                         _st_print_sa:
                                 		.STACK	_st_print_sa=8
                                 ;    1584 void st_print_sa(nvObj_t *nv) { _print_motor_flt_units(nv, fmt_0sa, DEGREE_INDEX);}
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1584
00001398 6040                    		SUB #04H, R0
0000139A E301                    		MOV.L R1, [R0]
0000139C 6623                    		MOV.L #00000002H, R3
0000139E FB22rrrrrrrr            		MOV.L #__$fmt_0sa, R2
000013A4 39rrrr               W  		BSR __$_print_motor_flt_units
000013A7 6701                    		RTSD #04H
000013A9                         _st_print_tr:
                                 		.STACK	_st_print_tr=12
                                 ;    1585 void st_print_tr(nvObj_t *nv) { _print_motor_flt_units(nv, fmt_0tr, cm_get_units_mode(MODEL));}
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1585
000013A9 7EA6                    		PUSH.L R6
000013AB 6040                    		SUB #04H, R0
000013AD EF16                    		MOV.L R1, R6
000013AF E306                    		MOV.L R6, [R0]
000013B1 FB12rrrrrrrr            		MOV.L #_cm, R1
000013B7 72115402                		ADD #0254H, R1
000013BB 05rrrrrr             A  		BSR _cm_get_units_mode
000013BF EF13                    		MOV.L R1, R3
000013C1 FB22rrrrrrrr            		MOV.L #__$fmt_0tr, R2
000013C7 EF61                    		MOV.L R6, R1
000013C9 39rrrr               W  		BSR __$_print_motor_flt_units
000013CC 3F6602                  		RTSD #08H, R6-R6
000013CF                         _st_print_mi:
                                 		.STACK	_st_print_mi=8
                                 ;    1586 void st_print_mi(nvObj_t *nv) { _print_motor_ui8(nv, fmt_0mi);}
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1586
000013CF 6040                    		SUB #04H, R0
000013D1 E301                    		MOV.L R1, [R0]
000013D3 FB22rrrrrrrr            		MOV.L #__$fmt_0mi, R2
000013D9 39rrrr               W  		BSR __$_print_motor_ui8
000013DC 6701                    		RTSD #04H
000013DE                         _st_print_po:
                                 		.STACK	_st_print_po=8
                                 ;    1587 void st_print_po(nvObj_t *nv) { _print_motor_ui8(nv, fmt_0po);}
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1587
000013DE 6040                    		SUB #04H, R0
000013E0 E301                    		MOV.L R1, [R0]
000013E2 FB22rrrrrrrr            		MOV.L #__$fmt_0po, R2
000013E8 39rrrr               W  		BSR __$_print_motor_ui8
000013EB 6701                    		RTSD #04H
000013ED                         _st_print_pm:
                                 		.STACK	_st_print_pm=8
                                 ;    1588 void st_print_pm(nvObj_t *nv) { _print_motor_ui8(nv, fmt_0pm);}
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1588
000013ED 6040                    		SUB #04H, R0
000013EF E301                    		MOV.L R1, [R0]
000013F1 FB22rrrrrrrr            		MOV.L #__$fmt_0pm, R2
000013F7 39rrrr               W  		BSR __$_print_motor_ui8
000013FA 6701                    		RTSD #04H
000013FC                         _st_print_pl:
                                 		.STACK	_st_print_pl=8
                                 ;    1589 void st_print_pl(nvObj_t *nv) { _print_motor_flt(nv, fmt_0pl);}
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1589
000013FC 6040                    		SUB #04H, R0
000013FE E301                    		MOV.L R1, [R0]
00001400 FB22rrrrrrrr            		MOV.L #__$fmt_0pl, R2
00001406 39rrrr               W  		BSR __$_print_motor_flt
00001409 6701                    		RTSD #04H
0000140B                         _st_print_pwr:
                                 		.STACK	_st_print_pwr=8
                                 ;    1590 void st_print_pwr(nvObj_t *nv){ _print_motor_pwr(nv, fmt_pwr);}
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\src\cnc\stepper.c",1590
0000140B 6040                    		SUB #04H, R0
0000140D E301                    		MOV.L R1, [R0]
0000140F FB22rrrrrrrr            		MOV.L #__$fmt_pwr, R2
00001415 39rrrr               W  		BSR __$_print_motor_pwr
00001418 6701                    		RTSD #04H
                                 ;    1591 
                                 ;    1592 #endif // __TEXT_MODE
                                 		.SECTION	C,ROMDATA,ALIGN=4
00000000                         __$msg_units:
00000000 rrrrrrrr                		.lword	__$msg_units0
00000004 rrrrrrrr                		.lword	__$msg_units1
00000008 rrrrrrrr                		.lword	__$msg_units2
                                 		.SECTION	C_1,ROMDATA
00000000                         __$msg_units0:
00000000 20696E                  		.byte	" in"
00000003 00                      		.byte	00H
00000004                         __$msg_units1:
00000004 206D6D                  		.byte	" mm"
00000007 00                      		.byte	00H
00000008                         __$msg_units2:
00000008 20646567                		.byte	" deg"
0000000C 00                      		.byte	00H
0000000D                         __$fmt_me:
0000000D 6D6F746F                		.byte	"motors energized"
         72732065                
         6E657267                
         697A6564                
0000001D 0A00                    		.byte	0AH,00H
0000001F                         __$fmt_md:
0000001F 6D6F746F                		.byte	"motors de-energized"
         72732064                
         652D656E                
         65726769                
         7A6564                  
00000032 0A00                    		.byte	0AH,00H
00000034                         __$fmt_mt:
00000034 5B6D745D                		.byte	"[mt]  motor idle timeout%14.2f Sec"
         20206D6F                
         746F7220                
         69646C65                
         2074696D                
         656F7574                
         2531342E                
         32662053                
         6563                    
00000056 0A00                    		.byte	0AH,00H
00000058                         __$fmt_0ma:
00000058 5B257325                		.byte	"[%s%s] m%s map to axis%15d [0=X,1=Y,2=Z...]"
         735D206D                
         2573206D                
         61702074                
         6F206178                
         69732531                
         3564205B                
         303D582C                
         313D592C                
         323D5A2E                
         2E2E5D                  
00000083 0A00                    		.byte	0AH,00H
00000085                         __$fmt_0sa:
00000085 5B257325                		.byte	"[%s%s] m%s step angle%20.3f%s"
         735D206D                
         25732073                
         74657020                
         616E676C                
         65253230                
         2E336625                
         73                      
000000A2 0A00                    		.byte	0AH,00H
000000A4                         __$fmt_0tr:
000000A4 5B257325                		.byte	"[%s%s] m%s travel per revolution%10.4f%s"
         735D206D                
         25732074                
         72617665                
         6C207065                
         72207265                
         766F6C75                
         74696F6E                
         2531302E                
         34662573                
000000CC 0A00                    		.byte	0AH,00H
000000CE                         __$fmt_0mi:
000000CE 5B257325                		.byte	"[%s%s] m%s microsteps%16d [1,2,4,8]"
         735D206D                
         2573206D                
         6963726F                
         73746570                
         73253136                
         64205B31                
         2C322C34                
         2C385D                  
000000F1 0A00                    		.byte	0AH,00H
000000F3                         __$fmt_0po:
000000F3 5B257325                		.byte	"[%s%s] m%s polarity%18d [0=normal,1=reverse]"
         735D206D                
         25732070                
         6F6C6172                
         69747925                
         31386420                
         5B303D6E                
         6F726D61                
         6C2C313D                
         72657665                
         7273655D                
0000011F 0A00                    		.byte	0AH,00H
00000121                         __$fmt_0pm:
00000121 5B257325                		.byte	"[%s%s] m%s power management%10d [0=disabled,1=always on,2=in cycle,3=when moving]"
         735D206D                
         25732070                
         6F776572                
         206D616E                
         6167656D                
         656E7425                
         31306420                
         5B303D64                
         69736162                
         6C65642C                
         313D616C                
         77617973                
         206F6E2C                
         323D696E                
         20637963                
         6C652C33                
         3D776865                
         6E206D6F                
         76696E67                
         5D                      
00000172 0A00                    		.byte	0AH,00H
00000174                         __$fmt_0pl:
00000174 5B257325                		.byte	"[%s%s] m%s motor power level%13.3f [0.000=minimum, 1.000=maximum]"
         735D206D                
         2573206D                
         6F746F72                
         20706F77                
         6572206C                
         6576656C                
         2531332E                
         3366205B                
         302E3030                
         303D6D69                
         6E696D75                
         6D2C2031                
         2E303030                
         3D6D6178                
         696D756D                
         5D                      
000001B5 0A00                    		.byte	0AH,00H
000001B7                         __$fmt_pwr:
000001B7 4D6F746F                		.byte	"Motor %c power enabled state:%2.0f"
         72202563                
         20706F77                
         65722065                
         6E61626C                
         65642073                
         74617465                
         3A25322E                
         3066                    
000001D9 0A00                    		.byte	0AH,00H
                                 		.SECTION	L,ROMDATA,ALIGN=4
00000000                         _L10:
00000000 2A2A2A20                		.byte	"*** WARNING *** Setting non-standard microstep value"
         5741524E                
         494E4720                
         2A2A2A20                
         53657474                
         696E6720                
         6E6F6E2D                
         7374616E                
         64617264                
         206D6963                
         726F7374                
         65702076                
         616C7565                
00000034 00                      		.byte	00H
                                 		.SECTION	D,ROMDATA,ALIGN=4
00000000                         __$refresh$2:
00000000 00000000                		.lword	00000000H
00000004                         __$step$3:
00000004 00000000                		.lword	00000000H
                                 		.SECTION	D_1,ROMDATA
00000000                         _isDwell:
00000000 00                      		.byte	00H
00000001                         __$flag_dda$1:
00000001 01                      		.byte	01H
                                 		.SECTION	B,DATA,ALIGN=4
00000000                         _st_cfg:
00000000(00000094H)              		.blkl	37
00000094                         _st_pre:
00000094(00000088H)              		.blkl	34
0000011C                         __$st_run:
0000011C(00000060H)              		.blkl	24
0000017C                         _z_step_pulse:
0000017C(00000004H)              		.blkl	1
                                 		.END

Information List

TOTAL ERROR(S)    00000
TOTAL WARNING(S)  00000
TOTAL LINE(S)     04349   LINES

Section List

Attr         Size               Name
CODE     0000005146(0000141AH)  P
ROMDATA  0000000012(0000000CH)  C
ROMDATA  0000000475(000001DBH)  C_1
ROMDATA  0000000053(00000035H)  L
ROMDATA  0000000008(00000008H)  D
ROMDATA  0000000002(00000002H)  D_1
DATA     0000000384(00000180H)  B

Cpu Type

-ISA=RXV1 -FPU

Command Parameter

-subcommand=C:\Users\LAFONS~1\AppData\Local\Temp\$ccrx4D06\$ccrx\stepper.src.cmd
    -nologo
    -isa=rxv1
    -fpu
    -show=conditionals,definitions,expansions
    -define=__RXV1=1
    -fint_register=0
    -debug
    -endian=little
-listfile=C:\Workspace\e2studio\git\MT01_master\MT01_build\stepper.lst
-output=C:\Workspace\e2studio\git\MT01_master\MT01_build\src\cnc\stepper.obj
