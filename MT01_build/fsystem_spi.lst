* RX FAMILY ASSEMBLER V2.03.00.01 [24 Oct 2014] *  SOURCE LIST  Tue Mar 14 17:29:05 2017

LOC.     OBJ.              0XMDA SOURCE STATEMENT

                                 ;RX Family C/C++ Compiler (V2.03.00.03 [04 Dec 2014])  14-Mar-2017 17:29:04
                                 
                                 ;*** CPU TYPE ***
                                 
                                 ;-ISA=RXV1
                                 
                                 ;*** COMMAND PARAMETER ***
                                 
                                 ;-output=src=fsystem_spi.src
                                 ;-lang=c99
                                 ;-include=C:\PROGRA~2\Renesas\RX\2_3_0/include,C:\Workspace\e2studio\git\MT01_master\r_lvd_rx,C:\Workspace\e2studio\git\MT01_master\r_lvd_rx\src,C:/Workspace/e2studio/
                                 ;-debug
                                 ;-show=source,conditionals,definitions,expansions
                                 ;-listfile=fsystem_spi.lst
                                 ;-isa=rxv1
                                 ;-optimize=0
                                 ;-fpu
                                 ;-alias=noansi
                                 ;-nologo
                                 ;-nomessage
                                 ;-define=__RX,COMPACTAXP=0,EASYMAK=1,MOBILE=0,FREE_RTOS_PP
                                 ;fsystem_spi.c
                                 
                                 		.glb	_tx_data
                                 		.glb	_rx_data
                                 		.glb	_g_fs_header
                                 		.glb	_g_fs_header_format
                                 		.glb	_g_block_addr
                                 		.glb	_FS_spi_init
                                 		.glb	_R_SF_Erase
                                 		.glb	_FS_spi_start_block
                                 		.glb	_FS_spi_writeFile
                                 		.glb	_pvPortMalloc
                                 		.glb	_f_open
                                 		.glb	_f_read
                                 		.glb	_vPortFree
                                 		.glb	_FS_spi_readFile
                                 		.glb	_FS_spi_eof
                                 		.glb	_FS_spi_close
                                 		.glb	_FS_spi_gets
                                 		.glb	_FS_spi_idle
                                 		.glb	_FS_spi_read_blocking
                                 		.glb	_FS_spi_write_blocking
                                 		.glb	_FS_spi_erase_blocking
                                 		.glb	_R_SF_ReadStatus
                                 		.glb	_R_SF_ReadData
                                 		.glb	_R_SF_WriteData
                                 		.glb	_FS_spi_hw_init
                                 		.glb	_R_SF_Init
                                 ;LineNo. C-SOURCE STATEMENT
                                 
                                 		.SECTION	P,CODE
00000000                         _FS_spi_init:
                                 		.STACK	_FS_spi_init=12
                                 ;       1 /*
                                 ;       2  * fsystem_spi.c
                                 ;       3  *
                                 ;       4  *  Created on: Jul 13, 2016
                                 ;       5  *      Author: LAfonso01
                                 ;       6  */
                                 ;       7 #include "platform.h"
                                 ;       8 #include "r_spi_flash_if.h"
                                 ;       9 #include "fsystem_spi.h"
                                 ;      10 
                                 ;      11 #include "FreeRTOS.h"
                                 ;      12 
                                 ;      13 #include <string.h>
                                 ;      14 
                                 ;      15 #define FL_RSPI_CHANNEL				(1)
                                 ;      16 /* Valid Mask for Load Image Header */
                                 ;      17 #define FS_VALID_MASK                (0xAA)
                                 ;      18 /* SPI Flash FS block size */
                                 ;      19 #define FS_BLOCK_SIZE              (1024*1024)
                                 ;      20 /* SPI Flash FS init address */
                                 ;      21 #define FS_BLOCK_END              (1024*1024 - 1)
                                 ;      22 /* Number of blocks */
                                 ;      23 #define FS_BLOCK_MAX              (7)
                                 ;      24 /* Number of blocks */
                                 ;      25 #define FS_BLOCK_SIZE_64K         (16)
                                 ;      26 
                                 ;      27 volatile uint8_t tx_data;
                                 ;      28 volatile uint8_t rx_data;
                                 ;      29 
                                 ;      30 static uint8_t g_block_sanity;
                                 ;      31 static uint32_t g_write_addr;
                                 ;      32 static uint32_t g_read_addr;
                                 ;      33 static uint8_t g_file_block = 0;
                                 ;      34 static uint32_t g_file_index = 0;
                                 ;      35 static uint8_t file_block_index = 0;
                                 ;      36 static uint8_t g_wl_offset = 0;
                                 ;      37 
                                 ;      38 fs_image_header_t g_fs_header[FS_BLOCK_MAX];
                                 ;      39 fs_image_header_t g_fs_header_format;
                                 ;      40 const uint32_t g_block_addr[FS_BLOCK_MAX] = {
                                 ;      41 	0x100000,
                                 ;      42 	0x200000,
                                 ;      43 	0x300000,
                                 ;      44 	0x400000,
                                 ;      45 	0x500000,
                                 ;      46 	0x600000,
                                 ;      47 	0x700000,
                                 ;      48 };
                                 ;      49 
                                 ;      50 static uint8_t fs_find_next_block_erased(void);
                                 ;      51 static uint8_t fs_find_file_block(uint8_t fblock);
                                 ;      52 
                                 ;      53 void FS_spi_init(void)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",53
00000000 6080                    		SUB #08H, R0
00000002 6602                    		MOV.L #00000000H, R2
00000004 6611                    		MOV.L #00000001H, R1
                                 ;      54 {
                                 ;      55 	uint8_t i;
                                 ;      56 
                                 ;      57 	R_SF_Erase(FL_RSPI_CHANNEL, 0, SF_ERASE_BULK);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",57
00000006 EF13                    		MOV.L R1, R3
00000008 05rrrrrr             A  		BSR _R_SF_Erase
0000000C                         L11:	; entry.split
                                 ;      58 
                                 ;      59 	for (i = 0; i < FS_BLOCK_MAX; i++)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",59
0000000C 3C0700                  		MOV.B #00H, 07H[R0]
0000000F 38rrrr               W  		BRA L25
00000012                         L12:	; bb
                                 ;      60 	{
                                 ;      61 
                                 ;      62 		/* Read the block header */
                                 ;      63 		FS_spi_read_blocking(g_block_addr[i], (uint8_t *)&g_fs_header[i], sizeof(fs_image_header_t));
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",63
00000012 B18B                    		MOVU.B 07H[R0], R3
00000014 FBE2rrrrrrrr            		MOV.L #_g_block_addr, R14
0000001A FE63E1                  		MOV.L [R3,R14], R1
0000001D 751330                  		MUL #30H, R3
00000020 FB22rrrrrrrr            		MOV.L #_g_fs_header, R2
00000026 4B32                    		ADD R3, R2
00000028 754330                  		MOV.L #00000030H, R3
0000002B 39rrrr               W  		BSR _FS_spi_read_blocking
0000002E                         L13:	; bb.split
                                 ;      64 		/* Read the block end */
                                 ;      65 		FS_spi_read_blocking(g_block_addr[i] + FS_BLOCK_END, &g_block_sanity, 1);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",65
0000002E FBE2rrrrrrrr            		MOV.L #_g_block_addr, R14
00000034 B189                    		MOVU.B 07H[R0], R1
00000036 FE61E1                  		MOV.L [R1,R14], R1
00000039 7311FFFF0F              		ADD #000FFFFFH, R1
0000003E 6613                    		MOV.L #00000001H, R3
00000040 FB22rrrrrrrr            		MOV.L #__$g_block_sanity, R2
00000046 39rrrr               W  		BSR _FS_spi_read_blocking
00000049                         L14:	; bb.split1
                                 ;      66 		/* Checking if the block is totally erased */
                                 ;      67 		if (g_fs_header[i].valid_mask == 0xFF && g_block_sanity == 0xFF)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",67
00000049 B189                    		MOVU.B 07H[R0], R1
0000004B 751130                  		MUL #30H, R1
0000004E FBE2rrrrrrrr            		MOV.L #_g_fs_header, R14
00000054 FECE1E                  		MOVU.B [R14,R1], R14
00000057 755EFF                  		CMP #0FFH, R14
0000005A 20rr                    		BEQ L20
0000005C 2Err                 B  		BRA L22
0000005E                         L15:	; bb16
0000005E 754330                  		MOV.L #00000030H, R3
00000061 7542FF                  		MOV.L #000000FFH, R2
                                 ;      68 		{
                                 ;      69 			/* Write block header format*/
                                 ;      70 			memset((uint8_t *)&g_fs_header_format,0xFF,sizeof(fs_image_header_t));
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",70
00000064 FB12rrrrrrrr            		MOV.L #_g_fs_header_format, R1
0000006A 7F88                    		SSTR.B
0000006C                         L16:	; bb16.split
                                 ;      71 			g_fs_header_format.valid_mask = FS_VALID_MASK;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",71
0000006C FBE2rrrrrrrr            		MOV.L #_g_fs_header_format, R14
00000072 F8E4AA                  		MOV.B #0AAH, [R14]
00000075                         L17:	; bb16.split2
                                 ;      72 			g_fs_header_format.block_state = BLOCK_ERASED;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",72
00000075 FBE2rrrrrrrr            		MOV.L #_g_fs_header_format, R14
0000007B F9E911AAAA              		MOV.W #0AAAAH, 22H[R14]
00000080                         L18:	; bb16.split3
                                 ;      73 			FS_spi_write_blocking(g_block_addr[i], &g_fs_header_format.valid_mask, 1);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",73
00000080 FBE2rrrrrrrr            		MOV.L #_g_block_addr, R14
00000086 B189                    		MOVU.B 07H[R0], R1
00000088 FE61E1                  		MOV.L [R1,R14], R1
0000008B 6613                    		MOV.L #00000001H, R3
0000008D FB22rrrrrrrr            		MOV.L #_g_fs_header_format, R2
00000093 39rrrr               W  		BSR _FS_spi_write_blocking
00000096                         L19:	; bb16.split4
                                 ;      74 			FS_spi_write_blocking(g_block_addr[i] + offsetof(fs_image_header_t, block_state),\
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",74
00000096 FBE2rrrrrrrr            		MOV.L #_g_block_addr, R14
0000009C B189                    		MOVU.B 07H[R0], R1
0000009E FE61E1                  		MOV.L [R1,R14], R1
000000A1 711122                  		ADD #22H, R1
000000A4 FB22rrrrrrrr            		MOV.L #_g_fs_header_format, R2
000000AA 712222                  		ADD #22H, R2
000000AD 6623                    		MOV.L #00000002H, R3
000000AF 39rrrr               W  		BSR _FS_spi_write_blocking
000000B2 2Err                 B  		BRA L24
000000B4                         L20:	; bb35
000000B4 FBE2rrrrrrrr            		MOV.L #__$g_block_sanity, R14
000000BA 58EE                    		MOVU.B [R14], R14
000000BC 755EFF                  		CMP #0FFH, R14
000000BF 18                   S  		BNE L22
000000C0                         L21:	; bb40
000000C0 F80601                  		MOV.L #00000001H, [R0]
000000C3 08                   S  		BRA L23
000000C4                         L22:	; bb41
000000C4 F80600                  		MOV.L #00000000H, [R0]
000000C7                         L23:	; bb42
000000C7 EC01                    		MOV.L [R0], R1
000000C9 6101                    		CMP #00H, R1
000000CB 21rr                    		BNE L15
000000CD                         L24:	; bb46
000000CD B189                    		MOVU.B 07H[R0], R1
000000CF 6211                    		ADD #01H, R1
000000D1 8189                    		MOV.B R1, 07H[R0]
000000D3                         L25:	; bb49
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",59
000000D3 B189                    		MOVU.B 07H[R0], R1
000000D5 6171                    		CMP #07H, R1
000000D7 28rr                  * 		BLT L12
         38rrrr                  
000000DC                         L26:	; return
                                 ;      75 					(uint8_t *)&g_fs_header_format.block_state, sizeof(uint16_t));
                                 ;      76 		}
                                 ;      77 	}
                                 ;      78 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",78
000000DC 6702                    		RTSD #08H
000000DE                         _FS_spi_start_block:
                                 		.STACK	_FS_spi_start_block=20
                                 ;      79 
                                 ;      80 void FS_spi_start_block(uint32_t fsize)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",80
000000DE 7100F0                  		ADD #0FFFFFFF0H, R0
000000E1 A089                    		MOV.L R1, 0CH[R0]
                                 ;      81 {
                                 ;      82 	uint8_t i;
                                 ;      83 	uint8_t blocks_needed = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",83
000000E3 3C0800                  		MOV.B #00H, 08H[R0]
000000E6                         L28:	; entry.split
                                 ;      84 	uint8_t blocks_avalible = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",84
000000E6 3C0900                  		MOV.B #00H, 09H[R0]
000000E9                         L29:	; entry.split1
                                 ;      85 	uint8_t block_erase_count= 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",85
000000E9 3C0A00                  		MOV.B #00H, 0AH[R0]
000000EC                         L30:	; entry.split2
                                 ;      86 	uint8_t block_offset= 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",86
000000EC 3C0B00                  		MOV.B #00H, 0BH[R0]
000000EF                         L31:	; entry.split3
                                 ;      87 
                                 ;      88 	/* Calculate how many block are needed for the file  */
                                 ;      89 	blocks_needed = (fsize/FS_BLOCK_SIZE) + 1;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",89
000000EF A889                    		MOV.L 0CH[R0], R1
000000F1 6941                    		SHLR #14H, R1
000000F3 6211                    		ADD #01H, R1
000000F5 8201                    		MOV.B R1, 08H[R0]
000000F7                         L32:	; entry.split4
                                 ;      90 
                                 ;      91 	for (i = 0; i < FS_BLOCK_MAX; i++)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",91
000000F7 3C0700                  		MOV.B #00H, 07H[R0]
000000FA 2Err                 B  		BRA L40
000000FC                         L33:	; bb
                                 ;      92 	{
                                 ;      93 		/* Read the block header */
                                 ;      94 		FS_spi_read_blocking(g_block_addr[i], (uint8_t *)&g_fs_header[i], sizeof(fs_image_header_t));
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",94
000000FC B18B                    		MOVU.B 07H[R0], R3
000000FE FBE2rrrrrrrr            		MOV.L #_g_block_addr, R14
00000104 FE63E1                  		MOV.L [R3,R14], R1
00000107 751330                  		MUL #30H, R3
0000010A FB22rrrrrrrr            		MOV.L #_g_fs_header, R2
00000110 4B32                    		ADD R3, R2
00000112 754330                  		MOV.L #00000030H, R3
00000115 39rrrr               W  		BSR _FS_spi_read_blocking
00000118                         L34:	; bb.split
                                 ;      95 		/* Check if the block is available */
                                 ;      96 		if (g_fs_header[i].block_state == BLOCK_ERASED)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",96
00000118 B189                    		MOVU.B 07H[R0], R1
0000011A 751130                  		MUL #30H, R1
0000011D FB22rrrrrrrr            		MOV.L #_g_fs_header, R2
00000123 4B12                    		ADD R1, R2
00000125 BC29                    		MOVU.W 22H[R2], R1
00000127 7701AAAA00              		CMP #0AAAAH, R1
0000012C 18                   S  		BNE L36
0000012D                         L35:	; bb19
                                 ;      97 		{
                                 ;      98 			/* Get how many blocks is available*/
                                 ;      99 			blocks_avalible++;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",99
0000012D B209                    		MOVU.B 09H[R0], R1
0000012F 6211                    		ADD #01H, R1
00000131 8209                    		MOV.B R1, 09H[R0]
00000133                         L36:	; bb31
                                 ;     100 		}
                                 ;     101 		/* Check if the block was in use */
                                 ;     102 		if (g_fs_header[i].block_state == BLOCK_IN_USE)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",102
00000133 B189                    		MOVU.B 07H[R0], R1
00000135 751130                  		MUL #30H, R1
00000138 FB22rrrrrrrr            		MOV.L #_g_fs_header, R2
0000013E 4B12                    		ADD R1, R2
00000140 BC29                    		MOVU.W 22H[R2], R1
00000142 6101                    		CMP #00H, R1
00000144 21rr                    		BNE L39
00000146                         L37:	; bb32
                                 ;     103 		{
                                 ;     104 			/* Erase the used block header -  initial 64K block */
                                 ;     105 			FS_spi_erase_blocking(g_block_addr[i]);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",105
00000146 FBE2rrrrrrrr            		MOV.L #_g_block_addr, R14
0000014C B189                    		MOVU.B 07H[R0], R1
0000014E FE61E1                  		MOV.L [R1,R14], R1
00000151 39rrrr               W  		BSR _FS_spi_erase_blocking
00000154                         L38:	; bb32.split
                                 ;     106 
                                 ;     107 			g_wl_offset = i;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",107
00000154 FBE2rrrrrrrr            		MOV.L #__$g_wl_offset, R14
0000015A C10E07                  		MOV.B 07H[R0], [R14]
0000015D                         L39:	; bb47
0000015D B189                    		MOVU.B 07H[R0], R1
0000015F 6211                    		ADD #01H, R1
00000161 8189                    		MOV.B R1, 07H[R0]
00000163                         L40:	; bb50
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",91
00000163 B189                    		MOVU.B 07H[R0], R1
00000165 6171                    		CMP #07H, R1
00000167 29rr                    		BLT L33
00000169                         L41:	; bb57
                                 ;     108 		}
                                 ;     109 	}
                                 ;     110 	/* Check if there is enough space available to write the file*/
                                 ;     111 	if(blocks_avalible < blocks_needed)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",111
00000169 B209                    		MOVU.B 09H[R0], R1
0000016B 450108                  		CMP 08H[R0].UB, R1
0000016E 29rr                  * 		BGE L68
         38rrrr                  
00000173                         L42:	; bb58
                                 ;     112 	{
                                 ;     113 		/* Calculate how many block is needed*/
                                 ;     114 		blocks_needed = blocks_needed - blocks_avalible;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",114
00000173 B201                    		MOVU.B 08H[R0], R1
00000175 410109                  		SUB 09H[R0].UB, R1
00000178 8201                    		MOV.B R1, 08H[R0]
0000017A                         L43:	; bb58.split
                                 ;     115 
                                 ;     116 		block_offset = g_wl_offset;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",116
0000017A FBE2rrrrrrrr            		MOV.L #__$g_wl_offset, R14
00000180 C4E00B                  		MOV.B [R14], 0BH[R0]
00000183                         L44:	; bb58.split5
                                 ;     117 		for (i = 0; i < FS_BLOCK_MAX; i++)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",117
00000183 3C0700                  		MOV.B #00H, 07H[R0]
00000186 38rrrr               W  		BRA L67
00000189                         L45:	; bb66
                                 ;     118 		{
                                 ;     119 			block_offset += i;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",119
00000189 B289                    		MOVU.B 0BH[R0], R1
0000018B 490107                  		ADD 07H[R0].UB, R1
0000018E 8289                    		MOV.B R1, 0BH[R0]
00000190                         L46:	; bb66.split
                                 ;     120 
                                 ;     121 			if (block_offset == FS_BLOCK_MAX)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",121
00000190 B289                    		MOVU.B 0BH[R0], R1
00000192 6171                    		CMP #07H, R1
00000194 18                   S  		BNE L48
00000195                         L47:	; bb74
                                 ;     122 				block_offset = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",122
00000195 3C0B00                  		MOV.B #00H, 0BH[R0]
00000198                         L48:	; bb80
                                 ;     123 			/* Read the block header */
                                 ;     124 			FS_spi_read_blocking(g_block_addr[block_offset], (uint8_t *)&g_fs_header[block_offset], sizeof(fs_image_header_t));
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",124
00000198 B28B                    		MOVU.B 0BH[R0], R3
0000019A FBE2rrrrrrrr            		MOV.L #_g_block_addr, R14
000001A0 FE63E1                  		MOV.L [R3,R14], R1
000001A3 751330                  		MUL #30H, R3
000001A6 FB22rrrrrrrr            		MOV.L #_g_fs_header, R2
000001AC 4B32                    		ADD R3, R2
000001AE 754330                  		MOV.L #00000030H, R3
000001B1 39rrrr               W  		BSR _FS_spi_read_blocking
000001B4                         L49:	; bb80.split
                                 ;     125 			/* Check if the block should be erased */
                                 ;     126 			if (g_fs_header[block_offset].block_state == BLOCK_NEED_ERASE)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",126
000001B4 B289                    		MOVU.B 0BH[R0], R1
000001B6 751130                  		MUL #30H, R1
000001B9 FB22rrrrrrrr            		MOV.L #_g_fs_header, R2
000001BF 4B12                    		ADD R1, R2
000001C1 BC29                    		MOVU.W 22H[R2], R1
000001C3 7701FFFF00              		CMP #0FFFFH, R1
000001C8 3Brrrr               W  		BNE L66
000001CB                         L50:	; bb90
                                 ;     127 			{
                                 ;     128 				/* Erases all the 1MB Block except the first 64K block*/
                                 ;     129 				for (block_erase_count = 1; block_erase_count < FS_BLOCK_SIZE_64K ; block_erase_count++)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",129
000001CB 3C0A01                  		MOV.B #01H, 0AH[R0]
000001CE 2Err                 B  		BRA L52
000001D0                         L51:	; bb91
                                 ;     130 				{
                                 ;     131 					FS_spi_erase_blocking(g_block_addr[block_offset] + 0x10000*block_erase_count);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",131
000001D0 B282                    		MOVU.B 0AH[R0], R2
000001D2 6D02                    		SHLL #10H, R2
000001D4 4B21                    		ADD R2, R1
000001D6 39rrrr               W  		BSR _FS_spi_erase_blocking
000001D9 B281                    		MOVU.B 0AH[R0], R1
000001DB 6211                    		ADD #01H, R1
000001DD 8281                    		MOV.B R1, 0AH[R0]
000001DF                         L52:	; bb102
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",129
000001DF FBE2rrrrrrrr            		MOV.L #_g_block_addr, R14
000001E5 B289                    		MOVU.B 0BH[R0], R1
000001E7 FE61E1                  		MOV.L [R1,R14], R1
000001EA B282                    		MOVU.B 0AH[R0], R2
000001EC 755210                  		CMP #10H, R2
000001EF 29rr                    		BLT L51
000001F1                         L53:	; bb108
                                 ;     132 				}
                                 ;     133 				/* Read the block header */
                                 ;     134 				FS_spi_read_blocking(g_block_addr[block_offset], (uint8_t *)&g_fs_header[block_offset], sizeof(fs_image_header_t));
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",134
000001F1 B28B                    		MOVU.B 0BH[R0], R3
000001F3 751330                  		MUL #30H, R3
000001F6 FB22rrrrrrrr            		MOV.L #_g_fs_header, R2
000001FC 4B32                    		ADD R3, R2
000001FE 754330                  		MOV.L #00000030H, R3
00000201 39rrrr               W  		BSR _FS_spi_read_blocking
00000204                         L54:	; bb108.split
                                 ;     135 				/* Read the block end */
                                 ;     136 				FS_spi_read_blocking(g_block_addr[block_offset] + FS_BLOCK_END, &g_block_sanity, 1);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",136
00000204 FBE2rrrrrrrr            		MOV.L #_g_block_addr, R14
0000020A B289                    		MOVU.B 0BH[R0], R1
0000020C FE61E1                  		MOV.L [R1,R14], R1
0000020F 7311FFFF0F              		ADD #000FFFFFH, R1
00000214 6613                    		MOV.L #00000001H, R3
00000216 FB22rrrrrrrr            		MOV.L #__$g_block_sanity, R2
0000021C 39rrrr               W  		BSR _FS_spi_read_blocking
0000021F                         L55:	; bb108.split6
                                 ;     137 				/* Checking if the block is totally erased */
                                 ;     138 				if (g_fs_header[block_offset].valid_mask == 0xFF && g_block_sanity == 0xFF)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",138
0000021F B289                    		MOVU.B 0BH[R0], R1
00000221 751130                  		MUL #30H, R1
00000224 FBE2rrrrrrrr            		MOV.L #_g_fs_header, R14
0000022A FECE1E                  		MOVU.B [R14,R1], R14
0000022D 755EFF                  		CMP #0FFH, R14
00000230 20rr                    		BEQ L62
00000232 2Err                 B  		BRA L64
00000234                         L56:	; bb123
00000234 754330                  		MOV.L #00000030H, R3
00000237 7542FF                  		MOV.L #000000FFH, R2
                                 ;     139 				{
                                 ;     140 					/* Write block header format*/
                                 ;     141 					memset((uint8_t *)&g_fs_header_format,0xFF,sizeof(fs_image_header_t));
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",141
0000023A FB12rrrrrrrr            		MOV.L #_g_fs_header_format, R1
00000240 7F88                    		SSTR.B
00000242                         L57:	; bb123.split
                                 ;     142 					g_fs_header_format.valid_mask = FS_VALID_MASK;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",142
00000242 FBE2rrrrrrrr            		MOV.L #_g_fs_header_format, R14
00000248 F8E4AA                  		MOV.B #0AAH, [R14]
0000024B                         L58:	; bb123.split7
                                 ;     143 					g_fs_header_format.block_state = BLOCK_ERASED;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",143
0000024B FBE2rrrrrrrr            		MOV.L #_g_fs_header_format, R14
00000251 F9E911AAAA              		MOV.W #0AAAAH, 22H[R14]
00000256                         L59:	; bb123.split8
                                 ;     144 					FS_spi_write_blocking(g_block_addr[block_offset], &g_fs_header_format.valid_mask, 1);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",144
00000256 FBE2rrrrrrrr            		MOV.L #_g_block_addr, R14
0000025C B289                    		MOVU.B 0BH[R0], R1
0000025E FE61E1                  		MOV.L [R1,R14], R1
00000261 6613                    		MOV.L #00000001H, R3
00000263 FB22rrrrrrrr            		MOV.L #_g_fs_header_format, R2
00000269 39rrrr               W  		BSR _FS_spi_write_blocking
0000026C                         L60:	; bb123.split9
                                 ;     145 					FS_spi_write_blocking(g_block_addr[block_offset] + offsetof(fs_image_header_t, block_state),\
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",145
0000026C FBE2rrrrrrrr            		MOV.L #_g_block_addr, R14
00000272 B289                    		MOVU.B 0BH[R0], R1
00000274 FE61E1                  		MOV.L [R1,R14], R1
00000277 711122                  		ADD #22H, R1
0000027A FB22rrrrrrrr            		MOV.L #_g_fs_header_format, R2
00000280 712222                  		ADD #22H, R2
00000283 6623                    		MOV.L #00000002H, R3
00000285 39rrrr               W  		BSR _FS_spi_write_blocking
00000288                         L61:	; bb123.split10
                                 ;     146 							(uint8_t *)&g_fs_header_format.block_state, sizeof(uint16_t));
                                 ;     147 					/* Break the for loop if there is enough space to the incoming file*/
                                 ;     148 					if(--blocks_needed == 0)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",148
00000288 B201                    		MOVU.B 08H[R0], R1
0000028A 6011                    		SUB #01H, R1
0000028C 8201                    		MOV.B R1, 08H[R0]
0000028E 5B1E                    		MOVU.B R1, R14
00000290 610E                    		CMP #00H, R14
00000292 20rr                    		BEQ L68
00000294 2Err                 B  		BRA L66
00000296                         L62:	; bb152
00000296 FBE2rrrrrrrr            		MOV.L #__$g_block_sanity, R14
0000029C 58EE                    		MOVU.B [R14], R14
0000029E 755EFF                  		CMP #0FFH, R14
000002A1 18                   S  		BNE L64
000002A2                         L63:	; bb157
000002A2 F80601                  		MOV.L #00000001H, [R0]
000002A5 08                   S  		BRA L65
000002A6                         L64:	; bb158
000002A6 F80600                  		MOV.L #00000000H, [R0]
000002A9                         L65:	; bb159
000002A9 EC01                    		MOV.L [R0], R1
000002AB 6101                    		CMP #00H, R1
000002AD 21rr                    		BNE L56
000002AF                         L66:	; bb174
000002AF B189                    		MOVU.B 07H[R0], R1
000002B1 6211                    		ADD #01H, R1
000002B3 8189                    		MOV.B R1, 07H[R0]
000002B5                         L67:	; bb177
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",117
000002B5 B189                    		MOVU.B 07H[R0], R1
000002B7 6171                    		CMP #07H, R1
000002B9 28rr                  * 		BLT L45
         38rrrr                  
000002BE                         L68:	; return
                                 ;     149 						break;
                                 ;     150 				}
                                 ;     151 			}
                                 ;     152 		}
                                 ;     153 	}
                                 ;     154 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",154
000002BE 6704                    		RTSD #10H
000002C0                         _FS_spi_writeFile:
                                 		.STACK	_FS_spi_writeFile=36
                                 ;     155 
                                 ;     156 void FS_spi_writeFile(FIL* fp, char * fname)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",156
000002C0 7100E0                  		ADD #0FFFFFFE0H, R0
000002C3 A189                    		MOV.L R1, 1CH[R0]
000002C5 A182                    		MOV.L R2, 18H[R0]
                                 ;     157 {
                                 ;     158 	uint16_t page_index = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",158
000002C7 3D0200                  		MOV.W #0000H, 04H[R0]
000002CA                         L70:	; entry.split
                                 ;     159 	uint8_t cur_block_index = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",159
000002CA 3C0600                  		MOV.B #00H, 06H[R0]
000002CD                         L71:	; entry.split1
                                 ;     160 	uint8_t file_index = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",160
000002CD 3C0700                  		MOV.B #00H, 07H[R0]
000002D0                         L72:	; entry.split2
                                 ;     161 	uint32_t file_size_onblock = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",161
000002D0 3E0200                  		MOV.L #00000000H, 08H[R0]
000002D3                         L73:	; entry.split3
                                 ;     162 	uint8_t block_sanity_word = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",162
000002D3 3C0F00                  		MOV.B #00H, 0FH[R0]
000002D6                         L74:	; entry.split4
                                 ;     163 	void *temp = NULL;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",163
000002D6 3E0400                  		MOV.L #00000000H, 10H[R0]
000002D9                         L75:	; entry.split5
                                 ;     164 
                                 ;     165 	uint32_t remained;
                                 ;     166 	g_write_addr = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",166
000002D9 FBE2rrrrrrrr            		MOV.L #__$g_write_addr, R14
000002DF F8E600                  		MOV.L #00000000H, [R14]
000002E2                         L76:	; entry.split6
000002E2 FB1A0001                		MOV.L #00000100H, R1
                                 ;     167 	temp = pvPortMalloc( FS_PAGE_SIZE );
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",167
000002E6 05rrrrrr             A  		BSR _pvPortMalloc
000002EA A101                    		MOV.L R1, 10H[R0]
000002EC                         L77:	; entry.split7
                                 ;     168 
                                 ;     169 	f_open(fp,fname,FA_READ);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",169
000002EC A982                    		MOV.L 18H[R0], R2
000002EE A989                    		MOV.L 1CH[R0], R1
000002F0 6613                    		MOV.L #00000001H, R3
000002F2 05rrrrrr             A  		BSR _f_open
000002F6                         L78:	; entry.split8
                                 ;     170 
                                 ;     171 	cur_block_index = fs_find_next_block_erased();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",171
000002F6 39rrrr               W  		BSR __$fs_find_next_block_erased
000002F9 8181                    		MOV.B R1, 06H[R0]
000002FB                         L79:	; entry.split9
                                 ;     172 
                                 ;     173 	FS_spi_write_blocking(g_block_addr[cur_block_index] + offsetof(fs_image_header_t, file_block_number),\
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",173
000002FB FBE2rrrrrrrr            		MOV.L #_g_block_addr, R14
00000301 B181                    		MOVU.B 06H[R0], R1
00000303 FE61E1                  		MOV.L [R1,R14], R1
00000306 711124                  		ADD #24H, R1
00000309 6613                    		MOV.L #00000001H, R3
0000030B 710207                  		ADD #07H, R0, R2
0000030E 39rrrr               W  		BSR _FS_spi_write_blocking
00000311                         L80:	; entry.split10
                                 ;     174 				(uint8_t *)&file_index, 1);
                                 ;     175 
                                 ;     176 	FS_spi_write_blocking(g_block_addr[cur_block_index] + offsetof(fs_image_header_t, filename),\
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",176
00000311 FBE2rrrrrrrr            		MOV.L #_g_block_addr, R14
00000317 B181                    		MOVU.B 06H[R0], R1
00000319 FE61E1                  		MOV.L [R1,R14], R1
0000031C A982                    		MOV.L 18H[R0], R2
0000031E 6211                    		ADD #01H, R1
00000320 754320                  		MOV.L #00000020H, R3
00000323 39rrrr               W  		BSR _FS_spi_write_blocking
00000326                         L81:	; entry.split11
                                 ;     177 				(uint8_t *)fname, 32);
                                 ;     178 
                                 ;     179 	file_index++;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",179
00000326 B189                    		MOVU.B 07H[R0], R1
00000328 6211                    		ADD #01H, R1
0000032A 8189                    		MOV.B R1, 07H[R0]
0000032C                         L82:	; entry.split12
                                 ;     180 
                                 ;     181 	/* get the block erased address */
                                 ;     182 	g_write_addr = g_block_addr[cur_block_index];
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",182
0000032C FBE2rrrrrrrr            		MOV.L #_g_block_addr, R14
00000332 B181                    		MOVU.B 06H[R0], R1
00000334 FE61EE                  		MOV.L [R1,R14], R14
00000337 FBF2rrrrrrrr            		MOV.L #__$g_write_addr, R15
0000033D E3FE                    		MOV.L R14, [R15]
0000033F                         L83:	; entry.split13
                                 ;     183 
                                 ;     184 	page_index = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",184
0000033F 3D0200                  		MOV.W #0000H, 04H[R0]
00000342 38rrrr               W  		BRA L95
00000345                         L84:	; bb31
                                 ;     185 
                                 ;     186 	while(!f_eof(fp))
                                 ;     187 	{
                                 ;     188 		if(page_index == 4095)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",188
00000345 7601FF0F                		CMP #0FFFH, R1
00000349 21rr                    		BNE L92
0000034B                         L85:	; bb32
                                 ;     189 		{
                                 ;     190 
                                 ;     191 			cur_block_index = fs_find_next_block_erased();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",191
0000034B 39rrrr               W  		BSR __$fs_find_next_block_erased
0000034E 8181                    		MOV.B R1, 06H[R0]
00000350                         L86:	; bb32.split
                                 ;     192 
                                 ;     193 			FS_spi_write_blocking(g_block_addr[cur_block_index] + offsetof(fs_image_header_t, file_block_number),\
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",193
00000350 FBE2rrrrrrrr            		MOV.L #_g_block_addr, R14
00000356 B181                    		MOVU.B 06H[R0], R1
00000358 FE61E1                  		MOV.L [R1,R14], R1
0000035B 711124                  		ADD #24H, R1
0000035E 6613                    		MOV.L #00000001H, R3
00000360 710207                  		ADD #07H, R0, R2
00000363 39rrrr               W  		BSR _FS_spi_write_blocking
00000366                         L87:	; bb32.split14
                                 ;     194 					(uint8_t *)&file_index, 1);
                                 ;     195 
                                 ;     196 			file_index++;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",196
00000366 B189                    		MOVU.B 07H[R0], R1
00000368 6211                    		ADD #01H, R1
0000036A 8189                    		MOV.B R1, 07H[R0]
0000036C                         L88:	; bb32.split15
                                 ;     197 
                                 ;     198 			file_size_onblock = page_index*FS_PAGE_SIZE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",198
0000036C B881                    		MOVU.W 04H[R0], R1
0000036E 6C81                    		SHLL #08H, R1
00000370 A081                    		MOV.L R1, 08H[R0]
00000372                         L89:	; bb32.split16
                                 ;     199 
                                 ;     200 			FS_spi_write_blocking(g_block_addr[cur_block_index] + offsetof(fs_image_header_t, file_size_block),\
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",200
00000372 FBE2rrrrrrrr            		MOV.L #_g_block_addr, R14
00000378 B181                    		MOVU.B 06H[R0], R1
0000037A FE61E1                  		MOV.L [R1,R14], R1
0000037D 711128                  		ADD #28H, R1
00000380 6643                    		MOV.L #00000004H, R3
00000382 710208                  		ADD #08H, R0, R2
00000385 39rrrr               W  		BSR _FS_spi_write_blocking
00000388                         L90:	; bb32.split17
                                 ;     201 					(uint8_t *)&file_size_onblock, sizeof (uint32_t));
                                 ;     202 
                                 ;     203 			/* get the block erased address */
                                 ;     204 			g_write_addr = g_block_addr[cur_block_index];
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",204
00000388 FBE2rrrrrrrr            		MOV.L #_g_block_addr, R14
0000038E B181                    		MOVU.B 06H[R0], R1
00000390 FE61EE                  		MOV.L [R1,R14], R14
00000393 FBF2rrrrrrrr            		MOV.L #__$g_write_addr, R15
00000399 E3FE                    		MOV.L R14, [R15]
0000039B                         L91:	; bb32.split18
                                 ;     205 
                                 ;     206 			page_index = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",206
0000039B 3D0200                  		MOV.W #0000H, 04H[R0]
0000039E                         L92:	; bb58
                                 ;     207 
                                 ;     208 		}
                                 ;     209 
                                 ;     210 		f_read(fp,temp,FS_PAGE_SIZE,(UINT *)&remained);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",210
0000039E A902                    		MOV.L 10H[R0], R2
000003A0 A989                    		MOV.L 1CH[R0], R1
000003A2 710414                  		ADD #14H, R0, R4
000003A5 FB3A0001                		MOV.L #00000100H, R3
000003A9 05rrrrrr             A  		BSR _f_read
000003AD                         L93:	; bb58.split
                                 ;     211 
                                 ;     212 		FS_spi_write_blocking(g_write_addr + (page_index + 1)*FS_PAGE_SIZE, (uint8_t *)temp, FS_PAGE_SIZE);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",212
000003AD B881                    		MOVU.W 04H[R0], R1
000003AF 6C81                    		SHLL #08H, R1
000003B1 FBE2rrrrrrrr            		MOV.L #__$g_write_addr, R14
000003B7 0688E1                  		ADD [R14].L, R1
000003BA A902                    		MOV.L 10H[R0], R2
000003BC 72110001                		ADD #0100H, R1
000003C0 FB3A0001                		MOV.L #00000100H, R3
000003C4 39rrrr               W  		BSR _FS_spi_write_blocking
000003C7                         L94:	; bb58.split19
                                 ;     213 
                                 ;     214 		page_index++;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",214
000003C7 9881                    		MOV.W 04H[R0], R1
000003C9 6211                    		ADD #01H, R1
000003CB 9081                    		MOV.W R1, 04H[R0]
000003CD                         L95:	; bb71
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",186
000003CD A989                    		MOV.L 1CH[R0], R1
000003CF A892                    		MOV.L 08H[R1], R2
000003D1 06851203                		CMP 0CH[R1].L, R2
000003D5 18                   S  		BNE L97
000003D6                         L96:	; bb80
000003D6 F80600                  		MOV.L #00000000H, [R0]
000003D9 08                   S  		BRA L98
000003DA                         L97:	; bb81
000003DA F80601                  		MOV.L #00000001H, [R0]
000003DD                         L98:	; bb82
000003DD EC01                    		MOV.L [R0], R1
000003DF 6101                    		CMP #00H, R1
000003E1 B881                    		MOVU.W 04H[R0], R1
000003E3 3Brrrr               W  		BNE L84
000003E6                         L99:	; bb86
                                 ;     215 	}
                                 ;     216 
                                 ;     217 	file_size_onblock = (page_index - 1)*FS_PAGE_SIZE + remained;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",217
000003E6 6C81                    		SHLL #08H, R1
000003E8 06890105                		ADD 14H[R0].L, R1
000003EC 721100FF                		ADD #0FFFFFF00H, R1
000003F0 A081                    		MOV.L R1, 08H[R0]
000003F2                         L100:	; bb86.split
                                 ;     218 
                                 ;     219 	FS_spi_write_blocking(g_block_addr[cur_block_index] + offsetof(fs_image_header_t, file_size_block),\
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",219
000003F2 FBE2rrrrrrrr            		MOV.L #_g_block_addr, R14
000003F8 B181                    		MOVU.B 06H[R0], R1
000003FA FE61E1                  		MOV.L [R1,R14], R1
000003FD 711128                  		ADD #28H, R1
00000400 6643                    		MOV.L #00000004H, R3
00000402 710208                  		ADD #08H, R0, R2
00000405 39rrrr               W  		BSR _FS_spi_write_blocking
00000408                         L101:	; bb86.split20
                                 ;     220 			(uint8_t *)&file_size_onblock, sizeof (uint32_t));
                                 ;     221 
                                 ;     222 	block_sanity_word = FS_VALID_MASK;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",222
00000408 3C0FAA                  		MOV.B #0AAH, 0FH[R0]
0000040B                         L102:	; bb86.split21
                                 ;     223 
                                 ;     224 	g_write_addr = g_block_addr[cur_block_index] + FS_BLOCK_END;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",224
0000040B FBE2rrrrrrrr            		MOV.L #_g_block_addr, R14
00000411 B181                    		MOVU.B 06H[R0], R1
00000413 FE61EE                  		MOV.L [R1,R14], R14
00000416 73EEFFFF0F              		ADD #000FFFFFH, R14
0000041B FBF2rrrrrrrr            		MOV.L #__$g_write_addr, R15
00000421 E3FE                    		MOV.L R14, [R15]
00000423                         L103:	; bb86.split22
                                 ;     225 
                                 ;     226 	FS_spi_write_blocking(g_write_addr, &block_sanity_word, 1);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",226
00000423 FBE2rrrrrrrr            		MOV.L #__$g_write_addr, R14
00000429 ECE1                    		MOV.L [R14], R1
0000042B 6613                    		MOV.L #00000001H, R3
0000042D 71020F                  		ADD #0FH, R0, R2
00000430 39rrrr               W  		BSR _FS_spi_write_blocking
00000433                         L104:	; bb86.split23
                                 ;     227 
                                 ;     228 	vPortFree(temp);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",228
00000433 A901                    		MOV.L 10H[R0], R1
00000435 05rrrrrr             A  		BSR _vPortFree
00000439 6708                    		RTSD #20H
0000043B                         _FS_spi_readFile:
                                 		.STACK	_FS_spi_readFile=12
                                 ;     229 }
                                 ;     230 
                                 ;     231 void FS_spi_readFile(uint8_t * buffer, uint32_t size)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",231
0000043B 6080                    		SUB #08H, R0
0000043D A009                    		MOV.L R1, 04H[R0]
0000043F E302                    		MOV.L R2, [R0]
                                 ;     232 {
                                 ;     233 	file_block_index = fs_find_file_block(g_file_block);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",233
00000441 FBE2rrrrrrrr            		MOV.L #__$g_file_block, R14
00000447 58E1                    		MOVU.B [R14], R1
00000449 39rrrr               W  		BSR __$fs_find_file_block
0000044C FBE2rrrrrrrr            		MOV.L #__$file_block_index, R14
00000452 C3E1                    		MOV.B R1, [R14]
00000454                         L106:	; entry.split
                                 ;     234 
                                 ;     235 	g_read_addr = g_block_addr[file_block_index] + FS_PAGE_SIZE + g_file_index;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",235
00000454 FBE2rrrrrrrr            		MOV.L #__$file_block_index, R14
0000045A 58EE                    		MOVU.B [R14], R14
0000045C FBF2rrrrrrrr            		MOV.L #_g_block_addr, R15
00000462 FE6EFE                  		MOV.L [R14,R15], R14
00000465 FBF2rrrrrrrr            		MOV.L #__$g_file_index, R15
0000046B 0688FE                  		ADD [R15].L, R14
0000046E 72EE0001                		ADD #0100H, R14
00000472 FBF2rrrrrrrr            		MOV.L #__$g_read_addr, R15
00000478 E3FE                    		MOV.L R14, [R15]
0000047A                         L107:	; entry.split1
                                 ;     236 
                                 ;     237 	FS_spi_read_blocking(g_read_addr, buffer, size);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",237
0000047A FBE2rrrrrrrr            		MOV.L #__$g_read_addr, R14
00000480 ECE1                    		MOV.L [R14], R1
00000482 EC03                    		MOV.L [R0], R3
00000484 A80A                    		MOV.L 04H[R0], R2
00000486 39rrrr               W  		BSR _FS_spi_read_blocking
00000489                         L108:	; entry.split2
                                 ;     238 
                                 ;     239 	g_file_index += size;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",239
00000489 FBE2rrrrrrrr            		MOV.L #__$g_file_index, R14
0000048F ECEF                    		MOV.L [R14], R15
00000491 06880F                  		ADD [R0].L, R15
00000494 E3EF                    		MOV.L R15, [R14]
00000496                         L109:	; entry.split3
                                 ;     240 
                                 ;     241 	if(g_file_index > (FS_BLOCK_SIZE - FS_PAGE_SIZE))
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",241
00000496 FBE2rrrrrrrr            		MOV.L #__$g_file_index, R14
0000049C ECEE                    		MOV.L [R14], R14
0000049E 770E01FF0F              		CMP #000FFF01H, R14
000004A3 23rr                    		BLTU L112
000004A5                         L110:	; bb17
                                 ;     242 	{
                                 ;     243 		g_file_index = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",243
000004A5 FBE2rrrrrrrr            		MOV.L #__$g_file_index, R14
000004AB F8E600                  		MOV.L #00000000H, [R14]
000004AE                         L111:	; bb17.split
                                 ;     244 		g_file_block++;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",244
000004AE FBE2rrrrrrrr            		MOV.L #__$g_file_block, R14
000004B4 58EF                    		MOVU.B [R14], R15
000004B6 621F                    		ADD #01H, R15
000004B8 C3EF                    		MOV.B R15, [R14]
000004BA 6702                    		RTSD #08H
000004BC                         L112:	; return
                                 ;     245 	}
                                 ;     246 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",246
000004BC 6702                    		RTSD #08H
000004BE                         _FS_spi_eof:
                                 		.STACK	_FS_spi_eof=8
                                 ;     247 
                                 ;     248 bool FS_spi_eof(void)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",248
000004BE 6040                    		SUB #04H, R0
                                 ;     249 {
                                 ;     250 	if(g_file_index > g_fs_header[file_block_index].file_size_block)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",250
000004C0 FBE2rrrrrrrr            		MOV.L #__$file_block_index, R14
000004C6 58EE                    		MOVU.B [R14], R14
000004C8 751E30                  		MUL #30H, R14
000004CB FBF2rrrrrrrr            		MOV.L #_g_fs_header, R15
000004D1 4BEF                    		ADD R14, R15
000004D3 FBE2rrrrrrrr            		MOV.L #__$g_file_index, R14
000004D9 ECEE                    		MOV.L [R14], R14
000004DB 0685FE0A                		CMP 28H[R15].L, R14
000004DF 25rr                    		BLEU L115
000004E1                         L114:	; bb1
                                 ;     251 	{
                                 ;     252 		return true;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",252
000004E1 3C0201                  		MOV.B #01H, 02H[R0]
000004E4 08                   S  		BRA L116
000004E5                         L115:	; bb3
                                 ;     253 	}
                                 ;     254 	else
                                 ;     255 	{
                                 ;     256 		return false;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",256
000004E5 3C0200                  		MOV.B #00H, 02H[R0]
000004E8                         L116:	; bb14
000004E8 C5000203                		MOV.B 02H[R0], 03H[R0]
                                 ;     257 	}
                                 ;     258 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",258
000004EC B089                    		MOVU.B 03H[R0], R1
000004EE 6701                    		RTSD #04H
000004F0                         _FS_spi_close:
                                 		.STACK	_FS_spi_close=4
                                 ;     259 
                                 ;     260 void FS_spi_close(void)
                                 ;     261 {
                                 ;     262 	g_file_index = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",262
000004F0 FBE2rrrrrrrr            		MOV.L #__$g_file_index, R14
000004F6 F8E600                  		MOV.L #00000000H, [R14]
000004F9                         L118:	; entry.split
                                 ;     263 	g_file_block = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",263
000004F9 FBE2rrrrrrrr            		MOV.L #__$g_file_block, R14
000004FF F8E400                  		MOV.B #00H, [R14]
00000502 02                      		RTS
00000503                         _FS_spi_gets:
                                 		.STACK	_FS_spi_gets=36
                                 ;     264 }
                                 ;     265 
                                 ;     266 /*-----------------------------------------------------------------------*/
                                 ;     267 /* Get a string from the file                                            */
                                 ;     268 /*-----------------------------------------------------------------------*/
                                 ;     269 
                                 ;     270 uint8_t* FS_spi_gets (
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",270
00000503 7100E0                  		ADD #0FFFFFFE0H, R0
00000506 A189                    		MOV.L R1, 1CH[R0]
00000508 A182                    		MOV.L R2, 18H[R0]
                                 ;     271 	uint8_t* buff,	/* Pointer to the string buffer to read */
                                 ;     272 	int len		/* Size of string buffer (characters) */
                                 ;     273 )
                                 ;     274 {
                                 ;     275 	int n = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",275
0000050A 3E0100                  		MOV.L #00000000H, 04H[R0]
0000050D                         L120:	; entry.split
                                 ;     276 	uint8_t c, *p = buff;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",276
0000050D E5000703                		MOV.L 1CH[R0], 0CH[R0]
00000511 2Err                 B  		BRA L127
00000513                         L121:	; bb
00000513 6612                    		MOV.L #00000001H, R2
00000515 710112                  		ADD #12H, R0, R1
                                 ;     277 	uint8_t s[2];
                                 ;     278 
                                 ;     279 	while (n < len - 1) {	/* Read characters until buffer gets filled */
                                 ;     280 		FS_spi_readFile(s, 1);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",280
00000518 39rrrr               W  		BSR _FS_spi_readFile
0000051B                         L122:	; bb.split
                                 ;     281 		if (FS_spi_eof()) break;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",281
0000051B 39rrrr               W  		BSR _FS_spi_eof
0000051E 6101                    		CMP #00H, R1
00000520 21rr                    		BNE L128
00000522                         L123:	; bb16
                                 ;     282 		c = s[0];
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",282
00000522 C500120B                		MOV.B 12H[R0], 0BH[R0]
00000526                         L124:	; bb16.split1
                                 ;     283 		if (_USE_STRFUNC == 2 && c == '\r') continue;	/* Strip '\r' */
                                 ;     284 		*p++ = c;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",284
00000526 B289                    		MOVU.B 0BH[R0], R1
00000528 A88A                    		MOV.L 0CH[R0], R2
0000052A C321                    		MOV.B R1, [R2]
0000052C A889                    		MOV.L 0CH[R0], R1
0000052E 6211                    		ADD #01H, R1
00000530 A089                    		MOV.L R1, 0CH[R0]
00000532                         L125:	; bb16.split2
                                 ;     285 		n++;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",285
00000532 A809                    		MOV.L 04H[R0], R1
00000534 6211                    		ADD #01H, R1
00000536 A009                    		MOV.L R1, 04H[R0]
00000538                         L126:	; bb16.split3
                                 ;     286 		if (c == '\n') break;		/* Break on EOL */
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",286
00000538 B289                    		MOVU.B 0BH[R0], R1
0000053A 61A1                    		CMP #0AH, R1
0000053C 20rr                    		BEQ L128
0000053E                         L127:	; bb40
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",279
0000053E A981                    		MOV.L 18H[R0], R1
00000540 6011                    		SUB #01H, R1
00000542 06850101                		CMP 04H[R0].L, R1
00000546 2Arr                    		BGT L121
00000548                         L128:	; bb48
                                 ;     287 	}
                                 ;     288 	*p = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",288
00000548 A889                    		MOV.L 0CH[R0], R1
0000054A F81400                  		MOV.B #00H, [R1]
0000054D                         L129:	; bb48.split
                                 ;     289 	return n ? buff : 0;			/* When no data read (eof or error), return with error. */
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",289
0000054D A809                    		MOV.L 04H[R0], R1
0000054F 6101                    		CMP #00H, R1
00000551 10                   S  		BEQ L131
00000552                         L130:	; bb53
00000552 E10007                  		MOV.L 1CH[R0], [R0]
00000555 08                   S  		BRA L132
00000556                         L131:	; bb55
00000556 F80600                  		MOV.L #00000000H, [R0]
00000559                         L132:	; bb56
00000559 EC01                    		MOV.L [R0], R1
0000055B A109                    		MOV.L R1, 14H[R0]
                                 ;     290 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",290
0000055D 6708                    		RTSD #20H
0000055F                         _FS_spi_idle:
                                 		.STACK	_FS_spi_idle=8
                                 ;     291 
                                 ;     292 void FS_spi_idle(uint32_t size)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",292
0000055F 6040                    		SUB #04H, R0
00000561 E301                    		MOV.L R1, [R0]
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",295
00000563 6701                    		RTSD #04H
00000565                         _FS_spi_read_blocking:
                                 		.STACK	_FS_spi_read_blocking=16
                                 ;     293 {
                                 ;     294 
                                 ;     295 }
                                 ;     296 
                                 ;     297 void FS_spi_read_blocking(uint32_t rx_address, uint8_t * rx_buffer, uint32_t rx_bytes)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",297
00000565 60C0                    		SUB #0CH, R0
00000567 A081                    		MOV.L R1, 08H[R0]
00000569 A00A                    		MOV.L R2, 04H[R0]
0000056B E303                    		MOV.L R3, [R0]
0000056D                         L135:	; bb4
0000056D 6611                    		MOV.L #00000001H, R1
                                 ;     298 {
                                 ;     299     while((R_SF_ReadStatus(FL_RSPI_CHANNEL) & SF_WIP_BIT_MASK) == 1)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",299
0000056F 05rrrrrr             A  		BSR _R_SF_ReadStatus
00000573 6411                    		AND #01H, R1
00000575 6111                    		CMP #01H, R1
00000577 20rr                    		BEQ L135
00000579                         L136:	; bb9
                                 ;     300     {
                                 ;     301         /* Make sure SPI flash is not busy */
                                 ;     302     }
                                 ;     303 
                                 ;     304     /* Read data from external SPI flash */
                                 ;     305     R_SF_ReadData( FL_RSPI_CHANNEL,
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",305
00000579 EC04                    		MOV.L [R0], R4
0000057B A80B                    		MOV.L 04H[R0], R3
0000057D A882                    		MOV.L 08H[R0], R2
0000057F 6611                    		MOV.L #00000001H, R1
00000581 05rrrrrr             A  		BSR _R_SF_ReadData
00000585 6703                    		RTSD #0CH
00000587                         _FS_spi_write_blocking:
                                 		.STACK	_FS_spi_write_blocking=16
                                 ;     306                    rx_address,
                                 ;     307                    rx_buffer,
                                 ;     308                    rx_bytes);
                                 ;     309 }
                                 ;     310 
                                 ;     311 void FS_spi_write_blocking(uint32_t rx_address, uint8_t * rx_buffer, uint32_t rx_bytes)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",311
00000587 60C0                    		SUB #0CH, R0
00000589 A081                    		MOV.L R1, 08H[R0]
0000058B A00A                    		MOV.L R2, 04H[R0]
0000058D E303                    		MOV.L R3, [R0]
0000058F                         L138:	; bb4
0000058F 6611                    		MOV.L #00000001H, R1
                                 ;     312 {
                                 ;     313     while((R_SF_ReadStatus(FL_RSPI_CHANNEL) & SF_WIP_BIT_MASK) == 1)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",313
00000591 05rrrrrr             A  		BSR _R_SF_ReadStatus
00000595 6411                    		AND #01H, R1
00000597 6111                    		CMP #01H, R1
00000599 20rr                    		BEQ L138
0000059B                         L139:	; bb9
                                 ;     314     {
                                 ;     315         /* Make sure SPI flash is not busy */
                                 ;     316     }
                                 ;     317 
                                 ;     318     /* Read data from external SPI flash */
                                 ;     319     R_SF_WriteData( FL_RSPI_CHANNEL,
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",319
0000059B EC04                    		MOV.L [R0], R4
0000059D A80B                    		MOV.L 04H[R0], R3
0000059F A882                    		MOV.L 08H[R0], R2
000005A1 6611                    		MOV.L #00000001H, R1
000005A3 05rrrrrr             A  		BSR _R_SF_WriteData
000005A7 6703                    		RTSD #0CH
000005A9                         _FS_spi_erase_blocking:
                                 		.STACK	_FS_spi_erase_blocking=8
                                 ;     320                    rx_address,
                                 ;     321                    rx_buffer,
                                 ;     322                    rx_bytes);
                                 ;     323 }
                                 ;     324 
                                 ;     325 void FS_spi_erase_blocking(const uint32_t address)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",325
000005A9 6040                    		SUB #04H, R0
000005AB E301                    		MOV.L R1, [R0]
000005AD                         L141:	; bb2
000005AD 6611                    		MOV.L #00000001H, R1
                                 ;     326 {
                                 ;     327     while((R_SF_ReadStatus(FL_RSPI_CHANNEL) & SF_WIP_BIT_MASK) == 1)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",327
000005AF 05rrrrrr             A  		BSR _R_SF_ReadStatus
000005B3 6411                    		AND #01H, R1
000005B5 6111                    		CMP #01H, R1
000005B7 20rr                    		BEQ L141
000005B9                         L142:	; bb7
                                 ;     328     {
                                 ;     329         /* Make sure SPI flash is not busy */
                                 ;     330     }
                                 ;     331 
                                 ;     332 	/* Block erase */
                                 ;     333 	R_SF_Erase(FL_RSPI_CHANNEL, address, SF_ERASE_BLOCK);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",333
000005B9 EC02                    		MOV.L [R0], R2
000005BB 6623                    		MOV.L #00000002H, R3
000005BD 6611                    		MOV.L #00000001H, R1
000005BF 05rrrrrr             A  		BSR _R_SF_Erase
000005C3 6701                    		RTSD #04H
000005C5                         _FS_spi_hw_init:
                                 		.STACK	_FS_spi_hw_init=4
                                 ;     334 
                                 ;     335 }
                                 ;     336 
                                 ;     337 void FS_spi_hw_init(void)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",337
000005C5 6611                    		MOV.L #00000001H, R1
                                 ;     338 {
                                 ;     339 	R_SF_Init(FL_RSPI_CHANNEL);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",339
000005C7 05rrrrrr             A  		BSR _R_SF_Init
000005CB 02                      		RTS
000005CC                         __$fs_find_next_block_erased:
                                 		.STACK	__$fs_find_next_block_erased=12
                                 ;     340 }
                                 ;     341 
                                 ;     342 static uint8_t fs_find_next_block_erased(void)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",342
000005CC 6080                    		SUB #08H, R0
                                 ;     343 {
                                 ;     344 	uint8_t i = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",344
000005CE 3C0300                  		MOV.B #00H, 03H[R0]
000005D1                         L145:	; entry.split
                                 ;     345 	uint16_t cur_block_state;
                                 ;     346 	uint8_t block_offset;
                                 ;     347 
                                 ;     348 	block_offset = g_wl_offset;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",348
000005D1 FBE2rrrrrrrr            		MOV.L #__$g_wl_offset, R14
000005D7 C4E006                  		MOV.B [R14], 06H[R0]
000005DA                         L146:	; entry.split1
                                 ;     349 	for (i = 0; i < FS_BLOCK_MAX; i++)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",349
000005DA 3C0300                  		MOV.B #00H, 03H[R0]
000005DD 2Err                 B  		BRA L156
000005DF                         L147:	; bb
                                 ;     350 	{
                                 ;     351 			block_offset += i;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",351
000005DF B181                    		MOVU.B 06H[R0], R1
000005E1 490103                  		ADD 03H[R0].UB, R1
000005E4 8181                    		MOV.B R1, 06H[R0]
000005E6                         L148:	; bb.split
                                 ;     352 
                                 ;     353 			if (block_offset == FS_BLOCK_MAX)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",353
000005E6 B181                    		MOVU.B 06H[R0], R1
000005E8 6171                    		CMP #07H, R1
000005EA 18                   S  		BNE L150
000005EB                         L149:	; bb12
                                 ;     354 				block_offset = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",354
000005EB 3C0600                  		MOV.B #00H, 06H[R0]
000005EE                         L150:	; bb17
                                 ;     355 			/* Read the block header */
                                 ;     356 			FS_spi_read_blocking(g_block_addr[block_offset], (uint8_t *)&g_fs_header[block_offset], sizeof(fs_image_header_t));
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",356
000005EE B183                    		MOVU.B 06H[R0], R3
000005F0 FBE2rrrrrrrr            		MOV.L #_g_block_addr, R14
000005F6 FE63E1                  		MOV.L [R3,R14], R1
000005F9 751330                  		MUL #30H, R3
000005FC FB22rrrrrrrr            		MOV.L #_g_fs_header, R2
00000602 4B32                    		ADD R3, R2
00000604 754330                  		MOV.L #00000030H, R3
00000607 39rrrr               W  		BSR _FS_spi_read_blocking
0000060A                         L151:	; bb17.split
                                 ;     357 			/* Check if the block is erased */
                                 ;     358 			if (g_fs_header[block_offset].block_state == BLOCK_ERASED)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",358
0000060A B181                    		MOVU.B 06H[R0], R1
0000060C 751130                  		MUL #30H, R1
0000060F FB22rrrrrrrr            		MOV.L #_g_fs_header, R2
00000615 4B12                    		ADD R1, R2
00000617 BC29                    		MOVU.W 22H[R2], R1
00000619 7701AAAA00              		CMP #0AAAAH, R1
0000061E 21rr                    		BNE L155
00000620                         L152:	; bb27
                                 ;     359 			{
                                 ;     360 				/* Write block state to used*/
                                 ;     361 				cur_block_state = BLOCK_IN_USE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",361
00000620 3D0200                  		MOV.W #0000H, 04H[R0]
00000623                         L153:	; bb27.split
                                 ;     362 				FS_spi_write_blocking(g_block_addr[block_offset] + offsetof(fs_image_header_t, block_state),\
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",362
00000623 FBE2rrrrrrrr            		MOV.L #_g_block_addr, R14
00000629 B181                    		MOVU.B 06H[R0], R1
0000062B FE61E1                  		MOV.L [R1,R14], R1
0000062E 711122                  		ADD #22H, R1
00000631 6623                    		MOV.L #00000002H, R3
00000633 710204                  		ADD #04H, R0, R2
00000636 39rrrr               W  		BSR _FS_spi_write_blocking
00000639                         L154:	; bb27.split2
                                 ;     363 						(uint8_t *)&cur_block_state, 2);
                                 ;     364 
                                 ;     365 				return block_offset;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",365
00000639 C5000602                		MOV.B 06H[R0], 02H[R0]
0000063D 2Err                 B  		BRA L158
0000063F                         L155:	; bb45
0000063F B089                    		MOVU.B 03H[R0], R1
00000641 6211                    		ADD #01H, R1
00000643 8089                    		MOV.B R1, 03H[R0]
00000645                         L156:	; bb48
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",349
00000645 B089                    		MOVU.B 03H[R0], R1
00000647 6171                    		CMP #07H, R1
00000649 29rr                    		BLT L147
0000064B                         L157:	; bb54
                                 ;     366 			}
                                 ;     367 	}
                                 ;     368 
                                 ;     369 	return 0xff;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",369
0000064B 3C02FF                  		MOV.B #0FFH, 02H[R0]
0000064E                         L158:	; bb56
0000064E C5000207                		MOV.B 02H[R0], 07H[R0]
                                 ;     370 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",370
00000652 B189                    		MOVU.B 07H[R0], R1
00000654 6702                    		RTSD #08H
00000656                         __$fs_find_file_block:
                                 		.STACK	__$fs_find_file_block=12
                                 ;     371 
                                 ;     372 static uint8_t fs_find_file_block(uint8_t fblock)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",372
00000656 6080                    		SUB #08H, R0
00000658 8189                    		MOV.B R1, 07H[R0]
                                 ;     373 {
                                 ;     374 	uint8_t i = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",374
0000065A 3C0400                  		MOV.B #00H, 04H[R0]
0000065D                         L160:	; entry.split
                                 ;     375 	uint8_t block_offset;
                                 ;     376 
                                 ;     377 	block_offset = g_wl_offset;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",377
0000065D FBE2rrrrrrrr            		MOV.L #__$g_wl_offset, R14
00000663 C4E005                  		MOV.B [R14], 05H[R0]
00000666                         L161:	; entry.split1
                                 ;     378 	for (i = 0; i < FS_BLOCK_MAX; i++)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",378
00000666 3C0400                  		MOV.B #00H, 04H[R0]
00000669 2Err                 B  		BRA L170
0000066B                         L162:	; bb
                                 ;     379 	{
                                 ;     380 			block_offset += i;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",380
0000066B B109                    		MOVU.B 05H[R0], R1
0000066D 490104                  		ADD 04H[R0].UB, R1
00000670 8109                    		MOV.B R1, 05H[R0]
00000672                         L163:	; bb.split
                                 ;     381 
                                 ;     382 			if (block_offset == FS_BLOCK_MAX)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",382
00000672 B109                    		MOVU.B 05H[R0], R1
00000674 6171                    		CMP #07H, R1
00000676 18                   S  		BNE L165
00000677                         L164:	; bb12
                                 ;     383 				block_offset = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",383
00000677 3C0500                  		MOV.B #00H, 05H[R0]
0000067A                         L165:	; bb17
                                 ;     384 			/* Read the block header */
                                 ;     385 			FS_spi_read_blocking(g_block_addr[block_offset], (uint8_t *)&g_fs_header[block_offset], sizeof(fs_image_header_t));
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",385
0000067A B10B                    		MOVU.B 05H[R0], R3
0000067C FBE2rrrrrrrr            		MOV.L #_g_block_addr, R14
00000682 FE63E1                  		MOV.L [R3,R14], R1
00000685 751330                  		MUL #30H, R3
00000688 FB22rrrrrrrr            		MOV.L #_g_fs_header, R2
0000068E 4B32                    		ADD R3, R2
00000690 754330                  		MOV.L #00000030H, R3
00000693 39rrrr               W  		BSR _FS_spi_read_blocking
00000696                         L166:	; bb17.split
                                 ;     386 			/* Check if the block is erased */
                                 ;     387 			if (g_fs_header[block_offset].block_state == BLOCK_IN_USE)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",387
00000696 B109                    		MOVU.B 05H[R0], R1
00000698 751130                  		MUL #30H, R1
0000069B FB22rrrrrrrr            		MOV.L #_g_fs_header, R2
000006A1 4B12                    		ADD R1, R2
000006A3 BC29                    		MOVU.W 22H[R2], R1
000006A5 6101                    		CMP #00H, R1
000006A7 21rr                    		BNE L169
000006A9                         L167:	; bb28
                                 ;     388 			{
                                 ;     389 				if(g_fs_header[block_offset].file_block_number == fblock)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",389
000006A9 B109                    		MOVU.B 05H[R0], R1
000006AB 751130                  		MUL #30H, R1
000006AE FBE2rrrrrrrr            		MOV.L #_g_fs_header, R14
000006B4 4B1E                    		ADD R1, R14
000006B6 59EE24                  		MOVU.B 24H[R14], R14
000006B9 450E07                  		CMP 07H[R0].UB, R14
000006BC 18                   S  		BNE L169
000006BD                         L168:	; bb29
                                 ;     390 				{
                                 ;     391 					return block_offset;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",391
000006BD C5000503                		MOV.B 05H[R0], 03H[R0]
000006C1 2Err                 B  		BRA L172
000006C3                         L169:	; bb53
000006C3 B101                    		MOVU.B 04H[R0], R1
000006C5 6211                    		ADD #01H, R1
000006C7 8101                    		MOV.B R1, 04H[R0]
000006C9                         L170:	; bb56
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",378
000006C9 B101                    		MOVU.B 04H[R0], R1
000006CB 6171                    		CMP #07H, R1
000006CD 29rr                    		BLT L162
000006CF                         L171:	; bb62
                                 ;     392 				}
                                 ;     393 			}
                                 ;     394 	}
                                 ;     395 
                                 ;     396 	return 0xff;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",396
000006CF 3C03FF                  		MOV.B #0FFH, 03H[R0]
000006D2                         L172:	; bb64
000006D2 C5000306                		MOV.B 03H[R0], 06H[R0]
                                 ;     397 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01_master\fsystem_spi\fsystem_spi.c",397
000006D6 B181                    		MOVU.B 06H[R0], R1
000006D8 6702                    		RTSD #08H
                                 		.SECTION	C,ROMDATA,ALIGN=4
00000000                         _g_block_addr:
00000000 00001000                		.lword	00100000H
00000004 00002000                		.lword	00200000H
00000008 00003000                		.lword	00300000H
0000000C 00004000                		.lword	00400000H
00000010 00005000                		.lword	00500000H
00000014 00006000                		.lword	00600000H
00000018 00007000                		.lword	00700000H
                                 		.SECTION	D,ROMDATA,ALIGN=4
00000000                         __$g_file_index:
00000000 00000000                		.lword	00000000H
                                 		.SECTION	D_1,ROMDATA
00000000                         __$g_file_block:
00000000 00                      		.byte	00H
00000001                         __$file_block_index:
00000001 00                      		.byte	00H
00000002                         __$g_wl_offset:
00000002 00                      		.byte	00H
                                 		.SECTION	B,DATA,ALIGN=4
00000000                         __$g_write_addr:
00000000(00000004H)              		.blkl	1
00000004                         __$g_read_addr:
00000004(00000004H)              		.blkl	1
00000008                         _g_fs_header:
00000008(00000150H)              		.blkl	84
00000158                         _g_fs_header_format:
00000158(00000030H)              		.blkl	12
                                 		.SECTION	B_1,DATA
00000000                         _tx_data:
00000000(00000001H)              		.blkb	1
00000001                         _rx_data:
00000001(00000001H)              		.blkb	1
00000002                         __$g_block_sanity:
00000002(00000001H)              		.blkb	1
                                 		.END

Information List

TOTAL ERROR(S)    00000
TOTAL WARNING(S)  00000
TOTAL LINE(S)     01418   LINES

Section List

Attr         Size               Name
CODE     0000001754(000006DAH)  P
ROMDATA  0000000028(0000001CH)  C
ROMDATA  0000000004(00000004H)  D
ROMDATA  0000000003(00000003H)  D_1
DATA     0000000392(00000188H)  B
DATA     0000000003(00000003H)  B_1

Cpu Type

-ISA=RXV1 -FPU

Command Parameter

-subcommand=C:\Users\LAFONS~1\AppData\Local\Temp\$ccrx124\$ccrx\fsystem_spi.src.cmd
    -nologo
    -isa=rxv1
    -fpu
    -show=conditionals,definitions,expansions
    -define=__RXV1=1
    -fint_register=0
    -debug
    -endian=little
-listfile=C:\Workspace\e2studio\git\MT01_master\MT01_build\fsystem_spi.lst
-output=C:\Workspace\e2studio\git\MT01_master\MT01_build\fsystem_spi\fsystem_spi.obj
