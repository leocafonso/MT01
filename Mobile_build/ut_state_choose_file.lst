* RX FAMILY ASSEMBLER V2.03.00.01 [24 Oct 2014] *  SOURCE LIST  Sun Feb 19 10:53:50 2017

LOC.     OBJ.              0XMDA SOURCE STATEMENT

                                 ;RX Family C/C++ Compiler (V2.03.00.03 [04 Dec 2014])  19-Feb-2017 10:53:50
                                 
                                 ;*** CPU TYPE ***
                                 
                                 ;-ISA=RXV1
                                 
                                 ;*** COMMAND PARAMETER ***
                                 
                                 ;-output=src=ut_state_choose_file.src
                                 ;-lang=c99
                                 ;-include=C:\PROGRA~2\Renesas\RX\2_3_0/include,C:\Workspace\e2studio\git\MT01\r_lvd_rx,C:\Workspace\e2studio\git\MT01\r_lvd_rx\src,C:/Workspace/e2studio/git/MT01/r_tfa
                                 ;-debug
                                 ;-show=source,conditionals,definitions,expansions
                                 ;-listfile=ut_state_choose_file.lst
                                 ;-isa=rxv1
                                 ;-optimize=0
                                 ;-fpu
                                 ;-alias=noansi
                                 ;-nologo
                                 ;-nomessage
                                 ;-define=__RX,COMPACTAXP=0,EASYMAK=0,MOBILE=1,FREE_RTOS_PP
                                 ;ut_state_choose_file.c
                                 
                                 		.glb	_uspiffs
                                 		.glb	_st_usb_fatfs
                                 		.glb	_st_usb_dir
                                 		.glb	_gszCurFile
                                 		.glb	_buff
                                 		.glb	_drivemountFlag
                                 		.glb	_choosedLine
                                 		.glb	_choosedLinePosition
                                 		.glb	_currentLineSel
                                 		.glb	_g_fs_cur_header
                                 		.glb	_g_fs_next_header
                                 		.glb	_st_usb_finfo
                                 		.glb	_Lfname
                                 		.glb	_memcmp
                                 		.glb	_ut_menu_init
                                 		.glb	_f_getcwd
                                 		.glb	_f_opendir
                                 		.glb	_sprintf
                                 		.glb	_f_readdir
                                 		.glb	_strstr
                                 		.glb	_f_chdir
                                 		.glb	_f_open
                                 		.glb	_ut_lcd_output_warning
                                 		.glb	_SPIFFS_opendir
                                 		.glb	_SPIFFS_readdir
                                 		.glb	_SPIFFS_open_by_dirent
                                 		.glb	_SPIFFS_fremove
                                 		.glb	_SPIFFS_open
                                 		.glb	_pvPortMalloc
                                 		.glb	_f_read
                                 		.glb	_SPIFFS_write
                                 		.glb	_vPortFree
                                 		.glb	_f_close
                                 		.glb	_SPIFFS_close
                                 		.glb	_ut_menu_browse
                                 		.glb	_vTaskDelay
                                 		.glb	_ut_state_choose_file
                                 		.glb	_ut_lcd_clear
                                 		.glb	_ut_lcd_output
                                 ;LineNo. C-SOURCE STATEMENT
                                 
                                 		.SECTION	P,CODE
00000000                         __$ut_strrstr:
                                 		.STACK	__$ut_strrstr=28
                                 ;       1 /*
                                 ;       2  * ut_state_choose_file.c
                                 ;       3  *
                                 ;       4  *  Created on: Nov 2, 2015
                                 ;       5  *      Author: Fernando
                                 ;       6  */
                                 ;       7 
                                 ;       8 #include "FreeRTOS.h"
                                 ;       9 #include "task.h"
                                 ;      10 #include "ff.h"
                                 ;      11 #include "config_kernel.h"
                                 ;      12 
                                 ;      13 #include "r_usb_basic_if.h"
                                 ;      14 #include "r_usb_hmsc.h"
                                 ;      15 
                                 ;      16 #include "ut_context.h"
                                 ;      17 #include "ut_state.h"
                                 ;      18 #include "interpreter_if.h"
                                 ;      19 #include "xio.h"
                                 ;      20 
                                 ;      21 #include "lcd_menu.h"
                                 ;      22 #include "lcd.h"
                                 ;      23 #include "fsystem_spi.h"
                                 ;      24 #include "spiffs_hw.h"
                                 ;      25 #include "spiffs.h"
                                 ;      26 
                                 ;      27 #include <string.h>
                                 ;      28 #include <ctype.h>
                                 ;      29 #include <stdio.h>
                                 ;      30 #include <stdlib.h>
                                 ;      31 
                                 ;      32 // ***********************************************************************
                                 ;      33 // Global variables
                                 ;      34 // ***********************************************************************
                                 ;      35 FATFS  st_usb_fatfs;
                                 ;      36 DIR	   st_usb_dir;
                                 ;      37 char gszCurFile[MAX_FILE_PATH_SIZE];
                                 ;      38 char buff[MAX_FILE_PATH_SIZE];
                                 ;      39 extern bool drivemountFlag;
                                 ;      40 extern uint32_t choosedLine;
                                 ;      41 extern uint32_t choosedLinePosition;
                                 ;      42 extern uint32_t currentLineSel;
                                 ;      43 extern USB_UTR_t       msc_utr;
                                 ;      44 
                                 ;      45 // ***********************************************************************
                                 ;      46 // Internal variables
                                 ;      47 // ***********************************************************************
                                 ;      48 #define MAX_EXT_AVAIL	3
                                 ;      49 #define MAX_PATH_LENGHT 255
                                 ;      50 static const char* gaszFileExtensions[MAX_EXT_AVAIL] =
                                 ;      51 {
                                 ;      52 		".g",
                                 ;      53 		".tap",
                                 ;      54 		".nc"
                                 ;      55 };
                                 ;      56 
                                 ;      57 static const char* gszFileMenuTitle = "ESCOLHA UM ARQUIVO";
                                 ;      58 /* current file header */
                                 ;      59 fs_image_header_t *g_fs_cur_header;
                                 ;      60 /* next file header */
                                 ;      61 fs_image_header_t g_fs_next_header;
                                 ;      62 
                                 ;      63 // ***********************************************************************
                                 ;      64 // Global types
                                 ;      65 // ***********************************************************************
                                 ;      66 
                                 ;      67 typedef enum ut_fs_navigate_tag
                                 ;      68 {
                                 ;      69 	NAVIGATE_CANCELLED = -1,
                                 ;      70 	NAVIGATE_CONTINUE,
                                 ;      71 	NAVIGATE_END
                                 ;      72 } ut_fs_navigate;
                                 ;      73 
                                 ;      74 // ***********************************************************************
                                 ;      75 // Global functions
                                 ;      76 // ***********************************************************************
                                 ;      77 
                                 ;      78 /**
                                 ;      79  * Get first occurrence of find in string in reverse mode.
                                 ;      80  * It is the last occurrence of find in string.
                                 ;      81  *
                                 ;      82  * @param string	String to be searched.
                                 ;      83  * @param find		String to search.
                                 ;      84  * @return Pointer to the last occurrence.
                                 ;      85  */
                                 ;      86 static char * ut_strrstr(char *string, char *find)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",86
00000000 7100E8                  		ADD #0FFFFFFE8H, R0
00000003 A109                    		MOV.L R1, 14H[R0]
00000005 A102                    		MOV.L R2, 10H[R0]
00000007 FB36FF                  		MOV.L #0FFFFFFFFH, R3
0000000A 660E                    		MOV.L #00000000H, R14
                                 ;      87 {
                                 ;      88   char *cp;
                                 ;      89   uint32_t len = strlen(find);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",89
0000000C EF21                    		MOV.L R2, R1
0000000E EFE2                    		MOV.L R14, R2
00000010 7F80                    		SUNTIL.B
00000012 FB16FE                  		MOV.L #0FFFFFFFEH, R1
00000015 4331                    		SUB R3, R1
00000017 A081                    		MOV.L R1, 08H[R0]
00000019                         L24:	; entry.split
                                 ;      90   for (cp = string + strlen(string); cp >= string; cp--)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",90
00000019 A90C                    		MOV.L 14H[R0], R4
0000001B FB36FF                  		MOV.L #0FFFFFFFFH, R3
0000001E 6602                    		MOV.L #00000000H, R2
00000020 EF41                    		MOV.L R4, R1
00000022 7F80                    		SUNTIL.B
00000024 FBE6FE                  		MOV.L #0FFFFFFFEH, R14
00000027 433E                    		SUB R3, R14
00000029 4BE4                    		ADD R14, R4
0000002B A00C                    		MOV.L R4, 04H[R0]
0000002D 2Err                 B  		BRA L28
0000002F                         L25:	; bb11
                                 ;      91   {
                                 ;      92     if (strncmp(cp, find, len) == 0)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",92
0000002F A883                    		MOV.L 08H[R0], R3
00000031 6103                    		CMP #00H, R3
00000033 A902                    		MOV.L 10H[R0], R2
00000035 A80C                    		MOV.L 04H[R0], R4
00000037 EF41                    		MOV.L R4, R1
00000039 7F83                    		SCMPU
0000003B FCDBE2                  		SCGEU.L R14
0000003E FCDBF5                  		SCLEU.L R15
00000041 43FE                    		SUB R15, R14
00000043 610E                    		CMP #00H, R14
00000045 18                   S  		BNE L27
00000046                         L26:	; bb12
                                 ;      93     {
                                 ;      94     	return cp;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",94
00000046 E304                    		MOV.L R4, [R0]
00000048 2Err                 B  		BRA L30
0000004A                         L27:	; bb21
0000004A 6014                    		SUB #01H, R4
0000004C A00C                    		MOV.L R4, 04H[R0]
0000004E                         L28:	; bb24
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",90
0000004E A809                    		MOV.L 04H[R0], R1
00000050 06850105                		CMP 14H[R0].L, R1
00000054 22rr                    		BGEU L25
00000056                         L29:	; bb30
                                 ;      95     }
                                 ;      96   }
                                 ;      97   return NULL;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",97
00000056 F80600                  		MOV.L #00000000H, [R0]
00000059                         L30:	; bb32
00000059 EC01                    		MOV.L [R0], R1
0000005B A089                    		MOV.L R1, 0CH[R0]
                                 ;      98 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",98
0000005D 6706                    		RTSD #18H
0000005F                         __$validExtension:
                                 		.STACK	__$validExtension=28
                                 ;      99 
                                 ;     100 /**
                                 ;     101  * Checks if a word has a valid g extension
                                 ;     102  * @param szWord
                                 ;     103  * @return
                                 ;     104  */
                                 ;     105 static bool validExtension(const char* szWord)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",105
0000005F 7100E8                  		ADD #0FFFFFFE8H, R0
00000062 A109                    		MOV.L R1, 14H[R0]
00000064 FB36FF                  		MOV.L #0FFFFFFFFH, R3
00000067 6602                    		MOV.L #00000000H, R2
                                 ;     106 {
                                 ;     107 	uint8_t i;
                                 ;     108 	uint32_t wordLen = strlen(szWord);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",108
00000069 7F80                    		SUNTIL.B
0000006B FB16FE                  		MOV.L #0FFFFFFFEH, R1
0000006E 4331                    		SUB R3, R1
00000070 A081                    		MOV.L R1, 08H[R0]
00000072                         L32:	; entry.split
                                 ;     109 	uint32_t suffixLen = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",109
00000072 3E0300                  		MOV.L #00000000H, 0CH[R0]
00000075                         L33:	; entry.split1
                                 ;     110 
                                 ;     111 	for(i = 0; i < MAX_EXT_AVAIL; i++)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",111
00000075 3C0700                  		MOV.B #00H, 07H[R0]
00000078 2Err                 B  		BRA L45
0000007A                         L34:	; bb
                                 ;     112 	{
                                 ;     113 		suffixLen = strlen(gaszFileExtensions[i]);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",113
0000007A FBE2rrrrrrrr            		MOV.L #__$gaszFileExtensions, R14
00000080 B189                    		MOVU.B 07H[R0], R1
00000082 FE61E1                  		MOV.L [R1,R14], R1
00000085 FB36FF                  		MOV.L #0FFFFFFFFH, R3
00000088 6602                    		MOV.L #00000000H, R2
0000008A 7F80                    		SUNTIL.B
0000008C FB16FE                  		MOV.L #0FFFFFFFEH, R1
0000008F 4331                    		SUB R3, R1
00000091 A089                    		MOV.L R1, 0CH[R0]
00000093                         L35:	; bb.split
                                 ;     114 		if(wordLen >= suffixLen && !memcmp(&szWord[wordLen - suffixLen], gaszFileExtensions[i], suffixLen))
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",114
00000093 A881                    		MOV.L 08H[R0], R1
00000095 06850103                		CMP 0CH[R0].L, R1
00000099 22rr                    		BGEU L37
0000009B 2Err                 B  		BRA L42
0000009D                         L36:	; bb13
                                 ;     115 		{
                                 ;     116 			return true;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",116
0000009D 3C0601                  		MOV.B #01H, 06H[R0]
000000A0 2Err                 B  		BRA L47
000000A2                         L37:	; bb19
000000A2 FBE2rrrrrrrr            		MOV.L #__$gaszFileExtensions, R14
000000A8 B189                    		MOVU.B 07H[R0], R1
000000AA FE61E2                  		MOV.L [R1,R14], R2
000000AD A88B                    		MOV.L 0CH[R0], R3
000000AF A881                    		MOV.L 08H[R0], R1
000000B1 4331                    		SUB R3, R1
000000B3 06890105                		ADD 14H[R0].L, R1
000000B7 05rrrrrr             A  		BSR _memcmp
000000BB 6101                    		CMP #00H, R1
000000BD 10                   S  		BEQ L39
000000BE                         L38:	; bb33
000000BE F80600                  		MOV.L #00000000H, [R0]
000000C1 08                   S  		BRA L40
000000C2                         L39:	; bb34
000000C2 F80601                  		MOV.L #00000001H, [R0]
000000C5                         L40:	; bb35
000000C5 EC01                    		MOV.L [R0], R1
000000C7 6101                    		CMP #00H, R1
000000C9 10                   S  		BEQ L42
000000CA                         L41:	; bb37
000000CA F80601                  		MOV.L #00000001H, [R0]
000000CD 08                   S  		BRA L43
000000CE                         L42:	; bb38
000000CE F80600                  		MOV.L #00000000H, [R0]
000000D1                         L43:	; bb39
000000D1 EC01                    		MOV.L [R0], R1
000000D3 6101                    		CMP #00H, R1
000000D5 21rr                    		BNE L36
000000D7                         L44:	; bb44
000000D7 B189                    		MOVU.B 07H[R0], R1
000000D9 6211                    		ADD #01H, R1
000000DB 8189                    		MOV.B R1, 07H[R0]
000000DD                         L45:	; bb47
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",111
000000DD B189                    		MOVU.B 07H[R0], R1
000000DF 6131                    		CMP #03H, R1
000000E1 29rr                    		BLT L34
000000E3                         L46:	; bb53
                                 ;     117 		}
                                 ;     118 	}
                                 ;     119 
                                 ;     120 	return false;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",120
000000E3 3C0600                  		MOV.B #00H, 06H[R0]
000000E6                         L47:	; bb55
000000E6 C5000613                		MOV.B 06H[R0], 13H[R0]
                                 ;     121 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",121
000000EA B489                    		MOVU.B 13H[R0], R1
000000EC 6706                    		RTSD #18H
000000EE                         __$sort_array:
                                 		.STACK	__$sort_array=280
                                 ;     122 
                                 ;     123 /**
                                 ;     124  * Sort array in ascending order.
                                 ;     125  * @param pbArray	Array to be sorted.
                                 ;     126  * @param iLen		Array length.
                                 ;     127  */
                                 ;     128 static void sort_array(char* pbArray, int iLen)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",128
000000EE 7200ECFE                		ADD #0FFFFFEECH, R0
000000F2 E70144                  		MOV.L R1, 0110H[R0]
000000F5 E70243                  		MOV.L R2, 010CH[R0]
                                 ;     129 {
                                 ;     130 	char tmp[MAX_PATH_LENGHT + 1];
                                 ;     131 	char* pbStrNxt;
                                 ;     132 	int j;
                                 ;     133 	int i;
                                 ;     134 
                                 ;     135 	/* Sorting array */
                                 ;     136 	for(i = 0; i < iLen; ++i)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",136
000000F8 F9064200                		MOV.L #00000000H, 0108H[R0]
000000FC 38rrrr               W  		BRA L58
000000FF                         L49:	; bb
                                 ;     137 	{
                                 ;     138 		/* Next element */
                                 ;     139 		pbStrNxt = pbArray + (MAX_PATH_LENGHT + 1);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",139
000000FF ED0144                  		MOV.L 0110H[R0], R1
00000102 72110001                		ADD #0100H, R1
00000106 E70140                  		MOV.L R1, 0100H[R0]
00000109                         L50:	; bb.split
                                 ;     140 		for(j = i + 1; j < iLen; ++j)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",140
00000109 ED0142                  		MOV.L 0108H[R0], R1
0000010C 6211                    		ADD #01H, R1
0000010E E70141                  		MOV.L R1, 0104H[R0]
00000111 2Err                 B  		BRA L56
00000113                         L51:	; bb12
00000113 FB36FF                  		MOV.L #0FFFFFFFFH, R3
                                 ;     141 		{
                                 ;     142 			/* Swap */
                                 ;     143 			if(strcmp(pbArray, pbStrNxt) > 0)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",143
00000116 ED0240                  		MOV.L 0100H[R0], R2
00000119 7F83                    		SCMPU
0000011B FCDBE2                  		SCGEU.L R14
0000011E FCDBF5                  		SCLEU.L R15
00000121 43FE                    		SUB R15, R14
00000123 610E                    		CMP #00H, R14
00000125 2Brr                    		BLE L55
00000127                         L52:	; bb13
00000127 7543FF                  		MOV.L #000000FFH, R3
                                 ;     144 			{
                                 ;     145 				strncpy(tmp, pbArray, MAX_PATH_LENGHT);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",145
0000012A ED0244                  		MOV.L 0110H[R0], R2
0000012D EF01                    		MOV.L R0, R1
0000012F 7F87                    		SMOVU
00000131 7201FF00                		ADD #0FFH, R0, R1
00000135 4331                    		SUB R3, R1
00000137 6602                    		MOV.L #00000000H, R2
00000139 7F88                    		SSTR.B
0000013B                         L53:	; bb13.split
0000013B 7543FF                  		MOV.L #000000FFH, R3
                                 ;     146 				strncpy(pbArray, pbStrNxt, MAX_PATH_LENGHT);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",146
0000013E ED0444                  		MOV.L 0110H[R0], R4
00000141 ED0240                  		MOV.L 0100H[R0], R2
00000144 EF41                    		MOV.L R4, R1
00000146 7F87                    		SMOVU
00000148 7244FF00                		ADD #0FFH, R4
0000014C EF41                    		MOV.L R4, R1
0000014E 4331                    		SUB R3, R1
00000150 6602                    		MOV.L #00000000H, R2
00000152 7F88                    		SSTR.B
00000154                         L54:	; bb13.split1
                                 ;     147 				strncpy(pbStrNxt, tmp, MAX_PATH_LENGHT);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",147
00000154 ED0440                  		MOV.L 0100H[R0], R4
00000157 7543FF                  		MOV.L #000000FFH, R3
0000015A EF02                    		MOV.L R0, R2
0000015C EF41                    		MOV.L R4, R1
0000015E 7F87                    		SMOVU
00000160 7244FF00                		ADD #0FFH, R4
00000164 EF41                    		MOV.L R4, R1
00000166 4331                    		SUB R3, R1
00000168 6602                    		MOV.L #00000000H, R2
0000016A 7F88                    		SSTR.B
0000016C                         L55:	; bb25
                                 ;     148 			}
                                 ;     149 
                                 ;     150 			pbStrNxt += MAX_PATH_LENGHT + 1;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",150
0000016C ED0140                  		MOV.L 0100H[R0], R1
0000016F 72110001                		ADD #0100H, R1
00000173 E70140                  		MOV.L R1, 0100H[R0]
00000176 ED0141                  		MOV.L 0104H[R0], R1
00000179 6211                    		ADD #01H, R1
0000017B E70141                  		MOV.L R1, 0104H[R0]
0000017E                         L56:	; bb30
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",140
0000017E ED0141                  		MOV.L 0104H[R0], R1
00000181 06850143                		CMP 010CH[R0].L, R1
00000185 ED0144                  		MOV.L 0110H[R0], R1
00000188 29rr                    		BLT L51
0000018A                         L57:	; bb36
                                 ;     151 		}
                                 ;     152 
                                 ;     153 		/* Next element */
                                 ;     154 		pbArray += MAX_PATH_LENGHT + 1;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",154
0000018A 72110001                		ADD #0100H, R1
0000018E E70144                  		MOV.L R1, 0110H[R0]
00000191 ED0142                  		MOV.L 0108H[R0], R1
00000194 6211                    		ADD #01H, R1
00000196 E70142                  		MOV.L R1, 0108H[R0]
00000199                         L58:	; bb41
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",136
00000199 ED0142                  		MOV.L 0108H[R0], R1
0000019C 06850143                		CMP 010CH[R0].L, R1
000001A0 28rr                  * 		BLT L49
         38rrrr                  
000001A5                         L59:	; return
                                 ;     155 	}
                                 ;     156 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",156
000001A5 6745                    		RTSD #0114H
000001A7                         __$chooseFile:
                                 		.STACK	__$chooseFile=6216
                                 ;     157 
                                 ;     158 DIR	 st_usb_dir;
                                 ;     159 FILINFO st_usb_finfo;
                                 ;     160 #if _USE_LFN
                                 ;     161 char Lfname[_MAX_LFN + 1];
                                 ;     162 #endif
                                 ;     163 /**
                                 ;     164  * Scan files in a given directory and returns the selection.
                                 ;     165  * If the selection is a directory, it does it recursively
                                 ;     166  *
                                 ;     167  * @return
                                 ;     168  */
                                 ;     169 static ut_fs_navigate chooseFile()
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",169
000001A7 7EA6                    		PUSH.L R6
000001A9 7200CCE7                		ADD #0FFFFE7CCH, R0
000001AD 7201E803                		ADD #03E8H, R0, R1
                                 ;     170 {
                                 ;     171 	FIL File;
                                 ;     172 	FRESULT eRes;
                                 ;     173 	ut_menu filesMenu;
                                 ;     174 	uint8_t i;
                                 ;     175 	spiffs_DIR sf_dir;
                                 ;     176 	struct spiffs_dirent e;
                                 ;     177 	struct spiffs_dirent *pe = &e;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",177
000001B1 EB010501                		MOV.L R1, 0414H[R0]
000001B5                         L61:	; entry.split
                                 ;     178 	s32_t err;
                                 ;     179 	void *temp = NULL;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",179
000001B5 FA06070100              		MOV.L #00000000H, 041CH[R0]
000001BA                         L62:	; entry.split1
                                 ;     180 	uint32_t remain;
                                 ;     181 
                                 ;     182 	char *fn;
                                 ;     183 	char aszFiles[MENU_MAX_ITEMS][MAX_PATH_LENGHT + 1];
                                 ;     184 
                                 ;     185 #if _USE_LFN
                                 ;     186 	st_usb_finfo.lfname = Lfname;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",186
000001BA FB12rrrrrrrr            		MOV.L #_st_usb_finfo, R1
000001C0 FB22rrrrrrrr            		MOV.L #_Lfname, R2
000001C6 A192                    		MOV.L R2, 18H[R1]
000001C8                         L63:	; entry.split2
                                 ;     187 	st_usb_finfo.lfsize = sizeof Lfname;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",187
000001C8 FBE2rrrrrrrr            		MOV.L #_st_usb_finfo, R14
000001CE F9EA070001              		MOV.L #00000100H, 1CH[R14]
000001D3                         L64:	; entry.split3
000001D3 FB3A0014                		MOV.L #00001400H, R3
000001D7 6602                    		MOV.L #00000000H, R2
000001D9 72012804                		ADD #0428H, R0, R1
                                 ;     188 #endif
                                 ;     189 	/* Clean */
                                 ;     190 	memset(aszFiles, 0, MENU_MAX_ITEMS * (MAX_PATH_LENGHT + 1));
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",190
000001DD 7F88                    		SSTR.B
000001DF                         L65:	; entry.split4
000001DF 72013402                		ADD #0234H, R0, R1
                                 ;     191 
                                 ;     192 	/* Initialize menu */
                                 ;     193 	ut_menu_init(&filesMenu);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",193
000001E3 05rrrrrr             A  		BSR _ut_menu_init
000001E7                         L66:	; entry.split5
                                 ;     194 	/* No header */
                                 ;     195 	filesMenu.title = gszFileMenuTitle;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",195
000001E7 FBE2rrrrrrrr            		MOV.L #__$gszFileMenuTitle, R14
000001ED E4E0F1                  		MOV.L [R14], 03C4H[R0]
000001F0                         L67:	; entry.split6
000001F0 FB3A0001                		MOV.L #00000100H, R3
000001F4 6602                    		MOV.L #00000000H, R2
                                 ;     196 //	filesMenu.boShowTitle = true;
                                 ;     197 //	filesMenu.maxItemsPerPage = MAX_ROW;
                                 ;     198 
                                 ;     199 	memset(gszCurFile,'\0',sizeof(gszCurFile));
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",199
000001F6 FB12rrrrrrrr            		MOV.L #_gszCurFile, R1
000001FC 7F88                    		SSTR.B
000001FE                         L68:	; entry.split7
000001FE FB2A0001                		MOV.L #00000100H, R2
                                 ;     200 	/* Open dir */
                                 ;     201 	f_getcwd (gszCurFile,sizeof(gszCurFile));
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",201
00000202 FB12rrrrrrrr            		MOV.L #_gszCurFile, R1
00000208 05rrrrrr             A  		BSR _f_getcwd
0000020C                         L69:	; entry.split8
                                 ;     202 	eRes = f_opendir(&st_usb_dir, gszCurFile);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",202
0000020C FB22rrrrrrrr            		MOV.L #_gszCurFile, R2
00000212 FB12rrrrrrrr            		MOV.L #_st_usb_dir, R1
00000218 05rrrrrr             A  		BSR _f_opendir
0000021C E7018C                  		MOV.L R1, 0230H[R0]
0000021F                         L70:	; entry.split9
                                 ;     203 	if(eRes == FR_OK)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",203
0000021F ED018C                  		MOV.L 0230H[R0], R1
00000222 6101                    		CMP #00H, R1
00000224 3Brrrr               W  		BNE L125
00000227                         L71:	; bb22
00000227 FB36FF                  		MOV.L #0FFFFFFFFH, R3
                                 ;     204 	{
                                 ;     205 		/* Check if it is on root */
                                 ;     206 		if(strcmp(gszCurFile,"/") != 0)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",206
0000022A FB22rrrrrrrr            		MOV.L #_L15, R2
00000230 FB12rrrrrrrr            		MOV.L #_gszCurFile, R1
00000236 7F83                    		SCMPU
00000238 FCDBE2                  		SCGEU.L R14
0000023B FCDBF5                  		SCLEU.L R15
0000023E 43FE                    		SUB R15, R14
00000240 610E                    		CMP #00H, R14
00000242 3Arrrr               W  		BEQ L87
00000245                         L72:	; bb23
                                 ;     207 		{
                                 ;     208 			sprintf(aszFiles[filesMenu.numItems++], "..");
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",208
00000245 5E0EE501                		MOVU.W 03CAH[R0], R14
00000249 71EF01                  		ADD #01H, R14, R15
0000024C DB0FE501                		MOV.W R15, 03CAH[R0]
00000250 6040                    		SUB #04H, R0
00000252 FBF2rrrrrrrr            		MOV.L #_L14, R15
00000258 E30F                    		MOV.L R15, [R0]
0000025A 6C8E                    		SHLL #08H, R14
0000025C 72012C04                		ADD #042CH, R0, R1
00000260 4BE1                    		ADD R14, R1
00000262 05rrrrrr             A  		BSR _sprintf
00000266 6240                    		ADD #04H, R0
00000268 38rrrr               W  		BRA L87
0000026B                         L73:	; bb45
0000026B FB12rrrrrrrr            		MOV.L #_st_usb_finfo, R1
00000271 B219                    		MOVU.B 09H[R1], R1
00000273 6101                    		CMP #00H, R1
00000275 18                   S  		BNE L75
00000276                         L74:	; bb50
00000276 3E0101                  		MOV.L #00000001H, 04H[R0]
00000279 08                   S  		BRA L76
0000027A                         L75:	; bb51
0000027A 3E0100                  		MOV.L #00000000H, 04H[R0]
0000027D                         L76:	; bb52
0000027D A809                    		MOV.L 04H[R0], R1
0000027F 6101                    		CMP #00H, R1
00000281 3Brrrr               W  		BNE L89
00000284                         L77:	; bb58
                                 ;     209 		}
                                 ;     210 		/* Populate menu */
                                 ;     211 		while(true)
                                 ;     212 		{
                                 ;     213 			eRes = f_readdir(&st_usb_dir, &st_usb_finfo);
                                 ;     214 			/* Check for end of dir */
                                 ;     215 			if(eRes != FR_OK || st_usb_finfo.fname[0] == 0) { break; }
                                 ;     216 			if(st_usb_finfo.fname[0] == '.') { continue; } /* Ignore dot entry */
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",216
00000284 FB12rrrrrrrr            		MOV.L #_st_usb_finfo, R1
0000028A B219                    		MOVU.B 09H[R1], R1
0000028C 75512E                  		CMP #2EH, R1
0000028F 3Arrrr               W  		BEQ L87
00000292                         L78:	; bb66
                                 ;     217 #if _USE_LFN
                                 ;     218             fn = *st_usb_finfo.lfname ? st_usb_finfo.lfname : st_usb_finfo.fname;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",218
00000292 FB12rrrrrrrr            		MOV.L #_st_usb_finfo, R1
00000298 A991                    		MOV.L 18H[R1], R1
0000029A 581E                    		MOVU.B [R1], R14
0000029C 610E                    		CMP #00H, R14
0000029E 20rr                    		BEQ L80
000002A0                         L79:	; bb72
000002A0 FBE2rrrrrrrr            		MOV.L #_st_usb_finfo, R14
000002A6 E1E006                  		MOV.L 18H[R14], [R0]
000002A9 2Err                 B  		BRA L81
000002AB                         L80:	; bb74
000002AB FB12rrrrrrrr            		MOV.L #_st_usb_finfo, R1
000002B1 6291                    		ADD #09H, R1
000002B3 E301                    		MOV.L R1, [R0]
000002B5                         L81:	; bb76
000002B5 EC01                    		MOV.L [R0], R1
000002B7 EB010901                		MOV.L R1, 0424H[R0]
                                 ;     219 			if(strstr(fn, "System")) { continue; }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",219
000002BB FB22rrrrrrrr            		MOV.L #_L16, R2
000002C1 05rrrrrr             A  		BSR _strstr
000002C5 6101                    		CMP #00H, R1
000002C7 21rr                    		BNE L87
000002C9                         L82:	; bb88
                                 ;     220 #else
                                 ;     221             fn = st_usb_finfo.fname;
                                 ;     222 			if(strstr(fn, "SYSTEM")) { continue; }
                                 ;     223 #endif
                                 ;     224 			/* Copy to menu */
                                 ;     225 			if(st_usb_finfo.fattrib & AM_DIR)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",225
000002C9 FBE2rrrrrrrr            		MOV.L #_st_usb_finfo, R14
000002CF F5E408                  		BTST #04H, 08H[R14].B
000002D2 20rr                    		BEQ L84
000002D4                         L83:	; bb89
                                 ;     226 			{
                                 ;     227 				sprintf(aszFiles[filesMenu.numItems], "/%.*s", MAX_PATH_LENGHT, fn);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",227
000002D4 EE010901                		MOV.L 0424H[R0], R1
000002D8 5E0EE501                		MOVU.W 03CAH[R0], R14
000002DC 60C0                    		SUB #0CH, R0
000002DE A081                    		MOV.L R1, 08H[R0]
000002E0 FBF2rrrrrrrr            		MOV.L #_L17, R15
000002E6 E30F                    		MOV.L R15, [R0]
000002E8 3E01FF                  		MOV.L #000000FFH, 04H[R0]
000002EB 6C8E                    		SHLL #08H, R14
000002ED 72013404                		ADD #0434H, R0, R1
000002F1 4BE1                    		ADD R14, R1
000002F3 05rrrrrr             A  		BSR _sprintf
000002F7 62C0                    		ADD #0CH, R0
000002F9 2Err                 B  		BRA L86
000002FB                         L84:	; bb99
                                 ;     228 			}
                                 ;     229 			else if(validExtension(fn))
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",229
000002FB EE010901                		MOV.L 0424H[R0], R1
000002FF 39rrrr               W  		BSR __$validExtension
00000302 6101                    		CMP #00H, R1
00000304 20rr                    		BEQ L87
00000306                         L85:	; bb100
                                 ;     230 			{
                                 ;     231 				sprintf(aszFiles[filesMenu.numItems], "%.*s", MAX_PATH_LENGHT, fn);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",231
00000306 EE010901                		MOV.L 0424H[R0], R1
0000030A 5E0EE501                		MOVU.W 03CAH[R0], R14
0000030E 60C0                    		SUB #0CH, R0
00000310 A081                    		MOV.L R1, 08H[R0]
00000312 FBF2rrrrrrrr            		MOV.L #_L18, R15
00000318 E30F                    		MOV.L R15, [R0]
0000031A 3E01FF                  		MOV.L #000000FFH, 04H[R0]
0000031D 6C8E                    		SHLL #08H, R14
0000031F 72013404                		ADD #0434H, R0, R1
00000323 4BE1                    		ADD R14, R1
00000325 05rrrrrr             A  		BSR _sprintf
00000329 62C0                    		ADD #0CH, R0
0000032B                         L86:	; bb125
                                 ;     232 			}
                                 ;     233 			else
                                 ;     234 			{
                                 ;     235 				/* Not a valid file */
                                 ;     236 				continue;
                                 ;     237 			}
                                 ;     238 
                                 ;     239 			if(++filesMenu.numItems == MENU_MAX_ITEMS) { break; }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",239
0000032B DE0EE501                		MOV.W 03CAH[R0], R14
0000032F 621E                    		ADD #01H, R14
00000331 DB0EE501                		MOV.W R14, 03CAH[R0]
00000335 5FEE                    		MOVU.W R14, R14
00000337 755E14                  		CMP #14H, R14
0000033A 20rr                    		BEQ L89
0000033C                         L87:	; bb138.split
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",213
0000033C FB22rrrrrrrr            		MOV.L #_st_usb_finfo, R2
00000342 FB12rrrrrrrr            		MOV.L #_st_usb_dir, R1
00000348 05rrrrrr             A  		BSR _f_readdir
0000034C E7018C                  		MOV.L R1, 0230H[R0]
0000034F                         L88:	; bb138.split10
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",215
0000034F ED018C                  		MOV.L 0230H[R0], R1
00000352 6101                    		CMP #00H, R1
00000354 3Brrrr               W  		BNE L74
00000357 38rrrr               W  		BRA L73
0000035A                         L89:	; bb140
                                 ;     240 		}
                                 ;     241 
                                 ;     242 		/* Sort */
                                 ;     243 		sort_array(aszFiles[0], filesMenu.numItems);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",243
0000035A 5E02E501                		MOVU.W 03CAH[R0], R2
0000035E 72012804                		ADD #0428H, R0, R1
00000362 39rrrr               W  		BSR __$sort_array
00000365                         L90:	; bb140.split
                                 ;     244 		/* Fill menu */
                                 ;     245 		for(i = 0; i < filesMenu.numItems; ++i)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",245
00000365 FA04DB0300              		MOV.B #00H, 03DBH[R0]
0000036A 2Err                 B  		BRA L92
0000036C                         L91:	; bb147
                                 ;     246 		{
                                 ;     247 			filesMenu.items[i].text = aszFiles[i];
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",247
0000036C 5A01DB03                		MOVU.B 03DBH[R0], R1
00000370 EF1E                    		MOV.L R1, R14
00000372 751E14                  		MUL #14H, R14
00000375 72023402                		ADD #0234H, R0, R2
00000379 4BE2                    		ADD R14, R2
0000037B 6C81                    		SHLL #08H, R1
0000037D 72032804                		ADD #0428H, R0, R3
00000381 4B13                    		ADD R1, R3
00000383 A0AB                    		MOV.L R3, 0CH[R2]
00000385 5A01DB03                		MOVU.B 03DBH[R0], R1
00000389 6211                    		ADD #01H, R1
0000038B CB01DB03                		MOV.B R1, 03DBH[R0]
0000038F                         L92:	; bb161
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",245
0000038F 5A01DB03                		MOVU.B 03DBH[R0], R1
00000393 06C601E501              		CMP 03CAH[R0].UW, R1
00000398 29rr                    		BLT L91
0000039A                         L93:	; bb171
0000039A FB26FF                  		MOV.L #0FFFFFFFFH, R2
0000039D 72013402                		ADD #0234H, R0, R1
                                 ;     248 		}
                                 ;     249 
                                 ;     250 		/* Show menu */
                                 ;     251 		if(ut_menu_browse(&filesMenu, portMAX_DELAY) >= 0)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",251
000003A1 05rrrrrr             A  		BSR _ut_menu_browse
000003A5 6101                    		CMP #00H, R1
000003A7 28rr                  * 		BLT L125
         38rrrr                  
000003AC                         L94:	; bb173
                                 ;     252 		{
                                 ;     253 			if(filesMenu.items[filesMenu.selectedItem].text[0] == '/')
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",253
000003AC 5E0EE401                		MOVU.W 03C8H[R0], R14
000003B0 751E14                  		MUL #14H, R14
000003B3 72013402                		ADD #0234H, R0, R1
000003B7 4BE1                    		ADD R14, R1
000003B9 A89C                    		MOV.L 0CH[R1], R4
000003BB 584E                    		MOVU.B [R4], R14
000003BD 755E2F                  		CMP #2FH, R14
000003C0 21rr                    		BNE L98
000003C2                         L95:	; bb174
000003C2 FB36FF                  		MOV.L #0FFFFFFFFH, R3
000003C5 6602                    		MOV.L #00000000H, R2
                                 ;     254 			{
                                 ;     255 
                                 ;     256 				/* Is a dir, recursively */
                                 ;     257 				strcat(gszCurFile, filesMenu.items[filesMenu.selectedItem].text);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",257
000003C7 FB12rrrrrrrr            		MOV.L #_gszCurFile, R1
000003CD 7F80                    		SUNTIL.B
000003CF 6011                    		SUB #01H, R1
000003D1 EF42                    		MOV.L R4, R2
000003D3 7F87                    		SMOVU
000003D5                         L96:	; bb174.split
                                 ;     258 				f_chdir(gszCurFile);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",258
000003D5 FB12rrrrrrrr            		MOV.L #_gszCurFile, R1
000003DB 05rrrrrr             A  		BSR _f_chdir
000003DF                         L97:	; bb174.split11
                                 ;     259 				return NAVIGATE_CONTINUE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",259
000003DF 3E0200                  		MOV.L #00000000H, 08H[R0]
000003E2 38rrrr               W  		BRA L129
000003E5                         L98:	; bb186
                                 ;     260 			}
                                 ;     261 			else if(filesMenu.items[filesMenu.selectedItem].text[0] == '.')
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",261
000003E5 584E                    		MOVU.B [R4], R14
000003E7 755E2E                  		CMP #2EH, R14
000003EA 21rr                    		BNE L101
000003EC                         L99:	; bb187
                                 ;     262 			{
                                 ;     263 				/* It should rise up a level */
                                 ;     264 				//char* last = ut_strrstr(gszCurFile, "/");
                                 ;     265 				//if(last != 0) *last = 0;
                                 ;     266 				f_chdir("..");
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",266
000003EC FB12rrrrrrrr            		MOV.L #_L14, R1
000003F2 05rrrrrr             A  		BSR _f_chdir
000003F6                         L100:	; bb187.split
                                 ;     267 				return NAVIGATE_CONTINUE;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",267
000003F6 3E0200                  		MOV.L #00000000H, 08H[R0]
000003F9 38rrrr               W  		BRA L129
000003FC                         L101:	; bb219
000003FC FB3A0001                		MOV.L #00000100H, R3
00000400 6602                    		MOV.L #00000000H, R2
                                 ;     268 			}
                                 ;     269 			memset(gszCurFile,'\0',sizeof(gszCurFile));
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",269
00000402 FB12rrrrrrrr            		MOV.L #_gszCurFile, R1
00000408 7F88                    		SSTR.B
0000040A                         L102:	; bb219.split
                                 ;     270 			/* Is a file - end of routine */
                                 ;     271 			strcat(gszCurFile, filesMenu.items[filesMenu.selectedItem].text);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",271
0000040A 5E0EE401                		MOVU.W 03C8H[R0], R14
0000040E 751E14                  		MUL #14H, R14
00000411 72013402                		ADD #0234H, R0, R1
00000415 4BE1                    		ADD R14, R1
00000417 A89C                    		MOV.L 0CH[R1], R4
00000419 FB36FF                  		MOV.L #0FFFFFFFFH, R3
0000041C 6602                    		MOV.L #00000000H, R2
0000041E FB12rrrrrrrr            		MOV.L #_gszCurFile, R1
00000424 7F80                    		SUNTIL.B
00000426 6011                    		SUB #01H, R1
00000428 EF42                    		MOV.L R4, R2
0000042A 7F87                    		SMOVU
0000042C                         L103:	; bb219.split12
0000042C 6613                    		MOV.L #00000001H, R3
                                 ;     272 
                                 ;     273 			f_open(&File,gszCurFile,FA_READ);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",273
0000042E FB22rrrrrrrr            		MOV.L #_gszCurFile, R2
00000434 71010C                  		ADD #0CH, R0, R1
00000437 05rrrrrr             A  		BSR _f_open
0000043B                         L104:	; bb219.split13
                                 ;     274 
                                 ;     275 			ut_lcd_output_warning("CARREGANDO...\n");
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",275
0000043B FB12rrrrrrrr            		MOV.L #_L19, R1
00000441 05rrrrrr             A  		BSR _ut_lcd_output_warning
00000445                         L105:	; bb219.split14
                                 ;     276 
                                 ;     277 			spiffs_file *fd = &uspiffs[0].f;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",277
00000445 FB12rrrrrrrr            		MOV.L #_uspiffs, R1
0000044B 711164                  		ADD #64H, R1
0000044E EB010A06                		MOV.L R1, 1828H[R0]
00000452                         L106:	; bb219.split15
                                 ;     278 			spiffs *fs = &uspiffs[0].gSPIFFS;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",278
00000452 FB12rrrrrrrr            		MOV.L #_uspiffs, R1
00000458 EB010B06                		MOV.L R1, 182CH[R0]
0000045C                         L107:	; bb219.split16
                                 ;     279 
                                 ;     280 			SPIFFS_opendir(fs, "/", &sf_dir);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",280
0000045C EE010B06                		MOV.L 182CH[R0], R1
00000460 7203DC03                		ADD #03DCH, R0, R3
00000464 FB22rrrrrrrr            		MOV.L #_L15, R2
0000046A 05rrrrrr             A  		BSR _SPIFFS_opendir
0000046E                         L108:	; bb219.split17
                                 ;     281 			pe = SPIFFS_readdir(&sf_dir, pe);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",281
0000046E EE020501                		MOV.L 0414H[R0], R2
00000472 7201DC03                		ADD #03DCH, R0, R1
00000476 05rrrrrr             A  		BSR _SPIFFS_readdir
0000047A EB010501                		MOV.L R1, 0414H[R0]
0000047E                         L109:	; bb219.split18
                                 ;     282 			*fd = SPIFFS_open_by_dirent(fs, pe, SPIFFS_RDWR, 0);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",282
0000047E EE020501                		MOV.L 0414H[R0], R2
00000482 EE010B06                		MOV.L 182CH[R0], R1
00000486 EE060A06                		MOV.L 1828H[R0], R6
0000048A 6604                    		MOV.L #00000000H, R4
0000048C 754318                  		MOV.L #00000018H, R3
0000048F 05rrrrrr             A  		BSR _SPIFFS_open_by_dirent
00000493 D361                    		MOV.W R1, [R6]
00000495                         L110:	; bb219.split19
                                 ;     283 			if(*fd != SPIFFS_ERR_IS_FREE)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",283
00000495 EE010A06                		MOV.L 1828H[R0], R1
00000499 DC1E                    		MOV.W [R1], R14
0000049B 760EE4D8                		CMP #0FFFFD8E4H, R14
0000049F 20rr                    		BEQ L112
000004A1                         L111:	; bb238
                                 ;     284 			{
                                 ;     285 				err = SPIFFS_fremove(fs, *fd);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",285
000004A1 EE010A06                		MOV.L 1828H[R0], R1
000004A5 DC12                    		MOV.W [R1], R2
000004A7 EE010B06                		MOV.L 182CH[R0], R1
000004AB 05rrrrrr             A  		BSR _SPIFFS_fremove
000004AF EB010601                		MOV.L R1, 0418H[R0]
000004B3                         L112:	; bb249
                                 ;     286 			}
                                 ;     287 			ut_strrstr(gszCurFile, "/");
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",287
000004B3 FB22rrrrrrrr            		MOV.L #_L15, R2
000004B9 FB12rrrrrrrr            		MOV.L #_gszCurFile, R1
000004BF 39rrrr               W  		BSR __$ut_strrstr
000004C2                         L113:	; bb249.split
                                 ;     288 			*fd = SPIFFS_open(fs, gszCurFile, SPIFFS_CREAT | SPIFFS_RDWR | SPIFFS_DIRECT, 0);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",288
000004C2 EE010B06                		MOV.L 182CH[R0], R1
000004C6 EE060A06                		MOV.L 1828H[R0], R6
000004CA 6604                    		MOV.L #00000000H, R4
000004CC 75433C                  		MOV.L #0000003CH, R3
000004CF FB22rrrrrrrr            		MOV.L #_gszCurFile, R2
000004D5 05rrrrrr             A  		BSR _SPIFFS_open
000004D9 D361                    		MOV.W R1, [R6]
000004DB                         L114:	; bb249.split20
000004DB FB1A0001                		MOV.L #00000100H, R1
                                 ;     289 
                                 ;     290 			temp = pvPortMalloc( FS_PAGE_SIZE );
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",290
000004DF 05rrrrrr             A  		BSR _pvPortMalloc
000004E3 EB010701                		MOV.L R1, 041CH[R0]
000004E7 2Err                 B  		BRA L117
000004E9                         L115:	; bb255
000004E9 72042004                		ADD #0420H, R0, R4
000004ED FB3A0001                		MOV.L #00000100H, R3
000004F1 71010C                  		ADD #0CH, R0, R1
                                 ;     291 			while(!f_eof(&File))
                                 ;     292 			{
                                 ;     293 				f_read(&File,temp,FS_PAGE_SIZE,(UINT *)&remain);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",293
000004F4 05rrrrrr             A  		BSR _f_read
000004F8                         L116:	; bb255.split
                                 ;     294 				err = SPIFFS_write(fs, *fd, (u8_t *)temp, remain);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",294
000004F8 EE010A06                		MOV.L 1828H[R0], R1
000004FC DC12                    		MOV.W [R1], R2
000004FE EE040801                		MOV.L 0420H[R0], R4
00000502 EE030701                		MOV.L 041CH[R0], R3
00000506 EE010B06                		MOV.L 182CH[R0], R1
0000050A 05rrrrrr             A  		BSR _SPIFFS_write
0000050E EB010601                		MOV.L R1, 0418H[R0]
00000512                         L117:	; bb264
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",291
00000512 A909                    		MOV.L 14H[R0], R1
00000514 06850106                		CMP 18H[R0].L, R1
00000518 18                   S  		BNE L119
00000519                         L118:	; bb271
00000519 3E0100                  		MOV.L #00000000H, 04H[R0]
0000051C 08                   S  		BRA L120
0000051D                         L119:	; bb272
0000051D 3E0101                  		MOV.L #00000001H, 04H[R0]
00000520                         L120:	; bb273
00000520 A809                    		MOV.L 04H[R0], R1
00000522 6101                    		CMP #00H, R1
00000524 EE020701                		MOV.L 041CH[R0], R2
00000528 21rr                    		BNE L115
0000052A                         L121:	; bb277
                                 ;     295 			}
                                 ;     296 
                                 ;     297 			vPortFree(temp);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",297
0000052A EF21                    		MOV.L R2, R1
0000052C 05rrrrrr             A  		BSR _vPortFree
00000530                         L122:	; bb277.split
00000530 71010C                  		ADD #0CH, R0, R1
                                 ;     298 			f_close(&File);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",298
00000533 05rrrrrr             A  		BSR _f_close
00000537                         L123:	; bb277.split21
                                 ;     299 		    SPIFFS_close(fs, *fd);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",299
00000537 EE010A06                		MOV.L 1828H[R0], R1
0000053B DC12                    		MOV.W [R1], R2
0000053D EE010B06                		MOV.L 182CH[R0], R1
00000541 05rrrrrr             A  		BSR _SPIFFS_close
00000545                         L124:	; bb277.split22
                                 ;     300 
                                 ;     301 		    return NAVIGATE_END;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",301
00000545 3E0201                  		MOV.L #00000001H, 08H[R0]
00000548 2Err                 B  		BRA L129
0000054A                         L125:	; bb295
                                 ;     302 		}
                                 ;     303 	}
                                 ;     304 	/* Operation was cancelled */
                                 ;     305 	gszCurFile[0] = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",305
0000054A FBE2rrrrrrrr            		MOV.L #_gszCurFile, R14
00000550 F8E400                  		MOV.B #00H, [R14]
00000553                         L126:	; bb295.split
                                 ;     306 	ut_lcd_output_warning("NENHUM ARQUIVO\n\
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",306
00000553 FB12rrrrrrrr            		MOV.L #_L20, R1
00000559 05rrrrrr             A  		BSR _ut_lcd_output_warning
0000055D                         L127:	; bb295.split23
0000055D FB1AE803                		MOV.L #000003E8H, R1
                                 ;     307 						   DE CORTE\nENCONTRADO\n");
                                 ;     308 
                                 ;     309 	vTaskDelay(1000 / portTICK_PERIOD_MS);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",309
00000561 05rrrrrr             A  		BSR _vTaskDelay
00000565                         L128:	; bb295.split24
                                 ;     310 	return NAVIGATE_CANCELLED;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",310
00000565 F90602FF                		MOV.L #0FFFFFFFFH, 08H[R0]
00000569                         L129:	; bb297
00000569 A881                    		MOV.L 08H[R0], R1
0000056B EB010C06                		MOV.L R1, 1830H[R0]
                                 ;     311 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",311
0000056F 72003418                		ADD #1834H, R0
00000573 7EB6                    		POP R6
00000575 02                      		RTS
00000576                         _ut_state_choose_file:
                                 		.STACK	_ut_state_choose_file=20
                                 ;     312 
                                 ;     313 // ***********************************************************************
                                 ;     314 // Public functions
                                 ;     315 // ***********************************************************************
                                 ;     316 
                                 ;     317 /**
                                 ;     318  * Choose G file from USB.
                                 ;     319  * @param pContext
                                 ;     320  * @return
                                 ;     321  */
                                 ;     322 ut_state ut_state_choose_file(ut_context* pContext)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",322
00000576 7100F0                  		ADD #0FFFFFFF0H, R0
00000579 A089                    		MOV.L R1, 0CH[R0]
0000057B FB3A0001                		MOV.L #00000100H, R3
0000057F 6602                    		MOV.L #00000000H, R2
                                 ;     323 {
                                 ;     324 	usb_err_t res;
                                 ;     325 	/* Root dir */
                                 ;     326 	memset(gszCurFile, 0, sizeof(gszCurFile));
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",326
00000581 FB12rrrrrrrr            		MOV.L #_gszCurFile, R1
00000587 7F88                    		SSTR.B
00000589                         L131:	; entry.split
                                 ;     327 	strcpy(gszCurFile, USB_ROOT);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",327
00000589 FBE2rrrrrrrr            		MOV.L #_gszCurFile, R14
0000058F FBF2rrrrrrrr            		MOV.L #_L21, R15
00000595 C0FE                    		MOV.B [R15], [R14]
00000597                         L132:	; entry.split1
                                 ;     328 //	res = R_USB_Open( (usb_ip_t)msc_utr.ip );
                                 ;     329 //	vTaskDelay(600 / portTICK_PERIOD_MS);
                                 ;     330 
                                 ;     331 	/* Check if usb is mounted */
                                 ;     332 	if (drivemountFlag)
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",332
00000597 FBE2rrrrrrrr            		MOV.L #_drivemountFlag, R14
0000059D 58EE                    		MOVU.B [R14], R14
0000059F 610E                    		CMP #00H, R14
000005A1 20rr                    		BEQ L140
000005A3                         L133:	; bb4
                                 ;     333   //  if( xSemaphoreTake( xUsbMount, 100 / portTICK_PERIOD_MS ) == pdTRUE )
                                 ;     334 	{
                                 ;     335 	/* Check if usb is mounted */
                                 ;     336 		f_opendir(&st_usb_dir, USB_ROOT);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",336
000005A3 FB22rrrrrrrr            		MOV.L #_L21, R2
000005A9 FB12rrrrrrrr            		MOV.L #_st_usb_dir, R1
000005AF 05rrrrrr             A  		BSR _f_opendir
000005B3                         L134:	; bb4.split
                                 ;     337 		f_chdir("/");
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",337
000005B3 FB12rrrrrrrr            		MOV.L #_L15, R1
000005B9 05rrrrrr             A  		BSR _f_chdir
000005BD                         L135:	; bb4.split2
                                 ;     338 	}
                                 ;     339 	else
                                 ;     340 	{
                                 ;     341 //	    R_USB_Close( (usb_ip_t)msc_utr.ip );
                                 ;     342 //	    R_usb_hmsc_Release((usb_ip_t)msc_utr.ip );
                                 ;     343 //		UsbTaskDelete();
                                 ;     344 		ut_lcd_output_warning("NENHUM USB\n\
                                 ;     345 							   ENCONTRADO\n");
                                 ;     346 
                                 ;     347 		vTaskDelay(1000 / portTICK_PERIOD_MS);
                                 ;     348 
                                 ;     349 		return STATE_MAIN_MENU;
                                 ;     350 	}
                                 ;     351 
                                 ;     352 	choosedLine = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",352
000005BD FBE2rrrrrrrr            		MOV.L #_choosedLine, R14
000005C3 F8E600                  		MOV.L #00000000H, [R14]
000005C6                         L136:	; bb4.split3
                                 ;     353 	choosedLinePosition = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",353
000005C6 FBE2rrrrrrrr            		MOV.L #_choosedLinePosition, R14
000005CC F8E600                  		MOV.L #00000000H, [R14]
000005CF                         L137:	; bb4.split4
                                 ;     354 	currentLineSel = 0;
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",354
000005CF FBE2rrrrrrrr            		MOV.L #_currentLineSel, R14
000005D5 F8E600                  		MOV.L #00000000H, [R14]
000005D8                         L138:	; bb4.split5
                                 ;     355 	/* Fat is mounted */
                                 ;     356 	ut_lcd_clear();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",356
000005D8 05rrrrrr             A  		BSR _ut_lcd_clear
000005DC                         L139:	; bb4.split6
                                 ;     357 
                                 ;     358 	/* Read */
                                 ;     359 	ut_lcd_output();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",359
000005DC 05rrrrrr             A  		BSR _ut_lcd_output
000005E0 2Err                 B  		BRA L143
000005E2                         L140:	; bb7
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",344
000005E2 FB12rrrrrrrr            		MOV.L #_L22, R1
000005E8 05rrrrrr             A  		BSR _ut_lcd_output_warning
000005EC                         L141:	; bb7.split
000005EC FB1AE803                		MOV.L #000003E8H, R1
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",347
000005F0 05rrrrrr             A  		BSR _vTaskDelay
000005F4                         L142:	; bb7.split7
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",349
000005F4 F80602                  		MOV.L #00000002H, [R0]
000005F7 2Err                 B  		BRA L147
000005F9                         L143:	; bb14
000005F9 66A1                    		MOV.L #0000000AH, R1
                                 ;     360 
                                 ;     361 	/* Try to selected a file */
                                 ;     362 	ut_fs_navigate eErr;
                                 ;     363 	do
                                 ;     364 	{
                                 ;     365 		/* Just a delay */
                                 ;     366 		vTaskDelay(10 / portTICK_PERIOD_MS);
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",366
000005FB 05rrrrrr             A  		BSR _vTaskDelay
000005FF                         L144:	; bb14.split
                                 ;     367 		/* Navigate through folders */
                                 ;     368 		eErr = chooseFile();
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",368
000005FF 39rrrr               W  		BSR __$chooseFile
00000602 A009                    		MOV.L R1, 04H[R0]
00000604                         L145:	; bb14.split8
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",363
00000604 A809                    		MOV.L 04H[R0], R1
00000606 6101                    		CMP #00H, R1
00000608 20rr                    		BEQ L143
0000060A                         L146:	; bb20
                                 ;     369 	} while(eErr == NAVIGATE_CONTINUE);
                                 ;     370  //   R_USB_Close( (usb_ip_t)msc_utr.ip );
                                 ;     371 //    R_usb_hmsc_Release((usb_ip_t)msc_utr.ip );
                                 ;     372 //	UsbTaskDelete();
                                 ;     373 	/* Go back to menu */
                                 ;     374 	return pContext->value[0];
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",374
0000060A A889                    		MOV.L 0CH[R0], R1
0000060C B091                    		MOVU.B 02H[R1], R1
0000060E E301                    		MOV.L R1, [R0]
00000610                         L147:	; bb28
00000610 EC01                    		MOV.L [R0], R1
00000612 A081                    		MOV.L R1, 08H[R0]
                                 ;     375 }
                                 		.LINE  "C:\Workspace\e2studio\git\MT01\src\states\ut_state_choose_file.c",375
00000614 6704                    		RTSD #10H
                                 		.SECTION	L,ROMDATA,ALIGN=4
00000000                         _L10:
00000000 2E67                    		.byte	".g"
00000002 00                      		.byte	00H
00000003                         _L11:
00000003 2E746170                		.byte	".tap"
00000007 00                      		.byte	00H
00000008                         _L12:
00000008 2E6E63                  		.byte	".nc"
0000000B 00                      		.byte	00H
0000000C                         _L13:
0000000C 4553434F                		.byte	"ESCOLHA UM ARQUIVO"
         4C484120                
         554D2041                
         52515549                
         564F                    
0000001E 00                      		.byte	00H
0000001F                         _L14:
0000001F 2E2E                    		.byte	".."
00000021 00                      		.byte	00H
00000022                         _L15:
00000022 2F                      		.byte	"/"
00000023 00                      		.byte	00H
00000024                         _L16:
00000024 53797374                		.byte	"System"
         656D                    
0000002A 00                      		.byte	00H
0000002B                         _L17:
0000002B 2F252E2A                		.byte	"/%.*s"
         73                      
00000030 00                      		.byte	00H
00000031                         _L18:
00000031 252E2A73                		.byte	"%.*s"
00000035 00                      		.byte	00H
00000036                         _L19:
00000036 43415252                		.byte	"CARREGANDO..."
         4547414E                
         444F2E2E                
         2E                      
00000043 0A00                    		.byte	0AH,00H
00000045                         _L20:
00000045 4E454E48                		.byte	"NENHUM ARQUIVO"
         554D2041                
         52515549                
         564F                    
00000053 0A090909                		.byte	0AH,09H,09H,09H,09H,09H,09H
         090909                  
0000005A 20202044                		.byte	"   DE CORTE"
         4520434F                
         525445                  
00000065 0A                      		.byte	0AH
00000066 454E434F                		.byte	"ENCONTRADO"
         4E545241                
         444F                    
00000070 0A00                    		.byte	0AH,00H
00000072                         _L21:
00000072 00                      		.byte	0
00000073                         _L22:
00000073 4E454E48                		.byte	"NENHUM USB"
         554D2055                
         5342                    
0000007D 0A090909                		.byte	0AH,09H,09H,09H,09H,09H,09H,09H
         09090909                
00000085 20202045                		.byte	"   ENCONTRADO"
         4E434F4E                
         54524144                
         4F                      
00000092 0A00                    		.byte	0AH,00H
                                 		.SECTION	D,ROMDATA,ALIGN=4
00000000                         __$gaszFileExtensions:
00000000 rrrrrrrr                		.lword	_L10
00000004 rrrrrrrr                		.lword	_L11
00000008 rrrrrrrr                		.lword	_L12
0000000C                         __$gszFileMenuTitle:
0000000C rrrrrrrr                		.lword	_L13
                                 		.SECTION	B,DATA,ALIGN=4
00000000                         _st_usb_fatfs:
00000000(00000234H)              		.blkl	141
00000234                         _st_usb_dir:
00000234(00000024H)              		.blkl	9
00000258                         _g_fs_cur_header:
00000258(00000004H)              		.blkl	1
0000025C                         _g_fs_next_header:
0000025C(00000030H)              		.blkl	12
0000028C                         _st_usb_finfo:
0000028C(00000020H)              		.blkl	8
                                 		.SECTION	B_1,DATA
00000000                         _gszCurFile:
00000000(00000100H)              		.blkb	256
00000100                         _buff:
00000100(00000100H)              		.blkb	256
00000200                         _Lfname:
00000200(00000100H)              		.blkb	256
                                 		.END

Information List

TOTAL ERROR(S)    00000
TOTAL WARNING(S)  00000
TOTAL LINE(S)     01256   LINES

Section List

Attr         Size               Name
CODE     0000001558(00000616H)  P
ROMDATA  0000000148(00000094H)  L
ROMDATA  0000000016(00000010H)  D
DATA     0000000684(000002ACH)  B
DATA     0000000768(00000300H)  B_1

Cpu Type

-ISA=RXV1 -FPU

Command Parameter

-subcommand=C:\Users\LAFONS~1\AppData\Local\Temp\$ccrx99\$ccrx\ut_state_choose_file.src.cmd
    -nologo
    -isa=rxv1
    -fpu
    -show=conditionals,definitions,expansions
    -define=__RXV1=1
    -fint_register=0
    -debug
    -endian=little
-listfile=C:\Workspace\e2studio\git\MT01\Mobile_build\ut_state_choose_file.lst
-output=C:\Workspace\e2studio\git\MT01\Mobile_build\src\states\ut_state_choose_file.obj
